# CONCAT OUTPUT
# Root: C:\Users\Francois\source\repos\LoGeCui\LoGeCuiMobile
# Files: 62


================================================================================
FILE: App.xaml
================================================================================

Ôªø<?xml version = "1.0" encoding = "UTF-8" ?>
<Application xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:LoGeCuiMobile"
             x:Class="LoGeCuiMobile.App">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Colors.xaml" />
                <ResourceDictionary Source="Resources/Styles/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
        </ResourceDictionary>
    </Application.Resources>
</Application>

================================================================================
FILE: App.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Extensions.Configuration;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Storage;
using System;
using System.Globalization;
using System.IO;
using System.Threading.Tasks;
using LoGeCuiMobile.Services.Local;

namespace LoGeCuiMobile
{
    public partial class App : Application
    {
        public RecetteIngredientsService? RecetteIngredientsService { get; private set; }

        public SupabaseService? Supabase { get; private set; }
        public SupabaseRestClient? RestClient { get; private set; }

        public RecipesService? RecipesService { get; private set; }
        public IngredientsService? IngredientsService { get; private set; }
        public ListeCoursesSupabaseService? ListeCoursesSupabaseService { get; private set; }

        public static LocalDatabase LocalDb { get; private set; } = null!;

        public Guid? CurrentUserId { get; private set; }
        public string OcrApiKey { get; private set; } = "";

        public bool IsConnected =>
            CurrentUserId != null &&
            RestClient != null &&
            RecipesService != null &&
            IngredientsService != null &&
            ListeCoursesSupabaseService != null;

        private IConfigurationRoot? _config;

        public App()
        {
            InitializeComponent();

            // ‚úÖ Langue & th√®me avant l'UI
            ApplySavedLanguage();
            ApplySavedTheme();

            // ‚úÖ Local DB
            string dbPath = Path.Combine(FileSystem.AppDataDirectory, "logecui.db3");
            LocalDb = new LocalDatabase(dbPath);

            // ‚úÖ Init services de base (anon + OCR)
            InitBaseServices();

            // ‚úÖ Page par d√©faut : Login (avant auto-login)
            MainPage = RootPage.CreateLoginRoot();

            // ‚úÖ Init async (config + auto-login)
            _ = InitAsync();
        }

        // ------------------ JWT EXPIRED HANDLING ------------------

        public static bool IsJwtExpiredException(Exception ex)
        {
            // "JWT expired" est dans le message renvoy√© par PostgREST / Supabase
            return ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        public void HandleJwtExpired()
        {
            // Session expir√©e => on nettoie + retour login
            MainThread.BeginInvokeOnMainThread(async () =>
            {
                try
                {
                    await Current?.MainPage?.DisplayAlert(
                        "Session expir√©e",
                        "Ta session a expir√©. Merci de te reconnecter.",
                        "OK"
                    );
                }
                catch
                {
                    // pas bloquant
                }

                Logout(silent: true);
            });
        }

        // ------------------ UI SETTINGS ------------------

        private void ApplySavedLanguage()
        {
            try
            {
                var lang = Preferences.Get("app_language", "fr");
                var culture = new CultureInfo(lang);
                LocalizationResourceManager.Instance.SetCulture(culture);
            }
            catch
            {
                LocalizationResourceManager.Instance.SetCulture(new CultureInfo("fr"));
            }
        }

        private void ApplySavedTheme()
        {
            var theme = Preferences.Get("app_theme", "system");

            Current.UserAppTheme = theme switch
            {
                "light" => AppTheme.Light,
                "dark" => AppTheme.Dark,
                _ => AppTheme.Unspecified
            };
        }

        // ------------------ INIT SERVICES ------------------

        private void InitBaseServices()
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            Supabase = new SupabaseService(url, key);

            try
            {
                OcrApiKey = ConfigurationHelper.GetOcrApiKey();
                if (!string.IsNullOrWhiteSpace(OcrApiKey) && OcrApiKey.Length >= 5)
                    System.Diagnostics.Debug.WriteLine($"‚úÖ OCR Key charg√©e: {OcrApiKey.Substring(0, 5)}...");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå ERREUR OCR: {ex.Message}");
                OcrApiKey = "K86867725288957"; // ‚ö†Ô∏è debug only
            }
        }

        private async Task InitAsync()
        {
            try
            {
                await InitConfigurationAsync();
                await TryAutoLoginAsync();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå InitAsync: {ex}");
                ShowLogin();
            }
        }

        private async Task InitConfigurationAsync()
        {
            try
            {
                using var stream = await FileSystem.OpenAppPackageFileAsync("appsettings.json");
                var builder = new ConfigurationBuilder().AddJsonStream(stream);
                _config = builder.Build();
            }
            catch (Exception ex)
            {
                // ‚úÖ Ne pas crasher si appsettings absent
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è appsettings.json introuvable ou illisible: " + ex.Message);
                _config = null;
            }
        }

        // ------------------ AUTO LOGIN ------------------

        private async Task TryAutoLoginAsync()
        {
            var rememberMe = await SecureStorage.GetAsync("remember_me");
            if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
            {
                ShowLogin();
                return;
            }

            var accessToken = await SecureStorage.GetAsync("sb_access_token");
            var userId = await SecureStorage.GetAsync("sb_user_id");

            if (string.IsNullOrWhiteSpace(accessToken) || string.IsNullOrWhiteSpace(userId))
            {
                ShowLogin();
                return;
            }

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // Init services REST avec bearer
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet : si token expir√© -> logout propre
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            ShowAppShell();
        }

        public async void OnLoginSuccess(string accessToken, string userId)
        {
            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            InitRestServicesInternal(accessToken);

            // Optionnel: validation imm√©diate si internet
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            ShowAppShell();
        }

        private void InitRestServicesInternal(string accessToken)
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            RestClient = client;
            RecipesService = new RecipesService(client);
            IngredientsService = new IngredientsService(client);
            ListeCoursesSupabaseService = new ListeCoursesSupabaseService(client);
            RecetteIngredientsService = new RecetteIngredientsService(client);
        }

        // ‚úÖ Test simple qui provoque JWT expired si token mort
        private async Task<bool> ValidateSessionAsync()
        {
            try
            {
                if (RecipesService == null || CurrentUserId == null)
                    return false;

                // Petit appel l√©ger: si JWT expir√©, √ßa throw
                _ = await RecipesService.GetRecettesAsync(CurrentUserId.Value);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpiredException(ex))
                    return false;

                // Autre erreur r√©seau : on ne force pas logout
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è ValidateSessionAsync: " + ex.Message);
                return true;
            }
        }

        // ------------------ NAV ------------------

        public void ShowAppShell()
        {
            if (!IsConnected)
            {
                ShowLogin();
                return;
            }

            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = new AppShell();
            });
        }

        public void ShowLogin()
        {
            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = RootPage.CreateLoginRoot();
            });
        }

        // ------------------ LOGOUT ------------------

        public void Logout(bool silent = false)
        {
            SecureStorage.Remove("remember_me");
            SecureStorage.Remove("sb_access_token");
            SecureStorage.Remove("sb_user_id");

            Supabase?.ClearSession();
            CurrentUserId = null;

            RestClient = null;
            RecipesService = null;
            IngredientsService = null;
            ListeCoursesSupabaseService = null;
            RecetteIngredientsService = null;

            if (!silent)
                ShowLogin();
            else
                MainThread.BeginInvokeOnMainThread(() => MainPage = RootPage.CreateLoginRoot());
        }

        // ------------------ MISC ------------------

        public Task HandleDeepLinkAsync(Uri uri) => Task.CompletedTask;

        public void SetSupabase(SupabaseService supabase) => Supabase = supabase;
        public void SetCurrentUserId(Guid userId) => CurrentUserId = userId;

        public void InitRestServices(string accessToken)
        {
            InitRestServicesInternal(accessToken);
        }
    }
}

================================================================================
FILE: appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  },

  "OCR": {
    "ApiKey": "K86867725288957"
  }

}

================================================================================
FILE: AppShell.xaml
================================================================================

<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="LoGeCuiMobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:LoGeCuiMobile.Pages"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    FlyoutBehavior="Flyout">

    <FlyoutItem Title="{tr:Translate Nav_ShoppingList}" Route="liste-courses">
        <ShellContent Route="liste-courses"
                      ContentTemplate="{DataTemplate pages:ListeCoursesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Recipes}" Route="mes-recettes">
        <ShellContent Route="mes-recettes"
                      ContentTemplate="{DataTemplate pages:MesRecettesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_RandomMenu}" Route="menu-aleatoire">
        <ShellContent Route="menu-aleatoire"
                      ContentTemplate="{DataTemplate pages:MenuAleatoirePage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Ingredients}" Route="mes-ingredients">
        <ShellContent Route="mes-ingredients"
                      ContentTemplate="{DataTemplate pages:MesIngredientsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Settings}" Route="settings">
        <ShellContent Route="settings"
                      ContentTemplate="{DataTemplate pages:SettingsPage}" />
    </FlyoutItem>

</Shell>


================================================================================
FILE: AppShell.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile; // si ForgotPasswordPage est √† la racine du projet

namespace LoGeCuiMobile;

public partial class AppShell : Shell
{
    public AppShell()
    {
        InitializeComponent();

        Routing.RegisterRoute(nameof(ListeCoursesPage), typeof(ListeCoursesPage));
        Routing.RegisterRoute(nameof(ForgotPasswordPage), typeof(ForgotPasswordPage));
        Routing.RegisterRoute(nameof(AjouterIngredientPage), typeof(AjouterIngredientPage));
        Routing.RegisterRoute(nameof(AjouterRecettePage), typeof(AjouterRecettePage));
        Routing.RegisterRoute(nameof(MenuAleatoirePage), typeof(MenuAleatoirePage));

    }
}

================================================================================
FILE: ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using Microsoft.Maui.Storage;
using System;
using System.IO;

namespace LoGeCuiMobile
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;
        private static readonly object _lock = new();

        private static IConfiguration Configuration
        {
            get
            {
                if (_configuration != null)
                    return _configuration;

                lock (_lock)
                {
                    if (_configuration != null)
                        return _configuration;

                    try
                    {
                        // Lire le fichier depuis le package MAUI
                        using var streamTask = FileSystem.OpenAppPackageFileAsync("appsettings.json");
                        streamTask.Wait();
                        using var stream = streamTask.Result;

                        // Copie en m√©moire pour √©viter tout souci de stream non seekable / lecture partielle
                        using var ms = new MemoryStream();
                        stream.CopyTo(ms);
                        ms.Position = 0;

                        var builder = new ConfigurationBuilder()
                            .AddJsonStream(ms);

                        _configuration = builder.Build();

#if DEBUG
                        System.Diagnostics.Debug.WriteLine("[CONFIG] appsettings.json charg√©");
                        System.Diagnostics.Debug.WriteLine("[CONFIG] Supabase:Url=" + (_configuration["Supabase:Url"] ?? "<null>"));
                        System.Diagnostics.Debug.WriteLine("[CONFIG] OCR:ApiKey present=" + (!string.IsNullOrWhiteSpace(_configuration["OCR:ApiKey"])));
#endif

                        return _configuration;
                    }
                    catch (Exception ex)
                    {
                        throw new Exception(
                            "Impossible de charger appsettings.json depuis le package MAUI. " +
                            "V√©rifie qu'il est bien dans LoGeCuiMobile, Build Action = MauiAsset, et que tu as fait Clean/Rebuild. " +
                            $"D√©tail: {ex.Message}", ex);
                    }
                }
            }
        }


        // =========================
        // SUPABASE
        // =========================

        public static string GetSupabaseUrl()
            => Configuration["Supabase:Url"]
               ?? throw new Exception("Supabase:Url manquant dans appsettings.json");

        public static string GetSupabaseKey()
            => Configuration["Supabase:Key"]
               ?? throw new Exception("Supabase:Key manquant dans appsettings.json");

        // =========================
        // OCR
        // =========================

        public static string GetOcrApiKey()
        {
            var key = Configuration["OCR:ApiKey"];

            if (string.IsNullOrWhiteSpace(key))
                throw new Exception("OCR:ApiKey manquant dans appsettings.json");

            return key;
        }
    }
}





================================================================================
FILE: Converters\BoolToStrikethroughConverter.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Globalization;

namespace LoGeCuiMobile.Converters
{
    public class BoolToStrikethroughConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
            => (value is bool b && b) ? TextDecorations.Strikethrough : TextDecorations.None;

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
            => throw new NotImplementedException();
    }
}

================================================================================
FILE: Converters\QuantityFormatConverter.cs
================================================================================

Ôªøusing System;
using System.Globalization;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile.Converters
{
    public class QuantityFormatConverter : IMultiValueConverter
    {
        public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
        {
            var q = values.Length > 0 ? values[0]?.ToString() ?? "" : "";
            var u = values.Length > 1 ? values[1]?.ToString() ?? "" : "";

            var fmt = LocalizationResourceManager.Instance["Ingredients_QuantityFormat"];
            // Ex: "Quantit√© : {0} {1}" / "Menge: {0} {1}"
            return string.Format(fmt, q, u).Trim();
        }

        public object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture)
            => throw new NotSupportedException();
    }
}

================================================================================
FILE: ForgotPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="LoGeCuiMobile.ForgotPasswordPage"
    Title="Mot de passe oubli√©">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="Mot de passe oubli√©"
                   FontSize="20"
                   FontAttributes="Bold" />

            <Label Text="Entrez votre email pour recevoir un lien de r√©initialisation."
                   FontSize="14" />

            <Entry x:Name="EmailEntry"
                   Placeholder="Adresse email"
                   Keyboard="Email" />

            <Button x:Name="SendButton"
                    Text="Envoyer"
                    Clicked="OnSendClicked" />

            <Label x:Name="StatusLabel"
                   FontSize="13" />

            <Button Text="Retour"
                    Clicked="OnBackClicked" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: ForgotPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Graphics;
using System;

namespace LoGeCuiMobile
{
    // Optionnel : permet de pr√©-remplir l'email si tu navigues avec ?email=...
    [QueryProperty(nameof(PrefillEmail), "email")]
    public partial class ForgotPasswordPage : ContentPage
    {
        private readonly SupabaseService _supabaseService;

        // Valeur pass√©e via Shell : ?email=...
        public string PrefillEmail
        {
            set
            {
                // Evite crash si EmailEntry n'est pas encore pr√™t
                try
                {
                    var decoded = Uri.UnescapeDataString(value ?? "");
                    if (!string.IsNullOrWhiteSpace(decoded))
                        EmailEntry.Text = decoded;
                }
                catch { /* ignore */ }
            }
        }

        public ForgotPasswordPage()
        {
            InitializeComponent();

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            _supabaseService = new SupabaseService(url, key);

            StatusLabel.Text = "";
        }

        private async void OnSendClicked(object sender, EventArgs e)
        {
            try
            {
                // S√©curit√© si un contr√¥le est null (mauvais x:Name / x:Class)
                if (EmailEntry == null || SendButton == null || StatusLabel == null)
                {
                    await DisplayAlert("Erreur", "Interface non initialis√©e (XAML). V√©rifie x:Class et x:Name.", "OK");
                    return;
                }

                var email = (EmailEntry.Text ?? "").Trim();

                // ‚úÖ Validation obligatoire
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@") || !email.Contains("."))
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = "Veuillez saisir une adresse email valide.";
                    return;
                }

                SendButton.IsEnabled = false;
                StatusLabel.TextColor = Colors.Black;
                StatusLabel.Text = "Envoi en cours‚Ä¶";

                var result = await _supabaseService.SendPasswordResetAsync(email);

                if (result.success)
                {
                    StatusLabel.TextColor = Colors.Green;
                    StatusLabel.Text = "Email envoy√© ‚úÖ V√©rifiez votre bo√Æte mail (et les spams).";
                }
                else
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = result.error ?? "Impossible d'envoyer l'email.";
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ √©vite le crash et donne une erreur lisible
                StatusLabel.TextColor = Colors.Red;
                StatusLabel.Text = "Erreur : " + ex.Message;
            }
            finally
            {
                if (SendButton != null)
                    SendButton.IsEnabled = true;
            }
        }

        private async void OnBackClicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PopAsync();
            }
            catch
            {
                // au cas o√π
                await Shell.Current?.GoToAsync("..");
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFrameworks>net10.0-android;net10.0-ios;net10.0-maccatalyst</TargetFrameworks>
		<TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('windows'))">$(TargetFrameworks);net10.0-windows10.0.19041.0</TargetFrameworks>

		<!-- Note for MacCatalyst:
		The default runtime is maccatalyst-x64, except in Release config, in which case the default is maccatalyst-x64;maccatalyst-arm64.
		When specifying both architectures, use the plural <RuntimeIdentifiers> instead of the singular <RuntimeIdentifier>.
		The Mac App Store will NOT accept apps with ONLY maccatalyst-arm64 indicated;
		either BOTH runtimes must be indicated or ONLY macatalyst-x64. -->
		<!-- For example: <RuntimeIdentifiers>maccatalyst-x64;maccatalyst-arm64</RuntimeIdentifiers> -->

		<OutputType>Exe</OutputType>
		<RootNamespace>LoGeCuiMobile</RootNamespace>
		<UseMaui>true</UseMaui>
		<SingleProject>true</SingleProject>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>

		<!-- Display name -->
		<ApplicationTitle>LoGeCuiMobile</ApplicationTitle>

		<!-- App Identifier -->
		<ApplicationId>com.companyname.logecuimobile</ApplicationId>

		<!-- Versions -->
		<ApplicationDisplayVersion>2.0.0</ApplicationDisplayVersion>
		<ApplicationVersion>6</ApplicationVersion>

		<!-- To develop, package, and publish an app to the Microsoft Store, see: https://aka.ms/MauiTemplateUnpackaged -->
		<WindowsPackageType>None</WindowsPackageType>

		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">21.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</SupportedOSPlatformVersion>
		<TargetPlatformMinVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</TargetPlatformMinVersion>
		<AndroidSigningKeyStore>logecui.keystore</AndroidSigningKeyStore>
	</PropertyGroup>

	<PropertyGroup>
		<UserSecretsId>votre-guid-unique</UserSecretsId>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <EmbedAssembliesIntoApk>False</EmbedAssembliesIntoApk>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<ItemGroup>
		<!-- App Icon -->
		<MauiIcon Include="Resources\AppIcon\postriticone.png" />

		<!-- Splash Screen -->
		<MauiSplashScreen Include="Resources\Splash\postriticone.png" Color="#FFFFFF" BaseSize="128,128" />

		<!-- Images -->
		<MauiImage Include="Resources\Images\*" />
		<MauiImage Update="Resources\Images\dotnet_bot.png" Resize="True" BaseSize="300,185" />
		
		<!-- Custom Fonts -->
		<MauiFont Include="Resources\Fonts\*" />

		<!-- Raw Assets (also remove the "Resources\Raw" prefix) -->
		<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />
	</ItemGroup>

	<ItemGroup>
		<MauiAsset Include="appsettings.json">
		  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</MauiAsset>
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="CommunityToolkit.Maui" Version="14.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
		<PackageReference Include="Microsoft.Maui.Controls" Version="10.0.30" />
		<PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="10.0.2" />
		<PackageReference Include="SkiaSharp" Version="3.119.1" />
		<PackageReference Include="sqlite-net-pcl" Version="1.9.172" />
		<PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
	</ItemGroup>

	<ItemGroup>
	  <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <MauiXaml Update="ForgotPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="LoginPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterIngredientPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterRecettePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ListeCoursesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MenuAleatoirePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesIngredientsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesRecettesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ResetPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\SettingsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	</ItemGroup>

	<ItemGroup>
	  <Folder Include="Platforms\Android\Resources\Raw\" />
	</ItemGroup>

	<ItemGroup>
	  <Compile Update="Resources\Lang\AppResources.Designer.cs">
	    <DesignTime>True</DesignTime>
	    <AutoGen>True</AutoGen>
	    <DependentUpon>AppResources.resx</DependentUpon>
	  </Compile>
	</ItemGroup>

	<ItemGroup>
	  <EmbeddedResource Update="Resources\Lang\AppResources.resx">
	    <Generator>PublicResXFileCodeGenerator</Generator>
	    <LastGenOutput>AppResources.Designer.cs</LastGenOutput>
	  </EmbeddedResource>
	</ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiMobile.sln
================================================================================

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.5.2.0
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "LoGeCuiMobile", "LoGeCuiMobile.csproj", "{718860EB-0CC0-D204-6424-4B05AD96CB46}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {FE3EFD92-D10C-4693-8095-DE23E3011D74}
	EndGlobalSection
EndGlobal

================================================================================
FILE: LoginPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lang="clr-namespace:LoGeCuiMobile.Resources.Lang"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.LoginPage"
             Title="LoGeCui - Connexion"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="20" VerticalOptions="Center">

            

            <!-- Logo -->
            <Label Text="üõí LoGeCui"
                   FontSize="42"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                   Margin="0,10,0,30"/>

            <!-- üåç Choix de langue -->
            <Picker x:Name="LanguagePicker"
        Title="üåç Language"
        SelectedIndexChanged="LanguagePicker_SelectedIndexChanged">
                <Picker.Items>
                    <x:String>üá´üá∑ Fran√ßais</x:String>
                    <x:String>üá¨üáß English</x:String>
                    <x:String>üá©üá™ Deutsch</x:String>
                    <x:String>üá™üá∏ Espa√±ol</x:String>
                    <x:String>üáÆüáπ Italiano</x:String>
                    <x:String>üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</x:String>
                    <x:String>üáµüá± Polski</x:String>
                    <x:String>üáπüá∑ T√ºrk√ße</x:String>
                    <x:String>üá∑üá¥ Rom√¢nƒÉ</x:String>
                    <x:String>üá®üáø ƒåe≈°tina</x:String>
                    <x:String>üá∞üá∑ ÌïúÍµ≠Ïñ¥</x:String>
                    <x:String>üáØüáµ Êó•Êú¨Ë™û</x:String>
                    <x:String>üáπüá≠ ‡πÑ‡∏ó‡∏¢</x:String>
                    <x:String>üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</x:String>
                </Picker.Items>
            </Picker>

            <!-- Email -->
            <Label Text="{tr:Translate Email}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Entry x:Name="TxtEmail"
                   Placeholder="email@example.com"
                   Keyboard="Email"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <!-- Mot de passe -->
            <Label Text="{tr:Translate Password}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Grid ColumnDefinitions="*,Auto"
                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                  Padding="8">

                <Entry x:Name="TxtPassword"
                       Placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                       IsPassword="True"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                <Button Grid.Column="1"
                        Text="üëÅ"
                        BackgroundColor="Transparent"
                        Clicked="TogglePassword"/>
            </Grid>

            <!-- Rester connect√© -->
            <HorizontalStackLayout Spacing="10">
                <CheckBox x:Name="ChkRememberMe" Color="#27AE60"/>
                <Label Text="{tr:Translate StayConnected}"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            </HorizontalStackLayout>

            <!-- Connexion -->
            <Button x:Name="BtnConnexion"
                    Text="{tr:Translate LoginButton}"
                    BackgroundColor="#27AE60"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnConnexion_Clicked"/>

            <!-- Inscription -->
            <Button x:Name="BtnInscription"
                    Text="{tr:Translate SignupButton}"
                    BackgroundColor="#3498DB"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnInscription_Clicked"/>

            <!-- Message -->
            <Label x:Name="TxtMessage"
                   TextColor="Red"
                   HorizontalOptions="Center"
                   IsVisible="False"/>

            <!-- Mot de passe oubli√© -->
            <Button Text="{tr:Translate ForgotPassword}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light=Blue, Dark=#4DA3FF}"
                    Clicked="BtnForgotPassword_Clicked"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoginPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile; // ForgotPasswordPage / RootPage
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;
using System.Globalization;

namespace LoGeCuiMobile.Pages
{
    public partial class LoginPage : ContentPage
    {
        private readonly SupabaseService _supabase;
        private bool _isPasswordVisible = false;

        // Emp√™che SelectedIndexChanged pendant l'init
        private bool _isInitializingLanguage = false;

        public LoginPage()
        {
            InitializeComponent();

            _isInitializingLanguage = true;
            InitLanguagePickerSelection();
            _isInitializingLanguage = false;

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            _supabase = new SupabaseService(url, key);

            _ = LoadSavedUserAsync();
        }

        // =========================
        // LANGUE (Picker)
        // =========================
        private void LanguagePicker_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (_isInitializingLanguage)
                return;

            if (LanguagePicker.SelectedIndex < 0)
                return;

            var langCode = LanguagePicker.SelectedIndex switch
            {
                0 => "fr",
                1 => "en",
                2 => "de",
                3 => "es",
                4 => "it",
                5 => "ar",
                6 => "pl",
                7 => "tr",
                8 => "ro",
                9 => "cs",
                10 => "ko",
                11 => "ja",
                12 => "th",
                13 => "hi",
                _ => "fr"
            };

            var current = Preferences.Get("app_language", "fr");
            if (string.Equals(current, langCode, StringComparison.OrdinalIgnoreCase))
                return;

            Preferences.Set("app_language", langCode);

            var culture = new CultureInfo(langCode);

            // ‚úÖ Applique la culture + notifie l'UI (si tu utilises TranslateExtension)
            LocalizationResourceManager.Instance.SetCulture(culture);

            // ‚ö†Ô∏è Si ton XAML est encore en x:Static et que tu veux quand m√™me voir le changement,
            // d√©-commente ce bloc (mais √©vite de le faire pendant l'init) :
            // MainThread.BeginInvokeOnMainThread(() =>
            // {
            //     Application.Current.MainPage = RootPage.CreateLoginRoot();
            // });
        }

        private void InitLanguagePickerSelection()
        {
            var lang = Preferences.Get("app_language", "fr");

            var index = lang switch
            {
                "fr" => 0,
                "en" => 1,
                "de" => 2,
                "es" => 3,
                "it" => 4,
                "ar" => 5,
                "pl" => 6,
                "tr" => 7,
                "ro" => 8,
                "cs" => 9,
                "ko" => 10,
                "ja" => 11,
                "th" => 12,
                "hi" => 13,
                _ => 0
            };

            LanguagePicker.SelectedIndex = index;
        }

        // =========================
        // LOGIN
        // =========================
        private async void BtnConnexion_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.Connecting, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.ConnectionError, Colors.Red);
                    await DisplayAlert(AppResources.ErrorTitle, AppResources.BadPassword, "OK");
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);


                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async Task LoadSavedUserAsync()
        {
            try
            {
                var rememberMe = await SecureStorage.GetAsync("remember_me");
                if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
                    return;

                var email = await SecureStorage.GetAsync("user_email");
                if (!string.IsNullOrEmpty(email))
                {
                    TxtEmail.Text = email;
                    ChkRememberMe.IsChecked = true;
                }
            }
            catch
            {
                // ignore SecureStorage errors
            }
        }

        private async void BtnInscription_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.CreatingAccount, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignUpThenSignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.SignupError, Colors.Red);
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);
                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async void BtnForgotPassword_Clicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PushAsync(new ForgotPasswordPage());
            }
            catch (Exception ex)
            {
                await DisplayAlert(AppResources.ErrorTitle, ex.ToString(), "OK");
            }
        }

        private void TogglePassword(object sender, EventArgs e)
        {
            _isPasswordVisible = !_isPasswordVisible;

            TxtPassword.IsPassword = !_isPasswordVisible;

            if (sender is Button btn)
                btn.Text = _isPasswordVisible ? "üôà" : "üëÅ";

            if (!string.IsNullOrEmpty(TxtPassword.Text))
            {
                var t = TxtPassword.Text;
                TxtPassword.Text = string.Empty;
                TxtPassword.Text = t;
            }
        }

        private void SetStatus(string message, Color color)
        {
            TxtMessage.Text = message;
            TxtMessage.TextColor = color;
            TxtMessage.IsVisible = true;
        }
    }
}

================================================================================
FILE: MainPage.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LoGeCuiMobile.MainPage">

    <ScrollView>
        <VerticalStackLayout
            Padding="30,0"
            Spacing="25">
            <Image
                Source="dotnet_bot.png"
                HeightRequest="185"
                Aspect="AspectFit"
                SemanticProperties.Description="dot net bot in a submarine number ten" />

            <Label
                Text="Hello, World!"
                Style="{StaticResource Headline}"
                SemanticProperties.HeadingLevel="Level1" />

            <Label
                Text="Welcome to &#10;.NET Multi-platform App UI"
                Style="{StaticResource SubHeadline}"
                SemanticProperties.HeadingLevel="Level2"
                SemanticProperties.Description="Welcome to dot net Multi platform App U I" />

            <Button
                x:Name="CounterBtn"
                Text="Click me" 
                SemanticProperties.Hint="Counts the number of times you click"
                Clicked="OnCounterClicked"
                HorizontalOptions="Fill" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: MainPage.xaml.cs
================================================================================

Ôªønamespace LoGeCuiMobile
{
    public partial class MainPage : ContentPage
    {
        int count = 0;

        public MainPage()
        {
            InitializeComponent();
        }

        private void OnCounterClicked(object? sender, EventArgs e)
        {
            count++;

            if (count == 1)
                CounterBtn.Text = $"Clicked {count} time";
            else
                CounterBtn.Text = $"Clicked {count} times";

            SemanticScreenReader.Announce(CounterBtn.Text);
        }
    }
}

================================================================================
FILE: MauiProgram.cs
================================================================================

Ôªøusing System;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.Maui.Storage;
using CommunityToolkit.Maui;

namespace LoGeCuiMobile
{
    public static class MauiProgram
    {
        public static IConfiguration Configuration { get; private set; } = new ConfigurationBuilder().Build();

        public static MauiApp CreateMauiApp()
        {
            var builder = MauiApp.CreateBuilder();

            builder
            .UseMauiApp<App>()
            .UseMauiCommunityToolkit()   // üëà AJOUT ICI
            .ConfigureFonts(fonts =>
            {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
            });

#if DEBUG
            builder.Logging.AddDebug();
#endif

            // ‚úÖ Charge appsettings.json (MauiAsset) sans faire crasher l'app si absent
            try
            {
                using var stream = FileSystem.OpenAppPackageFileAsync("appsettings.json")
                                             .GetAwaiter()
                                             .GetResult();

                builder.Configuration.AddJsonStream(stream);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIG ERROR ==========");
                System.Diagnostics.Debug.WriteLine("Impossible de charger appsettings.json depuis le package MAUI.");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("==================================");
                // On continue volontairement pour √©viter le crash.
            }

            Configuration = builder.Configuration;

            // ‚úÖ IMPORTANT: on force le namespace exact (√©vite conflits)
            try
            {
                LoGeCuiShared.Services.ConfigurationHelper.Configure(key => Configuration[key]);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIGHELPER ERROR ==========");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("========================================");
                // On continue; l'erreur r√©elle ressortira quand une cl√© sera demand√©e.
            }

            return builder.Build();
        }
    }
}


================================================================================
FILE: Models\IngredientUI.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    public class IngredientUi : INotifyPropertyChanged
    {
        public Ingredient Model { get; }

        public IngredientUi(Ingredient model)
        {
            Model = model;
        }

        public System.Guid Id => Model.Id;
        public string Nom => Model.Nom ?? "";
        public string? Quantite => Model.Quantite;
        public string? Unite => Model.Unite;

        public bool EstDisponible
        {
            get => Model.EstDisponible;
            set
            {
                if (Model.EstDisponible == value) return;
                Model.EstDisponible = value;
                OnPropertyChanged();
            }
        }

        // ‚úÖ NOUVEAU : Favori (n√©cessite Model.EstFavori)
        public bool EstFavori
        {
            get => Model.EstFavori;
            set
            {
                if (Model.EstFavori == value) return;
                Model.EstFavori = value;
                OnPropertyChanged();
                OnPropertyChanged(nameof(HeartText));
            }
        }

        // ‚úÖ NOUVEAU : emoji coeur
        public string HeartText => EstFavori ? "‚ù§Ô∏è" : "ü§ç";

        bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                OnPropertyChanged();
            }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: Models\LanguageItem.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiMobile.Models
{
    internal class LanguageItem
    {
        public string Name { get; set; } = "";
        public string Code { get; set; } = "";
        public string Flag { get; set; } = ""; // emoji drapeau
    }
}

================================================================================
FILE: Pages\AjouterIngredientPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    x:Class="LoGeCuiMobile.Pages.AjouterIngredientPage"
    Title="{tr:Translate Ingredients_Add_Title}">

    <VerticalStackLayout Padding="20" Spacing="14">

        <Entry
            x:Name="NomEntry"
            Placeholder="{tr:Translate Ingredients_Add_NamePlaceholder}" />

        <Entry
            x:Name="QuantiteEntry"
            Placeholder="{tr:Translate Ingredients_Add_QuantityPlaceholder}"
            Keyboard="Numeric" />

        <Entry
            x:Name="UniteEntry"
            Placeholder="{tr:Translate Ingredients_Add_UnitPlaceholder}" />

        <HorizontalStackLayout Spacing="10">
            <CheckBox x:Name="DisponibleCheckBox" IsChecked="True"/>
            <Label Text="{tr:Translate Ingredients_Add_Available}"
                   VerticalTextAlignment="Center"/>
        </HorizontalStackLayout>

        <Button
            Text="{tr:Translate Ingredients_Add_Save}"
            BackgroundColor="#28a745"
            Clicked="OnSaveClicked"/>

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: Pages\AjouterIngredientPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.Pages;

public partial class AjouterIngredientPage : ContentPage
{
    public AjouterIngredientPage()
    {
        InitializeComponent();
    }

    private async void OnSaveClicked(object sender, EventArgs e)
    {
        try
        {
            if (string.IsNullOrWhiteSpace(NomEntry.Text))
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Ingredients_Add_NameRequired"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            var ingredient = new Ingredient
            {
                Nom = NomEntry.Text.Trim(),
                Quantite = QuantiteEntry.Text?.Trim() ?? "",
                Unite = UniteEntry.Text?.Trim() ?? "",
                EstDisponible = DisponibleCheckBox.IsChecked
            };

            // ‚úÖ 1) Toujours sauver dans le cache local (offline-first)
            await SaveIngredientToLocalCacheAsync(ingredient);

            // ‚úÖ 2) Si internet + connect√© => push Supabase
            var app = (App)Application.Current;

            var hasInternet = Connectivity.Current.NetworkAccess == NetworkAccess.Internet;

            if (hasInternet && app.IsConnected && app.IngredientsService != null && app.CurrentUserId != null)
            {
                await app.IngredientsService.CreateIngredientAsync(app.CurrentUserId.Value, ingredient);

            }

            // ‚úÖ Retour
            await Shell.Current.GoToAsync("..");
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private static async System.Threading.Tasks.Task SaveIngredientToLocalCacheAsync(Ingredient ingredient)
    {
        // R√©cup√®re cache local
        var local = await App.LocalDb.GetIngredientsAsync();
        var models = local.Select(x => x.ToModel()).ToList();

        // Evite doublon par Nom (tu peux adapter sur ExternalId si tu en as)
        bool exists = models.Any(x =>
            string.Equals(x.Nom?.Trim(), ingredient.Nom?.Trim(), StringComparison.OrdinalIgnoreCase));

        if (!exists)
            models.Add(ingredient);

        await App.LocalDb.SaveIngredientsAsync(models);
    }
}

================================================================================
FILE: Pages\AjouterRecettePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.AjouterRecettePage"
             Title="{tr:Translate Recipes_Add_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="{tr:Translate Recipes_Add_NameLabel}" />
            <Entry x:Name="NomEntry"
                   Placeholder="{tr:Translate Recipes_Add_NamePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_CategoryLabel}" />
            <Picker x:Name="CategoriePicker"
                    Title="{tr:Translate Recipes_Add_CategoryPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_TimeLabel}" />
            <Entry x:Name="TempsEntry"
                   Keyboard="Numeric"
                   Placeholder="{tr:Translate Recipes_Add_TimePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_IngredientsLabel}" />
            <Editor x:Name="IngredientsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="140"
                    Placeholder="{tr:Translate Recipes_Add_IngredientsPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_InstructionsLabel}" />
            <Editor x:Name="InstructionsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="180"
                    Placeholder="{tr:Translate Recipes_Add_InstructionsPlaceholder}" />

            <Button Text="{tr:Translate Recipes_Add_ScanOcr}"
                    Clicked="OnScanClicked" />

            <Button Text="{tr:Translate Recipes_Add_Save}"
                    Clicked="OnSaveClicked" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: Pages\AjouterRecettePage.xaml.cs
================================================================================

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.Services;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Media;

namespace LoGeCuiMobile.Pages
{
    public partial class AjouterRecettePage : ContentPage
    {
        private Recette? _editingRecette;

        public AjouterRecettePage(Recette? recette = null)
        {
            InitializeComponent();

            // Valeurs conformes ÔøΩ ta DB Supabase (Entree / Plat / Dessert)
            CategoriePicker.ItemsSource = new List<string> { "Entree", "Plat", "Dessert" };
            CategoriePicker.SelectedIndex = 1; // Plat par dÔøΩfaut

            _editingRecette = recette;

            if (_editingRecette != null)
            {
                Title = "Modifier recette";
                _ = LoadRecetteForEditAsync();
            }
            else
            {
                Title = "Ajouter recette";
            }
        }

        private async System.Threading.Tasks.Task LoadRecetteForEditAsync()
        {
            try
            {
                if (_editingRecette == null)
                    return;

                NomEntry.Text = _editingRecette.Nom;
                TempsEntry.Text = _editingRecette.TempsPreparation.ToString(CultureInfo.InvariantCulture);
                InstructionsEditor.Text = _editingRecette.Instructions ?? "";

                // CatÔøΩgorie
                var cat = string.IsNullOrWhiteSpace(_editingRecette.CategorieDb) ? "Plat" : _editingRecette.CategorieDb.Trim();
                if (CategoriePicker.ItemsSource is List<string> cats && cats.Contains(cat))
                    CategoriePicker.SelectedItem = cat;
                else
                    CategoriePicker.SelectedItem = "Plat";

                // Charger ingrÔøΩdients depuis Supabase
                var app = (App)Application.Current;
                if (app.RecetteIngredientsService != null && _editingRecette.Id != Guid.Empty)
                {
                    var items = await app.RecetteIngredientsService.GetForRecetteAsync(_editingRecette.Id);

                    // On remplit l'editor ingrÔøΩdients en "1 par ligne"
                    // NOTE: items = (nom, quantite, unite)
                    IngredientsEditor.Text = (items.Count == 0)
                        ? ""
                        : string.Join("\n", items.Select(x =>
                            string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                                ? x.nom
                                : $"{x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                        ));
                }
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    ex.Message,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        private async void OnSaveClicked(object sender, EventArgs e)
        {
            try
            {
                var app = (App)Application.Current;

                if (app.CurrentUserId == null || app.RecipesService == null)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_LoginRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                if (app.RecetteIngredientsService == null)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ServiceNotReady"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NameRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                var userId = app.CurrentUserId.Value;
                var categorie = (CategoriePicker.SelectedItem as string) ?? "Plat";
                int temps = int.TryParse(TempsEntry.Text, out var t) ? t : 0;

                // Mode ÔøΩdition => on reprend la recette, sinon crÔøΩation
                var recette = _editingRecette ?? new Recette();

                recette.Nom = NomEntry.Text.Trim();
                recette.CategorieDb = categorie;
                recette.TempsPreparation = temps;
                recette.Difficulte = 1;
                recette.Instructions = InstructionsEditor.Text ?? "";
                recette.IsFavorite = false;

                // ExternalId stable (requis pour lÔøΩupsert + rÔøΩcupÔøΩration d'id si besoin)
                if (string.IsNullOrWhiteSpace(recette.ExternalId))
                    recette.ExternalId = Guid.NewGuid().ToString("N");

                // 1) Upsert recette (table recettes)
                await app.RecipesService.UpsertRecetteAsync(userId, recette);

                // 2) Obtenir l'UUID DB (recette_id) pour recette_ingredients
                Guid recetteId;

                // Si on est en ÔøΩdition et qu'on a un Id valide, on l'utilise directement
                if (_editingRecette != null && _editingRecette.Id != Guid.Empty)
                {
                    recetteId = _editingRecette.Id;
                }
                else
                {
                    // Sinon fallback via ExternalId (fiable aprÔøΩs upsert)
                    var rid = await app.RecipesService.GetRecetteIdByExternalIdAsync(recette.ExternalId);
                    if (rid == null)
                    {
                        await DisplayAlert(
                            LocalizationResourceManager.Instance["ErrorTitle"],
                            LocalizationResourceManager.Instance["Recipes_Add_IdNotFound"],
                            LocalizationResourceManager.Instance["Dialog_Ok"]
                        );
                        return;
                    }

                    recetteId = rid.Value;
                }

                // 3) Parser les ingrÔøΩdients depuis l'ÔøΩditeur
                var items = ParseIngredientsEditor(IngredientsEditor.Text);

                // 4) ÔøΩcriture dans recette_ingredients (delete + insert)
                await app.RecetteIngredientsService.ReplaceForRecetteAsync(recetteId, items);

                await DisplayAlert(
                    LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_Saved"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );

                await Navigation.PopAsync();
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex.ToString());
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    ex.Message,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        // Transforme le texte du multi-line editor en liste (nom, quantite, unite)
        private static List<(string nom, string? quantite, string? unite)> ParseIngredientsEditor(string? text)
        {
            text ??= "";

            return text
                .Replace("\r\n", "\n")
                .Replace("\r", "\n")
                .Split('\n', StringSplitOptions.RemoveEmptyEntries)
                .Select(l => l.Trim())
                .Where(l => !string.IsNullOrWhiteSpace(l))
                .Select(ParseIngredientLine)
                .Where(x => !string.IsNullOrWhiteSpace(x.nom))
                .ToList();
        }

        // Supporte:
        // - "Tomate"
        // - "200 g Farine"
        // - "2 pcs Tomate"
        // - "Farine - 200 g"
        private static (string nom, string? quantite, string? unite) ParseIngredientLine(string line)
        {
            // "Nom - Quantite Unite"
            var dashSplit = line.Split(" - ", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
            if (dashSplit.Length >= 2)
            {
                var nomPart = dashSplit[0];
                var qtePart = dashSplit[1];

                var parts = qtePart.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                if (parts.Length >= 2)
                    return (nomPart, parts[0], string.Join(" ", parts.Skip(1)));

                return (nomPart, qtePart, null);
            }

            // "200 g Farine"
            var tokens = line.Split(' ', StringSplitOptions.RemoveEmptyEntries);
            if (tokens.Length >= 3 && char.IsDigit(tokens[0][0]))
            {
                var quantite = tokens[0];
                var unite = tokens[1];
                var nom = string.Join(" ", tokens.Skip(2));
                return (nom, quantite, unite);
            }

            // Sinon : juste le nom
            return (line, null, null);
        }

        private async void OnScanClicked(object sender, EventArgs e)
        {
            try
            {
                // Permission camÔøΩra (Android 6+)
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                // Capture supportÔøΩe ?
                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                var photo = await MediaPicker.Default.CapturePhotoAsync(new MediaPickerOptions
                {
                    Title = LocalizationResourceManager.Instance["Recipes_Add_ScanTitle"]
                });

                if (photo == null)
                    return;

                byte[] bytes;
                using (var stream = await photo.OpenReadAsync())
                using (var ms = new MemoryStream())
                {
                    await stream.CopyToAsync(ms);
                    bytes = ms.ToArray();
                }

                Debug.WriteLine($"Image originale: {bytes.Length / 1024} KB");

                // Compression pour rester sous la limite OCR.Space (souvent 1024 KB)
                bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1600, jpegQuality: 75);
                Debug.WriteLine($"Image compressÔøΩe: {bytes.Length / 1024} KB");

                // Si encore trop gros, on retente plus agressif automatiquement
                if (bytes.Length > 1024 * 1024)
                {
                    bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1200, jpegQuality: 65);
                    Debug.WriteLine($"Image recompressÔøΩe: {bytes.Length / 1024} KB");
                }

                if (bytes.Length > 1024 * 1024)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                // OCR
                var ocrKey = LoGeCuiShared.Services.ConfigurationHelper.GetOcrApiKey();
                var ocr = new OcrService(ocrKey);

                var fullText = await ocr.ExtractTextFromImageAsync(bytes, photo.FileName);

                if (string.IsNullOrWhiteSpace(fullText))
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["OcrTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NoTextDetected"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                fullText = NormalizeOcrText(fullText);

                var (ingredients, instructions) = SplitRecipeText(fullText);

                if (!string.IsNullOrWhiteSpace(instructions))
                    InstructionsEditor.Text = instructions.Trim();

                if (!string.IsNullOrWhiteSpace(ingredients))
                    IngredientsEditor.Text = ingredients.Trim();

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    var title = GuessTitle(fullText);
                    if (!string.IsNullOrWhiteSpace(title))
                        NomEntry.Text = title;
                }

                await DisplayAlert(
                    LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_OcrSuccess"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
            catch (Exception ex)
            {
                var msg = ex.Message ?? LocalizationResourceManager.Instance["UnknownError"];

                if (msg.Contains("File failed validation", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("maximum permissible file size", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("1024kb", StringComparison.OrdinalIgnoreCase))
                {
                    msg = LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"];
                }

                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    msg,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        private static string NormalizeOcrText(string s)
        {
            s = s.Replace("\r\n", "\n").Replace("\r", "\n");
            while (s.Contains("\n\n\n")) s = s.Replace("\n\n\n", "\n\n");
            return s.Trim();
        }

        private static (string ingredients, string instructions) SplitRecipeText(string text)
        {
            var lower = text.ToLowerInvariant();

            int idxIng = IndexOfAny(lower, "ingrÔøΩdients", "ingredients");
            int idxPrep = IndexOfAny(lower, "prÔøΩparation", "preparation", "instructions", "rÔøΩalisation", "realisation", "ÔøΩtapes", "etapes");

            if (idxIng >= 0 && idxPrep > idxIng)
            {
                var ingPart = text.Substring(idxIng, idxPrep - idxIng);
                var prepPart = text.Substring(idxPrep);

                ingPart = RemoveHeaderLine(ingPart);
                prepPart = RemoveHeaderLine(prepPart);

                return (CleanupListLike(ingPart), CleanupParagraph(prepPart));
            }

            if (idxPrep >= 0)
            {
                var before = text.Substring(0, idxPrep);
                var after = text.Substring(idxPrep);

                after = RemoveHeaderLine(after);
                return (CleanupListLike(before), CleanupParagraph(after));
            }

            var lines = text.Split('\n').Select(l => l.Trim()).Where(l => l.Length > 0).ToList();

            var ingLines = new List<string>();
            var instrLines = new List<string>();

            bool inInstructions = false;
            foreach (var line in lines)
            {
                if (!inInstructions && LooksLikeStep(line))
                    inInstructions = true;

                if (!inInstructions && LooksLikeIngredientLine(line))
                    ingLines.Add(line);
                else
                    instrLines.Add(line);
            }

            return (string.Join("\n", ingLines), string.Join("\n", instrLines));
        }

        private static int IndexOfAny(string haystack, params string[] needles)
        {
            int best = -1;
            foreach (var n in needles)
            {
                var i = haystack.IndexOf(n, StringComparison.OrdinalIgnoreCase);
                if (i >= 0 && (best < 0 || i < best)) best = i;
            }
            return best;
        }

        private static string RemoveHeaderLine(string block)
        {
            var lines = block.Replace("\r\n", "\n").Split('\n').ToList();
            if (lines.Count == 0) return block;
            lines.RemoveAt(0);
            return string.Join("\n", lines).Trim();
        }

        private static string CleanupListLike(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0)
                .Select(l => l.TrimStart('-', 'ÔøΩ', '*', 'ÔøΩ', 'ÔøΩ', 'ÔøΩ', ' '))
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static string CleanupParagraph(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static bool LooksLikeIngredientLine(string line)
        {
            if (line.StartsWith("-") || line.StartsWith("ÔøΩ") || line.StartsWith("*")) return true;

            var l = line.ToLowerInvariant();
            string[] units = { " g", "kg", " ml", "cl", " l", "cÔøΩs", "cas", "cÔøΩc", "cac", "cuillÔøΩre", "pincÔøΩe", "tranche", "sachet" };
            if (units.Any(u => l.Contains(u))) return true;

            if (char.IsDigit(line.FirstOrDefault())) return true;

            return false;
        }

        private static bool LooksLikeStep(string line)
        {
            var l = line.Trim();
            if (l.StartsWith("1)") || l.StartsWith("1.") ||
                l.StartsWith("ÔøΩtape", StringComparison.OrdinalIgnoreCase) ||
                l.StartsWith("Etape", StringComparison.OrdinalIgnoreCase))
                return true;

            if (l.Length >= 2 && char.IsDigit(l[0]) && (l[1] == ')' || l[1] == '.'))
                return true;

            return false;
        }

        private static string GuessTitle(string text)
        {
            var first = text.Split('\n').Select(l => l.Trim()).FirstOrDefault(l => l.Length > 0) ?? "";
            if (first.Length >= 3 && first.Length <= 50) return first;
            return "";
        }
    }
}

================================================================================
FILE: Pages\ListeCoursesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ListeCoursesPage"
             Title="{tr:Translate Shopping_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:BoolToStrikethroughConverter x:Key="BoolToStrikethroughConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Checkbox Tout s√©lectionner -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Label Grid.Row="0"
               Text="{tr:Translate Shopping_Header}"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10,0,10"/>

        <!-- Buttons -->
        <Grid Grid.Row="1" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Shopping_AddItem}"
                    BackgroundColor="#27AE60"
                    FontAttributes="Bold"
                    Clicked="BtnAjouter_Clicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelection"
                    Text="{tr:Translate Shopping_DeleteSelection}"
                    BackgroundColor="#E67E22"
                    FontAttributes="Bold"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="2"
                               Spacing="10"
                               Padding="4,6"
                               VerticalOptions="Center">
            <CheckBox x:Name="ChkToutSelectionner"
                      CheckedChanged="ChkToutSelectionner_CheckedChanged"/>
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray"/>
        </HorizontalStackLayout>

        <!-- Liste des courses -->
        <CollectionView Grid.Row="3"
                        x:Name="ListeCourses"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Shopping_Empty}"
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="6"
                           Padding="14"
                           BorderColor="#DDDDDD"
                           CornerRadius="12"
                           HasShadow="True"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}">

                        <VerticalStackLayout Spacing="8">

                            <!-- Nom -->
                            <Label Text="{Binding Nom}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextDecorations="{Binding EstAchete, Converter={StaticResource BoolToStrikethroughConverter}}"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                            <!-- Quantit√© -->
                            <Label FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Quantite}"/>
                                        <Span Text=" "/>
                                        <Span Text="{Binding Unite}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Actions -->
                            <HorizontalStackLayout Spacing="20">

                                <!-- Achet√© -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstAchete, Mode=TwoWay}"
                                              CheckedChanged="CheckBox_CheckedChanged"/>
                                    <Label Text="{tr:Translate Shopping_Bought}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                                <!-- S√©lection pour suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}"/>
                                    <Label Text="{tr:Translate Shopping_Delete}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: Pages\ListeCoursesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiMobile.Models;

namespace LoGeCuiMobile.Pages
{
    public partial class ListeCoursesPage : ContentPage
    {
        private readonly ObservableCollection<ArticleCourseUi> _articles = new();
        private readonly SupabaseService _supabase;

        // Emp√™che la checkbox "Tout s√©lectionner" de d√©clencher une s√©lection de masse
        // quand on la met √† jour depuis le code.
        private bool _suppressSelectAllEvent;

        public ListeCoursesPage()
        {
            InitializeComponent();

            _supabase = ((App)Application.Current).Supabase
                ?? throw new InvalidOperationException("Supabase non initialis√©.");

            // IMPORTANT : ne pas re-s'abonner ici si ton XAML a d√©j√† Clicked="BtnSupprimerSelection_Clicked"
            // BtnSupprimerSelection.Clicked += BtnSupprimerSelection_Clicked;  <-- SUPPRIM√â

            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private async void ChargerDonnees()
        {
            try
            {
                // 1Ô∏è‚É£ Charger depuis le cache local
                var local = await App.LocalDb.GetArticlesAsync();
                _articles.Clear();
                foreach (var a in local)
                    _articles.Add(new ArticleCourseUi(a.ToModel()));

                // 2Ô∏è‚É£ Si internet ‚Üí rafra√Æchir depuis Supabase
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var remote = await _supabase.GetArticlesAsync();

                    _articles.Clear();
                    foreach (var a in remote)
                        _articles.Add(new ArticleCourseUi(a));

                    // üîÑ Mettre √† jour le cache
                    await App.LocalDb.SaveArticlesAsync(remote);
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Chargement impossible : {ex.Message}", "OK");
            }
        }

        private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
        {
            var selected = _articles.Where(a => a.IsSelectedForDelete).ToList();

            if (selected.Count == 0)
            {
                await DisplayAlert("Information", "Aucun article s√©lectionn√©.", "OK");
                return;
            }

            bool confirm = await DisplayAlert(
                "Confirmation",
                $"Supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Oui",
                "Non");

            if (!confirm)
                return;

            try
            {
                foreach (var articleUi in selected)
                {
                    await _supabase.DeleteArticleAsync(articleUi.Id);
                    _articles.Remove(articleUi);
                }

                RefreshSelectAllCheckBox();

                await DisplayAlert("Succ√®s", $"{selected.Count} article(s) supprim√©(s).", "OK");
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Suppression impossible : {ex.Message}", "OK");
                ChargerDonnees();
            }
        }

        private async void CheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            // Checkbox "Achet√©"
            if (sender is not CheckBox checkbox) return;
            if (checkbox.BindingContext is not ArticleCourseUi articleUi) return;

            var article = articleUi.Model;

            checkbox.IsEnabled = false;
            var oldValue = !e.Value;

            try
            {
                await _supabase.UpdateArticleAsync(article.Id, article);
            }
            catch (Exception ex)
            {
                article.EstAchete = oldValue;
                checkbox.IsChecked = oldValue;

                await DisplayAlert("Erreur", $"Synchronisation √©chou√©e : {ex.Message}", "OK");
            }
            finally
            {
                checkbox.IsEnabled = true;
            }
        }

        // Checkbox "Tout s√©lectionner" (pour suppression)
        private void ChkToutSelectionner_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (_suppressSelectAllEvent) return;

            foreach (var a in _articles)
                a.IsSelectedForDelete = e.Value;

            // Optionnel : si tu veux d√©sactiver le bouton supprimer quand rien n'est coch√©,
            // il faudra √©couter les changements de IsSelectedForDelete (INotifyPropertyChanged).
            // Ici on se contente de garder la checkbox coh√©rente.
        }

        private void RefreshSelectAllCheckBox()
        {
            if (ChkToutSelectionner == null) return;

            _suppressSelectAllEvent = true;
            try
            {
                if (_articles.Count == 0)
                {
                    ChkToutSelectionner.IsEnabled = false;
                    ChkToutSelectionner.IsChecked = false;
                    return;
                }

                ChkToutSelectionner.IsEnabled = true;

                // MAUI CheckBox n'a pas de tri-state :
                // on met "checked" seulement si TOUT est s√©lectionn√©.
                bool allSelected = _articles.All(a => a.IsSelectedForDelete);
                ChkToutSelectionner.IsChecked = allSelected;
            }
            finally
            {
                _suppressSelectAllEvent = false;
            }
        }

        private async void BtnAjouter_Clicked(object sender, EventArgs e)
        {
            string nom = await DisplayPromptAsync("Ajouter", "Nom de l'article :");
            if (string.IsNullOrWhiteSpace(nom))
                return;

            string quantite = await DisplayPromptAsync("Ajouter", "Quantit√© :");
            if (string.IsNullOrWhiteSpace(quantite))
                return;

            string unite = await DisplayPromptAsync("Ajouter", "Unit√© (g, kg, L, pi√®ces...) :");
            if (string.IsNullOrWhiteSpace(unite))
                return;

            try
            {
                var app = (App)Application.Current;
                if (app.CurrentUserId == null)
                {
                    await DisplayAlert("Erreur", "Vous devez √™tre connect√©.", "OK");
                    return;
                }

                var article = new ArticleCourse
                {
                    UserId = app.CurrentUserId.Value,
                    Nom = nom,
                    Quantite = quantite,
                    Unite = unite,
                    EstAchete = false
                };

                var added = await _supabase.AddArticleAsync(article);
                if (added != null)
                {
                    _articles.Add(new ArticleCourseUi(added));

                    // Nouveau item => on met √† jour la checkbox "Tout s√©lectionner"
                    RefreshSelectAllCheckBox();

                    await DisplayAlert("Succ√®s", $"'{added.Nom}' ajout√© !", "OK");
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Impossible d'ajouter : {ex.Message}", "OK");
            }
        }
    }
}

================================================================================
FILE: Pages\MenuAleatoirePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.MenuAleatoirePage"
             Title="{tr:Translate RandomMenu_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Button
                Text="{tr:Translate RandomMenu_GenerateButton}"
                Clicked="OnMenuAleatoireClicked" />

            <Label
                x:Name="ResultLabel"
                Text="{tr:Translate RandomMenu_DefaultText}"
                FontSize="18"
                HorizontalTextAlignment="Center" />

            <!-- Bouton visible uniquement apr√®s g√©n√©ration si ingr√©dients manquants -->
            <Button x:Name="SendMissingButton"
                    Text="{tr:Translate RandomMenu_SendMissingToShopping}"
                    Clicked="OnSendMissingClicked"
                    HorizontalOptions="FillAndExpand"
                    IsVisible="False"
                    IsEnabled="False" />

            <Button
                Text="{tr:Translate RandomMenu_OpenShopping}"
                Clicked="OnOpenListeCoursesClicked"
                HorizontalOptions="FillAndExpand" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: Pages\MenuAleatoirePage.xaml.cs
================================================================================

Ôªøusing CommunityToolkit.Maui.Views;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace LoGeCuiMobile.Pages;

public partial class MenuAleatoirePage : ContentPage
{
    private static readonly Random _random = new();
    public record MenuOptionsResult(bool Entree, bool Plat, bool Dessert);


    private List<string> _lastMissing = new();
    private Guid? _lastUserId;
    private bool _lastIngredientsKnown = false;

    public MenuAleatoirePage()
    {
        InitializeComponent();

        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
    }

    // ------------------ UTIL ------------------

    private static string Norm(string s)
    {
        if (string.IsNullOrWhiteSpace(s))
            return "";

        var normalized = s.Trim().ToLowerInvariant().Normalize(NormalizationForm.FormD);
        var sb = new StringBuilder();

        foreach (var c in normalized)
            if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
                sb.Append(c);

        return sb.ToString();
    }

    private sealed class RecetteIngredientRow
    {
        public string? ingredient_nom { get; set; }
    }

    private async Task<List<string>> GetRecetteIngredientsAsync(App app, Guid recetteId)
    {
        if (app.RestClient == null)
            return new List<string>();

        // recette_ingredients(recette_id, ingredient_nom, quantite, unite)
        var q = $"recette_ingredients?select=ingredient_nom&recette_id=eq.{recetteId}";

        var rows = await app.RestClient.GetAsync<List<RecetteIngredientRow>>(q)
                   ?? new List<RecetteIngredientRow>();

        return rows
            .Select(r => r.ingredient_nom ?? "")
            .Select(s => s.Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private async Task<List<string>> GetUserIngredientsAsync(App app, Guid userId)
    {
        if (app.IngredientsService == null)
            return new List<string>();

        var rows = await app.IngredientsService.GetIngredientsAsync(userId)
                   ?? new List<Ingredient>();

        return rows
            .Where(i => i.EstDisponible)
            .Select(i => (i.Nom ?? "").Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private static Recette? PickRandom(List<Recette> list)
    {
        if (list == null || list.Count == 0) return null;
        return list[_random.Next(list.Count)];
    }

    // ------------------ EVENTS ------------------

    private async void OnMenuAleatoireClicked(object sender, EventArgs e)
    {
        try
        {
            // Choix initial : on d√©marre tout coch√©
            bool wantEntree = true;
            bool wantPlat = true;
            bool wantDessert = true;

            while (true)
            {
                string entreeTxt = wantEntree ? "‚úÖ Entr√©e" : "‚¨ú Entr√©e";
                string platTxt = wantPlat ? "‚úÖ Plat" : "‚¨ú Plat";
                string dessertTxt = wantDessert ? "‚úÖ Dessert" : "‚¨ú Dessert";

                var choice = await DisplayActionSheet(
                    "Choisis les cat√©gories",
                    "Annuler",
                    "G√©n√©rer",
                    entreeTxt,
                    platTxt,
                    dessertTxt
                );

                if (choice == "Annuler")
                    return;

                if (choice == "G√©n√©rer")
                {
                    if (!wantEntree && !wantPlat && !wantDessert)
                    {
                        await DisplayAlert("Info", "Coche au moins une cat√©gorie.", "OK");
                        continue;
                    }

                    var opts = new MenuOptionsResult(wantEntree, wantPlat, wantDessert);
                    await RunMenuAleatoireAsync(opts);
                    return;
                }

                if (choice == entreeTxt) wantEntree = !wantEntree;
                else if (choice == platTxt) wantPlat = !wantPlat;
                else if (choice == dessertTxt) wantDessert = !wantDessert;
            }
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }



    private async void OnOpenListeCoursesClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;
            if (app?.ListeCoursesSupabaseService == null)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["ServiceUnavailable"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            await Shell.Current.GoToAsync(nameof(ListeCoursesPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private async void OnSendMissingClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;

            if (app?.ListeCoursesSupabaseService == null || app.CurrentUserId == null)
                return;

            if (!_lastIngredientsKnown || _lastMissing.Count == 0)
                return;

            bool confirm = await DisplayAlert(
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmTitle"],
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmBody"] + "\n- " + string.Join("\n- ", _lastMissing),
                LocalizationResourceManager.Instance["Dialog_Yes"],
                LocalizationResourceManager.Instance["Dialog_No"]
            );

            if (!confirm)
                return;

            await app.ListeCoursesSupabaseService.AddMissingAsync(
                app.CurrentUserId.Value,
                _lastMissing);

            SendMissingButton.IsEnabled = false;
            SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SentButton"];
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // ------------------ LOGIQUE ------------------

    private async Task RunMenuAleatoireAsync(MenuOptionsResult opts)
    {
        var app = Application.Current as App;
        if (app == null)
            return;

        // Reset UI
        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
        SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SendMissingToShopping"];
        _lastMissing = new List<string>();
        _lastIngredientsKnown = false;
        _lastUserId = app.CurrentUserId;

        if (app.CurrentUserId == null ||
            app.RestClient == null ||
            app.RecipesService == null ||
            app.IngredientsService == null ||
            app.ListeCoursesSupabaseService == null)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["LoginRequired"];
            return;
        }

        var userId = app.CurrentUserId.Value;
        ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_Generating"];

        // 1) Recettes utilisateur
        // (tu utilises GetMyRecettesAsync dans ton code : je le garde)
        var recettes = await app.RecipesService.GetMyRecettesAsync();

        if (recettes == null || recettes.Count == 0)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_NoRecipes"];
            return;
        }

        // 2) Listes par type (si l'option est coch√©e)
        var entrees = opts.Entree ? recettes.Where(r => r.Type == TypePlat.Entree).ToList() : new List<Recette>();
        var plats = opts.Plat ? recettes.Where(r => r.Type == TypePlat.Plat).ToList() : new List<Recette>();
        var desserts = opts.Dessert ? recettes.Where(r => r.Type == TypePlat.Dessert).ToList() : new List<Recette>();

        // 3) Tirage (uniquement si demand√©)
        var entree = opts.Entree ? PickRandom(entrees) : null;
        var plat = opts.Plat ? PickRandom(plats) : null;
        var dessert = opts.Dessert ? PickRandom(desserts) : null;

        // Si une cat√©gorie coch√©e n'a aucune recette
        if ((opts.Entree && entree == null) || (opts.Plat && plat == null) || (opts.Dessert && dessert == null))
        {
            var sbErr = new StringBuilder();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotGenerate"]);
            sbErr.AppendLine();

            if (opts.Entree && entree == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Entr√©e");
            if (opts.Plat && plat == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Plat");
            if (opts.Dessert && dessert == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Dessert");

            sbErr.AppendLine();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CheckCategories"]);

            ResultLabel.Text = sbErr.ToString();
            return;
        }

        // 4) Ingr√©dients utilisateur disponibles
        var userIngredients = await GetUserIngredientsAsync(app, userId);
        var userSet = userIngredients
            .Select(Norm)
            .Where(x => !string.IsNullOrWhiteSpace(x))
            .ToHashSet();

        // 5) Analyse d'une recette
        async Task<(List<string> ingredients, List<string> missing, bool hasData)> AnalyzeAsync(Recette r)
        {
            var ingredients = await GetRecetteIngredientsAsync(app, r.Id);
            var distinct = ingredients
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (distinct.Count == 0)
                return (distinct, new List<string>(), false);

            var missing = distinct
                .Where(i => !userSet.Contains(Norm(i)))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            return (distinct, missing, true);
        }

        // 6) Analyse seulement des recettes r√©ellement tir√©es
        var chosen = new List<Recette>();
        if (entree != null) chosen.Add(entree);
        if (plat != null) chosen.Add(plat);
        if (dessert != null) chosen.Add(dessert);

        var analyses = new Dictionary<Guid, (List<string> ingredients, List<string> missing, bool hasData)>();
        foreach (var r in chosen)
            analyses[r.Id] = await AnalyzeAsync(r);

        // 7) Agr√©gation manquants (uniquement si on a des donn√©es pour toutes les recettes choisies)
        var allHaveData = chosen.All(r => analyses[r.Id].hasData);

        if (allHaveData)
        {
            _lastMissing = chosen
                .SelectMany(r => analyses[r.Id].missing)
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            _lastIngredientsKnown = true;
        }
        else
        {
            _lastMissing = new List<string>();
            _lastIngredientsKnown = false;
        }

        // 8) UI texte
        var sb = new StringBuilder();

        sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GeneratedHeader"]);

        if (entree != null) sb.AppendLine($"- {entree.TypeTexte} : {entree.Nom}");
        if (plat != null) sb.AppendLine($"- {plat.TypeTexte} : {plat.Nom}");
        if (dessert != null) sb.AppendLine($"- {dessert.TypeTexte} : {dessert.Nom}");
        sb.AppendLine();

        void AppendRecetteBlock(Recette r)
        {
            var a = analyses[r.Id];

            sb.AppendLine($"{r.TypeTexte} ‚Äî {r.Nom}");

            if (!a.hasData)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_NoIngredientsForRecipe"]);
                sb.AppendLine();
                return;
            }

            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_IngredientsHeader"]);
            foreach (var i in a.ingredients)
                sb.AppendLine("- " + i);

            if (a.missing.Count == 0)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingNone"]);
            }
            else
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingHeader"]);
                foreach (var m in a.missing)
                    sb.AppendLine("- " + m);
            }

            sb.AppendLine();
        }

        foreach (var r in chosen)
            AppendRecetteBlock(r);

        // 9) Bouton ‚Äúenvoyer manquants‚Äù
        if (!allHaveData)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotComputeMissing"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else if (_lastMissing.Count == 0)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_AllAvailable"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GlobalMissingHeader"]);
            foreach (var m in _lastMissing)
                sb.AppendLine("- " + m);

            SendMissingButton.IsVisible = true;
            SendMissingButton.IsEnabled = true;
        }

        ResultLabel.Text = sb.ToString();
    }
}

================================================================================
FILE: Pages\MesIngredientsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
    x:Class="LoGeCuiMobile.Pages.MesIngredientsPage"
    Title="{tr:Translate Ingredients_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:QuantityFormatConverter x:Key="QuantityFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="16" RowDefinitions="Auto,Auto,*" RowSpacing="12">

        <!-- Boutons -->
        <Grid Grid.Row="0" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Ingredients_AddButton}"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    Clicked="OnAddIngredientClicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelectionIngredients"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="OnDeleteSelectedIngredientsClicked" />
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Padding="4,0">
            <CheckBox x:Name="ChkToutSelectionnerIngredients"
                      CheckedChanged="ChkToutSelectionnerIngredients_CheckedChanged" />
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray" />
        </HorizontalStackLayout>

        <!-- Liste -->
        <CollectionView Grid.Row="2"
                        x:Name="IngredientsCollection"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="Aucun ingr√©dient."
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12"
                           Margin="0,4"
                           BorderColor="#ddd"
                           CornerRadius="10">

                        <Grid ColumnDefinitions="*,Auto">

                            <VerticalStackLayout Spacing="6">

                                <Label Text="{Binding Nom}"
                                       FontSize="18"
                                       FontAttributes="Bold" />

                                <Label FontSize="14" TextColor="Gray">
                                    <Label.Text>
                                        <MultiBinding Converter="{StaticResource QuantityFormatConverter}">
                                            <Binding Path="Quantite"/>
                                            <Binding Path="Unite"/>
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>

                                <!-- Disponible -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstDisponible}"
                                                CheckedChanged="OnDisponibleChanged" />
                                    <Label Text="{tr:Translate Ingredients_Available}"
                                           VerticalTextAlignment="Center"/>
                                </HorizontalStackLayout>

                                <!-- S√©lection suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}" />
                                    <Label Text="Supprimer"
                                           VerticalTextAlignment="Center"
                                           TextColor="Gray"/>
                                </HorizontalStackLayout>

                            </VerticalStackLayout>

                            <!-- Supprimer item -->
                            <Button Grid.Column="1"
                                    Text="üóë"
                                    BackgroundColor="#e74c3c"
                                    Clicked="OnDeleteIngredientClicked" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: Pages\MesIngredientsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Models;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Networking;


namespace LoGeCuiMobile.Pages;

public partial class MesIngredientsPage : ContentPage
{
    private readonly ObservableCollection<IngredientUi> _ingredients = new();

    private bool _isLoading;
    private bool _suppressSelectAllEvent;

    public MesIngredientsPage()
    {
        InitializeComponent();
        IngredientsCollection.ItemsSource = _ingredients;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();
        await LoadIngredientsAsync();
    }

    private async Task LoadIngredientsAsync()
    {
        if (_isLoading) return;

        try
        {
            _isLoading = true;

            // 0) Toujours tenter d'afficher le cache local en premier (offline-friendly)
            var local = await App.LocalDb.GetIngredientsAsync();
            _ingredients.Clear();
            foreach (var li in local)
                _ingredients.Add(new IngredientUi(li.ToModel()));

            RefreshSelectAllCheckBox();

            // 1) Si pas connect√© (session) -> on s'arr√™te apr√®s le cache
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            // 2) Si pas internet -> on s'arr√™te apr√®s le cache
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return;

            var userId = app.CurrentUserId.Value;

            // 3) Refresh depuis Supabase
            var remote = await app.IngredientsService.GetIngredientsAsync(userId);

            // 4) Mettre √† jour l'UI avec remote
            _ingredients.Clear();
            foreach (var ing in remote)
                _ingredients.Add(new IngredientUi(ing));

            // 5) Sauver remote dans SQLite
            await App.LocalDb.SaveIngredientsAsync(remote);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        finally
        {
            _isLoading = false;
        }
    }


    private async void OnAddIngredientClicked(object sender, EventArgs e)
    {
        try
        {
            await Shell.Current.GoToAsync(nameof(AjouterIngredientPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // Suppression d'un seul ingr√©dient via l'ic√¥ne üóë
    private async void OnDeleteIngredientClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        if (sender is not Button btn || btn.BindingContext is not IngredientUi ingredientUi)
            return;

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"{LocalizationResourceManager.Instance["Dialog_DeleteConfirm"]}\n{ingredientUi.Nom}",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            _ingredients.Remove(ingredientUi);

            if (ingredientUi.Id != Guid.Empty)
                await app.IngredientsService.DeleteIngredientAsync(ingredientUi.Id);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Checkbox "Tout s√©lectionner" (s√©lection suppression)
    private void ChkToutSelectionnerIngredients_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_suppressSelectAllEvent) return;

        foreach (var ing in _ingredients)
            ing.IsSelectedForDelete = e.Value;
    }

    private void RefreshSelectAllCheckBox()
    {
        if (ChkToutSelectionnerIngredients == null) return;

        _suppressSelectAllEvent = true;
        try
        {
            if (_ingredients.Count == 0)
            {
                ChkToutSelectionnerIngredients.IsEnabled = false;
                ChkToutSelectionnerIngredients.IsChecked = false;
                return;
            }

            ChkToutSelectionnerIngredients.IsEnabled = true;
            ChkToutSelectionnerIngredients.IsChecked = _ingredients.All(i => i.IsSelectedForDelete);
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    // Supprimer s√©lection
    private async void OnDeleteSelectedIngredientsClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        var selected = _ingredients.Where(i => i.IsSelectedForDelete).ToList();

        if (selected.Count == 0)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                "Aucun ingr√©dient s√©lectionn√©.",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"Supprimer {selected.Count} ingr√©dient(s) s√©lectionn√©(s) ?",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            foreach (var ingUi in selected)
            {
                if (ingUi.Id != Guid.Empty)
                    await app.IngredientsService.DeleteIngredientAsync(ingUi.Id);

                _ingredients.Remove(ingUi);
            }

            RefreshSelectAllCheckBox();

            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                $"{selected.Count} ingr√©dient(s) supprim√©(s).",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Mise √† jour "Disponible" -> synchro Supabase (si tu as une m√©thode UpdateIngredientAsync)
    private async void OnDisponibleChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_isLoading) return;

        if (sender is not CheckBox cb || cb.BindingContext is not IngredientUi ingUi)
            return;

        try
        {
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null)
                return;

            // Ici il faut une m√©thode d'update dans IngredientsService.
            // Si tu l'as d√©j√† : await app.IngredientsService.UpdateIngredientAsync(ingUi.Model.Id, ingUi.Model);
            // Sinon : on ne fait rien (l'UI reste locale). Dis-moi et je te donne l'impl√©mentation c√¥t√© service.
        }
        catch
        {
            // Optionnel : rollback si update √©choue
        }
    }
}

================================================================================
FILE: Pages\MesRecettesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="LoGeCuiMobile.Pages.MesRecettesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:vm="clr-namespace:LoGeCuiMobile.ViewModels"
    Title="{tr:Translate Recipes_Title}">

    <Grid Padding="12" RowDefinitions="Auto,Auto,*" RowSpacing="10">

        <!-- ====== FILTRES + ACTIONS HAUT ====== -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">

            <Picker Title="{tr:Translate Recipes_Category}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategorie}" />

            <HorizontalStackLayout Spacing="10">
                <Button Text="{tr:Translate Recipes_Refresh}"
                        Command="{Binding RefreshCommand}"
                        HorizontalOptions="StartAndExpand" />

                <Button Text="{tr:Translate Recipes_Add}"
                        Clicked="OnAjouterRecetteClicked"
                        HorizontalOptions="EndAndExpand" />
            </HorizontalStackLayout>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}" />

        </VerticalStackLayout>

        <!-- ====== LIGNE S√âLECTION MULTIPLE ====== -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" VerticalOptions="Center">

            <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">
                <CheckBox x:Name="ChkToutSelectionnerRecettes"
                          CheckedChanged="ChkToutSelectionnerRecettes_CheckedChanged"/>
                <Label Text="Tout s√©lectionner"
                       VerticalTextAlignment="Center"
                       TextColor="Gray"/>
            </HorizontalStackLayout>

            <Label Grid.Column="1"
                   x:Name="SelectionInfoLabel"
                   Text=""
                   TextColor="Gray"
                   VerticalTextAlignment="Center"/>

            <Button Grid.Column="2"
                    x:Name="BtnSupprimerSelection"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- ====== LISTE DES RECETTES ====== -->
        <CollectionView Grid.Row="2"
                        x:Name="RecettesCollection"
                        ItemsSource="{Binding Recettes}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Recipes_Empty}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       Margin="0,30,0,0" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10"
                           Margin="0,6"
                           HasShadow="False">

                        <!-- üî¥üü¢ Couleur bordure selon disponibilit√© -->
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Unknown}">
                                <Setter Property="BorderColor" Value="#B0B0B0"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.AllAvailable}">
                                <Setter Property="BorderColor" Value="#27AE60"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Missing}">
                                <Setter Property="BorderColor" Value="#E74C3C"/>
                            </DataTrigger>
                        </Frame.Triggers>

                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">

                            <!-- Checkbox suppression multiple -->
                            <CheckBox Grid.Column="0"
                                      Grid.RowSpan="2"
                                      IsChecked="{Binding IsSelectedForDelete}"
                                      CheckedChanged="RecetteDeleteCheckBox_CheckedChanged"
                                      VerticalOptions="Center" />

                            <!-- Zone infos recette (tap = d√©tails) -->
                            <Grid Grid.Column="1" Grid.RowSpan="2">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRecetteTapped"
                                                          CommandParameter="{Binding Model}" />
                                </Grid.GestureRecognizers>

                                <VerticalStackLayout Spacing="4">

                                    <Label Text="{Binding Nom}"
                                           FontSize="18"
                                           FontAttributes="Bold" />

                                    <Label Text="{Binding TypeTexte}" />

                                    <Label Text="{Binding TempsPreparation, StringFormat='{tr:Translate Recipes_TimeFormat}'}" />

                                    <Label Text="{Binding DifficulteTexte}" />

                                    <Label Text="{Binding AvailabilityLabel}"
                                           FontSize="12"
                                           TextColor="Gray"/>

                                </VerticalStackLayout>
                            </Grid>

                            <!-- Boutons actions -->
                            <HorizontalStackLayout Grid.Column="2" Grid.RowSpan="2"
                                                   Spacing="8"
                                                   VerticalOptions="Center">

                                <!-- Ajouter ingr√©dients manquants -->
                                <Button Text="üõí"
                                        BackgroundColor="#3498DB"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnAjouterManquants_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <!-- Supprimer une recette -->
                                <Button Text="üóë"
                                        BackgroundColor="#e74c3c"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnSupprimerRecette_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <!-- Modifier recette -->
                                <Button Text="‚úèÔ∏è"
                                        BackgroundColor="#F1C40F"
                                        TextColor="Black"
                                        Padding="8"
                                        Clicked="BtnModifierRecette_Clicked"
                                        CommandParameter="{Binding Model}"/>

                            </HorizontalStackLayout>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>
</ContentPage>

================================================================================
FILE: Pages\MesRecettesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.ViewModels;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Pages;

public partial class MesRecettesPage : ContentPage
{
    private MesRecettesViewModel? _vm;
    private bool _suppressSelectAllEvent;

    public MesRecettesPage()
    {
        InitializeComponent();

        var app = (App)Application.Current;

        if (app.RecipesService == null)
        {
            MainThread.BeginInvokeOnMainThread(async () =>
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Recipes_ServiceNull"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                ));

            return;
        }

        _vm = new MesRecettesViewModel(app.RecipesService);
        BindingContext = _vm;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        if (_vm == null)
            return;

        await _vm.LoadAsync();

        // Recalcule vert/rouge si ton VM le fait (et si tu l‚Äôas impl√©ment√©)
        // Sinon tu peux commenter la ligne.
        await _vm.RefreshAvailabilityAsync();

        RefreshSelectionUi();
    }

    private async void OnAjouterRecetteClicked(object sender, EventArgs e)
    {
        await Navigation.PushAsync(new AjouterRecettePage());
    }

    // Tap recette -> d√©tails
    private async void OnRecetteTapped(object sender, TappedEventArgs e)
    {
        // Ici on accepte RecetteUi OU Recette
        Recette? recette = e.Parameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        var app = (App)Application.Current;

        if (app.RecetteIngredientsService == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Recipes_IngredientsServiceNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var items = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

        var ingredientsText = (items.Count == 0)
            ? LocalizationResourceManager.Instance["Recipes_NoIngredients"]
            : string.Join("\n", items.Select(x =>
                string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                    ? $"‚Ä¢ {x.nom}"
                    : $"‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
            ));

        var details = string.Format(
            LocalizationResourceManager.Instance["Recipes_DetailsFormat"],
            recette.CategorieDb,
            recette.TempsPreparation,
            ingredientsText,
            recette.Instructions ?? ""
        );

        await DisplayAlert(recette.Nom, details, LocalizationResourceManager.Instance["Dialog_Ok"]);
    }

    // ----------- S√©lection / suppression -----------

    private void ChkToutSelectionnerRecettes_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_vm == null) return;
        if (_suppressSelectAllEvent) return;

        foreach (var r in _vm.Recettes)
            r.IsSelectedForDelete = e.Value;

        RefreshSelectionUi();
    }

    private void RecetteDeleteCheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        RefreshSelectionUi();
    }

    private void RefreshSelectionUi()
    {
        if (_vm == null) return;

        // ‚ö†Ô∏è si ton XAML n‚Äôa pas ces x:Name, √ßa crash => je prot√®ge
        var selectedCount = _vm.Recettes.Count(x => x.IsSelectedForDelete);

        if (SelectionInfoLabel != null)
            SelectionInfoLabel.Text = selectedCount == 0 ? "" : $"{selectedCount} s√©lectionn√©(s)";

        _suppressSelectAllEvent = true;
        try
        {
            if (ChkToutSelectionnerRecettes != null)
            {
                if (_vm.Recettes.Count == 0)
                {
                    ChkToutSelectionnerRecettes.IsEnabled = false;
                    ChkToutSelectionnerRecettes.IsChecked = false;
                }
                else
                {
                    ChkToutSelectionnerRecettes.IsEnabled = true;
                    ChkToutSelectionnerRecettes.IsChecked = _vm.Recettes.All(x => x.IsSelectedForDelete);
                }
            }
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        var selected = _vm.Recettes.Where(r => r.IsSelectedForDelete).ToList();
        if (selected.Count == 0)
        {
            await DisplayAlert("Info", "Aucune recette s√©lectionn√©e.", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer {selected.Count} recette(s) s√©lectionn√©e(s) ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteSelectedAsync(selected);

        RefreshSelectionUi();
    }

    private async void BtnSupprimerRecette_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        if (sender is not Button btn)
            return;

        // Accepte RecetteUi OU Recette (pratique si tu changes le XAML)
        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null)
            return;

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer '{recetteUi.Nom}' ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteOneAsync(recetteUi);
        RefreshSelectionUi();
    }

    // ----------- Modifier -----------

    private async void BtnModifierRecette_Clicked(object sender, EventArgs e)
    {
        if (sender is not Button btn)
            return;

        Recette? recette = btn.CommandParameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        await Navigation.PushAsync(new AjouterRecettePage(recette));
    }

    // ----------- Ajouter manquants √† la liste de courses -----------

    private async void BtnAjouterManquants_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        var missing = await _vm.GetMissingIngredientsForRecipeAsync(recetteUi.Model);
        if (missing == null)
        {
            await DisplayAlert("Info", "Impossible de calculer les ingr√©dients (offline ou donn√©es manquantes).", "OK");
            return;
        }

        if (missing.Count == 0)
        {
            await DisplayAlert("Info", "Tu as d√©j√† tous les ingr√©dients pour cette recette ‚úÖ", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Ajouter √† la liste",
            "Ajouter ces ingr√©dients manquants ?\n- " + string.Join("\n- ", missing),
            "Oui",
            "Non");

        if (!confirm) return;

        var ok = await _vm.SendMissingToShoppingAsync(missing);

        if (ok)
            await DisplayAlert("Succ√®s", $"{missing.Count} ingr√©dient(s) ajout√©(s) √† la liste de courses.", "OK");
        else
            await DisplayAlert("Erreur", "Impossible d‚Äôajouter √† la liste de courses.", "OK");
    }
}

================================================================================
FILE: Pages\ResetPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ResetPasswordPage"
             Title="{tr:Translate Reset_Title}">

    <VerticalStackLayout Padding="24" Spacing="12">

        <Label Text="{tr:Translate Reset_Header}"
               FontSize="20"
               FontAttributes="Bold" />

        <Entry x:Name="Pwd1"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_NewPassword}" />

        <Entry x:Name="Pwd2"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_ConfirmPassword}" />

        <Button Text="{tr:Translate Reset_Submit}"
                Clicked="OnSubmit" />

        <Label x:Name="Msg" />

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: Pages\ResetPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages;

public partial class ResetPasswordPage : ContentPage
{
    private readonly string _accessToken;
    private readonly SupabaseService _supabase;

    public ResetPasswordPage(string accessToken)
    {
        InitializeComponent();
        _accessToken = accessToken;

        string url = ConfigurationHelper.GetSupabaseUrl();
        string key = ConfigurationHelper.GetSupabaseKey();
        _supabase = new SupabaseService(url, key);
    }

    private async void OnSubmit(object sender, EventArgs e)
    {
        var p1 = Pwd1.Text ?? "";
        var p2 = Pwd2.Text ?? "";

        if (string.IsNullOrWhiteSpace(p1) || p1.Length < 6)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMinLength"];
            Msg.TextColor = Colors.Red;
            return;
        }

        if (p1 != p2)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMismatch"];
            Msg.TextColor = Colors.Red;
            return;
        }

        Msg.Text = LocalizationResourceManager.Instance["Reset_Updating"];
        Msg.TextColor = Colors.Blue;

        var (success, error) = await _supabase.UpdatePasswordAsync(_accessToken, p1);

        if (success)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Reset_DoneTitle"],
                LocalizationResourceManager.Instance["Reset_DoneBody"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await Navigation.PopToRootAsync();
        }
        else
        {
            Msg.Text = string.IsNullOrWhiteSpace(error)
                ? LocalizationResourceManager.Instance["Reset_Failed"]
                : error;

            Msg.TextColor = Colors.Red;
        }
    }
}

================================================================================
FILE: Pages\SettingsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.SettingsPage"
             Title="{tr:Translate Settings_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <Label Text="{tr:Translate Settings_Account}"
                   FontSize="18"
                   FontAttributes="Bold" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">

                    <Button Text="{tr:Translate Settings_Logout}"
                            BackgroundColor="#34495E"
                            FontAttributes="Bold"
                            Clicked="OnLogoutClicked" />

                    <Label Text="{tr:Translate Settings_DangerZone}"
                           FontSize="14"
                           TextColor="Gray"
                           Margin="0,6,0,0" />

                    <Button Text="{tr:Translate Settings_Unsubscribe}"
                            BackgroundColor="IndianRed"
                            FontAttributes="Bold"
                            Clicked="OnDesinscriptionClicked" />

                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: Pages\SettingsPage.xaml.cs
================================================================================

Ôªøusing System;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages;

public partial class SettingsPage : ContentPage
{
    public SettingsPage()
    {
        InitializeComponent();
    }

    private async void OnDesinscriptionClicked(object sender, EventArgs e)
    {
        bool confirm = await DisplayAlert(
            LocalizationResourceManager.Instance["Settings_DeleteConfirmTitle"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmBody"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmYes"],
            LocalizationResourceManager.Instance["Dialog_Cancel"]);

        if (!confirm) return;

        var app = (App)Application.Current;

        if (app.Supabase == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Settings_SupabaseNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        // 1) Lire la session stock√©e
        var token = await SecureStorage.GetAsync("sb_access_token");
        var userId = await SecureStorage.GetAsync("sb_user_id");

        if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["SessionTitle"],
                LocalizationResourceManager.Instance["SessionExpired"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        // 2) R√©injecter la session AVANT delete
        app.Supabase.SetSession(token, userId);

        // 3) Appel Edge Function
        var (ok, err) = await app.Supabase.DeleteAccountAsync();

        if (!ok)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                string.Format(LocalizationResourceManager.Instance["Settings_DeleteFailed"], err),
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            if (!string.IsNullOrWhiteSpace(err) &&
                err.Contains("Invalid JWT", StringComparison.OrdinalIgnoreCase))
            {
                app.ShowLogin();
            }

            return;
        }

        // Nettoyage local
        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        await DisplayAlert(
            LocalizationResourceManager.Instance["Dialog_Ok"],
            LocalizationResourceManager.Instance["Settings_DeleteSuccess"],
            LocalizationResourceManager.Instance["Dialog_Ok"]);

        app.ShowLogin();
    }

    private void OnLogoutClicked(object sender, EventArgs e)
    {
        var app = (App)Application.Current;

        app.Supabase?.ClearSession();

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        app.ShowLogin();
    }
}

================================================================================
FILE: Platforms\Android\AndroidManifest.xml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
	<application android:allowBackup="true" android:icon="@mipmap/postriticone" android:supportsRtl="true"></application>
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.CAMERA" />
	<queries>
		<intent>
			<action android:name="android.intent.action.VIEW" />
			<data android:scheme="logecui" />
		</intent>
	</queries>
</manifest>

================================================================================
FILE: Platforms\Android\MainActivity.cs
================================================================================

Ôªøusing Android.App;
using Android.Content;
using Android.Content.PM;
using Android.OS;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile
{
    [Activity(
        Theme = "@style/Maui.SplashTheme",
        MainLauncher = true,
        LaunchMode = LaunchMode.SingleTop,
        ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | ConfigChanges.SmallestScreenSize | ConfigChanges.Density)]

    // Configuration du Deep Link pour la confirmation email
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "confirm",
        AutoVerify = true)]

    // Deep Link - reset password
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "reset-password")]

    public class MainActivity : MauiAppCompatActivity
    {
        protected override void OnCreate(Bundle? savedInstanceState)
        {
            base.OnCreate(savedInstanceState);

            // G√©rer le deep link si l'app est lanc√©e via un lien
            HandleIntent(Intent);
        }

        protected override void OnNewIntent(Intent? intent)
        {
            base.OnNewIntent(intent);

            if (intent != null)
            {
                Intent = intent;
                HandleIntent(intent);
            }
        }

        private void HandleIntent(Intent? intent)
        {
            var data = intent?.DataString;
            if (string.IsNullOrEmpty(data))
                return;

            var uri = new Uri(data);

            MainThread.BeginInvokeOnMainThread(async () =>
            {
                if (Microsoft.Maui.Controls.Application.Current is App app)
                    await app.HandleDeepLinkAsync(uri);
            });
        }
    }
}

================================================================================
FILE: Platforms\Android\MainApplication.cs
================================================================================

Ôªøusing Android.App;
using Android.Runtime;

namespace LoGeCuiMobile
{
    [Application]
    public class MainApplication : MauiApplication
    {
        public MainApplication(IntPtr handle, JniHandleOwnership ownership)
            : base(handle, ownership)
        {
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\Android\Resources\values\colors.xml
================================================================================

<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="colorPrimary">#512BD4</color>
    <color name="colorPrimaryDark">#2B0B98</color>
    <color name="colorAccent">#2B0B98</color>
</resources>

================================================================================
FILE: Platforms\iOS\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\iOS\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: Platforms\MacCatalyst\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\MacCatalyst\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: Platforms\Windows\App.xaml
================================================================================

Ôªø<maui:MauiWinUIApplication
    x:Class="LoGeCuiMobile.WinUI.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:maui="using:Microsoft.Maui"
    xmlns:local="using:LoGeCuiMobile.WinUI">

</maui:MauiWinUIApplication>

================================================================================
FILE: Platforms\Windows\App.xaml.cs
================================================================================

Ôªøusing Microsoft.UI.Xaml;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace LoGeCuiMobile.WinUI
{
    /// <summary>
    /// Provides application-specific behavior to supplement the default Application class.
    /// </summary>
    public partial class App : MauiWinUIApplication
    {
        /// <summary>
        /// Initializes the singleton application object.  This is the first line of authored code
        /// executed, and as such is the logical equivalent of main() or WinMain().
        /// </summary>
        public App()
        {
            this.InitializeComponent();
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }

}

================================================================================
FILE: Properties\launchSettings.json
================================================================================

{
  "profiles": {
    "Windows Machine": {
      "commandName": "Project",
      "nativeDebugging": false
    }
  }
}

================================================================================
FILE: Resources\Lang\AppResources.Designer.cs
================================================================================

Ôªø//------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a √©t√© g√©n√©r√© par un outil.
//     Version du runtime :4.0.30319.42000
//
//     Les modifications apport√©es √† ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est r√©g√©n√©r√©.
// </auto-generated>
//------------------------------------------------------------------------------

namespace LoGeCuiMobile.Resources.Lang {
    using System;
    
    
    /// <summary>
    ///   Une classe de ressource fortement typ√©e destin√©e, entre autres, √† la consultation des cha√Ænes localis√©es.
    /// </summary>
    // Cette classe a √©t√© g√©n√©r√©e automatiquement par la classe StronglyTypedResourceBuilder
    // √† l'aide d'un outil, tel que ResGen ou Visual Studio.
    // Pour ajouter ou supprimer un membre, modifiez votre fichier .ResX, puis r√©ex√©cutez ResGen
    // avec l'option /str ou r√©g√©n√©rez votre projet VS.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "18.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    public class AppResources {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal AppResources() {
        }
        
        /// <summary>
        ///   Retourne l'instance ResourceManager mise en cache utilis√©e par cette classe.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("LoGeCuiMobile.Resources.Lang.AppResources", typeof(AppResources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   Remplace la propri√©t√© CurrentUICulture du thread actuel pour toutes
        ///   les recherches de ressources √† l'aide de cette classe de ressource fortement typ√©e.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mauvais mot de passe.
        /// </summary>
        public static string BadPassword {
            get {
                return ResourceManager.GetString("BadPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Connexion en cours....
        /// </summary>
        public static string Connecting {
            get {
                return ResourceManager.GetString("Connecting", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur de connexion.
        /// </summary>
        public static string ConnectionError {
            get {
                return ResourceManager.GetString("ConnectionError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©ation du compte....
        /// </summary>
        public static string CreatingAccount {
            get {
                return ResourceManager.GetString("CreatingAccount", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Annuler.
        /// </summary>
        public static string Dialog_Cancel {
            get {
                return ResourceManager.GetString("Dialog_Cancel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer cet ingr√©dient ?.
        /// </summary>
        public static string Dialog_DeleteConfirm {
            get {
                return ResourceManager.GetString("Dialog_DeleteConfirm", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Non.
        /// </summary>
        public static string Dialog_No {
            get {
                return ResourceManager.GetString("Dialog_No", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OK.
        /// </summary>
        public static string Dialog_Ok {
            get {
                return ResourceManager.GetString("Dialog_Ok", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui.
        /// </summary>
        public static string Dialog_Yes {
            get {
                return ResourceManager.GetString("Dialog_Yes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Email.
        /// </summary>
        public static string Email {
            get {
                return ResourceManager.GetString("Email", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur.
        /// </summary>
        public static string ErrorTitle {
            get {
                return ResourceManager.GetString("ErrorTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Veuillez remplir tous les champs.
        /// </summary>
        public static string FillAllFields {
            get {
                return ResourceManager.GetString("FillAllFields", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe oubli√© ?.
        /// </summary>
        public static string ForgotPassword {
            get {
                return ResourceManager.GetString("ForgotPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Add_Available {
            get {
                return ResourceManager.GetString("Ingredients_Add_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de l‚Äôingr√©dient.
        /// </summary>
        public static string Ingredients_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Ingredients_Add_NameRequired {
            get {
                return ResourceManager.GetString("Ingredients_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© (ex : 10).
        /// </summary>
        public static string Ingredients_Add_QuantityPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_QuantityPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üíæ Enregistrer.
        /// </summary>
        public static string Ingredients_Add_Save {
            get {
                return ResourceManager.GetString("Ingredients_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_Add_Title {
            get {
                return ResourceManager.GetString("Ingredients_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Unit√© (ex : kg, pi√®ces).
        /// </summary>
        public static string Ingredients_Add_UnitPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_UnitPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_AddButton {
            get {
                return ResourceManager.GetString("Ingredients_AddButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Available {
            get {
                return ResourceManager.GetString("Ingredients_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dient.
        /// </summary>
        public static string Ingredients_DialogTitle {
            get {
                return ResourceManager.GetString("Ingredients_DialogTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© : {0} {1}.
        /// </summary>
        public static string Ingredients_QuantityFormat {
            get {
                return ResourceManager.GetString("Ingredients_QuantityFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Gestion des ingr√©dients.
        /// </summary>
        public static string Ingredients_Title {
            get {
                return ResourceManager.GetString("Ingredients_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Se connecter.
        /// </summary>
        public static string LoginButton {
            get {
                return ResourceManager.GetString("LoginButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string LoginRequired {
            get {
                return ResourceManager.GetString("LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients.
        /// </summary>
        public static string Nav_Ingredients {
            get {
                return ResourceManager.GetString("Nav_Ingredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Menu al√©atoire.
        /// </summary>
        public static string Nav_RandomMenu {
            get {
                return ResourceManager.GetString("Nav_RandomMenu", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Nav_Recipes {
            get {
                return ResourceManager.GetString("Nav_Recipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Nav_Settings {
            get {
                return ResourceManager.GetString("Nav_Settings", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste de courses.
        /// </summary>
        public static string Nav_ShoppingList {
            get {
                return ResourceManager.GetString("Nav_ShoppingList", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OCR.
        /// </summary>
        public static string OcrTitle {
            get {
                return ResourceManager.GetString("OcrTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe.
        /// </summary>
        public static string Password {
            get {
                return ResourceManager.GetString("Password", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üîí Permission.
        /// </summary>
        public static string PermissionTitle {
            get {
                return ResourceManager.GetString("PermissionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Tout est disponible. Aucun ingr√©dient manquant..
        /// </summary>
        public static string RandomMenu_AllAvailable {
            get {
                return ResourceManager.GetString("RandomMenu_AllAvailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de calculer les ingr√©dients manquants : certaines recettes n‚Äôont pas d‚Äôingr√©dients enregistr√©s..
        /// </summary>
        public static string RandomMenu_CannotComputeMissing {
            get {
                return ResourceManager.GetString("RandomMenu_CannotComputeMissing", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de g√©n√©rer un menu Entr√©e/Plat/Dessert..
        /// </summary>
        public static string RandomMenu_CannotGenerate {
            get {
                return ResourceManager.GetString("RandomMenu_CannotGenerate", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† V√©rifie que tes recettes ont bien &apos;categorie&apos; = Entree / Plat / Dessert en DB..
        /// </summary>
        public static string RandomMenu_CheckCategories {
            get {
                return ResourceManager.GetString("RandomMenu_CheckCategories", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Entr√©es: {0}
        ///Plats: {1}
        ///Desserts: {2}.
        /// </summary>
        public static string RandomMenu_CountsFormat {
            get {
                return ResourceManager.GetString("RandomMenu_CountsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Appuyez sur le bouton pour g√©n√©rer un menu.
        /// </summary>
        public static string RandomMenu_DefaultText {
            get {
                return ResourceManager.GetString("RandomMenu_DefaultText", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_GenerateButton {
            get {
                return ResourceManager.GetString("RandomMenu_GenerateButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Menu g√©n√©r√© :.
        /// </summary>
        public static string RandomMenu_GeneratedHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GeneratedHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ G√©n√©ration du menu (Entr√©e / Plat / Dessert)‚Ä¶.
        /// </summary>
        public static string RandomMenu_Generating {
            get {
                return ResourceManager.GetString("RandomMenu_Generating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste globale des ingr√©dients manquants :.
        /// </summary>
        public static string RandomMenu_GlobalMissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GlobalMissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients :.
        /// </summary>
        public static string RandomMenu_IngredientsHeader {
            get {
                return ResourceManager.GetString("RandomMenu_IngredientsHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants :.
        /// </summary>
        public static string RandomMenu_MissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_MissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants : aucun.
        /// </summary>
        public static string RandomMenu_MissingNone {
            get {
                return ResourceManager.GetString("RandomMenu_MissingNone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients : (aucun ingr√©dient enregistr√© pour cette recette).
        /// </summary>
        public static string RandomMenu_NoIngredientsForRecipe {
            get {
                return ResourceManager.GetString("RandomMenu_NoIngredientsForRecipe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette disponible..
        /// </summary>
        public static string RandomMenu_NoRecipes {
            get {
                return ResourceManager.GetString("RandomMenu_NoRecipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ouvrir la liste de courses.
        /// </summary>
        public static string RandomMenu_OpenShopping {
            get {
                return ResourceManager.GetString("RandomMenu_OpenShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Il manque :.
        /// </summary>
        public static string RandomMenu_SendConfirmBody {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Envoyer ?.
        /// </summary>
        public static string RandomMenu_SendConfirmTitle {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Envoyer les ingr√©dients manquants dans la liste de courses.
        /// </summary>
        public static string RandomMenu_SendMissingToShopping {
            get {
                return ResourceManager.GetString("RandomMenu_SendMissingToShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ingr√©dients envoy√©s.
        /// </summary>
        public static string RandomMenu_SentButton {
            get {
                return ResourceManager.GetString("RandomMenu_SentButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_Title {
            get {
                return ResourceManager.GetString("RandomMenu_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add {
            get {
                return ResourceManager.GetString("Recipes_Add", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;acc√®s √† la cam√©ra est requis pour scanner..
        /// </summary>
        public static string Recipes_Add_CameraPermission {
            get {
                return ResourceManager.GetString("Recipes_Add_CameraPermission", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Capture photo non support√©e sur cet appareil..
        /// </summary>
        public static string Recipes_Add_CaptureNotSupported {
            get {
                return ResourceManager.GetString("Recipes_Add_CaptureNotSupported", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Choisir une cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de retrouver l&apos;ID de la recette apr√®s sauvegarde..
        /// </summary>
        public static string Recipes_Add_IdNotFound {
            get {
                return ResourceManager.GetString("Recipes_Add_IdNotFound", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;image est trop lourde pour l&apos;OCR. Essayez de cadrer plus serr√© ou baissez la r√©solution..
        /// </summary>
        public static string Recipes_Add_ImageTooLarge {
            get {
                return ResourceManager.GetString("Recipes_Add_ImageTooLarge", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients (1 par ligne).
        /// </summary>
        public static string Recipes_Add_IngredientsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex :
        ///2 ≈ìufs
        ///100g farine
        ///1 pinc√©e de sel.
        /// </summary>
        public static string Recipes_Add_IngredientsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Instructions.
        /// </summary>
        public static string Recipes_Add_InstructionsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : M√©langer, cuire 10 min....
        /// </summary>
        public static string Recipes_Add_InstructionsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string Recipes_Add_LoginRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom.
        /// </summary>
        public static string Recipes_Add_NameLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_NameLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de la recette.
        /// </summary>
        public static string Recipes_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Recipes_Add_NameRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun texte d√©tect√©. Essayez avec plus de lumi√®re et sans flou..
        /// </summary>
        public static string Recipes_Add_NoTextDetected {
            get {
                return ResourceManager.GetString("Recipes_Add_NoTextDetected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Texte scann√© et champs pr√©-remplis. V√©rifiez et corrigez si besoin..
        /// </summary>
        public static string Recipes_Add_OcrSuccess {
            get {
                return ResourceManager.GetString("Recipes_Add_OcrSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Enregistrer.
        /// </summary>
        public static string Recipes_Add_Save {
            get {
                return ResourceManager.GetString("Recipes_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Recette enregistr√©e..
        /// </summary>
        public static string Recipes_Add_Saved {
            get {
                return ResourceManager.GetString("Recipes_Add_Saved", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Scanner (OCR).
        /// </summary>
        public static string Recipes_Add_ScanOcr {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanOcr", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üì∏ Scanner une recette.
        /// </summary>
        public static string Recipes_Add_ScanTitle {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_Add_ServiceNotReady {
            get {
                return ResourceManager.GetString("Recipes_Add_ServiceNotReady", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps (minutes).
        /// </summary>
        public static string Recipes_Add_TimeLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_TimeLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : 30.
        /// </summary>
        public static string Recipes_Add_TimePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_TimePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add_Title {
            get {
                return ResourceManager.GetString("Recipes_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Category {
            get {
                return ResourceManager.GetString("Recipes_Category", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie: {0}
        ///Temps: {1} min
        ///
        ///Ingr√©dients:
        ///{2}
        ///
        ///Instructions:
        ///{3}.
        /// </summary>
        public static string Recipes_DetailsFormat {
            get {
                return ResourceManager.GetString("Recipes_DetailsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette pour l&apos;instant..
        /// </summary>
        public static string Recipes_Empty {
            get {
                return ResourceManager.GetString("Recipes_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_IngredientsServiceNull {
            get {
                return ResourceManager.GetString("Recipes_IngredientsServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† (aucun ingr√©dient renseign√©).
        /// </summary>
        public static string Recipes_NoIngredients {
            get {
                return ResourceManager.GetString("Recipes_NoIngredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rafra√Æchir.
        /// </summary>
        public static string Recipes_Refresh {
            get {
                return ResourceManager.GetString("Recipes_Refresh", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecipesService est NULL (InitRestServices n&apos;a pas √©t√© appel√© apr√®s login)..
        /// </summary>
        public static string Recipes_ServiceNull {
            get {
                return ResourceManager.GetString("Recipes_ServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps : {0} min.
        /// </summary>
        public static string Recipes_TimeFormat {
            get {
                return ResourceManager.GetString("Recipes_TimeFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Recipes_Title {
            get {
                return ResourceManager.GetString("Recipes_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Confirmer le mot de passe.
        /// </summary>
        public static string Reset_ConfirmPassword {
            get {
                return ResourceManager.GetString("Reset_ConfirmPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Votre mot de passe a √©t√© modifi√©. Vous pouvez vous connecter..
        /// </summary>
        public static string Reset_DoneBody {
            get {
                return ResourceManager.GetString("Reset_DoneBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Termin√©.
        /// </summary>
        public static string Reset_DoneTitle {
            get {
                return ResourceManager.GetString("Reset_DoneTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de modifier le mot de passe..
        /// </summary>
        public static string Reset_Failed {
            get {
                return ResourceManager.GetString("Reset_Failed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialiser votre mot de passe.
        /// </summary>
        public static string Reset_Header {
            get {
                return ResourceManager.GetString("Reset_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nouveau mot de passe.
        /// </summary>
        public static string Reset_NewPassword {
            get {
                return ResourceManager.GetString("Reset_NewPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le mot de passe doit contenir au moins 6 caract√®res..
        /// </summary>
        public static string Reset_PwdMinLength {
            get {
                return ResourceManager.GetString("Reset_PwdMinLength", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Les mots de passe ne correspondent pas..
        /// </summary>
        public static string Reset_PwdMismatch {
            get {
                return ResourceManager.GetString("Reset_PwdMismatch", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Valider.
        /// </summary>
        public static string Reset_Submit {
            get {
                return ResourceManager.GetString("Reset_Submit", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialisation.
        /// </summary>
        public static string Reset_Title {
            get {
                return ResourceManager.GetString("Reset_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ Mise √† jour en cours....
        /// </summary>
        public static string Reset_Updating {
            get {
                return ResourceManager.GetString("Reset_Updating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Service indisponible..
        /// </summary>
        public static string ServiceUnavailable {
            get {
                return ResourceManager.GetString("ServiceUnavailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session absente ou expir√©e. Veuillez vous reconnecter..
        /// </summary>
        public static string SessionExpired {
            get {
                return ResourceManager.GetString("SessionExpired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session.
        /// </summary>
        public static string SessionTitle {
            get {
                return ResourceManager.GetString("SessionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Compte.
        /// </summary>
        public static string Settings_Account {
            get {
                return ResourceManager.GetString("Settings_Account", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Zone dangereuse.
        /// </summary>
        public static string Settings_DangerZone {
            get {
                return ResourceManager.GetString("Settings_DangerZone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Es-tu s√ªr de vouloir supprimer ton compte ? Cette action est irr√©versible..
        /// </summary>
        public static string Settings_DeleteConfirmBody {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_DeleteConfirmTitle {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui, supprimer.
        /// </summary>
        public static string Settings_DeleteConfirmYes {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmYes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Suppression impossible : {0}.
        /// </summary>
        public static string Settings_DeleteFailed {
            get {
                return ResourceManager.GetString("Settings_DeleteFailed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Votre compte a √©t√© supprim√©..
        /// </summary>
        public static string Settings_DeleteSuccess {
            get {
                return ResourceManager.GetString("Settings_DeleteSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©connexion.
        /// </summary>
        public static string Settings_Logout {
            get {
                return ResourceManager.GetString("Settings_Logout", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supabase non initialis√©. Reconnectez-vous..
        /// </summary>
        public static string Settings_SupabaseNull {
            get {
                return ResourceManager.GetString("Settings_SupabaseNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Settings_Title {
            get {
                return ResourceManager.GetString("Settings_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_Unsubscribe {
            get {
                return ResourceManager.GetString("Settings_Unsubscribe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un article.
        /// </summary>
        public static string Shopping_AddItem {
            get {
                return ResourceManager.GetString("Shopping_AddItem", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Achet√©.
        /// </summary>
        public static string Shopping_Bought {
            get {
                return ResourceManager.GetString("Shopping_Bought", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer.
        /// </summary>
        public static string Shopping_Delete {
            get {
                return ResourceManager.GetString("Shopping_Delete", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üóëÔ∏è Supprimer s√©lection.
        /// </summary>
        public static string Shopping_DeleteSelection {
            get {
                return ResourceManager.GetString("Shopping_DeleteSelection", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun article pour l‚Äôinstant..
        /// </summary>
        public static string Shopping_Empty {
            get {
                return ResourceManager.GetString("Shopping_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ma liste de courses.
        /// </summary>
        public static string Shopping_Header {
            get {
                return ResourceManager.GetString("Shopping_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Liste de Courses.
        /// </summary>
        public static string Shopping_Title {
            get {
                return ResourceManager.GetString("Shopping_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©er un compte.
        /// </summary>
        public static string SignupButton {
            get {
                return ResourceManager.GetString("SignupButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur lors de l&apos;inscription.
        /// </summary>
        public static string SignupError {
            get {
                return ResourceManager.GetString("SignupError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rester connect√©.
        /// </summary>
        public static string StayConnected {
            get {
                return ResourceManager.GetString("StayConnected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ OK.
        /// </summary>
        public static string SuccessTitle {
            get {
                return ResourceManager.GetString("SuccessTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur inconnue..
        /// </summary>
        public static string UnknownError {
            get {
                return ResourceManager.GetString("UnknownError", resourceCulture);
            }
        }
    }
}

================================================================================
FILE: Resources\Lang\LocalizationResourceManager.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Globalization;
using System.Resources;

namespace LoGeCuiMobile.Resources.Lang;

public class LocalizationResourceManager : INotifyPropertyChanged
{
    public static LocalizationResourceManager Instance { get; } = new();

    private readonly ResourceManager _resourceManager = AppResources.ResourceManager;

    public event PropertyChangedEventHandler? PropertyChanged;

    public string this[string key] => _resourceManager.GetString(key, CultureInfo.CurrentUICulture) ?? key;

    public void SetCulture(CultureInfo culture)
    {
        if (culture == null) return;

        CultureInfo.CurrentUICulture = culture;
        CultureInfo.CurrentCulture = culture;

        CultureInfo.DefaultThreadCurrentCulture = culture;
        CultureInfo.DefaultThreadCurrentUICulture = culture;

        // ‚úÖ Notifie toute l‚ÄôUI : toutes les bindings se r√©√©valuent
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(null));
    }
}

================================================================================
FILE: Resources\Lang\TranslateExtension.cs
================================================================================

Ôªøusing Microsoft.Maui.Controls;
using System;

namespace LoGeCuiMobile.Resources.Lang;

[ContentProperty(nameof(Key))]
public class TranslateExtension : IMarkupExtension<BindingBase>
{
    public string Key { get; set; } = "";

    public BindingBase ProvideValue(IServiceProvider serviceProvider)
        => new Binding($"[{Key}]", source: LocalizationResourceManager.Instance);

    object IMarkupExtension.ProvideValue(IServiceProvider serviceProvider)
        => ProvideValue(serviceProvider);
}

================================================================================
FILE: Resources\Raw\AboutAssets.txt
================================================================================

ÔªøAny raw assets you want to be deployed with your application can be placed in
this directory (and child directories). Deployment of the asset to your application
is automatically handled by the following `MauiAsset` Build Action within your `.csproj`.

	<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />

These files will be deployed with your package and will be accessible using Essentials:

	async Task LoadMauiAsset()
	{
		using var stream = await FileSystem.OpenAppPackageFileAsync("AboutAssets.txt");
		using var reader = new StreamReader(stream);

		var contents = reader.ReadToEnd();
	}

================================================================================
FILE: Resources\Styles\Colors.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- Couleurs fixes -->
    <Color x:Key="AccentColor">#FF6B00</Color>

    <!-- Couleurs Light -->
    <Color x:Key="LightPageBackground">#FFFFFF</Color>
    <Color x:Key="LightTextPrimary">#111111</Color>
    <Color x:Key="LightCardBackground">#F2F2F2</Color>

    <!-- Couleurs Dark -->
    <Color x:Key="DarkPageBackground">#121212</Color>
    <Color x:Key="DarkTextPrimary">#FFFFFF</Color>
    <Color x:Key="DarkCardBackground">#1E1E1E</Color>

    <!-- Texte sur cartes -->
    <Color x:Key="LightCardText">#111111</Color>
    <Color x:Key="DarkCardText">#FFFFFF</Color>

</ResourceDictionary>


================================================================================
FILE: Resources\Styles\Styles.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- PAGE -->
    <Style TargetType="ContentPage">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightPageBackground}"
                                 Dark="{StaticResource DarkPageBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- LABEL -->
    <Style TargetType="Label">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- ENTRY -->
    <Style TargetType="Entry">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- FRAME -->
    <Style TargetType="Frame">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- BUTTON -->
    <Style TargetType="Button">
        <Setter Property="TextColor" Value="White" />
        <Setter Property="BackgroundColor" Value="{StaticResource AccentColor}" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Padding" Value="14,10" />
        <Setter Property="MinimumHeightRequest" Value="44" />
        <Setter Property="MinimumWidthRequest" Value="44" />
    </Style>

    <!-- LABEL DANS UNE CARTE -->
    <Style TargetType="Label" x:Key="CardLabel">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardText}"
                             Dark="{StaticResource DarkCardText}" />
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>

================================================================================
FILE: RootPage.cs
================================================================================

namespace LoGeCuiMobile;

public static class RootPage
{
    public static Page CreateLoginRoot()
        => new NavigationPage(new Pages.LoginPage());

    public static Page CreateAppShellRoot()
        => new AppShell();
}

================================================================================
FILE: Services\Local\ArticleLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class ArticleLocal
    {
        [PrimaryKey]
        public int Id { get; set; }   // int

        public string Nom { get; set; } = "";
        public string Quantite { get; set; } = "";
        public string Unite { get; set; } = "";
        public bool EstAchete { get; set; }

        public ArticleLocal() { }

        public ArticleLocal(ArticleCourse a)
        {
            Id = a.Id;                 // int -> int ‚úÖ
            Nom = a.Nom ?? "";
            Quantite = a.Quantite ?? "";
            Unite = a.Unite ?? "";
            EstAchete = a.EstAchete;
        }

        public ArticleCourse ToModel()
        {
            return new ArticleCourse
            {
                Id = Id,              // int -> int ‚úÖ
                Nom = Nom,
                Quantite = Quantite,
                Unite = Unite,
                EstAchete = EstAchete
            };
        }
    }
}

================================================================================
FILE: Services\Local\IngredientLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

public class IngredientLocal
{
    [PrimaryKey]
    public Guid Id { get; set; }
    public string Nom { get; set; } = "";
    public string? Quantite { get; set; }
    public string? Unite { get; set; }
    public bool EstDisponible { get; set; }

    public IngredientLocal() { }

    public IngredientLocal(Ingredient i)
    {
        Id = i.Id;
        Nom = i.Nom;
        Quantite = i.Quantite;
        Unite = i.Unite;
        EstDisponible = i.EstDisponible;
    }

    public Ingredient ToModel() => new Ingredient
    {
        Id = Id,
        Nom = Nom,
        Quantite = Quantite,
        Unite = Unite,
        EstDisponible = EstDisponible
    };
}

================================================================================
FILE: Services\Local\LocalDatabase.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local;

public class LocalDatabase
{
    private readonly SQLiteAsyncConnection _db;

    public LocalDatabase(string path)
    {
        _db = new SQLiteAsyncConnection(path);
        _db.CreateTableAsync<IngredientLocal>().Wait();
        _db.CreateTableAsync<ArticleLocal>().Wait();
        _db.CreateTableAsync<RecetteLocal>().Wait();

    }

    // ---------- INGREDIENTS ----------
    public Task<List<IngredientLocal>> GetIngredientsAsync() =>
        _db.Table<IngredientLocal>().ToListAsync();

    public Task SaveIngredientsAsync(IEnumerable<Ingredient> ingredients)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<IngredientLocal>();
            foreach (var i in ingredients)
                tran.Insert(new IngredientLocal(i));
        });
    }

    // ---------- ARTICLES ----------
    public Task<List<ArticleLocal>> GetArticlesAsync() =>
        _db.Table<ArticleLocal>().ToListAsync();

    public Task SaveArticlesAsync(IEnumerable<ArticleCourse> articles)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<ArticleLocal>();
            foreach (var a in articles)
                tran.Insert(new ArticleLocal(a));
        });
    }

    public Task<List<RecetteLocal>> GetRecettesAsync() =>
    _db.Table<RecetteLocal>().ToListAsync();

    public Task SaveRecettesAsync(IEnumerable<Recette> recettes)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<RecetteLocal>();
            foreach (var r in recettes)
                tran.Insert(new RecetteLocal(r));
        });
    }
}

================================================================================
FILE: Services\Local\RecetteLocal.cs
================================================================================

Ôªøusing System;
using SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class RecetteLocal
    {
        [PrimaryKey]
        public string Id { get; set; } = ""; // Guid stock√© en texte

        public string Nom { get; set; } = "";
        public int TempsPreparation { get; set; }
        public string Instructions { get; set; } = "";
        public string CategorieDb { get; set; } = "";
        public int Type { get; set; } // enum -> int

        public RecetteLocal() { }

        public RecetteLocal(Recette r)
        {
            // adapte selon ton type r√©el :
            // si r.Id est Guid => r.Id.ToString()
            // si r.Id est string => r.Id
            // si r.Id est int => r.Id.ToString()
            Id = r.Id.ToString();

            Nom = r.Nom ?? "";
            TempsPreparation = r.TempsPreparation;
            Instructions = r.Instructions ?? "";
            CategorieDb = r.CategorieDb ?? "";
            Type = (int)r.Type;
        }

        public Recette ToModel()
        {
            // si Recette.Id est Guid, remets Guid.Parse
            // sinon adapte.
            Guid.TryParse(Id, out var guid);

            return new Recette
            {
                Id = guid,
                Nom = Nom,
                TempsPreparation = TempsPreparation,
                Instructions = Instructions,
                CategorieDb = CategorieDb,
                Type = (TypePlat)Type
            };
        }
    }
}

================================================================================
FILE: Services\OcrService.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text.Json;

namespace LoGeCuiMobile.Services
{
    public sealed class OcrService
    {
        private readonly HttpClient _http;
        private readonly string _apiKey;

        public OcrService(string apiKey)
        {
            _apiKey = apiKey ?? throw new ArgumentNullException(nameof(apiKey));
            _http = new HttpClient { Timeout = TimeSpan.FromSeconds(60) };
        }

        public async Task<string> ExtractTextFromImageAsync(byte[] imageBytes, string fileName = "scan.jpg")
        {
            if (imageBytes is null || imageBytes.Length == 0)
                throw new ArgumentException("Image vide.", nameof(imageBytes));

            if (string.IsNullOrWhiteSpace(_apiKey))
                throw new InvalidOperationException("Cl√© OCR manquante (apiKey).");

            var url = "https://api.ocr.space/parse/image";

            using var content = new MultipartFormDataContent();

            // Param√®tres utiles
            content.Add(new StringContent("fre"), "language");          // fre = fran√ßais
            content.Add(new StringContent("false"), "isOverlayRequired");
            content.Add(new StringContent("2"), "OCREngine");           // 1 ou 2 (2 souvent meilleur)
            content.Add(new StringContent("true"), "scale");
            content.Add(new StringContent("true"), "detectOrientation");

            var fileContent = new ByteArrayContent(imageBytes);
            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("image/jpeg");
            content.Add(fileContent, "file", fileName);

            using var request = new HttpRequestMessage(HttpMethod.Post, url);
            request.Headers.Add("apikey", _apiKey); // ‚úÖ endroit le plus fiable
            request.Content = content;

            using var resp = await _http.SendAsync(request);
            var json = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"OCR HTTP {(int)resp.StatusCode}: {json}");

            using var doc = JsonDocument.Parse(json);

            // Si l‚ÄôAPI retourne une erreur applicative
            if (doc.RootElement.TryGetProperty("IsErroredOnProcessing", out var errored)
                && errored.ValueKind == JsonValueKind.True)
            {
                string msg = "Erreur OCR.";
                if (doc.RootElement.TryGetProperty("ErrorMessage", out var em))
                {
                    // ErrorMessage peut √™tre string ou tableau selon les cas
                    msg = em.ValueKind switch
                    {
                        JsonValueKind.Array => string.Join(" | ", em.EnumerateArray().Select(x => x.ToString())),
                        _ => em.ToString()
                    };
                }
                throw new Exception(msg);
            }

            if (!doc.RootElement.TryGetProperty("ParsedResults", out var parsedResults)
                || parsedResults.ValueKind != JsonValueKind.Array
                || parsedResults.GetArrayLength() == 0)
            {
                return "";
            }

            var first = parsedResults[0];
            if (!first.TryGetProperty("ParsedText", out var parsedTextEl))
                return "";

            return parsedTextEl.GetString() ?? "";
        }
    }
}



================================================================================
FILE: Services\Skiasharp.cs
================================================================================

Ôªøusing SkiaSharp;

namespace LoGeCuiMobile.Services
{
    public static class ImageCompressionHelper
    {
        public static byte[] CompressJpeg(
            byte[] input,
            int maxWidth = 1600,
            int jpegQuality = 75)
        {
            using var inputStream = new SKMemoryStream(input);
            using var codec = SKCodec.Create(inputStream);
            using var bitmap = SKBitmap.Decode(codec);

            if (bitmap == null)
                throw new InvalidOperationException("Impossible de d√©coder l'image.");

            var width = bitmap.Width;
            var height = bitmap.Height;

            if (width > maxWidth)
            {
                var ratio = (float)maxWidth / width;
                var newW = maxWidth;
                var newH = (int)(height * ratio);

                using var resized = bitmap.Resize(
                    new SKImageInfo(newW, newH),
                    SKFilterQuality.Medium);

                using var image = SKImage.FromBitmap(resized);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
            else
            {
                using var image = SKImage.FromBitmap(bitmap);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
        }
    }
}


================================================================================
FILE: Services\SupabaseConfig.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public static class SupabaseConfig
    {
        public static string Url { get; } = ConfigurationHelper.GetSupabaseUrl();
        public static string Key { get; } = ConfigurationHelper.GetSupabaseKey();
    }
}

================================================================================
FILE: ViewModels\ArticleCourseUi.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    // Wrapper UI: on conserve ArticleCourse et on ajoute une s√©lection locale (non persist√©e)
    public class ArticleCourseUi : INotifyPropertyChanged
    {
        public ArticleCourseUi(ArticleCourse model) => Model = model;

        public ArticleCourse Model { get; }

        public int Id => Model.Id;

        public string Nom
        {
            get => Model.Nom;
            set { if (Model.Nom != value) { Model.Nom = value; OnPropertyChanged(); } }
        }

        public string Quantite
        {
            get => Model.Quantite;
            set { if (Model.Quantite != value) { Model.Quantite = value; OnPropertyChanged(); } }
        }

        public string Unite
        {
            get => Model.Unite;
            set { if (Model.Unite != value) { Model.Unite = value; OnPropertyChanged(); } }
        }

        public bool EstAchete
        {
            get => Model.EstAchete;
            set { if (Model.EstAchete != value) { Model.EstAchete = value; OnPropertyChanged(); } }
        }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set { if (_isSelectedForDelete != value) { _isSelectedForDelete = value; OnPropertyChanged(); } }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}


================================================================================
FILE: ViewModels\MesRecettesViewModel.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.ViewModels
{
    public enum AvailabilityState
    {
        Unknown,
        AllAvailable,
        Missing
    }

    // ‚úÖ UI wrapper (selection, couleurs, etc.)
    public class RecetteUi : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        public Recette Model { get; }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(IsSelectedForDelete)));
            }
        }

        private AvailabilityState _availabilityState = AvailabilityState.Unknown;
        public AvailabilityState AvailabilityState
        {
            get => _availabilityState;
            set
            {
                if (_availabilityState == value) return;
                _availabilityState = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityState)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        private int _missingCount;
        public int MissingCount
        {
            get => _missingCount;
            set
            {
                if (_missingCount == value) return;
                _missingCount = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(MissingCount)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        public string AvailabilityLabel =>
            AvailabilityState == AvailabilityState.Unknown ? "Disponibilit√© inconnue"
            : AvailabilityState == AvailabilityState.AllAvailable ? "‚úÖ Tous ingr√©dients disponibles"
            : $"‚ùå Manque {MissingCount} ingr√©dient(s)";

        public Guid Id => Model.Id;
        public string Nom => Model.Nom;
        public string TypeTexte => Model.TypeTexte;
        public int TempsPreparation => Model.TempsPreparation;
        public string DifficulteTexte => Model.DifficulteTexte;

        public RecetteUi(Recette r) => Model = r;
    }

    public class MesRecettesViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));

        private readonly RecipesService _recipesService;

        public ObservableCollection<RecetteUi> Recettes { get; } = new();

        public ObservableCollection<string> Categories { get; } =
            new() { "Toutes", "Entr√©es", "Plats", "Desserts" };

        private string _selectedCategorie = "Toutes";
        public string SelectedCategorie
        {
            get => _selectedCategorie;
            set
            {
                if (_selectedCategorie == value) return;
                _selectedCategorie = value;
                OnPropertyChanged(nameof(SelectedCategorie));
                ApplyFilter(); // ‚úÖ synchro
            }
        }

        public ICommand RefreshCommand { get; }

        private bool _isBusy;
        public bool IsBusy
        {
            get => _isBusy;
            private set
            {
                if (_isBusy == value) return;
                _isBusy = value;
                OnPropertyChanged(nameof(IsBusy));
            }
        }

        private List<Recette> _all = new();

        public MesRecettesViewModel(RecipesService recipesService)
        {
            _recipesService = recipesService;
            RefreshCommand = new Command(async () => await LoadAsync(forceRemote: true));
        }

        // ------------------ HELPERS erreurs Supabase ------------------

        private static bool IsJwtExpired(Exception ex)
        {
            // On d√©tecte "JWT expired" m√™me si c'est encapsul√© dans une exception
            var msg = ex.ToString();
            return msg.Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        private static bool IsNetworkRelated(Exception ex)
        {
            // Large: HttpRequestException, timeout, etc.
            // On fait simple: si on est online mais l'appel rate, on fallback cache.
            // (Si tu veux, on peut raffiner apr√®s.)
            var msg = ex.ToString();
            return msg.Contains("HttpRequestException", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timed out", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timeout", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("network", StringComparison.OrdinalIgnoreCase);
        }

        // ------------------ LOAD ------------------

        public async Task LoadAsync(bool forceRemote = false)
        {
            if (IsBusy) return;

            try
            {
                IsBusy = true;

                // 0) Cache local d‚Äôabord (offline friendly)
                var local = await App.LocalDb.GetRecettesAsync();
                _all = local.Select(x => x.ToModel()).ToList();

                // 1) Si internet + connect√© : refresh
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var app = (App)Microsoft.Maui.Controls.Application.Current;

                    if (app.IsConnected && app.CurrentUserId != null)
                    {
                        try
                        {
                            var remote = await _recipesService.GetRecettesAsync(app.CurrentUserId.Value)
                                         ?? new List<Recette>();

                            // Si forceRemote on remplace toujours
                            // Sinon: on remplace si remote non vide (√©vite d‚Äô√©craser cache avec vide)
                            if (forceRemote || remote.Count > 0)
                            {
                                _all = remote;
                                await App.LocalDb.SaveRecettesAsync(remote);
                            }
                        }
                        catch (Exception ex)
                        {
                            // ‚úÖ IMPORTANT : si JWT expir√©, on reste sur cache (ne pas crasher l'app)
                            if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                            {
                                // Optionnel: tu peux d√©clencher une UI "Reconnecte-toi"
                                // mais ici on reste silencieux pour que l'app d√©marre.
                            }
                            else
                            {
                                // Autres erreurs: on laisse remonter (ou tu peux aussi fallback)
                                throw;
                            }
                        }
                    }
                }

                ApplyFilter();
            }
            finally
            {
                IsBusy = false;
            }
        }

        private void ApplyFilter()
        {
            IEnumerable<Recette> filtered = _all;

            if (SelectedCategorie == "Entr√©es")
                filtered = _all.Where(r => r.Type == TypePlat.Entree);
            else if (SelectedCategorie == "Plats")
                filtered = _all.Where(r => r.Type == TypePlat.Plat);
            else if (SelectedCategorie == "Desserts")
                filtered = _all.Where(r => r.Type == TypePlat.Dessert);

            Recettes.Clear();
            foreach (var r in filtered)
                Recettes.Add(new RecetteUi(r));
        }

        // -------- Availability (vert/rouge) --------
        public async Task RefreshAvailabilityAsync()
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            // Offline => Unknown
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            try
            {
                var userId = app.CurrentUserId.Value;

                // 1) ingr√©dients dispo user
                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                // 2) pour chaque recette, calcule missing (‚ö†Ô∏è N requ√™tes - ok pour d√©marrer)
                foreach (var r in Recettes)
                {
                    var rows = await app.RecetteIngredientsService.GetForRecetteAsync(r.Model.Id);

                    var recipeNames = rows
                        .Select(x => Norm(x.nom))
                        .Where(s => !string.IsNullOrWhiteSpace(s))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    if (recipeNames.Count == 0)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                        continue;
                    }

                    var missing = recipeNames
                        .Where(n => !userSet.Contains(n))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    r.MissingCount = missing.Count;
                    r.AvailabilityState = (missing.Count == 0) ? AvailabilityState.AllAvailable : AvailabilityState.Missing;
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ si JWT expir√© => on met tout en Unknown et on sort
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                {
                    foreach (var r in Recettes)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                    }
                    return;
                }

                throw;
            }
        }

        // -------- Actions recette -> liste de courses --------
        public async Task<List<string>?> GetMissingIngredientsForRecipeAsync(Recette recette)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return null;

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
                return null;

            try
            {
                var userId = app.CurrentUserId.Value;

                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                var rows = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);
                var recipeNames = rows
                    .Select(x => (x.nom ?? "").Trim())
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                if (recipeNames.Count == 0)
                    return null;

                var missing = recipeNames
                    .Where(n => !userSet.Contains(Norm(n)))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                return missing;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return null;

                throw;
            }
        }

        public async Task<bool> SendMissingToShoppingAsync(List<string> missing)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return false;

            if (!app.IsConnected || app.CurrentUserId == null || app.ListeCoursesSupabaseService == null)
                return false;

            try
            {
                await app.ListeCoursesSupabaseService.AddMissingAsync(app.CurrentUserId.Value, missing);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return false;

                throw;
            }
        }

        // -------- Suppression --------
        public async Task DeleteSelectedAsync(List<RecetteUi> selected)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            // Optimistic UI
            foreach (var r in selected.ToList())
                Recettes.Remove(r);

            // Supabase si possible
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet && app.IsConnected && app.RecipesService != null)
            {
                try
                {
                    foreach (var r in selected)
                        await app.RecipesService.DeleteRecetteAsync(r.Model.Id);
                }
                catch (Exception ex)
                {
                    // si JWT expir√© => on ne peut pas supprimer c√¥t√© serveur.
                    // on reload depuis cache pour √™tre coh√©rent
                    if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                        throw;
                }
            }

            // Recharge (cache + remote si possible)
            await LoadAsync(forceRemote: true);

            // Refresh disponibilit√© (si possible)
            try
            {
                await RefreshAvailabilityAsync();
            }
            catch (Exception ex)
            {
                if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                    throw;
            }
        }

        public Task DeleteOneAsync(RecetteUi one)
            => DeleteSelectedAsync(new List<RecetteUi> { one });

        // -------- Helpers --------
        private static string Norm(string? s)
            => (s ?? "").Trim().ToLowerInvariant();
    }
}
