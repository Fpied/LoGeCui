# CONCAT OUTPUT
# Root: C:\Users\Francois\source\repos\LoGeCui
# Files: 118


================================================================================
FILE: LoGeCui\App.xaml
================================================================================

Ôªø<Application x:Class="LoGeCui.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Application.Resources>
         
    </Application.Resources>
</Application>

================================================================================
FILE: LoGeCui\App.xaml.cs
================================================================================

Ôªøusing System;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCui
{
    public partial class App : Application
    {
        // AJOUT√â : Instance unique de SupabaseService
        public static SupabaseService SupabaseService { get; private set; }
        public static SupabaseRestClient? RestClient { get; private set; }
        public static RecipesService? RecipesService { get; private set; }
        public static Guid? CurrentUserId { get; private set; }

        protected override void OnStartup(StartupEventArgs e)
        {
            base.OnStartup(e);

            // AJOUT√â : Initialiser le service Supabase UNE SEULE FOIS
            string url = ConfigurationHelper.GetSupabaseUrl();
            string key = ConfigurationHelper.GetSupabaseKey(); // Remplace par ta cl√© anon

            // Cr√©er l'instance UNE SEULE FOIS
            SupabaseService = new SupabaseService(url, key);

            // Ouvrir la fen√™tre de connexion en premier
            var loginWindow = new LoginWindow();
            loginWindow.Show();
        }

        public static void InitRestServices(string accessToken, Guid userId)
        {
            string url = ConfigurationHelper.GetSupabaseUrl();
            string key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            RestClient = client;
            RecipesService = new RecipesService(client);
            CurrentUserId = userId;
        }
    }
}

================================================================================
FILE: LoGeCui\appsettings.example.json
================================================================================

Ôªø{
  "Supabase": {
    "Url": "https://VOTRE_PROJECT_ID.supabase.co",
    "Key": "VOTRE_PUBLISHABLE_KEY"
  }
}

================================================================================
FILE: LoGeCui\appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  }

}

================================================================================
FILE: LoGeCui\AssemblyInfo.cs
================================================================================

using System.Windows;

[assembly: ThemeInfo(
    ResourceDictionaryLocation.None,            //where theme specific resource dictionaries are located
                                                //(used if a resource is not found in the page,
                                                // or application resource dictionaries)
    ResourceDictionaryLocation.SourceAssembly   //where the generic resource dictionary is located
                                                //(used if a resource is not found in the page,
                                                // app, or any theme specific resource dictionaries)
)]

================================================================================
FILE: LoGeCui\ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using System;
using System.IO;

namespace LoGeCui
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;

        public static IConfiguration Configuration
        {
            get
            {
                if (_configuration == null)
                {
                    var builder = new ConfigurationBuilder()
                        .SetBasePath(AppDomain.CurrentDomain.BaseDirectory)
                        .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true);

                    _configuration = builder.Build();
                }
                return _configuration;
            }
        }

        public static string GetSupabaseUrl()
        {
            return Configuration["Supabase:Url"] ?? throw new Exception("Supabase URL non configur√©e");
        }

        public static string GetSupabaseKey()
        {
            return Configuration["Supabase:Key"] ?? throw new Exception("Supabase Key non configur√©e");
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterArticleCourseDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterArticleCourseDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter un article" 
        Height="400" 
        Width="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0"
                   Text="üõí Ajouter √† la liste de courses"
                   FontSize="18"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <StackPanel Grid.Row="1" Margin="0,0,0,10">
            <TextBlock Text="Nom *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtNom"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <StackPanel Grid.Row="2" Margin="0,0,0,10">
            <TextBlock Text="Quantit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtQuantite"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <StackPanel Grid.Row="3" Margin="0,0,0,10">
            <TextBlock Text="Unit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <ComboBox x:Name="CmbUnite"
                      Height="30"
                      FontSize="13"
                      Padding="5">
                <ComboBoxItem Content="g"/>
                <ComboBoxItem Content="kg"/>
                <ComboBoxItem Content="ml"/>
                <ComboBoxItem Content="L"/>
                <ComboBoxItem Content="pi√®ces" IsSelected="True"/>
                <ComboBoxItem Content="bo√Ætes"/>
                <ComboBoxItem Content="sachets"/>
            </ComboBox>
        </StackPanel>

        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">

            <Button Content="Annuler"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAnnuler_Click"/>

            <Button Content="Ajouter"
                    Width="100"
                    Height="35"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAjouter_Click"/>

        </StackPanel>

    </Grid>

</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterArticleCourseDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using LoGeCuiShared.Models;

namespace LoGeCui.Dialogs
{
    public partial class AjouterArticleCourseDialog : Window
    {
        public ArticleCourse? NouvelArticle { get; private set; }

        public AjouterArticleCourseDialog()
        {
            InitializeComponent();
            TxtNom.Focus();
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtQuantite.Text))
            {
                MessageBox.Show("Veuillez entrer une quantit√©.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            NouvelArticle = new ArticleCourse
            {
                Nom = TxtNom.Text.Trim(),
                Quantite = TxtQuantite.Text.Trim(),
                Unite = (CmbUnite.SelectedItem as System.Windows.Controls.ComboBoxItem)?.Content.ToString() ?? "pi√®ces",
                EstAchete = false
            };

            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterIngredientDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter un ingr√©dient" 
        Height="700" 
        Width="450"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Titre -->
        <TextBlock Grid.Row="0"
                   Text="‚ûï Nouvel ingr√©dient"
                   FontSize="22"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,20"/>
        
        <!-- Nom -->
        <StackPanel Grid.Row="1" Margin="0,0,0,15">
            <TextBlock Text="Nom de l'ingr√©dient *"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Foreground="#34495E"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtNom"
                     Height="35"
                     FontSize="14"
                     Padding="8"
                     BorderBrush="#BDC3C7"
                     BorderThickness="1"/>
        </StackPanel>
        
        <!-- Quantit√© -->
        <StackPanel Grid.Row="2" Margin="0,0,0,15">
            <TextBlock Text="Quantit√© *"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Foreground="#34495E"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtQuantite"
                     Height="35"
                     FontSize="14"
                     Padding="8"
                     BorderBrush="#BDC3C7"
                     BorderThickness="1"/>
        </StackPanel>
        
        <!-- Unit√© -->
        <StackPanel Grid.Row="3" Margin="0,0,0,15">
            <TextBlock Text="Unit√© *"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Foreground="#34495E"
                       Margin="0,0,0,5"/>
            <ComboBox x:Name="CmbUnite"
                      Height="35"
                      FontSize="14"
                      Padding="8,5"
                      BorderBrush="#BDC3C7"
                      BorderThickness="1">
                <ComboBoxItem Content="kg" IsSelected="True"/>
                <ComboBoxItem Content="g"/>
                <ComboBoxItem Content="L"/>
                <ComboBoxItem Content="ml"/>
                <ComboBoxItem Content="pi√®ces"/>
                <ComboBoxItem Content="sachets"/>
                <ComboBoxItem Content="bo√Ætes"/>
            </ComboBox>
        </StackPanel>
        
        <!-- Boutons -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right">
            
            <Button Content="‚ùå Annuler"
                    Width="120"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnAnnuler_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#95A5A6"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#7F8C8D"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            
            <Button Content="‚úÖ Ajouter"
                    Width="120"
                    Height="40"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnAjouter_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            
        </StackPanel>
        
    </Grid>
    
</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using LoGeCuiShared.Models;

namespace LoGeCui.Dialogs
{
    public partial class AjouterIngredientDialog : Window
    {
        // Propri√©t√© pour r√©cup√©rer l'ingr√©dient cr√©√©
        public Ingredient? NouvelIngredient { get; private set; }

        public AjouterIngredientDialog()
        {
            InitializeComponent();

            // Focus sur le premier champ
            TxtNom.Focus();
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            // Validation : v√©rifier que tous les champs sont remplis
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom d'ingr√©dient.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtNom.Focus();
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtQuantite.Text))
            {
                MessageBox.Show("Veuillez entrer une quantit√©.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtQuantite.Focus();
                return;
            }

            // Cr√©er l'ingr√©dient
            NouvelIngredient = new Ingredient
            {
                Nom = TxtNom.Text.Trim(),
                Quantite = TxtQuantite.Text.Trim(),
                Unite = (CmbUnite.SelectedItem as ComboBoxItem)?.Content.ToString() ?? "pi√®ces",
                EstDisponible = true
            };

            // Fermer la fen√™tre avec succ√®s
            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            // Fermer sans rien faire
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientRecetteDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterIngredientRecetteDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter un ingr√©dient" 
        Height="400" 
        Width="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Titre -->
        <TextBlock Grid.Row="0"
                   Text="ü•ò Ajouter un ingr√©dient"
                   FontSize="18"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <!-- Nom -->
        <StackPanel Grid.Row="1" Margin="0,0,0,10">
            <TextBlock Text="Nom *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtNom"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <!-- Quantit√© -->
        <StackPanel Grid.Row="2" Margin="0,0,0,10">
            <TextBlock Text="Quantit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtQuantite"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <!-- Unit√© -->
        <StackPanel Grid.Row="3" Margin="0,0,0,10">
            <TextBlock Text="Unit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <ComboBox x:Name="CmbUnite"
                      Height="30"
                      FontSize="13"
                      Padding="5">
                <ComboBoxItem Content="g"/>
                <ComboBoxItem Content="kg"/>
                <ComboBoxItem Content="ml"/>
                <ComboBoxItem Content="L"/>
                <ComboBoxItem Content="pi√®ces" IsSelected="True"/>
                <ComboBoxItem Content="cuill√®res √† soupe"/>
                <ComboBoxItem Content="cuill√®res √† caf√©"/>
            </ComboBox>
        </StackPanel>

        <!-- Boutons -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">

            <Button Content="Annuler"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAnnuler_Click"/>

            <Button Content="Ajouter"
                    Width="100"
                    Height="35"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAjouter_Click"/>

        </StackPanel>

    </Grid>

</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientRecetteDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using LoGeCuiShared.Models;

namespace LoGeCui.Dialogs
{
    /// <summary>
    /// Logique d'interaction pour AjouterIngredientRecetteDialog.xaml
    /// </summary>
    public partial class AjouterIngredientRecetteDialog : Window
    {
        public IngredientRecette? NouvelIngredient { get; private set; }  // ‚Üê LIGNE AJOUT√âE !

        public AjouterIngredientRecetteDialog()
        {
            InitializeComponent();
            TxtNom.Focus();
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtQuantite.Text))
            {
                MessageBox.Show("Veuillez entrer une quantit√©.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            NouvelIngredient = new IngredientRecette  // ‚Üê CHANG√â aussi ici !
            {
                Nom = TxtNom.Text.Trim(),
                Quantite = TxtQuantite.Text.Trim(),
                Unite = (CmbUnite.SelectedItem as System.Windows.Controls.ComboBoxItem)?.Content.ToString() ?? "pi√®ces"
            };

            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterRecetteDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterRecetteDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter une recette" 
        Height="700" 
        Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Titre -->
            <TextBlock Grid.Row="0"
                       Text="‚ûï Nouvelle recette"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#2C3E50"
                       Margin="0,0,0,20"/>

            <!-- Nom -->
            <StackPanel Grid.Row="1" Margin="0,0,0,15">
                <TextBlock Text="Nom de la recette *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>
                <TextBox x:Name="TxtNom"
                         Height="35"
                         FontSize="14"
                         Padding="8"
                         BorderBrush="#BDC3C7"
                         BorderThickness="1"/>
            </StackPanel>

            <!-- Type et Temps sur la m√™me ligne -->
            <Grid Grid.Row="2" Margin="0,0,0,15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Type -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Type *"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="#34495E"
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="CmbType"
                              Height="35"
                              FontSize="14"
                              Padding="8,5"
                              BorderBrush="#BDC3C7"
                              BorderThickness="1">
                        <ComboBoxItem Content="Entr√©e" Tag="Entree"/>
                        <ComboBoxItem Content="Plat" Tag="Plat" IsSelected="True"/>
                        <ComboBoxItem Content="Dessert" Tag="Dessert"/>
                    </ComboBox>
                </StackPanel>

                <!-- Temps -->
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Temps (minutes) *"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="#34495E"
                               Margin="0,0,0,5"/>
                    <TextBox x:Name="TxtTemps"
                             Height="35"
                             FontSize="14"
                             Padding="8"
                             BorderBrush="#BDC3C7"
                             BorderThickness="1"/>
                </StackPanel>
            </Grid>

            <!-- Difficult√© -->
            <StackPanel Grid.Row="3" Margin="0,0,0,15">
                <TextBlock Text="Difficult√© *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>
                <StackPanel Orientation="Horizontal">
                    <Slider x:Name="SliderDifficulte"
                            Width="400"
                            Minimum="1"
                            Maximum="5"
                            Value="3"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            VerticalAlignment="Center"
                            ValueChanged="SliderDifficulte_ValueChanged"/>
                    <TextBlock x:Name="TxtDifficulte"
                               Text="‚≠ê‚≠ê‚≠ê"
                               FontSize="18"
                               Margin="10,0,0,0"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <!-- Ingr√©dients -->
            <StackPanel Grid.Row="4" Margin="0,0,0,15">
                <TextBlock Text="Ingr√©dients *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>

                <!-- Liste des ingr√©dients ajout√©s -->
                <Border BorderBrush="#BDC3C7"
                        BorderThickness="1"
                        CornerRadius="3"
                        Background="White"
                        MinHeight="100"
                        MaxHeight="150"
                        Margin="0,0,0,10">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ListBox x:Name="ListeIngredients"
                                 BorderThickness="0"
                                 Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding}"
                                                   VerticalAlignment="Center"/>

                                        <Button Grid.Column="1"
                                                Content="‚ùå"
                                                Width="25"
                                                Height="25"
                                                FontSize="10"
                                                Background="#E74C3C"
                                                Foreground="White"
                                                BorderThickness="0"
                                                Cursor="Hand"
                                                Click="BtnSupprimerIngredient_Click"
                                                Tag="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </ScrollViewer>
                </Border>

                <Button Content="‚ûï Ajouter un ingr√©dient"
                        Height="35"
                        Background="#27AE60"
                        Foreground="White"
                        FontSize="13"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAjouterIngredient_Click"/>
            </StackPanel>

            <!-- Instructions -->
            <StackPanel Grid.Row="5" Margin="0,0,0,15">
                <TextBlock Text="Instructions *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>
                <TextBox x:Name="TxtInstructions"
                         Height="100"
                         FontSize="14"
                         Padding="8"
                         BorderBrush="#BDC3C7"
                         BorderThickness="1"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"/>
            </StackPanel>

            <!-- Boutons -->
            <StackPanel Grid.Row="8"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,20,0,0">

                <Button Content="‚ùå Annuler"
                        Width="120"
                        Height="40"
                        Margin="0,0,10,0"
                        Background="#95A5A6"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAnnuler_Click"/>

                <Button Content="‚úÖ Ajouter"
                        Width="120"
                        Height="40"
                        Background="#27AE60"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAjouter_Click"/>

            </StackPanel>

        </Grid>
    </ScrollViewer>

</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterRecetteDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using System.Collections.ObjectModel;
using LoGeCuiShared.Models;


namespace LoGeCui.Dialogs
{
    /// <summary>
    /// Logique d'interaction pour AjouterRecetteDialog.xaml
    /// </summary>
    public partial class AjouterRecetteDialog : Window
    {

        public Recette? NouvelleRecette { get; private set; }
        private ObservableCollection<IngredientRecette> _ingredients;

        public AjouterRecetteDialog()
        {
            InitializeComponent();

            _ingredients = new ObservableCollection<IngredientRecette>();
            ListeIngredients.ItemsSource = _ingredients;

            TxtNom.Focus();
        }

        private void SliderDifficulte_ValueChanged(object sender, RoutedPropertyChangedEventArgs<double> e)
        {
            if (TxtDifficulte != null)
            {
                int valeur = (int)SliderDifficulte.Value;
                TxtDifficulte.Text = new string('‚≠ê', valeur);
            }
        }

        private void BtnAjouterIngredient_Click(object sender, RoutedEventArgs e)
        {
            // Cr√©er une petite fen√™tre pour ajouter un ingr√©dient
            var dialogIngredient = new AjouterIngredientRecetteDialog();
            dialogIngredient.Owner = this;

            bool? resultat = dialogIngredient.ShowDialog();

            if (resultat == true && dialogIngredient.NouvelIngredient != null)
            {
                _ingredients.Add(dialogIngredient.NouvelIngredient);
            }
        }

        private void BtnSupprimerIngredient_Click(object sender, RoutedEventArgs e)
        {
            var bouton = sender as System.Windows.Controls.Button;
            var ingredient = bouton?.Tag as IngredientRecette;

            if (ingredient != null)
            {
                _ingredients.Remove(ingredient);
            }
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            // Validation
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom de recette.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtNom.Focus();
                return;
            }

            if (!int.TryParse(TxtTemps.Text, out int temps) || temps <= 0)
            {
                MessageBox.Show("Veuillez entrer un temps de pr√©paration valide.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtTemps.Focus();
                return;
            }

            if (_ingredients.Count == 0)
            {
                MessageBox.Show("Veuillez ajouter au moins un ingr√©dient.",
                    "Ingr√©dients requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtInstructions.Text))
            {
                MessageBox.Show("Veuillez entrer les instructions.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtInstructions.Focus();
                return;
            }

            // R√©cup√©rer le type
            var selectedItem = CmbType.SelectedItem as System.Windows.Controls.ComboBoxItem;
            var typeTag = selectedItem?.Tag?.ToString() ?? "Plat";

            TypePlat type = typeTag switch
            {
                "Entree" => TypePlat.Entree,
                "Dessert" => TypePlat.Dessert,
                _ => TypePlat.Plat
            };

            // Cr√©er la recette
            NouvelleRecette = new Recette
            {
                Nom = TxtNom.Text.Trim(),
                Type = type,
                TempsPreparation = temps,
                Difficulte = (int)SliderDifficulte.Value,
                Ingredients = new System.Collections.Generic.List<IngredientRecette>(_ingredients),
                Instructions = TxtInstructions.Text.Trim()
            };

            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\LoGeCui.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net10.0-windows</TargetFramework>
	  <SelfContained>true</SelfContained>
	  <PublishSingleFile>true</PublishSingleFile>
	  <IncludeNativeLibrariesForSelfExtract>true</IncludeNativeLibrariesForSelfExtract>
	  <IncludeAllContentForSelfExtract>true</IncludeAllContentForSelfExtract>
	  <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <UseWPF>true</UseWPF>
    <Version>1.1.5</Version>
	  <ApplicationIcon>postriticone.ico</ApplicationIcon>
  </PropertyGroup>

	<ItemGroup>
		<EmbeddedResource Include="appsettings.json" />
	</ItemGroup>

  <ItemGroup>
    <None Remove="appsettings.json" />
    <None Remove="postriticone.ico" />
  </ItemGroup>

  <ItemGroup>
    <Content Include="appsettings.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
    <PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
  </ItemGroup>

  <ItemGroup>
    <Resource Include="postriticone.ico">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Resource>
  </ItemGroup>

</Project>

================================================================================
FILE: LoGeCui\LoginWindow.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.LoginWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="LoGeCui - Connexion"
        Height="600" Width="500"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Grid Background="#F5F5F5">
        <Border Background="White"
                CornerRadius="10"
                Padding="40"
                Margin="40">
            <StackPanel>
                <!-- Logo / Titre -->
                <TextBlock Text="üõí LoGeCui"
                          FontSize="48"
                          FontWeight="Bold"
                          HorizontalAlignment="Center"
                          Foreground="#27AE60"
                          Margin="0,0,0,40"/>

                <!-- Email -->
                <TextBlock Text="Email :" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox x:Name="TxtEmail"
                        Padding="10"
                        FontSize="14"
                        Margin="0,0,0,15"/>

                <!-- Mot de passe -->
                <TextBlock Text="Mot de passe :" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <PasswordBox x:Name="TxtPassword"
                            Padding="10"
                            FontSize="14"
                            Margin="0,0,0,20"/>

                <!-- Boutons -->
                <Button x:Name="BtnConnexion"
                       Content="Se connecter"
                       Background="#27AE60"
                       Foreground="White"
                       Padding="15"
                       FontSize="16"
                       FontWeight="SemiBold"
                       BorderThickness="0"
                       Cursor="Hand"
                       Margin="0,0,0,10"
                       Click="BtnConnexion_Click"/>

                <Button x:Name="BtnInscription"
                       Content="Cr√©er un compte"
                       Background="#3498DB"
                       Foreground="White"
                       Padding="15"
                       FontSize="16"
                       FontWeight="SemiBold"
                       BorderThickness="0"
                       Cursor="Hand"
                       Click="BtnInscription_Click"/>

                <!-- Message -->
                <TextBlock x:Name="TxtMessage"
                          Foreground="Red"
                          TextWrapping="Wrap"
                          HorizontalAlignment="Center"
                          Margin="0,15,0,0"
                          FontSize="12"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>

================================================================================
FILE: LoGeCui\LoginWindow.xaml.cs
================================================================================

Ôªøusing System;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCui
{
    public partial class LoginWindow : Window
    {
        public LoginWindow()
        {
            InitializeComponent();
        }

        private async void BtnConnexion_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                SetStatus("Connexion en cours...", isError: false);

                string email = TxtEmail.Text.Trim();
                string password = TxtPassword.Password;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus("Veuillez remplir tous les champs.", isError: true);
                    return;
                }

                var (success, accessToken, userIdString, error) = await App.SupabaseService.SignInAsync(email, password);


                if (!success)
                {
                    SetStatus(error ?? "Erreur de connexion", isError: true);
                    return;
                }
                if (!Guid.TryParse(userIdString, out var userId))
                {
                    SetStatus("ID utilisateur invalide.", isError: true);
                    return;
                }

                App.InitRestServices(accessToken, userId);


                // ‚¨áÔ∏è ICI : import des recettes locales vers Supabase (une seule fois)
                await ImporterRecettesLocalVersSupabaseSiBesoinAsync(userId);

                // V√©rifier les mises √† jour (optionnel)
                await CheckForUpdatesAsync();

                // Ouvrir l'app
                var mainWindow = new MainWindow();
                mainWindow.Show();
                Close();
            }
            catch (Exception ex)
            {
                SetStatus($"Erreur : {ex.Message}", isError: true);
            }
        }

        private async void BtnInscription_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                SetStatus("Inscription en cours...", isError: false);

                string email = TxtEmail.Text.Trim();
                string password = TxtPassword.Password;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus("Veuillez remplir tous les champs.", isError: true);
                    return;
                }

                if (password.Length < 6)
                {
                    SetStatus("Le mot de passe doit contenir au moins 6 caract√®res.", isError: true);
                    return;
                }

                var (success, userId, error) = await App.SupabaseService.SignUpAsync(email, password);

                if (success)
                {
                    MessageBox.Show(
                        "Compte cr√©√© avec succ√®s !\n\nVous pouvez maintenant vous connecter.",
                        "Inscription r√©ussie",
                        MessageBoxButton.OK,
                        MessageBoxImage.Information);

                    TxtPassword.Password = "";
                    SetStatus("Compte cr√©√© ! Connectez-vous.", isError: false);
                }
                else
                {
                    SetStatus(error ?? "Erreur lors de l'inscription", isError: true);
                }
            }
            catch (Exception ex)
            {
                SetStatus($"Erreur : {ex.Message}", isError: true);
            }
        }

        private void SetStatus(string message, bool isError)
        {
            TxtMessage.Text = message;
            TxtMessage.Foreground = isError
                ? System.Windows.Media.Brushes.Red
                : System.Windows.Media.Brushes.Blue;
        }

        private async Task CheckForUpdatesAsync()
        {
            try
            {
                string url = ConfigurationHelper.GetSupabaseUrl();
                string key = ConfigurationHelper.GetSupabaseKey();

                var updateService = new LoGeCuiShared.Services.UpdateService(url, key);
                var updateInfo = await updateService.CheckForUpdateAsync("wpf", "1.0.0");

                if (updateInfo != null)
                {
                    var result = MessageBox.Show(
                        $"Une nouvelle version {updateInfo.Version} est disponible !\n\n" +
                        $"Notes de version :\n{updateInfo.ReleaseNotes}\n\n" +
                        $"Voulez-vous t√©l√©charger la mise √† jour ?",
                        "Mise √† jour disponible",
                        MessageBoxButton.YesNo,
                        MessageBoxImage.Information);

                    if (result == MessageBoxResult.Yes)
                    {
                        System.Diagnostics.Process.Start(new System.Diagnostics.ProcessStartInfo
                        {
                            FileName = updateInfo.DownloadUrl,
                            UseShellExecute = true
                        });
                    }
                }
            }
            catch
            {
                // Erreur silencieuse
            }
        }

        private async Task ImporterRecettesLocalVersSupabaseSiBesoinAsync(Guid userId)
        {
            try
            {
                // üìÅ M√™me chemin que ton ancien RecetteService (JSON)
                string dossier = System.IO.Path.Combine(
                    Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                    "LoGeCui"
                );

                string cheminJson = System.IO.Path.Combine(dossier, "recettes.json");

                // ‚ùå Pas de fichier ‚Üí rien √† importer
                if (!System.IO.File.Exists(cheminJson))
                    return;

                // üè∑Ô∏è Fichier "flag" pour √©viter de r√©importer √† chaque login
                string flagPath = System.IO.Path.Combine(dossier, "recettes_import_done.txt");
                if (System.IO.File.Exists(flagPath))
                    return;

                // üìñ Lecture du JSON
                var json = await System.IO.File.ReadAllTextAsync(cheminJson);

                var options = new System.Text.Json.JsonSerializerOptions
                {
                    PropertyNameCaseInsensitive = true
                };

                var recettes = System.Text.Json.JsonSerializer
                    .Deserialize<List<LoGeCuiShared.Models.Recette>>(json, options)
                    ?? new List<LoGeCuiShared.Models.Recette>();

                if (recettes.Count == 0)
                {
                    // Rien √† importer mais on marque comme fait
                    await System.IO.File.WriteAllTextAsync(flagPath, "empty");
                    return;
                }

                // üîå Service Supabase d√©j√† initialis√© dans App.InitRestServices
                var recipesService = App.RecipesService;
                if (recipesService == null)
                    return;

                // üöÄ Import / upsert
                foreach (var r in recettes)
                {
                    // ExternalId obligatoire pour l'upsert
                    if (string.IsNullOrWhiteSpace(r.ExternalId))
                        r.ExternalId = Guid.NewGuid().ToString("N");

                    // Nettoyage cat√©gorie (important pour mobile)
                    if (!string.IsNullOrWhiteSpace(r.CategorieDb))
                        r.CategorieDb = r.CategorieDb.Trim();

                    await recipesService.UpsertRecetteAsync(userId, r);
                }

                // ‚úÖ Marqueur "import termin√©"
                await System.IO.File.WriteAllTextAsync(
                    flagPath,
                    $"done:{DateTime.UtcNow:O}"
                );
            }
            catch (Exception ex)
            {
                // ‚ö†Ô∏è Import non bloquant : on log mais on n'emp√™che pas le login
                System.Diagnostics.Debug.WriteLine("[ImportRecettes] " + ex);
            }
        }
    }
}


================================================================================
FILE: LoGeCui\MainWindow.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LoGeCui"
        xmlns:views="clr-namespace:LoGeCui.Views"
        mc:Ignorable="d"
        Title="LoGeCui" Height="900" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#ECF0F1">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- En T√™te (sur toute la largeur -->
        <Border Grid.Row="0"
                Grid.ColumnSpan="2"
                Background="#2C3E50">
            <StackPanel Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="20 , 0">
                <TextBlock Text="üç≥"
                           FontSize="40"
                           Margin="0, 0,15,0"/>
                <StackPanel>
                    <TextBlock Text="LoGeCui"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="White"/>
                    <TextBlock Text=" Logiciel de Gestion de Cuisine"
                           FontSize="12"
                           Foreground="#BDC3C7"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- MENU GAUCHE -->
        <Border Grid.Row="1" 
                Grid.Column="0"
                Background="#34495E"
                BorderBrush="#2C3E50"
                BorderThickness="0,0,1,0">

            <StackPanel Margin="0,20,0,0">

                <!-- Bouton Ingr√©dients -->
                <Button Content="üì¶ Mes Ingr√©dients"
                        Height="60"
                        Background="#3498DB"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnIngredients_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#3498DB"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2980B9"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bouton Recettes -->
                <Button Content="üìñ Mes Recettes"
                        Height="60"
                        Background="#2ECC71"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnRecettes_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#2ECC71"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#27AE60"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bouton Ajouter Recette -->
                <Button Content="‚ûï Ajouter Recette"
                        Height="60"
                        Background="#F39C12"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAjouterRecette_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#F39C12"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#E67E22"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <!-- Bouton Menu Al√©atoire -->
                <Button Content="üé≤ Menu Al√©atoire"
                        Height="60"
                        Background="#9B59B6"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnMenuAleatoire_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#9B59B6"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#8E44AD"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bouton Liste de Courses -->
                <Button Content="üõí Liste de Courses"
                        Height="60"
                        Background="#E74C3C"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnListeCourses_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#E74C3C"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#C0392B"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Content="Synchroniser recettes"
                    Click="BtnSyncRecettes_Click"
                    Margin="10"/>

            </StackPanel>
        </Border>

        <!-- ZONE DE CONTENU PRINCIPAL -->
        <Border Grid.Row="1" 
        Grid.Column="1"
        Background="White"
        Margin="10">

            <ContentControl x:Name="MainContent">
                <TextBlock Text="Bienvenue dans LoGeCui ! üç≥&#x0a;&#x0a;S√©lectionnez une option dans le menu."
                   FontSize="24"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   TextAlignment="Center"
                   Foreground="#7F8C8D"/>
            </ContentControl>

        </Border>



    </Grid>
</Window>

================================================================================
FILE: LoGeCui\MainWindow.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using LoGeCui.Services;
using LoGeCui.Views;

namespace LoGeCui
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        // SUPPRIM√â : private SupabaseService _supabase;

        public MainWindow()
        {
            InitializeComponent();

            // SUPPRIM√â : Ne plus cr√©er une nouvelle instance !
            // _supabase = new SupabaseService(url, key);

            // Maintenant on utilisera App.SupabaseService partout
        }

        private void BtnIngredients_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.IngredientsView();
        }

        private void BtnRecettes_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.RecettesView();
        }

        private async void BtnAjouterRecette_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterRecetteDialog();
            dialog.Owner = this;

            bool? resultat = dialog.ShowDialog();

            if (resultat == true && dialog.NouvelleRecette != null)
            {
                try
                {
                    if (App.RecipesService == null || App.CurrentUserId == null)
                    {
                        MessageBox.Show("Utilisateur non connect√© ou services non initialis√©s.");
                        return;
                    }

                    var r = dialog.NouvelleRecette;

                    // ExternalId obligatoire pour l'upsert (√©vite les doublons)
                    if (string.IsNullOrWhiteSpace(r.ExternalId))
                        r.ExternalId = Guid.NewGuid().ToString("N");

                    // Sauvegarde vers Supabase
                    await App.RecipesService.UpsertRecetteAsync(App.CurrentUserId.Value, r);

                    // Recharge la vue Recettes (qui doit lire Supabase)
                    var view = new RecettesView();
                    MainContent.Content = view;

                    MessageBox.Show(
                        $"La recette '{r.Nom}' a √©t√© ajout√©e avec succ√®s !",
                        "Succ√®s",
                        MessageBoxButton.OK,
                        MessageBoxImage.Information);
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Erreur lors de l'ajout :\n{ex}", "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
        }


        private void BtnMenuAleatoire_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.MenuAleatoireView();
        }

        private void BtnListeCourses_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.ListeCoursesView();
        }

        public async Task SyncRecettesToSupabaseAsync(IEnumerable<LoGeCuiShared.Models.Recette> recettesLocales)
        {
            if (App.RecipesService == null || App.CurrentUserId == null)
                throw new InvalidOperationException("Services REST non initialis√©s. Connecte-toi d'abord.");

            foreach (var r in recettesLocales)
            {
                if (string.IsNullOrWhiteSpace(r.ExternalId))
                    throw new InvalidOperationException($"Recette '{r.Nom}' sans ExternalId. Il faut un identifiant stable pour √©viter les doublons.");

                await App.RecipesService.UpsertRecetteAsync(App.CurrentUserId.Value, r);
            }
        }

        private async void BtnSyncRecettes_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                if (App.RecipesService == null || App.CurrentUserId == null)
                {
                    MessageBox.Show("Utilisateur non connect√© ou services non initialis√©s.");
                    return;
                }

                // üîπ ICI tu dois r√©cup√©rer TA liste de recettes WPF
                // Adapte cette ligne √† TON code existant

                MessageBox.Show("Synchronisation termin√©e avec succ√®s.");
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur de synchronisation :\n{ex.Message}");
            }
        }


    }
}

================================================================================
FILE: LoGeCui\Models\ArticleCourse.cs
================================================================================

Ôªønamespace LoGeCui.Models
{
    public class ArticleCourse
    {
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }
        public bool EstAchete { get; set; }

        public ArticleCourse()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
            EstAchete = false;
        }

        // Pour l'affichage
        public override string ToString()
        {
            return $"{Nom} - {Quantite} {Unite}";
        }
    }
}

================================================================================
FILE: LoGeCui\Models\Ingredient.cs
================================================================================

Ôªønamespace LoGeCui.Models
{
    public class Ingredient
    {
        public Guid Id { get; set; }          // correspond √† id
        public Guid? UserId { get; set; }
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }
        public bool EstDisponible { get; set; }

        // Constructeur (optionnel mais pratique)
        public Ingredient()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
            EstDisponible = true;
        }
    }
}

================================================================================
FILE: LoGeCui\Models\IngredientRecette.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;


namespace LoGeCui.Models
{
    public class IngredientRecette
    {
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }

        public IngredientRecette()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
        }

        // Pour l'affichage
        public override string ToString()
        {
            return $"{Nom} - {Quantite} {Unite}";
        }
    }
}

================================================================================
FILE: LoGeCui\Models\MenuJournalier.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using LoGeCuiShared.Models;

namespace LoGeCui.Models
{
    public class MenuJournalier
    {
        public DateTime Date { get; set; }
        public Recette? Entree { get; set; }
        public Recette? Plat { get; set; }
        public Recette? Dessert { get; set; }
        public List<IngredientRecette> IngredientsManquants { get; set; }

        public MenuJournalier()
        {
            Date = DateTime.Now;
            IngredientsManquants = new List<IngredientRecette>();
        }
    }
}

================================================================================
FILE: LoGeCui\Services\IngredientService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;
using System.Linq;

namespace LoGeCui.Services
{
    public class IngredientService
    {
        // Chemin du fichier de sauvegarde
        private readonly string _cheminFichier;
        private List<Ingredient> _ingredients = new List<Ingredient>();

        public IngredientService()
        {
            // Le fichier sera sauvegard√© dans AppData de l'utilisateur
            string dossier = Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                "LoGeCui"
            );

            // Cr√©er le dossier s'il n'existe pas
            Directory.CreateDirectory(dossier);

            _cheminFichier = Path.Combine(dossier, "ingredients.json");
        }

        /// <summary>
        /// Charge les ingr√©dients depuis le fichier JSON
        /// </summary>
        public List<Ingredient> ChargerIngredients()
        {
            try
            {
                // V√©rifier si le fichier existe
                if (!File.Exists(_cheminFichier))
                {
                    // Pas de fichier = liste vide
                    return new List<Ingredient>();
                }

                // Lire le contenu du fichier
                string json = File.ReadAllText(_cheminFichier);

                // Convertir le JSON en liste d'ingr√©dients
                var ingredients = JsonSerializer.Deserialize<List<Ingredient>>(json);

                return ingredients ?? new List<Ingredient>();
            }
            catch (Exception ex)
            {
                // En cas d'erreur, afficher un message et retourner une liste vide
                System.Windows.MessageBox.Show(
                    $"Erreur lors du chargement des ingr√©dients : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);

                return new List<Ingredient>();
            }
        }

        public List<Ingredient> ObtenirTousLesIngredients()
        {
            return _ingredients.ToList();
        }

        public List<Ingredient> ObtenirIngredientsDisponibles()
        {
            return _ingredients.Where(i => i.EstDisponible).ToList();
        }

        /// <summary>
        /// Sauvegarde les ingr√©dients dans le fichier JSON
        /// </summary>
        public void SauvegarderIngredients(List<Ingredient> ingredients)
        {
            try
            {
                // Options pour rendre le JSON lisible (avec indentation)
                var options = new JsonSerializerOptions
                {
                    WriteIndented = true  // Pour avoir un JSON "joli"
                };

                // Convertir la liste en JSON
                string json = JsonSerializer.Serialize(ingredients, options);

                // √âcrire dans le fichier
                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception ex)
            {
                // En cas d'erreur, afficher un message
                System.Windows.MessageBox.Show(
                    $"Erreur lors de la sauvegarde des ingr√©dients : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
            }
        }

        /// <summary>
        /// Retourne le chemin du fichier de sauvegarde
        /// </summary>
        public string ObtenirCheminFichier()
        {
            return _cheminFichier;
        }
    }
}

================================================================================
FILE: LoGeCui\Services\ListeCoursesService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;

namespace LoGeCui.Services
{
    public class ListeCoursesService
    {
        private readonly string _cheminFichier;

        public ListeCoursesService()
        {
            string dossier = Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                "LoGeCui"
            );
                    Directory.CreateDirectory(dossier);
                    _cheminFichier = Path.Combine(dossier, "liste_courses.json");
        }

        public List<ArticleCourse> ChargerListeCourses()
        {
            try
            {
                if (!File.Exists(_cheminFichier))
                {
                    return new List<ArticleCourse>();
                }

                string json = File.ReadAllText(_cheminFichier);
                var liste = JsonSerializer.Deserialize<List<ArticleCourse>>(json);
                return liste ?? new List<ArticleCourse>();
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors du chargement de la liste de courses : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
                return new List<ArticleCourse>();
            }
        }

        public void SauvegarderListeCourses(List<ArticleCourse> articles)
        {
            try
            {
                var options = new JsonSerializerOptions { WriteIndented = true };
                string json = JsonSerializer.Serialize(articles, options);
                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors de la sauvegarde de la liste de courses : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
            }
        }
    }
}

================================================================================
FILE: LoGeCui\Services\RecetteService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;

namespace LoGeCui.Services
{
    public class RecetteService
    {
        private readonly string _cheminFichier;

        public RecetteService()
        {
            string dossier = Path.Combine(
             Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
             "LoGeCui"
            );
            Directory.CreateDirectory(dossier);
            _cheminFichier = Path.Combine(dossier, "recettes.json");
        }

        public List<Recette> ChargerRecettes()
        {
            try
            {
                if (!File.Exists(_cheminFichier))
                {
                    return new List<Recette>();
                }

                string json = File.ReadAllText(_cheminFichier);
                var options = new JsonSerializerOptions
                {
                    PropertyNameCaseInsensitive = true
                };

                var recettes = JsonSerializer.Deserialize<List<Recette>>(json, options);
                return recettes ?? new List<Recette>();
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors du chargement des recettes : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
                return new List<Recette>();
            }
        }

        public void SauvegarderRecettes(List<Recette> recettes)
        {
            try
            {
                var options = new JsonSerializerOptions
                {
                    WriteIndented = true
                };
                string json = JsonSerializer.Serialize(recettes, options);
                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors de la sauvegarde des recettes : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
            }
        }
    }
}

================================================================================
FILE: LoGeCui\Views\IngredientsView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.IngredientsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Titre -->
            <RowDefinition Height="Auto"/>
            <!-- Boutons -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- TITRE -->
        <TextBlock Grid.Row="0"
                   Text="üì¶ Gestion des Ingr√©dients"
                   FontSize="28"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,20"/>

        <!-- ZONE DE BOUTONS -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal"
                    Margin="0,0,0,20">

            <Button Content="‚ûï Ajouter un ingr√©dient"
                    Height="40"
                    Width="200"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnAjouter_Click"/>

        </StackPanel>

        <!-- LISTE DES INGR√âDIENTS -->
        <Border Grid.Row="2"
                BorderBrush="#BDC3C7"
                BorderThickness="1"
                CornerRadius="5">

            <ListBox x:Name="ListeIngredients"
                     Background="#F8F9FA"
                     BorderThickness="0">

                <!-- Template pour afficher chaque ingr√©dient -->
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
            BorderBrush="#E0E0E0"
            BorderThickness="1"
            CornerRadius="5"
            Margin="5"
            Padding="15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Informations de l'ingr√©dient -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Nom}"
                           FontSize="16"
                           FontWeight="Bold"
                           Foreground="#2C3E50"/>
                                    <TextBlock Foreground="#7F8C8D"
                           FontSize="14">
                    <Run Text="Quantit√© : "/>
                    <Run Text="{Binding Quantite}"/>
                    <Run Text=" "/>
                    <Run Text="{Binding Unite}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- CheckBox Disponible -->
                                <CheckBox Grid.Column="1"
                     IsChecked="{Binding EstDisponible}"
                     Content="Disponible"
                     VerticalAlignment="Center"
                     Margin="10,0"
                     Checked="ChkDisponible_Changed"
                     Unchecked="ChkDisponible_Changed"/>

                                <!-- Bouton Supprimer -->
                                <Button Grid.Column="2"
                    Content="üóëÔ∏è"
                    Width="40"
                    Height="40"
                    Background="#E74C3C"
                    Foreground="White"
                    FontSize="18"
                    BorderThickness="0"
                    Cursor="Hand"
                    ToolTip="Supprimer cet ingr√©dient"
                    Click="BtnSupprimer_Click"
                    Tag="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#E74C3C"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#C0392B"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>

    </Grid>

</UserControl>

================================================================================
FILE: LoGeCui\Views\IngredientsView.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using LoGeCuiShared.Models;

namespace LoGeCui.Views
{
    public partial class IngredientsView : UserControl
    {
        private readonly ObservableCollection<Ingredient> _ingredients = new();

        public IngredientsView()
        {
            InitializeComponent();

            ListeIngredients.ItemsSource = _ingredients;

            Loaded += IngredientsView_Loaded;
        }

        private async void IngredientsView_Loaded(object sender, RoutedEventArgs e)
        {
            // Evite de recharger plusieurs fois si Loaded se d√©clenche √† nouveau
            Loaded -= IngredientsView_Loaded;
            await ReloadIngredientsAsync();
        }

        private async Task ReloadIngredientsAsync()
        {
            try
            {
                var data = await App.SupabaseService.GetIngredientsAsync();

                _ingredients.Clear();
                foreach (var ing in data.OrderBy(i => i.Nom))
                    _ingredients.Add(ing);
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur chargement ingr√©dients (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterIngredientDialog
            {
                Owner = Window.GetWindow(this)
            };

            bool? resultat = dialog.ShowDialog();
            if (resultat != true || dialog.NouvelIngredient == null)
                return;

            try
            {
                var saved = await App.SupabaseService.AddIngredientAsync(dialog.NouvelIngredient);

                if (saved == null)
                {
                    MessageBox.Show("L'ajout a √©chou√© (aucune donn√©e retourn√©e).",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                    return;
                }

                _ingredients.Add(saved);

                MessageBox.Show(
                    $"L'ingr√©dient '{saved.Nom}' a √©t√© ajout√© avec succ√®s !",
                    "Succ√®s",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur lors de l'ajout (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnSupprimer_Click(object sender, RoutedEventArgs e)
        {
            if (sender is not Button bouton)
                return;

            // On r√©cup√®re l'objet li√© √† la ligne (plus fiable que Tag si ton XAML est bind√© correctement)
            if (bouton.DataContext is not Ingredient ingredient)
                return;

            var confirmation = MessageBox.Show(
                $"Voulez-vous vraiment supprimer '{ingredient.Nom}' ?",
                "Confirmation de suppression",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (confirmation != MessageBoxResult.Yes)
                return;

            try
            {
                if (ingredient.Id == Guid.Empty)
                {
                    MessageBox.Show("Impossible de supprimer : l'ingr√©dient n'a pas d'Id.",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                    return;
                }

                bool ok = await App.SupabaseService.DeleteIngredientAsync(ingredient.Id);
                if (!ok)
                {
                    MessageBox.Show("La suppression a √©chou√© c√¥t√© serveur.",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                    return;
                }

                _ingredients.Remove(ingredient);

                MessageBox.Show(
                    $"L'ingr√©dient '{ingredient.Nom}' a √©t√© supprim√©.",
                    "Suppression r√©ussie",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur lors de la suppression (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void ChkDisponible_Changed(object sender, RoutedEventArgs e)
        {
            if (sender is not CheckBox cb)
                return;

            // Objet li√© √† la ligne
            if (cb.DataContext is not Ingredient ingredient)
                return;

            try
            {
                if (ingredient.Id == Guid.Empty)
                    return; // pas persist√© c√¥t√© Supabase

                bool ok = await App.SupabaseService.UpdateIngredientAsync(ingredient);
                if (!ok)
                {
                    MessageBox.Show("La mise √† jour a √©chou√© c√¥t√© serveur.",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur mise √† jour (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}

================================================================================
FILE: LoGeCui\Views\ListeCoursesView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.ListeCoursesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TITRE -->
        <TextBlock Grid.Row="0"
                   Text="üõí Liste de Courses"
                   FontSize="28"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,20"/>

        <!-- BOUTONS -->
        <!-- BOUTONS -->
        <StackPanel Grid.Row="1"
            Orientation="Horizontal"
            Margin="0,0,0,20">

            <Button Content="‚ûï Ajouter un article"
            Height="40"
            Width="180"
            Background="#27AE60"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnAjouterArticle_Click"
            Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="üóëÔ∏è Supprimer les articles achet√©s"
            Height="40"
            Width="230"
            Background="#E74C3C"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnSupprimerAchetes_Click"
            Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#E74C3C"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#C0392B"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- NOUVEAU : Tout s√©lectionner -->
            <Button Content="‚úÖ Tout s√©lectionner"
            Height="40"
            Width="170"
            Background="#3498DB"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnToutSelectionner_Click"
            Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#3498DB"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2E86C1"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- NOUVEAU : Supprimer la s√©lection -->
            <Button Content="üóëÔ∏è Supprimer la s√©lection"
            Height="40"
            Width="210"
            Background="#E67E22"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnSupprimerSelection_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#E67E22"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#D35400"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

        </StackPanel>

        <!-- LISTE DES COURSES -->
        <Border Grid.Row="2"
                BorderBrush="#BDC3C7"
                BorderThickness="1"
                CornerRadius="5">

            <ListBox x:Name="ListeCourses"
                     Background="#F8F9FA"
                     BorderThickness="0"
                     SelectionMode="Extended">

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="5"
                                Margin="5"
                                Padding="15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- CheckBox Achet√© -->
                                <CheckBox Grid.Column="0"
                                         IsChecked="{Binding EstAchete}"
                                         VerticalAlignment="Center"
                                         Margin="0,0,15,0"
                                         Checked="ChkAchete_Changed"
                                         Unchecked="ChkAchete_Changed"/>

                                <!-- Informations -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock FontSize="16"
                                               FontWeight="Bold"
                                               Foreground="#2C3E50">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="{Binding Nom}"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding EstAchete}" Value="True">
                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                        <Setter Property="Foreground" Value="#95A5A6"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <TextBlock Foreground="#7F8C8D"
                                               FontSize="14">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding EstAchete}" Value="True">
                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                        <Run Text="Quantit√© : "/>
                                        <Run Text="{Binding Quantite, Mode=OneWay}"/>
                                        <Run Text=" "/>
                                        <Run Text="{Binding Unite, Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Bouton Supprimer -->
                                <Button Grid.Column="2"
                                        Content="üóëÔ∏è"
                                        Width="40"
                                        Height="40"
                                        Background="#E74C3C"
                                        Foreground="White"
                                        FontSize="18"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        ToolTip="Supprimer cet article"
                                        Click="BtnSupprimerArticle_Click"
                                        Tag="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#E74C3C"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#C0392B"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>

    </Grid>

</UserControl>

================================================================================
FILE: LoGeCui\Views\ListeCoursesView.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using LoGeCuiShared.Models;

namespace LoGeCui.Views
{
    public partial class ListeCoursesView : UserControl
    {
        private readonly ObservableCollection<ArticleCourse> _articles = new ObservableCollection<ArticleCourse>();

        public ListeCoursesView()
        {
            InitializeComponent();

            // Binding une fois
            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private async void ChargerDonnees()
        {
            try
            {
                var articles = await App.SupabaseService.GetArticlesAsync();

                _articles.Clear();
                foreach (var article in articles)
                    _articles.Add(article);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur de chargement : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnAjouterArticle_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterArticleCourseDialog
            {
                Owner = Window.GetWindow(this)
            };

            bool? resultat = dialog.ShowDialog();

            if (resultat == true && dialog.NouvelArticle != null)
            {
                try
                {
                    var added = await App.SupabaseService.AddArticleAsync(dialog.NouvelArticle);

                    if (added != null)
                    {
                        _articles.Add(added);
                        MessageBox.Show($"'{added.Nom}' ajout√© avec succ√®s !", "Succ√®s",
                            MessageBoxButton.OK, MessageBoxImage.Information);
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                        MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
        }

        private async void BtnSupprimerArticle_Click(object sender, RoutedEventArgs e)
        {
            var bouton = sender as Button;
            var article = bouton?.Tag as ArticleCourse;

            if (article == null)
                return;

            var resultat = MessageBox.Show(
                $"Voulez-vous vraiment supprimer '{article.Nom}' ?",
                "Confirmation",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                await App.SupabaseService.DeleteArticleAsync(article.Id);
                _articles.Remove(article);

                MessageBox.Show("Article supprim√© !", "Succ√®s",
                    MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void ChkAchete_Changed(object sender, RoutedEventArgs e)
        {
            var checkbox = sender as CheckBox;
            var article = checkbox?.DataContext as ArticleCourse;

            if (article == null)
                return;

            try
            {
                await App.SupabaseService.UpdateArticleAsync(article.Id, article);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur de synchronisation : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private void BtnToutSelectionner_Click(object sender, RoutedEventArgs e)
        {
            ListeCourses.SelectAll();
        }

        private async void BtnSupprimerSelection_Click(object sender, RoutedEventArgs e)
        {
            // NOTE: SelectedItems est un IList -> on copie avant toute suppression
            var selected = ListeCourses.SelectedItems.Cast<ArticleCourse>().ToList();

            if (!selected.Any())
            {
                MessageBox.Show("Aucun article s√©lectionn√©.", "Information",
                    MessageBoxButton.OK, MessageBoxImage.Information);
                return;
            }

            var resultat = MessageBox.Show(
                $"Voulez-vous supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Confirmation",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                // Variante qui fonctionne tout de suite, sans ajouter de m√©thode Supabase en lot :
                // on supprime en boucle via la m√©thode existante DeleteArticleAsync(id).
                foreach (var article in selected)
                {
                    await App.SupabaseService.DeleteArticleAsync(article.Id);
                    _articles.Remove(article);
                }

                MessageBox.Show($"{selected.Count} article(s) supprim√©(s).", "Succ√®s",
                    MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnSupprimerAchetes_Click(object sender, RoutedEventArgs e)
        {
            var achetes = _articles.Where(a => a.EstAchete).ToList();

            if (!achetes.Any())
            {
                MessageBox.Show("Aucun article achet√© √† supprimer.", "Information",
                    MessageBoxButton.OK, MessageBoxImage.Information);
                return;
            }

            var resultat = MessageBox.Show(
                $"Voulez-vous supprimer les {achetes.Count} article(s) achet√©(s) ?",
                "Confirmation",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                await App.SupabaseService.DeleteAchetesAsync();

                foreach (var article in achetes)
                    _articles.Remove(article);

                MessageBox.Show($"{achetes.Count} article(s) supprim√©(s).", "Succ√®s",
                    MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}



================================================================================
FILE: LoGeCui\Views\MenuAleatoireView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.MenuAleatoireView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- TITRE -->
            <TextBlock Grid.Row="0"
                       Text="üé≤ Menu Al√©atoire"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="#2C3E50"
                       Margin="0,0,0,20"/>

            <!-- BOUTON GENERER -->
            <Button Grid.Row="1"
                    Content="üé≤ G√©n√©rer un nouveau menu"
                    Width="250"
                    Height="50"
                    Background="#9B59B6"
                    Foreground="White"
                    FontSize="16"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnGenererMenu_Click"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,30">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#9B59B6"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#8E44AD"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- CONTENU DU MENU -->
            <StackPanel Grid.Row="2" x:Name="MenuPanel" Visibility="Collapsed">

                <!-- Date -->
                <TextBlock x:Name="TxtDate"
                           FontSize="16"
                           Foreground="#7F8C8D"
                           Margin="0,0,0,20"
                           HorizontalAlignment="Center"/>

                <!-- Entr√©e -->
                <Border Background="#E8F5E9"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="ü•ó ENTR√âE"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#27AE60"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="TxtEntree"
                                   Text="Aucune entr√©e"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock x:Name="TxtEntreeDetails"
                                   FontSize="14"
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Plat -->
                <Border Background="#E3F2FD"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="üçΩÔ∏è PLAT PRINCIPAL"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#2196F3"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="TxtPlat"
                                   Text="Aucun plat"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock x:Name="TxtPlatDetails"
                                   FontSize="14"
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Dessert -->
                <Border Background="#FFF3E0"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="üç∞ DESSERT"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#FF9800"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="TxtDessert"
                                   Text="Aucun dessert"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock x:Name="TxtDessertDetails"
                                   FontSize="14"
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Ingr√©dients manquants -->
                <Border x:Name="IngredientsManquantsPanel"
                        Background="#FFEBEE"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,20"
                        Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="‚ö†Ô∏è INGR√âDIENTS MANQUANTS"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#E74C3C"
                                   Margin="0,0,0,10"/>

                        <ListBox x:Name="ListeIngredientsManquants"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 MaxHeight="200">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                               FontSize="14"
                                               Foreground="#E74C3C"
                                               Margin="5"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <Button Content="‚ûï Ajouter √† la liste de courses"
                                Height="40"
                                Background="#E74C3C"
                                Foreground="White"
                                FontSize="14"
                                FontWeight="Bold"
                                BorderThickness="0"
                                Cursor="Hand"
                                Click="BtnAjouterListeCourses_Click"
                                Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Tout est disponible -->
                <Border x:Name="ToutDisponiblePanel"
                        Background="#E8F5E9"
                        CornerRadius="10"
                        Padding="20"
                        Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal"
                               HorizontalAlignment="Center">
                        <TextBlock Text="‚úÖ"
                                   FontSize="24"
                                   Margin="0,0,10,0"/>
                        <TextBlock Text="Tous les ingr√©dients sont disponibles !"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="#27AE60"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

            </StackPanel>

        </Grid>
    </ScrollViewer>

</UserControl>

================================================================================
FILE: LoGeCui\Views\MenuAleatoireView.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using LoGeCuiShared.Models;
using LoGeCui.Services;

namespace LoGeCui.Views
{
    public partial class MenuAleatoireView : UserControl
    {
        private MenuJournalier? _menuCourant;
        private static readonly Random _random = new Random();

        public MenuAleatoireView()
        {
            InitializeComponent();
        }

        private async void BtnGenererMenu_Click(object sender, RoutedEventArgs e)
        {
            // Charger les recettes depuis Supabase
            if (App.RecipesService == null || App.CurrentUserId == null)
            {
                MessageBox.Show("Connecte-toi d'abord (services non initialis√©s).");
                return;
            }

            var recettes = await App.RecipesService.GetRecettesAsync(App.CurrentUserId.Value)
                          ?? new List<Recette>();

            if (recettes.Count == 0)
            {
                MessageBox.Show(
                    "Vous n'avez aucune recette !\n\nAjoutez des recettes d'abord.",
                    "Aucune recette",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                return;
            }

            // Filtrer par type
            var entrees = recettes.Where(r => r.Type == TypePlat.Entree).ToList();
            var plats = recettes.Where(r => r.Type == TypePlat.Plat).ToList();
            var desserts = recettes.Where(r => r.Type == TypePlat.Dessert).ToList();

            // Cr√©er le menu
            _menuCourant = new MenuJournalier
            {
                Date = DateTime.Now,
                Entree = ChoisirRecetteAleatoire(entrees),
                Plat = ChoisirRecetteAleatoire(plats),
                Dessert = ChoisirRecetteAleatoire(desserts)
            };

            // Charger les ingr√©dients depuis Supabase
            if (App.RestClient == null)
            {
                MessageBox.Show("RestClient non initialis√©.");
                return;
            }

            try
            {
                var ingSvc = new LoGeCuiShared.Services.RecetteIngredientsService(App.RestClient);

                if (_menuCourant.Entree != null)
                {
                    var tuples = await ingSvc.GetForRecetteAsync(_menuCourant.Entree.Id);
                    _menuCourant.Entree.Ingredients = tuples
                        .Select(t => new IngredientRecette
                        {
                            Nom = t.nom,
                            Quantite = t.quantite,
                            Unite = t.unite
                        })
                        .ToList();
                }

                if (_menuCourant.Plat != null)
                {
                    var tuples = await ingSvc.GetForRecetteAsync(_menuCourant.Plat.Id);
                    _menuCourant.Plat.Ingredients = tuples
                        .Select(t => new IngredientRecette
                        {
                            Nom = t.nom,
                            Quantite = t.quantite,
                            Unite = t.unite
                        })
                        .ToList();
                }

                if (_menuCourant.Dessert != null)
                {
                    var tuples = await ingSvc.GetForRecetteAsync(_menuCourant.Dessert.Id);
                    _menuCourant.Dessert.Ingredients = tuples
                        .Select(t => new IngredientRecette
                        {
                            Nom = t.nom,
                            Quantite = t.quantite,
                            Unite = t.unite
                        })
                        .ToList();
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(
                    $"Erreur chargement ingr√©dients des recettes : {ex.Message}",
                    "Erreur",
                    MessageBoxButton.OK,
                    MessageBoxImage.Error);
                return;
            }

            // Afficher menu
            AfficherMenu();

            IngredientsManquantsPanel.Visibility = Visibility.Collapsed;
            ToutDisponiblePanel.Visibility = Visibility.Collapsed;
            ListeIngredientsManquants.ItemsSource = null;

            await VerifierIngredientsAsync();
        }

        private Recette? ChoisirRecetteAleatoire(List<Recette> recettes)
        {
            if (recettes == null || recettes.Count == 0)
                return null;

            return recettes[_random.Next(recettes.Count)];
        }

        private void AfficherMenu()
        {
            if (_menuCourant == null)
                return;

            MenuPanel.Visibility = Visibility.Visible;
            TxtDate.Text = $"Menu g√©n√©r√© le {_menuCourant.Date:dd/MM/yyyy √† HH:mm}";

            AfficherBlocRecette(_menuCourant.Entree, TxtEntree, TxtEntreeDetails, "entr√©e");
            AfficherBlocRecette(_menuCourant.Plat, TxtPlat, TxtPlatDetails, "plat");
            AfficherBlocRecette(_menuCourant.Dessert, TxtDessert, TxtDessertDetails, "dessert");
        }

        private void AfficherBlocRecette(Recette? recette, TextBlock titre, TextBlock details, string type)
        {
            if (recette != null)
            {
                titre.Text = recette.Nom;
                details.Text = $"{recette.DifficulteTexte} ‚Ä¢ {recette.TempsPreparation} min";
            }
            else
            {
                titre.Text = $"Aucun {type} disponible";
                details.Text = $"Ajoutez des recettes de type '{type}'";
            }
        }

        private async System.Threading.Tasks.Task VerifierIngredientsAsync()
        {
            if (_menuCourant == null)
                return;

            try
            {
                var ingredientsDisponibles = await App.SupabaseService.GetIngredientsAsync();

                var disponibles = (ingredientsDisponibles ?? new List<Ingredient>())
                    .Where(i => i.EstDisponible)
                    .Select(i => (i.Nom ?? "").Trim().ToLowerInvariant())
                    .Where(n => !string.IsNullOrWhiteSpace(n))
                    .ToHashSet();

                var necessaires = new List<IngredientRecette>();

                if (_menuCourant.Entree != null)
                    necessaires.AddRange(_menuCourant.Entree.Ingredients ?? new List<IngredientRecette>());
                if (_menuCourant.Plat != null)
                    necessaires.AddRange(_menuCourant.Plat.Ingredients ?? new List<IngredientRecette>());
                if (_menuCourant.Dessert != null)
                    necessaires.AddRange(_menuCourant.Dessert.Ingredients ?? new List<IngredientRecette>());

                if (necessaires.Count == 0)
                {
                    IngredientsManquantsPanel.Visibility = Visibility.Collapsed;
                    ToutDisponiblePanel.Visibility = Visibility.Collapsed;
                    ListeIngredientsManquants.ItemsSource = null;
                    return;
                }

                _menuCourant.IngredientsManquants.Clear();

                foreach (var ingredient in necessaires)
                {
                    var nom = (ingredient.Nom ?? "").Trim();
                    if (!disponibles.Contains(nom.ToLowerInvariant()))
                    {
                        if (!_menuCourant.IngredientsManquants.Any(i =>
                                (i.Nom ?? "").Equals(nom, StringComparison.OrdinalIgnoreCase)))
                        {
                            _menuCourant.IngredientsManquants.Add(ingredient);
                        }
                    }
                }

                if (_menuCourant.IngredientsManquants.Any())
                {
                    IngredientsManquantsPanel.Visibility = Visibility.Visible;
                    ToutDisponiblePanel.Visibility = Visibility.Collapsed;

                    ListeIngredientsManquants.ItemsSource = _menuCourant.IngredientsManquants
                        .Select(i => $"‚Ä¢ {i.Quantite} {i.Unite} {i.Nom}".Replace("  ", " ").Trim())
                        .ToList();
                }
                else
                {
                    IngredientsManquantsPanel.Visibility = Visibility.Collapsed;
                    ToutDisponiblePanel.Visibility = Visibility.Visible;
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur v√©rification ingr√©dients : {ex.Message}");
            }
        }

        private async void BtnAjouterListeCourses_Click(object sender, RoutedEventArgs e)
        {
            if (_menuCourant == null || !_menuCourant.IngredientsManquants.Any())
                return;

            var supabase = App.SupabaseService;
            var articlesExistants = await supabase.GetArticlesAsync();
            var nomsExistants = (articlesExistants ?? new List<ArticleCourse>())
                .Select(a => (a.Nom ?? "").Trim().ToLowerInvariant())
                .ToHashSet();

            foreach (var ingredient in _menuCourant.IngredientsManquants)
            {
                var nom = (ingredient.Nom ?? "").Trim();
                if (!nomsExistants.Contains(nom.ToLowerInvariant()))
                {
                    await supabase.AddArticleAsync(new ArticleCourse
                    {
                        Nom = nom,
                        Quantite = ingredient.Quantite,
                        Unite = ingredient.Unite,
                        EstAchete = false
                    });
                }
            }

            MessageBox.Show("Ingr√©dients ajout√©s √† la liste de courses !");
        }
    }
}

================================================================================
FILE: LoGeCui\Views\RecetteView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.RecettesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TITRE -->
        <!-- TITRE ET BOUTON -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
               Text="üìñ Mes Recettes"
               FontSize="28"
               FontWeight="Bold"
               Foreground="#2C3E50"
               VerticalAlignment="Center"/>

            <Button Grid.Column="1"
            Content="‚ûï Nouvelle recette"
            Width="180"
            Height="45"
            Background="#27AE60"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnNouvelleRecette_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>

        <!-- FILTRES -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal"
                    Margin="0,0,0,20">

            <Button Content="Toutes"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnTous_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#95A5A6"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#7F8C8D"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="ü•ó Entr√©es"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnEntrees_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="üçΩÔ∏è Plats"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#3498DB"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnPlats_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#3498DB"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="üç∞ Desserts"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#F39C12"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnDesserts_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#F39C12"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E67E22"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="Synchroniser"
        Click="BtnSyncRecettes_Click"
        Margin="8"/>

        </StackPanel>

        <!-- LISTE DES RECETTES -->
        <Border Grid.Row="2"
                BorderBrush="#BDC3C7"
                BorderThickness="1"
                CornerRadius="5">

            <ListBox x:Name="ListeRecettes"
                     Background="#F8F9FA"
                     BorderThickness="0"
                     MouseDoubleClick="ListeRecettes_DoubleClick">

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="5"
                                Margin="5"
                                Padding="15"
                                Cursor="Hand">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Informations -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Nom}"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="#2C3E50"/>

                                    <TextBlock Foreground="#7F8C8D"
                                               FontSize="13"
                                               Margin="0,5,0,0">
                                        <Run Text="{Binding TypeTexte, Mode=OneWay}"/>
                                        <Run Text=" ‚Ä¢ "/>
                                        <Run Text="{Binding TempsPreparation, Mode=OneWay}"/>
                                        <Run Text=" min"/>
                                    </TextBlock>

                                    <TextBlock Text="{Binding DifficulteTexte, Mode=OneWay}"
                                               FontSize="14"
                                               Margin="0,3,0,0"/>
                                </StackPanel>

                                <!-- Badge du type -->
                                <Border Grid.Column="1"
                                        Background="#E8F5E9"
                                        CornerRadius="10"
                                        Padding="10,5"
                                        Margin="10,0"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Type}"
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="#27AE60"/>
                                </Border>

                                <!-- Bouton Supprimer -->
                                <Button Grid.Column="2"
                                        Content="üóëÔ∏è"
                                        Width="40"
                                        Height="40"
                                        Background="#E74C3C"
                                        Foreground="White"
                                        FontSize="18"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        ToolTip="Supprimer cette recette"
                                        Click="BtnSupprimerRecette_Click"
                                        Tag="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#E74C3C"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#C0392B"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>

    </Grid>

</UserControl>

================================================================================
FILE: LoGeCui\Views\RecetteView.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;

namespace LoGeCui.Views
{
    public partial class RecettesView : UserControl
    {
        private readonly ObservableCollection<Recette> _recettesAffichees = new();
        private List<Recette> _toutesLesRecettes = new();

        public RecettesView()
        {
            InitializeComponent();

            ListeRecettes.ItemsSource = _recettesAffichees;

            Loaded += RecettesView_Loaded;
        }

        private async void RecettesView_Loaded(object sender, RoutedEventArgs e)
        {
            Loaded -= RecettesView_Loaded;
            await RefreshDepuisSupabaseAsync();
        }

        private bool EnsureConnected(out Guid userId)
        {
            userId = Guid.Empty;

            if (App.RecipesService == null || App.CurrentUserId == null)
            {
                MessageBox.Show("Connecte-toi d'abord (services non initialis√©s).");
                return false;
            }

            userId = App.CurrentUserId.Value;
            return true;
        }

        private bool EnsureRestClient()
        {
            if (App.RestClient == null)
            {
                MessageBox.Show("RestClient non initialis√©.");
                return false;
            }
            return true;
        }

        private async System.Threading.Tasks.Task RefreshDepuisSupabaseAsync()
        {
            if (!EnsureConnected(out var userId))
                return;

            var recettes = await App.RecipesService!.GetRecettesAsync(userId);
            _toutesLesRecettes = recettes ?? new List<Recette>();

            _recettesAffichees.Clear();
            foreach (var r in _toutesLesRecettes)
                _recettesAffichees.Add(r);
        }

        private void BtnTous_Click(object sender, RoutedEventArgs e)
        {
            _recettesAffichees.Clear();
            foreach (var recette in _toutesLesRecettes)
                _recettesAffichees.Add(recette);
        }

        private void BtnEntrees_Click(object sender, RoutedEventArgs e) => FiltrerParType(TypePlat.Entree);
        private void BtnPlats_Click(object sender, RoutedEventArgs e) => FiltrerParType(TypePlat.Plat);
        private void BtnDesserts_Click(object sender, RoutedEventArgs e) => FiltrerParType(TypePlat.Dessert);

        private void FiltrerParType(TypePlat type)
        {
            _recettesAffichees.Clear();
            foreach (var recette in _toutesLesRecettes.Where(r => r.Type == type))
                _recettesAffichees.Add(recette);
        }

        private void ListeRecettes_DoubleClick(object sender, MouseButtonEventArgs e)
        {
            var recette = ListeRecettes.SelectedItem as Recette;
            if (recette != null)
                AfficherDetailsRecette(recette);
        }

        private async void AfficherDetailsRecette(Recette recette)
        {
            try
            {
                if (!EnsureRestClient())
                    return;

                var ingSvc = new RecetteIngredientsService(App.RestClient!);
                var items = await ingSvc.GetForRecetteAsync(recette.Id);

                var ingredientsText = (items.Count == 0)
                    ? "(aucun ingr√©dient renseign√©)"
                    : string.Join("\n", items.Select(x =>
                        string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                            ? $"  ‚Ä¢ {x.nom}"
                            : $"  ‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                    ));

                MessageBox.Show(
                    $"üìñ {recette.Nom}\n\n" +
                    $"Cat√©gorie: {recette.CategorieDb}\n" +
                    $"Temps: {recette.TempsPreparation} minutes\n\n" +
                    $"Ingr√©dients:\n{ingredientsText}\n\n" +
                    $"Instructions:\n{recette.Instructions}",
                    "D√©tails de la recette",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur chargement ingr√©dients:\n{ex}");
            }
        }

        private async void BtnNouvelleRecette_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterRecetteDialog();
            dialog.Owner = Window.GetWindow(this);

            bool? resultat = dialog.ShowDialog();
            if (resultat != true || dialog.NouvelleRecette == null)
                return;

            if (!EnsureConnected(out var userId))
                return;

            if (!EnsureRestClient())
                return;

            var r = dialog.NouvelleRecette;

            // ExternalId obligatoire pour upsert
            if (string.IsNullOrWhiteSpace(r.ExternalId))
                r.ExternalId = Guid.NewGuid().ToString("N");

            // owner important
            r.OwnerUserId = userId;

            // Save recette (upsert via external_id)
            await App.RecipesService!.UpsertRecetteAsync(userId, r);

            // r√©cup√©rer recetteId DB √† partir de ExternalId (‚ö†Ô∏è nouvelle signature: userId + externalId)
            var recetteId = await App.RecipesService.GetRecetteIdByExternalIdAsync(userId, r.ExternalId);
            if (recetteId == null)
                throw new Exception("Recette introuvable apr√®s upsert.");

            // envoyer ingr√©dients
            var ingSvc = new RecetteIngredientsService(App.RestClient!);
            var items = (r.Ingredients ?? new List<IngredientRecette>())
                .Select(i => (i.Nom, i.Quantite, i.Unite))
                .ToList();

            await ingSvc.ReplaceForRecetteAsync(recetteId.Value, items);

            await RefreshDepuisSupabaseAsync();

            MessageBox.Show(
                $"La recette '{r.Nom}' a √©t√© ajout√©e avec succ√®s !",
                "Succ√®s",
                MessageBoxButton.OK,
                MessageBoxImage.Information);
        }

        private async void BtnSupprimerRecette_Click(object sender, RoutedEventArgs e)
        {
            var bouton = sender as Button;
            var recette = bouton?.Tag as Recette;

            if (recette == null)
                return;

            var resultat = MessageBox.Show(
                $"Voulez-vous vraiment supprimer la recette '{recette.Nom}' ?",
                "Confirmation de suppression",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                if (!EnsureConnected(out _))
                    return;

                await App.RecipesService!.DeleteRecetteAsync(recette.Id);

                await RefreshDepuisSupabaseAsync();

                MessageBox.Show(
                    $"La recette '{recette.Nom}' a √©t√© supprim√©e.",
                    "Suppression r√©ussie",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur suppression :\n{ex}");
            }
        }

        private async void BtnSyncRecettes_Click(object sender, RoutedEventArgs e)
        {
            await RefreshDepuisSupabaseAsync();
            MessageBox.Show("Recettes recharg√©es depuis Supabase.");
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\App.xaml
================================================================================

Ôªø<?xml version = "1.0" encoding = "UTF-8" ?>
<Application xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:LoGeCuiMobile"
             x:Class="LoGeCuiMobile.App">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Colors.xaml" />
                <ResourceDictionary Source="Resources/Styles/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
        </ResourceDictionary>
    </Application.Resources>
</Application>

================================================================================
FILE: LoGeCuiMobile\App.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Extensions.Configuration;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Storage;
using System;
using System.Globalization;
using System.IO;
using System.Threading.Tasks;
using LoGeCuiMobile.Services.Local;
using Microsoft.Maui.Networking;
using Supabase; // ‚úÖ pour SupabaseRestClient

namespace LoGeCuiMobile
{
    public partial class App : Application
    {
        public RecetteIngredientsService? RecetteIngredientsService { get; private set; }

        public SupabaseService? Supabase { get; private set; }
        public SupabaseRestClient? RestClient { get; private set; }

        public RecipesService? RecipesService { get; private set; }
        public IngredientsService? IngredientsService { get; private set; }
        public ListeCoursesSupabaseService? ListeCoursesSupabaseService { get; private set; }

        public ShoppingListsService? ShoppingListsService { get; private set; }

        public static LocalDatabase LocalDb { get; private set; } = null!;

        // ‚úÖ Token RAM (upload storage etc.)
        public string? CurrentAccessToken { get; private set; }

        // ‚úÖ Liste de courses active
        public Guid? CurrentShoppingListId { get; private set; }
        public void SetCurrentShoppingListId(Guid listId) => CurrentShoppingListId = listId;

        public Guid? CurrentUserId { get; private set; }
        public string OcrApiKey { get; private set; } = "";

        // ‚úÖ Inclure ShoppingListsService dans la condition ‚Äúconnect√©‚Äù
        public bool IsConnected =>
            CurrentUserId != null &&
            RestClient != null &&
            RecipesService != null &&
            IngredientsService != null &&
            ListeCoursesSupabaseService != null &&
            RecetteIngredientsService != null &&
            ShoppingListsService != null;

        private IConfigurationRoot? _config;

        public App()
        {
            InitializeComponent();

            // ‚úÖ Langue & th√®me avant l'UI
            ApplySavedLanguage();
            ApplySavedTheme();

            // ‚úÖ Local DB
            string dbPath = Path.Combine(FileSystem.AppDataDirectory, "logecui.db3");
            LocalDb = new LocalDatabase(dbPath);

            // ‚úÖ Init services de base (anon + OCR)
            InitBaseServices();

            // ‚úÖ Page par d√©faut : Login (avant auto-login)
            MainPage = RootPage.CreateLoginRoot();

            // ‚úÖ Init async (config + auto-login)
            _ = InitAsync();
        }

        // ------------------ JWT EXPIRED HANDLING ------------------

        public static bool IsJwtExpiredException(Exception ex)
        {
            return ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        public void HandleJwtExpired()
        {
            MainThread.BeginInvokeOnMainThread(async () =>
            {
                try
                {
                    await Current?.MainPage?.DisplayAlert(
                        "Session expir√©e",
                        "Ta session a expir√©. Merci de te reconnecter.",
                        "OK"
                    );
                }
                catch { }

                Logout(silent: true);
            });
        }

        // ------------------ UI SETTINGS ------------------

        private void ApplySavedLanguage()
        {
            try
            {
                var lang = Preferences.Get("app_language", "fr");
                var culture = new CultureInfo(lang);
                LocalizationResourceManager.Instance.SetCulture(culture);
            }
            catch
            {
                LocalizationResourceManager.Instance.SetCulture(new CultureInfo("fr"));
            }
        }

        private void ApplySavedTheme()
        {
            var theme = Preferences.Get("app_theme", "system");

            Current.UserAppTheme = theme switch
            {
                "light" => AppTheme.Light,
                "dark" => AppTheme.Dark,
                _ => AppTheme.Unspecified
            };
        }

        // ------------------ INIT SERVICES ------------------

        private void InitBaseServices()
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            Supabase = new SupabaseService(url, key);

            try
            {
                OcrApiKey = ConfigurationHelper.GetOcrApiKey();
                if (!string.IsNullOrWhiteSpace(OcrApiKey) && OcrApiKey.Length >= 5)
                    System.Diagnostics.Debug.WriteLine($"‚úÖ OCR Key charg√©e: {OcrApiKey.Substring(0, 5)}...");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå ERREUR OCR: {ex.Message}");
                OcrApiKey = "K86867725288957"; // ‚ö†Ô∏è debug only
            }
        }

        private async Task InitAsync()
        {
            try
            {
                await InitConfigurationAsync();
                await TryAutoLoginAsync();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå InitAsync: {ex}");
                ShowLogin();
            }
        }

        private async Task InitConfigurationAsync()
        {
            try
            {
                using var stream = await FileSystem.OpenAppPackageFileAsync("appsettings.json");
                var builder = new ConfigurationBuilder().AddJsonStream(stream);
                _config = builder.Build();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è appsettings.json introuvable ou illisible: " + ex.Message);
                _config = null;
            }
        }

        // ------------------ AUTO LOGIN ------------------

        private async Task TryAutoLoginAsync()
        {
            var rememberMe = await SecureStorage.GetAsync("remember_me");
            if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
            {
                ShowLogin();
                return;
            }

            var accessToken = await SecureStorage.GetAsync("sb_access_token");
            var userId = await SecureStorage.GetAsync("sb_user_id");

            if (string.IsNullOrWhiteSpace(accessToken) || string.IsNullOrWhiteSpace(userId))
            {
                ShowLogin();
                return;
            }

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // ‚úÖ Init services REST avec bearer + token RAM
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet : si token expir√© -> logout propre
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            // ‚úÖ Charger / assurer list_id (liste de courses active)
            await EnsureActiveShoppingListAsync();

            ShowAppShell();
        }

        public async void OnLoginSuccess(string accessToken, string userId)
        {
            // ‚úÖ Toujours garder le token dispo pour Storage (m√™me si remember_me n'est pas activ√©)
            await SecureStorage.SetAsync("sb_access_token", accessToken);
            await SecureStorage.SetAsync("sb_user_id", userId);

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // ‚úÖ Init services REST avec bearer + token RAM
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            // ‚úÖ Charger / assurer list_id (liste de courses active)
            await EnsureActiveShoppingListAsync();

            ShowAppShell();
        }

        private void InitRestServicesInternal(string accessToken)
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            // ‚úÖ Stocker le token en RAM
            CurrentAccessToken = accessToken;

            RestClient = client;

            // ‚úÖ IMPORTANT : instancier les services AVEC le client non-null
            ShoppingListsService = new ShoppingListsService(client);
            RecipesService = new RecipesService(client);
            IngredientsService = new IngredientsService(client);
            ListeCoursesSupabaseService = new ListeCoursesSupabaseService(client);
            RecetteIngredientsService = new RecetteIngredientsService(client);
        }

        // ‚úÖ Garantit qu'on a toujours une liste active (sinon cr√©ation/r√©cup√©ration)
        private async Task EnsureActiveShoppingListAsync()
        {
            try
            {
                if (RestClient == null || CurrentUserId == null)
                {
                    CurrentShoppingListId = null;
                    return;
                }

                ShoppingListsService ??= new ShoppingListsService(RestClient);

                // 1) Essayer via memberships (listes partag√©es OU owner d√©j√† membre)
                Guid? listId = null;
                try
                {
                    var bootstrap = new ShoppingListBootstrapService(RestClient);
                    listId = await bootstrap.GetFirstListIdForUserAsync(CurrentUserId.Value);
                }
                catch (Exception ex)
                {
                    // On ne bloque pas : on passera au fallback ‚Äúowner list‚Äù
                    System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è Bootstrap memberships failed: " + ex.Message);
                }

                // 2) Fallback : r√©cup√©rer/cr√©er une liste perso (owner_user_id)
                if (listId == null)
                {
                    listId = await ShoppingListsService.EnsurePersonalListIdAsync(CurrentUserId.Value);

                    // 3) Assurer qu‚Äôon est membre (utile si ton app/RLS d√©pend de shopping_list_members)
                    await EnsureMembershipAsync(listId.Value, CurrentUserId.Value);
                }

                CurrentShoppingListId = listId;
                System.Diagnostics.Debug.WriteLine($"‚úÖ Shopping list active: {CurrentShoppingListId}");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("‚ùå EnsureActiveShoppingListAsync: " + ex);
                CurrentShoppingListId = null;
            }
        }

        // ‚úÖ Test simple qui provoque JWT expired si token mort
        private async Task<bool> ValidateSessionAsync()
        {
            try
            {
                if (RecipesService == null || CurrentUserId == null)
                    return false;

                _ = await RecipesService.GetRecettesAsync(CurrentUserId.Value);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpiredException(ex))
                    return false;

                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è ValidateSessionAsync: " + ex.Message);
                return true;
            }
        }

        // ------------------ NAV ------------------

        public void ShowAppShell()
        {
            if (!IsConnected)
            {
                ShowLogin();
                return;
            }

            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = new AppShell();
            });
        }

        public void ShowLogin()
        {
            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = RootPage.CreateLoginRoot();
            });
        }

        // ------------------ LOGOUT ------------------

        public void Logout(bool silent = false)
        {
            SecureStorage.Remove("remember_me");
            SecureStorage.Remove("sb_access_token");
            SecureStorage.Remove("sb_user_id");

            Supabase?.ClearSession();
            CurrentUserId = null;
            CurrentAccessToken = null;
            CurrentShoppingListId = null;

            RestClient = null;
            RecipesService = null;
            IngredientsService = null;
            ListeCoursesSupabaseService = null;
            RecetteIngredientsService = null;
            ShoppingListsService = null;

            if (!silent)
                ShowLogin();
            else
                MainThread.BeginInvokeOnMainThread(() => MainPage = RootPage.CreateLoginRoot());
        }

        // ‚úÖ Assure que l'utilisateur est membre de la liste (utile pour bootstrap + RLS)
        private async Task EnsureMembershipAsync(Guid listId, Guid userId)
        {
            if (RestClient == null) return;

            var payload = new[]
            {
                new { list_id = listId, user_id = userId, role = "owner" }
            };

            try
            {
                await RestClient.PostAsync<object>(
                    "shopping_list_members",
                    payload,
                    returnRepresentation: false);
            }
            catch
            {
                // D√©j√† membre / conflit / policy : on ignore.
            }
        }

        // ------------------ MISC ------------------

        public Task HandleDeepLinkAsync(Uri uri) => Task.CompletedTask;

        public void SetSupabase(SupabaseService supabase) => Supabase = supabase;
        public void SetCurrentUserId(Guid userId) => CurrentUserId = userId;

        public void InitRestServices(string accessToken)
        {
            InitRestServicesInternal(accessToken);
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  },

  "OCR": {
    "ApiKey": "K86867725288957"
  }

}

================================================================================
FILE: LoGeCuiMobile\AppShell.xaml
================================================================================

<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="LoGeCuiMobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:LoGeCuiMobile.Pages"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    FlyoutBehavior="Flyout">

    <FlyoutItem Title="{tr:Translate Nav_ShoppingList}" Route="liste-courses">
        <ShellContent Route="liste-courses"
                      ContentTemplate="{DataTemplate pages:ListeCoursesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Recipes}" Route="mes-recettes">
        <ShellContent Route="mes-recettes"
                      ContentTemplate="{DataTemplate pages:MesRecettesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_RandomMenu}" Route="menu-aleatoire">
        <ShellContent Route="menu-aleatoire"
                      ContentTemplate="{DataTemplate pages:MenuAleatoirePage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Ingredients}" Route="mes-ingredients">
        <ShellContent Route="mes-ingredients"
                      ContentTemplate="{DataTemplate pages:MesIngredientsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Settings}" Route="settings">
        <ShellContent Route="settings"
                      ContentTemplate="{DataTemplate pages:SettingsPage}" />
    </FlyoutItem>

</Shell>


================================================================================
FILE: LoGeCuiMobile\AppShell.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile; // si ForgotPasswordPage est √† la racine du projet

namespace LoGeCuiMobile;

public partial class AppShell : Shell
{
    public AppShell()
    {
        InitializeComponent();

        Routing.RegisterRoute(nameof(ListeCoursesPage), typeof(ListeCoursesPage));
        Routing.RegisterRoute(nameof(ForgotPasswordPage), typeof(ForgotPasswordPage));
        Routing.RegisterRoute(nameof(AjouterIngredientPage), typeof(AjouterIngredientPage));
        Routing.RegisterRoute(nameof(AjouterRecettePage), typeof(AjouterRecettePage));
        Routing.RegisterRoute(nameof(MenuAleatoirePage), typeof(MenuAleatoirePage));

    }
}

================================================================================
FILE: LoGeCuiMobile\ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using Microsoft.Maui.Storage;
using System;
using System.IO;

namespace LoGeCuiMobile
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;
        private static readonly object _lock = new();

        private static IConfiguration Configuration
        {
            get
            {
                if (_configuration != null)
                    return _configuration;

                lock (_lock)
                {
                    if (_configuration != null)
                        return _configuration;

                    try
                    {
                        // Lire le fichier depuis le package MAUI
                        using var streamTask = FileSystem.OpenAppPackageFileAsync("appsettings.json");
                        streamTask.Wait();
                        using var stream = streamTask.Result;

                        // Copie en m√©moire pour √©viter tout souci de stream non seekable / lecture partielle
                        using var ms = new MemoryStream();
                        stream.CopyTo(ms);
                        ms.Position = 0;

                        var builder = new ConfigurationBuilder()
                            .AddJsonStream(ms);

                        _configuration = builder.Build();

#if DEBUG
                        System.Diagnostics.Debug.WriteLine("[CONFIG] appsettings.json charg√©");
                        System.Diagnostics.Debug.WriteLine("[CONFIG] Supabase:Url=" + (_configuration["Supabase:Url"] ?? "<null>"));
                        System.Diagnostics.Debug.WriteLine("[CONFIG] OCR:ApiKey present=" + (!string.IsNullOrWhiteSpace(_configuration["OCR:ApiKey"])));
#endif

                        return _configuration;
                    }
                    catch (Exception ex)
                    {
                        throw new Exception(
                            "Impossible de charger appsettings.json depuis le package MAUI. " +
                            "V√©rifie qu'il est bien dans LoGeCuiMobile, Build Action = MauiAsset, et que tu as fait Clean/Rebuild. " +
                            $"D√©tail: {ex.Message}", ex);
                    }
                }
            }
        }


        // =========================
        // SUPABASE
        // =========================

        public static string GetSupabaseUrl()
            => Configuration["Supabase:Url"]
               ?? throw new Exception("Supabase:Url manquant dans appsettings.json");

        public static string GetSupabaseKey()
            => Configuration["Supabase:Key"]
               ?? throw new Exception("Supabase:Key manquant dans appsettings.json");

        // =========================
        // OCR
        // =========================

        public static string GetOcrApiKey()
        {
            var key = Configuration["OCR:ApiKey"];

            if (string.IsNullOrWhiteSpace(key))
                throw new Exception("OCR:ApiKey manquant dans appsettings.json");

            return key;
        }
    }
}





================================================================================
FILE: LoGeCuiMobile\Converters\BoolToStrikethroughConverter.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Globalization;

namespace LoGeCuiMobile.Converters
{
    public class BoolToStrikethroughConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
            => (value is bool b && b) ? TextDecorations.Strikethrough : TextDecorations.None;

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
            => throw new NotImplementedException();
    }
}

================================================================================
FILE: LoGeCuiMobile\Converters\QuantityFormatConverter.cs
================================================================================

Ôªøusing System;
using System.Globalization;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile.Converters
{
    public class QuantityFormatConverter : IMultiValueConverter
    {
        public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
        {
            var q = values.Length > 0 ? values[0]?.ToString() ?? "" : "";
            var u = values.Length > 1 ? values[1]?.ToString() ?? "" : "";

            var fmt = LocalizationResourceManager.Instance["Ingredients_QuantityFormat"];
            // Ex: "Quantit√© : {0} {1}" / "Menge: {0} {1}"
            return string.Format(fmt, q, u).Trim();
        }

        public object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture)
            => throw new NotSupportedException();
    }
}

================================================================================
FILE: LoGeCuiMobile\ForgotPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="LoGeCuiMobile.ForgotPasswordPage"
    Title="Mot de passe oubli√©">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="Mot de passe oubli√©"
                   FontSize="20"
                   FontAttributes="Bold" />

            <Label Text="Entrez votre email pour recevoir un lien de r√©initialisation."
                   FontSize="14" />

            <Entry x:Name="EmailEntry"
                   Placeholder="Adresse email"
                   Keyboard="Email" />

            <Button x:Name="SendButton"
                    Text="Envoyer"
                    Clicked="OnSendClicked" />

            <Label x:Name="StatusLabel"
                   FontSize="13" />

            <Button Text="Retour"
                    Clicked="OnBackClicked" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\ForgotPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Graphics;
using System;

namespace LoGeCuiMobile
{
    // Optionnel : permet de pr√©-remplir l'email si tu navigues avec ?email=...
    [QueryProperty(nameof(PrefillEmail), "email")]
    public partial class ForgotPasswordPage : ContentPage
    {
        private readonly SupabaseService _supabaseService;

        // Valeur pass√©e via Shell : ?email=...
        public string PrefillEmail
        {
            set
            {
                // Evite crash si EmailEntry n'est pas encore pr√™t
                try
                {
                    var decoded = Uri.UnescapeDataString(value ?? "");
                    if (!string.IsNullOrWhiteSpace(decoded))
                        EmailEntry.Text = decoded;
                }
                catch { /* ignore */ }
            }
        }

        public ForgotPasswordPage()
        {
            InitializeComponent();

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            _supabaseService = new SupabaseService(url, key);

            StatusLabel.Text = "";
        }

        private async void OnSendClicked(object sender, EventArgs e)
        {
            try
            {
                // S√©curit√© si un contr√¥le est null (mauvais x:Name / x:Class)
                if (EmailEntry == null || SendButton == null || StatusLabel == null)
                {
                    await DisplayAlert("Erreur", "Interface non initialis√©e (XAML). V√©rifie x:Class et x:Name.", "OK");
                    return;
                }

                var email = (EmailEntry.Text ?? "").Trim();

                // ‚úÖ Validation obligatoire
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@") || !email.Contains("."))
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = "Veuillez saisir une adresse email valide.";
                    return;
                }

                SendButton.IsEnabled = false;
                StatusLabel.TextColor = Colors.Black;
                StatusLabel.Text = "Envoi en cours‚Ä¶";

                var result = await _supabaseService.SendPasswordResetAsync(email);

                if (result.success)
                {
                    StatusLabel.TextColor = Colors.Green;
                    StatusLabel.Text = "Email envoy√© ‚úÖ V√©rifiez votre bo√Æte mail (et les spams).";
                }
                else
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = result.error ?? "Impossible d'envoyer l'email.";
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ √©vite le crash et donne une erreur lisible
                StatusLabel.TextColor = Colors.Red;
                StatusLabel.Text = "Erreur : " + ex.Message;
            }
            finally
            {
                if (SendButton != null)
                    SendButton.IsEnabled = true;
            }
        }

        private async void OnBackClicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PopAsync();
            }
            catch
            {
                // au cas o√π
                await Shell.Current?.GoToAsync("..");
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\LoGeCuiMobile.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFrameworks>net10.0-android;net10.0-ios;net10.0-maccatalyst</TargetFrameworks>
		<TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('windows'))">$(TargetFrameworks);net10.0-windows10.0.19041.0</TargetFrameworks>

		<!-- Note for MacCatalyst:
		The default runtime is maccatalyst-x64, except in Release config, in which case the default is maccatalyst-x64;maccatalyst-arm64.
		When specifying both architectures, use the plural <RuntimeIdentifiers> instead of the singular <RuntimeIdentifier>.
		The Mac App Store will NOT accept apps with ONLY maccatalyst-arm64 indicated;
		either BOTH runtimes must be indicated or ONLY macatalyst-x64. -->
		<!-- For example: <RuntimeIdentifiers>maccatalyst-x64;maccatalyst-arm64</RuntimeIdentifiers> -->

		<OutputType>Exe</OutputType>
		<RootNamespace>LoGeCuiMobile</RootNamespace>
		<UseMaui>true</UseMaui>
		<SingleProject>true</SingleProject>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>

		<!-- Display name -->
		<ApplicationTitle>LoGeCuiMobile</ApplicationTitle>

		<!-- App Identifier -->
		<ApplicationId>com.companyname.logecuimobile</ApplicationId>

		<!-- Versions -->
		<ApplicationDisplayVersion>2.0.0</ApplicationDisplayVersion>
		<ApplicationVersion>6</ApplicationVersion>

		<!-- To develop, package, and publish an app to the Microsoft Store, see: https://aka.ms/MauiTemplateUnpackaged -->
		<WindowsPackageType>None</WindowsPackageType>

		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">21.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</SupportedOSPlatformVersion>
		<TargetPlatformMinVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</TargetPlatformMinVersion>
		<AndroidSigningKeyStore>logecui.keystore</AndroidSigningKeyStore>
	</PropertyGroup>

	<PropertyGroup>
		<UserSecretsId>votre-guid-unique</UserSecretsId>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <EmbedAssembliesIntoApk>False</EmbedAssembliesIntoApk>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<ItemGroup>
		<!-- App Icon -->
		<MauiIcon Include="Resources\AppIcon\postriticone.png" />

		<!-- Splash Screen -->
		<MauiSplashScreen Include="Resources\Splash\postriticone.png" Color="#FFFFFF" BaseSize="128,128" />

		<!-- Images -->
		<MauiImage Include="Resources\Images\*" />
		<MauiImage Update="Resources\Images\dotnet_bot.png" Resize="True" BaseSize="300,185" />
		
		<!-- Custom Fonts -->
		<MauiFont Include="Resources\Fonts\*" />

		<!-- Raw Assets (also remove the "Resources\Raw" prefix) -->
		<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />
	</ItemGroup>

	<ItemGroup>
		<MauiAsset Include="appsettings.json">
		  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</MauiAsset>
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="CommunityToolkit.Maui" Version="14.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
		<PackageReference Include="Microsoft.Maui.Controls" Version="10.0.30" />
		<PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="10.0.2" />
		<PackageReference Include="SkiaSharp" Version="3.119.1" />
		<PackageReference Include="sqlite-net-pcl" Version="1.9.172" />
		<PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
	</ItemGroup>

	<ItemGroup>
	  <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <MauiXaml Update="ForgotPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="LoginPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterIngredientPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterRecettePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ListeCoursesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MenuAleatoirePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesIngredientsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesRecettesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ResetPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\SettingsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	</ItemGroup>

	<ItemGroup>
	  <Folder Include="Platforms\Android\Resources\Raw\" />
	</ItemGroup>

	<ItemGroup>
	  <Compile Update="Resources\Lang\AppResources.Designer.cs">
	    <DesignTime>True</DesignTime>
	    <AutoGen>True</AutoGen>
	    <DependentUpon>AppResources.resx</DependentUpon>
	  </Compile>
	</ItemGroup>

	<ItemGroup>
	  <EmbeddedResource Update="Resources\Lang\AppResources.resx">
	    <Generator>PublicResXFileCodeGenerator</Generator>
	    <LastGenOutput>AppResources.Designer.cs</LastGenOutput>
	  </EmbeddedResource>
	</ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiMobile\LoGeCuiMobile.sln
================================================================================

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.5.2.0
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "LoGeCuiMobile", "LoGeCuiMobile.csproj", "{718860EB-0CC0-D204-6424-4B05AD96CB46}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {FE3EFD92-D10C-4693-8095-DE23E3011D74}
	EndGlobalSection
EndGlobal

================================================================================
FILE: LoGeCuiMobile\LoginPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lang="clr-namespace:LoGeCuiMobile.Resources.Lang"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.LoginPage"
             Title="LoGeCui - Connexion"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="20" VerticalOptions="Center">

            

            <!-- Logo -->
            <Label Text="üõí LoGeCui"
                   FontSize="42"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                   Margin="0,10,0,30"/>

            <!-- üåç Choix de langue -->
            <Picker x:Name="LanguagePicker"
        Title="üåç Language"
        SelectedIndexChanged="LanguagePicker_SelectedIndexChanged">
                <Picker.Items>
                    <x:String>üá´üá∑ Fran√ßais</x:String>
                    <x:String>üá¨üáß English</x:String>
                    <x:String>üá©üá™ Deutsch</x:String>
                    <x:String>üá™üá∏ Espa√±ol</x:String>
                    <x:String>üáÆüáπ Italiano</x:String>
                    <x:String>üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</x:String>
                    <x:String>üáµüá± Polski</x:String>
                    <x:String>üáπüá∑ T√ºrk√ße</x:String>
                    <x:String>üá∑üá¥ Rom√¢nƒÉ</x:String>
                    <x:String>üá®üáø ƒåe≈°tina</x:String>
                    <x:String>üá∞üá∑ ÌïúÍµ≠Ïñ¥</x:String>
                    <x:String>üáØüáµ Êó•Êú¨Ë™û</x:String>
                    <x:String>üáπüá≠ ‡πÑ‡∏ó‡∏¢</x:String>
                    <x:String>üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</x:String>
                </Picker.Items>
            </Picker>

            <!-- Email -->
            <Label Text="{tr:Translate Email}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Entry x:Name="TxtEmail"
                   Placeholder="email@example.com"
                   Keyboard="Email"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <!-- Mot de passe -->
            <Label Text="{tr:Translate Password}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Grid ColumnDefinitions="*,Auto"
                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                  Padding="8">

                <Entry x:Name="TxtPassword"
                       Placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                       IsPassword="True"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                <Button Grid.Column="1"
                        Text="üëÅ"
                        BackgroundColor="Transparent"
                        Clicked="TogglePassword"/>
            </Grid>

            <!-- Rester connect√© -->
            <HorizontalStackLayout Spacing="10">
                <CheckBox x:Name="ChkRememberMe" Color="#27AE60"/>
                <Label Text="{tr:Translate StayConnected}"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            </HorizontalStackLayout>

            <!-- Connexion -->
            <Button x:Name="BtnConnexion"
                    Text="{tr:Translate LoginButton}"
                    BackgroundColor="#27AE60"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnConnexion_Clicked"/>

            <!-- Inscription -->
            <Button x:Name="BtnInscription"
                    Text="{tr:Translate SignupButton}"
                    BackgroundColor="#3498DB"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnInscription_Clicked"/>

            <!-- Message -->
            <Label x:Name="TxtMessage"
                   TextColor="Red"
                   HorizontalOptions="Center"
                   IsVisible="False"/>

            <!-- Mot de passe oubli√© -->
            <Button Text="{tr:Translate ForgotPassword}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light=Blue, Dark=#4DA3FF}"
                    Clicked="BtnForgotPassword_Clicked"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\LoginPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile; // ForgotPasswordPage / RootPage
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;
using System.Globalization;

namespace LoGeCuiMobile.Pages
{
    public partial class LoginPage : ContentPage
    {
        private readonly SupabaseService _supabase;
        private bool _isPasswordVisible = false;

        // Emp√™che SelectedIndexChanged pendant l'init
        private bool _isInitializingLanguage = false;

        public LoginPage()
        {
            InitializeComponent();

            _isInitializingLanguage = true;
            InitLanguagePickerSelection();
            _isInitializingLanguage = false;

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            _supabase = new SupabaseService(url, key);

            _ = LoadSavedUserAsync();
        }

        // =========================
        // LANGUE (Picker)
        // =========================
        private void LanguagePicker_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (_isInitializingLanguage)
                return;

            if (LanguagePicker.SelectedIndex < 0)
                return;

            var langCode = LanguagePicker.SelectedIndex switch
            {
                0 => "fr",
                1 => "en",
                2 => "de",
                3 => "es",
                4 => "it",
                5 => "ar",
                6 => "pl",
                7 => "tr",
                8 => "ro",
                9 => "cs",
                10 => "ko",
                11 => "ja",
                12 => "th",
                13 => "hi",
                _ => "fr"
            };

            var current = Preferences.Get("app_language", "fr");
            if (string.Equals(current, langCode, StringComparison.OrdinalIgnoreCase))
                return;

            Preferences.Set("app_language", langCode);

            var culture = new CultureInfo(langCode);

            // ‚úÖ Applique la culture + notifie l'UI (si tu utilises TranslateExtension)
            LocalizationResourceManager.Instance.SetCulture(culture);

            // ‚ö†Ô∏è Si ton XAML est encore en x:Static et que tu veux quand m√™me voir le changement,
            // d√©-commente ce bloc (mais √©vite de le faire pendant l'init) :
            // MainThread.BeginInvokeOnMainThread(() =>
            // {
            //     Application.Current.MainPage = RootPage.CreateLoginRoot();
            // });
        }

        private void InitLanguagePickerSelection()
        {
            var lang = Preferences.Get("app_language", "fr");

            var index = lang switch
            {
                "fr" => 0,
                "en" => 1,
                "de" => 2,
                "es" => 3,
                "it" => 4,
                "ar" => 5,
                "pl" => 6,
                "tr" => 7,
                "ro" => 8,
                "cs" => 9,
                "ko" => 10,
                "ja" => 11,
                "th" => 12,
                "hi" => 13,
                _ => 0
            };

            LanguagePicker.SelectedIndex = index;
        }

        // =========================
        // LOGIN
        // =========================
        private async void BtnConnexion_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.Connecting, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.ConnectionError, Colors.Red);
                    await DisplayAlert(AppResources.ErrorTitle, AppResources.BadPassword, "OK");
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);


                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async Task LoadSavedUserAsync()
        {
            try
            {
                var rememberMe = await SecureStorage.GetAsync("remember_me");
                if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
                    return;

                var email = await SecureStorage.GetAsync("user_email");
                if (!string.IsNullOrEmpty(email))
                {
                    TxtEmail.Text = email;
                    ChkRememberMe.IsChecked = true;
                }
            }
            catch
            {
                // ignore SecureStorage errors
            }
        }

        private async void BtnInscription_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.CreatingAccount, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignUpThenSignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.SignupError, Colors.Red);
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);
                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async void BtnForgotPassword_Clicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PushAsync(new ForgotPasswordPage());
            }
            catch (Exception ex)
            {
                await DisplayAlert(AppResources.ErrorTitle, ex.ToString(), "OK");
            }
        }

        private void TogglePassword(object sender, EventArgs e)
        {
            _isPasswordVisible = !_isPasswordVisible;

            TxtPassword.IsPassword = !_isPasswordVisible;

            if (sender is Button btn)
                btn.Text = _isPasswordVisible ? "üôà" : "üëÅ";

            if (!string.IsNullOrEmpty(TxtPassword.Text))
            {
                var t = TxtPassword.Text;
                TxtPassword.Text = string.Empty;
                TxtPassword.Text = t;
            }
        }

        private void SetStatus(string message, Color color)
        {
            TxtMessage.Text = message;
            TxtMessage.TextColor = color;
            TxtMessage.IsVisible = true;
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\MainPage.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LoGeCuiMobile.MainPage">

    <ScrollView>
        <VerticalStackLayout
            Padding="30,0"
            Spacing="25">
            <Image
                Source="dotnet_bot.png"
                HeightRequest="185"
                Aspect="AspectFit"
                SemanticProperties.Description="dot net bot in a submarine number ten" />

            <Label
                Text="Hello, World!"
                Style="{StaticResource Headline}"
                SemanticProperties.HeadingLevel="Level1" />

            <Label
                Text="Welcome to &#10;.NET Multi-platform App UI"
                Style="{StaticResource SubHeadline}"
                SemanticProperties.HeadingLevel="Level2"
                SemanticProperties.Description="Welcome to dot net Multi platform App U I" />

            <Button
                x:Name="CounterBtn"
                Text="Click me" 
                SemanticProperties.Hint="Counts the number of times you click"
                Clicked="OnCounterClicked"
                HorizontalOptions="Fill" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\MainPage.xaml.cs
================================================================================

Ôªønamespace LoGeCuiMobile
{
    public partial class MainPage : ContentPage
    {
        int count = 0;

        public MainPage()
        {
            InitializeComponent();
        }

        private void OnCounterClicked(object? sender, EventArgs e)
        {
            count++;

            if (count == 1)
                CounterBtn.Text = $"Clicked {count} time";
            else
                CounterBtn.Text = $"Clicked {count} times";

            SemanticScreenReader.Announce(CounterBtn.Text);
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\MauiProgram.cs
================================================================================

Ôªøusing System;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.Maui.Storage;
using CommunityToolkit.Maui;

namespace LoGeCuiMobile
{
    public static class MauiProgram
    {
        public static IConfiguration Configuration { get; private set; } = new ConfigurationBuilder().Build();

        public static MauiApp CreateMauiApp()
        {
            var builder = MauiApp.CreateBuilder();

            builder
            .UseMauiApp<App>()
            .UseMauiCommunityToolkit()   // üëà AJOUT ICI
            .ConfigureFonts(fonts =>
            {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
            });

#if DEBUG
            builder.Logging.AddDebug();
#endif

            // ‚úÖ Charge appsettings.json (MauiAsset) sans faire crasher l'app si absent
            try
            {
                using var stream = FileSystem.OpenAppPackageFileAsync("appsettings.json")
                                             .GetAwaiter()
                                             .GetResult();

                builder.Configuration.AddJsonStream(stream);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIG ERROR ==========");
                System.Diagnostics.Debug.WriteLine("Impossible de charger appsettings.json depuis le package MAUI.");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("==================================");
                // On continue volontairement pour √©viter le crash.
            }

            Configuration = builder.Configuration;

            // ‚úÖ IMPORTANT: on force le namespace exact (√©vite conflits)
            try
            {
                LoGeCuiShared.Services.ConfigurationHelper.Configure(key => Configuration[key]);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIGHELPER ERROR ==========");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("========================================");
                // On continue; l'erreur r√©elle ressortira quand une cl√© sera demand√©e.
            }

            return builder.Build();
        }
    }
}


================================================================================
FILE: LoGeCuiMobile\Models\IngredientUI.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    public class IngredientUi : INotifyPropertyChanged
    {
        public Ingredient Model { get; }

        public IngredientUi(Ingredient model)
        {
            Model = model;
        }

        public System.Guid Id => Model.Id;
        public string Nom => Model.Nom ?? "";
        public string? Quantite => Model.Quantite;
        public string? Unite => Model.Unite;

        public bool EstDisponible
        {
            get => Model.EstDisponible;
            set
            {
                if (Model.EstDisponible == value) return;
                Model.EstDisponible = value;
                OnPropertyChanged();
            }
        }

        // ‚úÖ NOUVEAU : Favori (n√©cessite Model.EstFavori)
        public bool EstFavori
        {
            get => Model.EstFavori;
            set
            {
                if (Model.EstFavori == value) return;
                Model.EstFavori = value;
                OnPropertyChanged();
                OnPropertyChanged(nameof(HeartText));
            }
        }

        // ‚úÖ NOUVEAU : emoji coeur
        public string HeartText => EstFavori ? "‚ù§Ô∏è" : "ü§ç";

        bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                OnPropertyChanged();
            }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: LoGeCuiMobile\Models\LanguageItem.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiMobile.Models
{
    internal class LanguageItem
    {
        public string Name { get; set; } = "";
        public string Code { get; set; } = "";
        public string Flag { get; set; } = ""; // emoji drapeau
    }
}

================================================================================
FILE: LoGeCuiMobile\output_concat.txt
================================================================================

# CONCAT OUTPUT
# Root: C:\Users\Francois\source\repos\LoGeCui\LoGeCuiMobile
# Files: 62


================================================================================
FILE: App.xaml
================================================================================

Ôªø<?xml version = "1.0" encoding = "UTF-8" ?>
<Application xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:LoGeCuiMobile"
             x:Class="LoGeCuiMobile.App">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Colors.xaml" />
                <ResourceDictionary Source="Resources/Styles/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
        </ResourceDictionary>
    </Application.Resources>
</Application>

================================================================================
FILE: App.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Extensions.Configuration;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Storage;
using System;
using System.Globalization;
using System.IO;
using System.Threading.Tasks;
using LoGeCuiMobile.Services.Local;

namespace LoGeCuiMobile
{
    public partial class App : Application
    {
        public RecetteIngredientsService? RecetteIngredientsService { get; private set; }

        public SupabaseService? Supabase { get; private set; }
        public SupabaseRestClient? RestClient { get; private set; }

        public RecipesService? RecipesService { get; private set; }
        public IngredientsService? IngredientsService { get; private set; }
        public ListeCoursesSupabaseService? ListeCoursesSupabaseService { get; private set; }

        public static LocalDatabase LocalDb { get; private set; } = null!;

        public Guid? CurrentUserId { get; private set; }
        public string OcrApiKey { get; private set; } = "";

        public bool IsConnected =>
            CurrentUserId != null &&
            RestClient != null &&
            RecipesService != null &&
            IngredientsService != null &&
            ListeCoursesSupabaseService != null;

        private IConfigurationRoot? _config;

        public App()
        {
            InitializeComponent();

            // ‚úÖ Langue & th√®me avant l'UI
            ApplySavedLanguage();
            ApplySavedTheme();

            // ‚úÖ Local DB
            string dbPath = Path.Combine(FileSystem.AppDataDirectory, "logecui.db3");
            LocalDb = new LocalDatabase(dbPath);

            // ‚úÖ Init services de base (anon + OCR)
            InitBaseServices();

            // ‚úÖ Page par d√©faut : Login (avant auto-login)
            MainPage = RootPage.CreateLoginRoot();

            // ‚úÖ Init async (config + auto-login)
            _ = InitAsync();
        }

        // ------------------ JWT EXPIRED HANDLING ------------------

        public static bool IsJwtExpiredException(Exception ex)
        {
            // "JWT expired" est dans le message renvoy√© par PostgREST / Supabase
            return ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        public void HandleJwtExpired()
        {
            // Session expir√©e => on nettoie + retour login
            MainThread.BeginInvokeOnMainThread(async () =>
            {
                try
                {
                    await Current?.MainPage?.DisplayAlert(
                        "Session expir√©e",
                        "Ta session a expir√©. Merci de te reconnecter.",
                        "OK"
                    );
                }
                catch
                {
                    // pas bloquant
                }

                Logout(silent: true);
            });
        }

        // ------------------ UI SETTINGS ------------------

        private void ApplySavedLanguage()
        {
            try
            {
                var lang = Preferences.Get("app_language", "fr");
                var culture = new CultureInfo(lang);
                LocalizationResourceManager.Instance.SetCulture(culture);
            }
            catch
            {
                LocalizationResourceManager.Instance.SetCulture(new CultureInfo("fr"));
            }
        }

        private void ApplySavedTheme()
        {
            var theme = Preferences.Get("app_theme", "system");

            Current.UserAppTheme = theme switch
            {
                "light" => AppTheme.Light,
                "dark" => AppTheme.Dark,
                _ => AppTheme.Unspecified
            };
        }

        // ------------------ INIT SERVICES ------------------

        private void InitBaseServices()
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            Supabase = new SupabaseService(url, key);

            try
            {
                OcrApiKey = ConfigurationHelper.GetOcrApiKey();
                if (!string.IsNullOrWhiteSpace(OcrApiKey) && OcrApiKey.Length >= 5)
                    System.Diagnostics.Debug.WriteLine($"‚úÖ OCR Key charg√©e: {OcrApiKey.Substring(0, 5)}...");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå ERREUR OCR: {ex.Message}");
                OcrApiKey = "K86867725288957"; // ‚ö†Ô∏è debug only
            }
        }

        private async Task InitAsync()
        {
            try
            {
                await InitConfigurationAsync();
                await TryAutoLoginAsync();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå InitAsync: {ex}");
                ShowLogin();
            }
        }

        private async Task InitConfigurationAsync()
        {
            try
            {
                using var stream = await FileSystem.OpenAppPackageFileAsync("appsettings.json");
                var builder = new ConfigurationBuilder().AddJsonStream(stream);
                _config = builder.Build();
            }
            catch (Exception ex)
            {
                // ‚úÖ Ne pas crasher si appsettings absent
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è appsettings.json introuvable ou illisible: " + ex.Message);
                _config = null;
            }
        }

        // ------------------ AUTO LOGIN ------------------

        private async Task TryAutoLoginAsync()
        {
            var rememberMe = await SecureStorage.GetAsync("remember_me");
            if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
            {
                ShowLogin();
                return;
            }

            var accessToken = await SecureStorage.GetAsync("sb_access_token");
            var userId = await SecureStorage.GetAsync("sb_user_id");

            if (string.IsNullOrWhiteSpace(accessToken) || string.IsNullOrWhiteSpace(userId))
            {
                ShowLogin();
                return;
            }

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // Init services REST avec bearer
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet : si token expir√© -> logout propre
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            ShowAppShell();
        }

        public async void OnLoginSuccess(string accessToken, string userId)
        {
            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            InitRestServicesInternal(accessToken);

            // Optionnel: validation imm√©diate si internet
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            ShowAppShell();
        }

        private void InitRestServicesInternal(string accessToken)
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            RestClient = client;
            RecipesService = new RecipesService(client);
            IngredientsService = new IngredientsService(client);
            ListeCoursesSupabaseService = new ListeCoursesSupabaseService(client);
            RecetteIngredientsService = new RecetteIngredientsService(client);
        }

        // ‚úÖ Test simple qui provoque JWT expired si token mort
        private async Task<bool> ValidateSessionAsync()
        {
            try
            {
                if (RecipesService == null || CurrentUserId == null)
                    return false;

                // Petit appel l√©ger: si JWT expir√©, √ßa throw
                _ = await RecipesService.GetRecettesAsync(CurrentUserId.Value);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpiredException(ex))
                    return false;

                // Autre erreur r√©seau : on ne force pas logout
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è ValidateSessionAsync: " + ex.Message);
                return true;
            }
        }

        // ------------------ NAV ------------------

        public void ShowAppShell()
        {
            if (!IsConnected)
            {
                ShowLogin();
                return;
            }

            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = new AppShell();
            });
        }

        public void ShowLogin()
        {
            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = RootPage.CreateLoginRoot();
            });
        }

        // ------------------ LOGOUT ------------------

        public void Logout(bool silent = false)
        {
            SecureStorage.Remove("remember_me");
            SecureStorage.Remove("sb_access_token");
            SecureStorage.Remove("sb_user_id");

            Supabase?.ClearSession();
            CurrentUserId = null;

            RestClient = null;
            RecipesService = null;
            IngredientsService = null;
            ListeCoursesSupabaseService = null;
            RecetteIngredientsService = null;

            if (!silent)
                ShowLogin();
            else
                MainThread.BeginInvokeOnMainThread(() => MainPage = RootPage.CreateLoginRoot());
        }

        // ------------------ MISC ------------------

        public Task HandleDeepLinkAsync(Uri uri) => Task.CompletedTask;

        public void SetSupabase(SupabaseService supabase) => Supabase = supabase;
        public void SetCurrentUserId(Guid userId) => CurrentUserId = userId;

        public void InitRestServices(string accessToken)
        {
            InitRestServicesInternal(accessToken);
        }
    }
}

================================================================================
FILE: appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  },

  "OCR": {
    "ApiKey": "K86867725288957"
  }

}

================================================================================
FILE: AppShell.xaml
================================================================================

<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="LoGeCuiMobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:LoGeCuiMobile.Pages"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    FlyoutBehavior="Flyout">

    <FlyoutItem Title="{tr:Translate Nav_ShoppingList}" Route="liste-courses">
        <ShellContent Route="liste-courses"
                      ContentTemplate="{DataTemplate pages:ListeCoursesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Recipes}" Route="mes-recettes">
        <ShellContent Route="mes-recettes"
                      ContentTemplate="{DataTemplate pages:MesRecettesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_RandomMenu}" Route="menu-aleatoire">
        <ShellContent Route="menu-aleatoire"
                      ContentTemplate="{DataTemplate pages:MenuAleatoirePage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Ingredients}" Route="mes-ingredients">
        <ShellContent Route="mes-ingredients"
                      ContentTemplate="{DataTemplate pages:MesIngredientsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Settings}" Route="settings">
        <ShellContent Route="settings"
                      ContentTemplate="{DataTemplate pages:SettingsPage}" />
    </FlyoutItem>

</Shell>


================================================================================
FILE: AppShell.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile; // si ForgotPasswordPage est √† la racine du projet

namespace LoGeCuiMobile;

public partial class AppShell : Shell
{
    public AppShell()
    {
        InitializeComponent();

        Routing.RegisterRoute(nameof(ListeCoursesPage), typeof(ListeCoursesPage));
        Routing.RegisterRoute(nameof(ForgotPasswordPage), typeof(ForgotPasswordPage));
        Routing.RegisterRoute(nameof(AjouterIngredientPage), typeof(AjouterIngredientPage));
        Routing.RegisterRoute(nameof(AjouterRecettePage), typeof(AjouterRecettePage));
        Routing.RegisterRoute(nameof(MenuAleatoirePage), typeof(MenuAleatoirePage));

    }
}

================================================================================
FILE: ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using Microsoft.Maui.Storage;
using System;
using System.IO;

namespace LoGeCuiMobile
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;
        private static readonly object _lock = new();

        private static IConfiguration Configuration
        {
            get
            {
                if (_configuration != null)
                    return _configuration;

                lock (_lock)
                {
                    if (_configuration != null)
                        return _configuration;

                    try
                    {
                        // Lire le fichier depuis le package MAUI
                        using var streamTask = FileSystem.OpenAppPackageFileAsync("appsettings.json");
                        streamTask.Wait();
                        using var stream = streamTask.Result;

                        // Copie en m√©moire pour √©viter tout souci de stream non seekable / lecture partielle
                        using var ms = new MemoryStream();
                        stream.CopyTo(ms);
                        ms.Position = 0;

                        var builder = new ConfigurationBuilder()
                            .AddJsonStream(ms);

                        _configuration = builder.Build();

#if DEBUG
                        System.Diagnostics.Debug.WriteLine("[CONFIG] appsettings.json charg√©");
                        System.Diagnostics.Debug.WriteLine("[CONFIG] Supabase:Url=" + (_configuration["Supabase:Url"] ?? "<null>"));
                        System.Diagnostics.Debug.WriteLine("[CONFIG] OCR:ApiKey present=" + (!string.IsNullOrWhiteSpace(_configuration["OCR:ApiKey"])));
#endif

                        return _configuration;
                    }
                    catch (Exception ex)
                    {
                        throw new Exception(
                            "Impossible de charger appsettings.json depuis le package MAUI. " +
                            "V√©rifie qu'il est bien dans LoGeCuiMobile, Build Action = MauiAsset, et que tu as fait Clean/Rebuild. " +
                            $"D√©tail: {ex.Message}", ex);
                    }
                }
            }
        }


        // =========================
        // SUPABASE
        // =========================

        public static string GetSupabaseUrl()
            => Configuration["Supabase:Url"]
               ?? throw new Exception("Supabase:Url manquant dans appsettings.json");

        public static string GetSupabaseKey()
            => Configuration["Supabase:Key"]
               ?? throw new Exception("Supabase:Key manquant dans appsettings.json");

        // =========================
        // OCR
        // =========================

        public static string GetOcrApiKey()
        {
            var key = Configuration["OCR:ApiKey"];

            if (string.IsNullOrWhiteSpace(key))
                throw new Exception("OCR:ApiKey manquant dans appsettings.json");

            return key;
        }
    }
}





================================================================================
FILE: Converters\BoolToStrikethroughConverter.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Globalization;

namespace LoGeCuiMobile.Converters
{
    public class BoolToStrikethroughConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
            => (value is bool b && b) ? TextDecorations.Strikethrough : TextDecorations.None;

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
            => throw new NotImplementedException();
    }
}

================================================================================
FILE: Converters\QuantityFormatConverter.cs
================================================================================

Ôªøusing System;
using System.Globalization;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile.Converters
{
    public class QuantityFormatConverter : IMultiValueConverter
    {
        public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
        {
            var q = values.Length > 0 ? values[0]?.ToString() ?? "" : "";
            var u = values.Length > 1 ? values[1]?.ToString() ?? "" : "";

            var fmt = LocalizationResourceManager.Instance["Ingredients_QuantityFormat"];
            // Ex: "Quantit√© : {0} {1}" / "Menge: {0} {1}"
            return string.Format(fmt, q, u).Trim();
        }

        public object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture)
            => throw new NotSupportedException();
    }
}

================================================================================
FILE: ForgotPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="LoGeCuiMobile.ForgotPasswordPage"
    Title="Mot de passe oubli√©">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="Mot de passe oubli√©"
                   FontSize="20"
                   FontAttributes="Bold" />

            <Label Text="Entrez votre email pour recevoir un lien de r√©initialisation."
                   FontSize="14" />

            <Entry x:Name="EmailEntry"
                   Placeholder="Adresse email"
                   Keyboard="Email" />

            <Button x:Name="SendButton"
                    Text="Envoyer"
                    Clicked="OnSendClicked" />

            <Label x:Name="StatusLabel"
                   FontSize="13" />

            <Button Text="Retour"
                    Clicked="OnBackClicked" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: ForgotPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Graphics;
using System;

namespace LoGeCuiMobile
{
    // Optionnel : permet de pr√©-remplir l'email si tu navigues avec ?email=...
    [QueryProperty(nameof(PrefillEmail), "email")]
    public partial class ForgotPasswordPage : ContentPage
    {
        private readonly SupabaseService _supabaseService;

        // Valeur pass√©e via Shell : ?email=...
        public string PrefillEmail
        {
            set
            {
                // Evite crash si EmailEntry n'est pas encore pr√™t
                try
                {
                    var decoded = Uri.UnescapeDataString(value ?? "");
                    if (!string.IsNullOrWhiteSpace(decoded))
                        EmailEntry.Text = decoded;
                }
                catch { /* ignore */ }
            }
        }

        public ForgotPasswordPage()
        {
            InitializeComponent();

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            _supabaseService = new SupabaseService(url, key);

            StatusLabel.Text = "";
        }

        private async void OnSendClicked(object sender, EventArgs e)
        {
            try
            {
                // S√©curit√© si un contr√¥le est null (mauvais x:Name / x:Class)
                if (EmailEntry == null || SendButton == null || StatusLabel == null)
                {
                    await DisplayAlert("Erreur", "Interface non initialis√©e (XAML). V√©rifie x:Class et x:Name.", "OK");
                    return;
                }

                var email = (EmailEntry.Text ?? "").Trim();

                // ‚úÖ Validation obligatoire
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@") || !email.Contains("."))
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = "Veuillez saisir une adresse email valide.";
                    return;
                }

                SendButton.IsEnabled = false;
                StatusLabel.TextColor = Colors.Black;
                StatusLabel.Text = "Envoi en cours‚Ä¶";

                var result = await _supabaseService.SendPasswordResetAsync(email);

                if (result.success)
                {
                    StatusLabel.TextColor = Colors.Green;
                    StatusLabel.Text = "Email envoy√© ‚úÖ V√©rifiez votre bo√Æte mail (et les spams).";
                }
                else
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = result.error ?? "Impossible d'envoyer l'email.";
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ √©vite le crash et donne une erreur lisible
                StatusLabel.TextColor = Colors.Red;
                StatusLabel.Text = "Erreur : " + ex.Message;
            }
            finally
            {
                if (SendButton != null)
                    SendButton.IsEnabled = true;
            }
        }

        private async void OnBackClicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PopAsync();
            }
            catch
            {
                // au cas o√π
                await Shell.Current?.GoToAsync("..");
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFrameworks>net10.0-android;net10.0-ios;net10.0-maccatalyst</TargetFrameworks>
		<TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('windows'))">$(TargetFrameworks);net10.0-windows10.0.19041.0</TargetFrameworks>

		<!-- Note for MacCatalyst:
		The default runtime is maccatalyst-x64, except in Release config, in which case the default is maccatalyst-x64;maccatalyst-arm64.
		When specifying both architectures, use the plural <RuntimeIdentifiers> instead of the singular <RuntimeIdentifier>.
		The Mac App Store will NOT accept apps with ONLY maccatalyst-arm64 indicated;
		either BOTH runtimes must be indicated or ONLY macatalyst-x64. -->
		<!-- For example: <RuntimeIdentifiers>maccatalyst-x64;maccatalyst-arm64</RuntimeIdentifiers> -->

		<OutputType>Exe</OutputType>
		<RootNamespace>LoGeCuiMobile</RootNamespace>
		<UseMaui>true</UseMaui>
		<SingleProject>true</SingleProject>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>

		<!-- Display name -->
		<ApplicationTitle>LoGeCuiMobile</ApplicationTitle>

		<!-- App Identifier -->
		<ApplicationId>com.companyname.logecuimobile</ApplicationId>

		<!-- Versions -->
		<ApplicationDisplayVersion>2.0.0</ApplicationDisplayVersion>
		<ApplicationVersion>6</ApplicationVersion>

		<!-- To develop, package, and publish an app to the Microsoft Store, see: https://aka.ms/MauiTemplateUnpackaged -->
		<WindowsPackageType>None</WindowsPackageType>

		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">21.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</SupportedOSPlatformVersion>
		<TargetPlatformMinVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</TargetPlatformMinVersion>
		<AndroidSigningKeyStore>logecui.keystore</AndroidSigningKeyStore>
	</PropertyGroup>

	<PropertyGroup>
		<UserSecretsId>votre-guid-unique</UserSecretsId>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <EmbedAssembliesIntoApk>False</EmbedAssembliesIntoApk>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<ItemGroup>
		<!-- App Icon -->
		<MauiIcon Include="Resources\AppIcon\postriticone.png" />

		<!-- Splash Screen -->
		<MauiSplashScreen Include="Resources\Splash\postriticone.png" Color="#FFFFFF" BaseSize="128,128" />

		<!-- Images -->
		<MauiImage Include="Resources\Images\*" />
		<MauiImage Update="Resources\Images\dotnet_bot.png" Resize="True" BaseSize="300,185" />
		
		<!-- Custom Fonts -->
		<MauiFont Include="Resources\Fonts\*" />

		<!-- Raw Assets (also remove the "Resources\Raw" prefix) -->
		<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />
	</ItemGroup>

	<ItemGroup>
		<MauiAsset Include="appsettings.json">
		  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</MauiAsset>
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="CommunityToolkit.Maui" Version="14.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
		<PackageReference Include="Microsoft.Maui.Controls" Version="10.0.30" />
		<PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="10.0.2" />
		<PackageReference Include="SkiaSharp" Version="3.119.1" />
		<PackageReference Include="sqlite-net-pcl" Version="1.9.172" />
		<PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
	</ItemGroup>

	<ItemGroup>
	  <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <MauiXaml Update="ForgotPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="LoginPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterIngredientPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterRecettePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ListeCoursesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MenuAleatoirePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesIngredientsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesRecettesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ResetPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\SettingsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	</ItemGroup>

	<ItemGroup>
	  <Folder Include="Platforms\Android\Resources\Raw\" />
	</ItemGroup>

	<ItemGroup>
	  <Compile Update="Resources\Lang\AppResources.Designer.cs">
	    <DesignTime>True</DesignTime>
	    <AutoGen>True</AutoGen>
	    <DependentUpon>AppResources.resx</DependentUpon>
	  </Compile>
	</ItemGroup>

	<ItemGroup>
	  <EmbeddedResource Update="Resources\Lang\AppResources.resx">
	    <Generator>PublicResXFileCodeGenerator</Generator>
	    <LastGenOutput>AppResources.Designer.cs</LastGenOutput>
	  </EmbeddedResource>
	</ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiMobile.sln
================================================================================

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.5.2.0
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "LoGeCuiMobile", "LoGeCuiMobile.csproj", "{718860EB-0CC0-D204-6424-4B05AD96CB46}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {FE3EFD92-D10C-4693-8095-DE23E3011D74}
	EndGlobalSection
EndGlobal

================================================================================
FILE: LoginPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lang="clr-namespace:LoGeCuiMobile.Resources.Lang"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.LoginPage"
             Title="LoGeCui - Connexion"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="20" VerticalOptions="Center">

            

            <!-- Logo -->
            <Label Text="üõí LoGeCui"
                   FontSize="42"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                   Margin="0,10,0,30"/>

            <!-- üåç Choix de langue -->
            <Picker x:Name="LanguagePicker"
        Title="üåç Language"
        SelectedIndexChanged="LanguagePicker_SelectedIndexChanged">
                <Picker.Items>
                    <x:String>üá´üá∑ Fran√ßais</x:String>
                    <x:String>üá¨üáß English</x:String>
                    <x:String>üá©üá™ Deutsch</x:String>
                    <x:String>üá™üá∏ Espa√±ol</x:String>
                    <x:String>üáÆüáπ Italiano</x:String>
                    <x:String>üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</x:String>
                    <x:String>üáµüá± Polski</x:String>
                    <x:String>üáπüá∑ T√ºrk√ße</x:String>
                    <x:String>üá∑üá¥ Rom√¢nƒÉ</x:String>
                    <x:String>üá®üáø ƒåe≈°tina</x:String>
                    <x:String>üá∞üá∑ ÌïúÍµ≠Ïñ¥</x:String>
                    <x:String>üáØüáµ Êó•Êú¨Ë™û</x:String>
                    <x:String>üáπüá≠ ‡πÑ‡∏ó‡∏¢</x:String>
                    <x:String>üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</x:String>
                </Picker.Items>
            </Picker>

            <!-- Email -->
            <Label Text="{tr:Translate Email}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Entry x:Name="TxtEmail"
                   Placeholder="email@example.com"
                   Keyboard="Email"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <!-- Mot de passe -->
            <Label Text="{tr:Translate Password}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Grid ColumnDefinitions="*,Auto"
                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                  Padding="8">

                <Entry x:Name="TxtPassword"
                       Placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                       IsPassword="True"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                <Button Grid.Column="1"
                        Text="üëÅ"
                        BackgroundColor="Transparent"
                        Clicked="TogglePassword"/>
            </Grid>

            <!-- Rester connect√© -->
            <HorizontalStackLayout Spacing="10">
                <CheckBox x:Name="ChkRememberMe" Color="#27AE60"/>
                <Label Text="{tr:Translate StayConnected}"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            </HorizontalStackLayout>

            <!-- Connexion -->
            <Button x:Name="BtnConnexion"
                    Text="{tr:Translate LoginButton}"
                    BackgroundColor="#27AE60"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnConnexion_Clicked"/>

            <!-- Inscription -->
            <Button x:Name="BtnInscription"
                    Text="{tr:Translate SignupButton}"
                    BackgroundColor="#3498DB"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnInscription_Clicked"/>

            <!-- Message -->
            <Label x:Name="TxtMessage"
                   TextColor="Red"
                   HorizontalOptions="Center"
                   IsVisible="False"/>

            <!-- Mot de passe oubli√© -->
            <Button Text="{tr:Translate ForgotPassword}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light=Blue, Dark=#4DA3FF}"
                    Clicked="BtnForgotPassword_Clicked"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoginPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile; // ForgotPasswordPage / RootPage
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;
using System.Globalization;

namespace LoGeCuiMobile.Pages
{
    public partial class LoginPage : ContentPage
    {
        private readonly SupabaseService _supabase;
        private bool _isPasswordVisible = false;

        // Emp√™che SelectedIndexChanged pendant l'init
        private bool _isInitializingLanguage = false;

        public LoginPage()
        {
            InitializeComponent();

            _isInitializingLanguage = true;
            InitLanguagePickerSelection();
            _isInitializingLanguage = false;

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            _supabase = new SupabaseService(url, key);

            _ = LoadSavedUserAsync();
        }

        // =========================
        // LANGUE (Picker)
        // =========================
        private void LanguagePicker_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (_isInitializingLanguage)
                return;

            if (LanguagePicker.SelectedIndex < 0)
                return;

            var langCode = LanguagePicker.SelectedIndex switch
            {
                0 => "fr",
                1 => "en",
                2 => "de",
                3 => "es",
                4 => "it",
                5 => "ar",
                6 => "pl",
                7 => "tr",
                8 => "ro",
                9 => "cs",
                10 => "ko",
                11 => "ja",
                12 => "th",
                13 => "hi",
                _ => "fr"
            };

            var current = Preferences.Get("app_language", "fr");
            if (string.Equals(current, langCode, StringComparison.OrdinalIgnoreCase))
                return;

            Preferences.Set("app_language", langCode);

            var culture = new CultureInfo(langCode);

            // ‚úÖ Applique la culture + notifie l'UI (si tu utilises TranslateExtension)
            LocalizationResourceManager.Instance.SetCulture(culture);

            // ‚ö†Ô∏è Si ton XAML est encore en x:Static et que tu veux quand m√™me voir le changement,
            // d√©-commente ce bloc (mais √©vite de le faire pendant l'init) :
            // MainThread.BeginInvokeOnMainThread(() =>
            // {
            //     Application.Current.MainPage = RootPage.CreateLoginRoot();
            // });
        }

        private void InitLanguagePickerSelection()
        {
            var lang = Preferences.Get("app_language", "fr");

            var index = lang switch
            {
                "fr" => 0,
                "en" => 1,
                "de" => 2,
                "es" => 3,
                "it" => 4,
                "ar" => 5,
                "pl" => 6,
                "tr" => 7,
                "ro" => 8,
                "cs" => 9,
                "ko" => 10,
                "ja" => 11,
                "th" => 12,
                "hi" => 13,
                _ => 0
            };

            LanguagePicker.SelectedIndex = index;
        }

        // =========================
        // LOGIN
        // =========================
        private async void BtnConnexion_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.Connecting, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.ConnectionError, Colors.Red);
                    await DisplayAlert(AppResources.ErrorTitle, AppResources.BadPassword, "OK");
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);


                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async Task LoadSavedUserAsync()
        {
            try
            {
                var rememberMe = await SecureStorage.GetAsync("remember_me");
                if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
                    return;

                var email = await SecureStorage.GetAsync("user_email");
                if (!string.IsNullOrEmpty(email))
                {
                    TxtEmail.Text = email;
                    ChkRememberMe.IsChecked = true;
                }
            }
            catch
            {
                // ignore SecureStorage errors
            }
        }

        private async void BtnInscription_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.CreatingAccount, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignUpThenSignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.SignupError, Colors.Red);
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);
                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async void BtnForgotPassword_Clicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PushAsync(new ForgotPasswordPage());
            }
            catch (Exception ex)
            {
                await DisplayAlert(AppResources.ErrorTitle, ex.ToString(), "OK");
            }
        }

        private void TogglePassword(object sender, EventArgs e)
        {
            _isPasswordVisible = !_isPasswordVisible;

            TxtPassword.IsPassword = !_isPasswordVisible;

            if (sender is Button btn)
                btn.Text = _isPasswordVisible ? "üôà" : "üëÅ";

            if (!string.IsNullOrEmpty(TxtPassword.Text))
            {
                var t = TxtPassword.Text;
                TxtPassword.Text = string.Empty;
                TxtPassword.Text = t;
            }
        }

        private void SetStatus(string message, Color color)
        {
            TxtMessage.Text = message;
            TxtMessage.TextColor = color;
            TxtMessage.IsVisible = true;
        }
    }
}

================================================================================
FILE: MainPage.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LoGeCuiMobile.MainPage">

    <ScrollView>
        <VerticalStackLayout
            Padding="30,0"
            Spacing="25">
            <Image
                Source="dotnet_bot.png"
                HeightRequest="185"
                Aspect="AspectFit"
                SemanticProperties.Description="dot net bot in a submarine number ten" />

            <Label
                Text="Hello, World!"
                Style="{StaticResource Headline}"
                SemanticProperties.HeadingLevel="Level1" />

            <Label
                Text="Welcome to &#10;.NET Multi-platform App UI"
                Style="{StaticResource SubHeadline}"
                SemanticProperties.HeadingLevel="Level2"
                SemanticProperties.Description="Welcome to dot net Multi platform App U I" />

            <Button
                x:Name="CounterBtn"
                Text="Click me" 
                SemanticProperties.Hint="Counts the number of times you click"
                Clicked="OnCounterClicked"
                HorizontalOptions="Fill" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: MainPage.xaml.cs
================================================================================

Ôªønamespace LoGeCuiMobile
{
    public partial class MainPage : ContentPage
    {
        int count = 0;

        public MainPage()
        {
            InitializeComponent();
        }

        private void OnCounterClicked(object? sender, EventArgs e)
        {
            count++;

            if (count == 1)
                CounterBtn.Text = $"Clicked {count} time";
            else
                CounterBtn.Text = $"Clicked {count} times";

            SemanticScreenReader.Announce(CounterBtn.Text);
        }
    }
}

================================================================================
FILE: MauiProgram.cs
================================================================================

Ôªøusing System;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.Maui.Storage;
using CommunityToolkit.Maui;

namespace LoGeCuiMobile
{
    public static class MauiProgram
    {
        public static IConfiguration Configuration { get; private set; } = new ConfigurationBuilder().Build();

        public static MauiApp CreateMauiApp()
        {
            var builder = MauiApp.CreateBuilder();

            builder
            .UseMauiApp<App>()
            .UseMauiCommunityToolkit()   // üëà AJOUT ICI
            .ConfigureFonts(fonts =>
            {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
            });

#if DEBUG
            builder.Logging.AddDebug();
#endif

            // ‚úÖ Charge appsettings.json (MauiAsset) sans faire crasher l'app si absent
            try
            {
                using var stream = FileSystem.OpenAppPackageFileAsync("appsettings.json")
                                             .GetAwaiter()
                                             .GetResult();

                builder.Configuration.AddJsonStream(stream);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIG ERROR ==========");
                System.Diagnostics.Debug.WriteLine("Impossible de charger appsettings.json depuis le package MAUI.");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("==================================");
                // On continue volontairement pour √©viter le crash.
            }

            Configuration = builder.Configuration;

            // ‚úÖ IMPORTANT: on force le namespace exact (√©vite conflits)
            try
            {
                LoGeCuiShared.Services.ConfigurationHelper.Configure(key => Configuration[key]);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIGHELPER ERROR ==========");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("========================================");
                // On continue; l'erreur r√©elle ressortira quand une cl√© sera demand√©e.
            }

            return builder.Build();
        }
    }
}


================================================================================
FILE: Models\IngredientUI.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    public class IngredientUi : INotifyPropertyChanged
    {
        public Ingredient Model { get; }

        public IngredientUi(Ingredient model)
        {
            Model = model;
        }

        public System.Guid Id => Model.Id;
        public string Nom => Model.Nom ?? "";
        public string? Quantite => Model.Quantite;
        public string? Unite => Model.Unite;

        public bool EstDisponible
        {
            get => Model.EstDisponible;
            set
            {
                if (Model.EstDisponible == value) return;
                Model.EstDisponible = value;
                OnPropertyChanged();
            }
        }

        // ‚úÖ NOUVEAU : Favori (n√©cessite Model.EstFavori)
        public bool EstFavori
        {
            get => Model.EstFavori;
            set
            {
                if (Model.EstFavori == value) return;
                Model.EstFavori = value;
                OnPropertyChanged();
                OnPropertyChanged(nameof(HeartText));
            }
        }

        // ‚úÖ NOUVEAU : emoji coeur
        public string HeartText => EstFavori ? "‚ù§Ô∏è" : "ü§ç";

        bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                OnPropertyChanged();
            }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: Models\LanguageItem.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiMobile.Models
{
    internal class LanguageItem
    {
        public string Name { get; set; } = "";
        public string Code { get; set; } = "";
        public string Flag { get; set; } = ""; // emoji drapeau
    }
}

================================================================================
FILE: Pages\AjouterIngredientPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    x:Class="LoGeCuiMobile.Pages.AjouterIngredientPage"
    Title="{tr:Translate Ingredients_Add_Title}">

    <VerticalStackLayout Padding="20" Spacing="14">

        <Entry
            x:Name="NomEntry"
            Placeholder="{tr:Translate Ingredients_Add_NamePlaceholder}" />

        <Entry
            x:Name="QuantiteEntry"
            Placeholder="{tr:Translate Ingredients_Add_QuantityPlaceholder}"
            Keyboard="Numeric" />

        <Entry
            x:Name="UniteEntry"
            Placeholder="{tr:Translate Ingredients_Add_UnitPlaceholder}" />

        <HorizontalStackLayout Spacing="10">
            <CheckBox x:Name="DisponibleCheckBox" IsChecked="True"/>
            <Label Text="{tr:Translate Ingredients_Add_Available}"
                   VerticalTextAlignment="Center"/>
        </HorizontalStackLayout>

        <Button
            Text="{tr:Translate Ingredients_Add_Save}"
            BackgroundColor="#28a745"
            Clicked="OnSaveClicked"/>

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: Pages\AjouterIngredientPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.Pages;

public partial class AjouterIngredientPage : ContentPage
{
    public AjouterIngredientPage()
    {
        InitializeComponent();
    }

    private async void OnSaveClicked(object sender, EventArgs e)
    {
        try
        {
            if (string.IsNullOrWhiteSpace(NomEntry.Text))
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Ingredients_Add_NameRequired"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            var ingredient = new Ingredient
            {
                Nom = NomEntry.Text.Trim(),
                Quantite = QuantiteEntry.Text?.Trim() ?? "",
                Unite = UniteEntry.Text?.Trim() ?? "",
                EstDisponible = DisponibleCheckBox.IsChecked
            };

            // ‚úÖ 1) Toujours sauver dans le cache local (offline-first)
            await SaveIngredientToLocalCacheAsync(ingredient);

            // ‚úÖ 2) Si internet + connect√© => push Supabase
            var app = (App)Application.Current;

            var hasInternet = Connectivity.Current.NetworkAccess == NetworkAccess.Internet;

            if (hasInternet && app.IsConnected && app.IngredientsService != null && app.CurrentUserId != null)
            {
                await app.IngredientsService.CreateIngredientAsync(app.CurrentUserId.Value, ingredient);

            }

            // ‚úÖ Retour
            await Shell.Current.GoToAsync("..");
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private static async System.Threading.Tasks.Task SaveIngredientToLocalCacheAsync(Ingredient ingredient)
    {
        // R√©cup√®re cache local
        var local = await App.LocalDb.GetIngredientsAsync();
        var models = local.Select(x => x.ToModel()).ToList();

        // Evite doublon par Nom (tu peux adapter sur ExternalId si tu en as)
        bool exists = models.Any(x =>
            string.Equals(x.Nom?.Trim(), ingredient.Nom?.Trim(), StringComparison.OrdinalIgnoreCase));

        if (!exists)
            models.Add(ingredient);

        await App.LocalDb.SaveIngredientsAsync(models);
    }
}

================================================================================
FILE: Pages\AjouterRecettePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.AjouterRecettePage"
             Title="{tr:Translate Recipes_Add_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="{tr:Translate Recipes_Add_NameLabel}" />
            <Entry x:Name="NomEntry"
                   Placeholder="{tr:Translate Recipes_Add_NamePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_CategoryLabel}" />
            <Picker x:Name="CategoriePicker"
                    Title="{tr:Translate Recipes_Add_CategoryPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_TimeLabel}" />
            <Entry x:Name="TempsEntry"
                   Keyboard="Numeric"
                   Placeholder="{tr:Translate Recipes_Add_TimePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_IngredientsLabel}" />
            <Editor x:Name="IngredientsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="140"
                    Placeholder="{tr:Translate Recipes_Add_IngredientsPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_InstructionsLabel}" />
            <Editor x:Name="InstructionsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="180"
                    Placeholder="{tr:Translate Recipes_Add_InstructionsPlaceholder}" />

            <Button Text="{tr:Translate Recipes_Add_ScanOcr}"
                    Clicked="OnScanClicked" />

            <Button Text="{tr:Translate Recipes_Add_Save}"
                    Clicked="OnSaveClicked" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: Pages\AjouterRecettePage.xaml.cs
================================================================================

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.Services;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Media;

namespace LoGeCuiMobile.Pages
{
    public partial class AjouterRecettePage : ContentPage
    {
        private Recette? _editingRecette;

        public AjouterRecettePage(Recette? recette = null)
        {
            InitializeComponent();

            // Valeurs conformes ÔøΩ ta DB Supabase (Entree / Plat / Dessert)
            CategoriePicker.ItemsSource = new List<string> { "Entree", "Plat", "Dessert" };
            CategoriePicker.SelectedIndex = 1; // Plat par dÔøΩfaut

            _editingRecette = recette;

            if (_editingRecette != null)
            {
                Title = "Modifier recette";
                _ = LoadRecetteForEditAsync();
            }
            else
            {
                Title = "Ajouter recette";
            }
        }

        private async System.Threading.Tasks.Task LoadRecetteForEditAsync()
        {
            try
            {
                if (_editingRecette == null)
                    return;

                NomEntry.Text = _editingRecette.Nom;
                TempsEntry.Text = _editingRecette.TempsPreparation.ToString(CultureInfo.InvariantCulture);
                InstructionsEditor.Text = _editingRecette.Instructions ?? "";

                // CatÔøΩgorie
                var cat = string.IsNullOrWhiteSpace(_editingRecette.CategorieDb) ? "Plat" : _editingRecette.CategorieDb.Trim();
                if (CategoriePicker.ItemsSource is List<string> cats && cats.Contains(cat))
                    CategoriePicker.SelectedItem = cat;
                else
                    CategoriePicker.SelectedItem = "Plat";

                // Charger ingrÔøΩdients depuis Supabase
                var app = (App)Application.Current;
                if (app.RecetteIngredientsService != null && _editingRecette.Id != Guid.Empty)
                {
                    var items = await app.RecetteIngredientsService.GetForRecetteAsync(_editingRecette.Id);

                    // On remplit l'editor ingrÔøΩdients en "1 par ligne"
                    // NOTE: items = (nom, quantite, unite)
                    IngredientsEditor.Text = (items.Count == 0)
                        ? ""
                        : string.Join("\n", items.Select(x =>
                            string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                                ? x.nom
                                : $"{x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                        ));
                }
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    ex.Message,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        private async void OnSaveClicked(object sender, EventArgs e)
        {
            try
            {
                var app = (App)Application.Current;

                if (app.CurrentUserId == null || app.RecipesService == null)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_LoginRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                if (app.RecetteIngredientsService == null)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ServiceNotReady"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NameRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                var userId = app.CurrentUserId.Value;
                var categorie = (CategoriePicker.SelectedItem as string) ?? "Plat";
                int temps = int.TryParse(TempsEntry.Text, out var t) ? t : 0;

                // Mode ÔøΩdition => on reprend la recette, sinon crÔøΩation
                var recette = _editingRecette ?? new Recette();

                recette.Nom = NomEntry.Text.Trim();
                recette.CategorieDb = categorie;
                recette.TempsPreparation = temps;
                recette.Difficulte = 1;
                recette.Instructions = InstructionsEditor.Text ?? "";
                recette.IsFavorite = false;

                // ExternalId stable (requis pour lÔøΩupsert + rÔøΩcupÔøΩration d'id si besoin)
                if (string.IsNullOrWhiteSpace(recette.ExternalId))
                    recette.ExternalId = Guid.NewGuid().ToString("N");

                // 1) Upsert recette (table recettes)
                await app.RecipesService.UpsertRecetteAsync(userId, recette);

                // 2) Obtenir l'UUID DB (recette_id) pour recette_ingredients
                Guid recetteId;

                // Si on est en ÔøΩdition et qu'on a un Id valide, on l'utilise directement
                if (_editingRecette != null && _editingRecette.Id != Guid.Empty)
                {
                    recetteId = _editingRecette.Id;
                }
                else
                {
                    // Sinon fallback via ExternalId (fiable aprÔøΩs upsert)
                    var rid = await app.RecipesService.GetRecetteIdByExternalIdAsync(recette.ExternalId);
                    if (rid == null)
                    {
                        await DisplayAlert(
                            LocalizationResourceManager.Instance["ErrorTitle"],
                            LocalizationResourceManager.Instance["Recipes_Add_IdNotFound"],
                            LocalizationResourceManager.Instance["Dialog_Ok"]
                        );
                        return;
                    }

                    recetteId = rid.Value;
                }

                // 3) Parser les ingrÔøΩdients depuis l'ÔøΩditeur
                var items = ParseIngredientsEditor(IngredientsEditor.Text);

                // 4) ÔøΩcriture dans recette_ingredients (delete + insert)
                await app.RecetteIngredientsService.ReplaceForRecetteAsync(recetteId, items);

                await DisplayAlert(
                    LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_Saved"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );

                await Navigation.PopAsync();
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex.ToString());
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    ex.Message,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        // Transforme le texte du multi-line editor en liste (nom, quantite, unite)
        private static List<(string nom, string? quantite, string? unite)> ParseIngredientsEditor(string? text)
        {
            text ??= "";

            return text
                .Replace("\r\n", "\n")
                .Replace("\r", "\n")
                .Split('\n', StringSplitOptions.RemoveEmptyEntries)
                .Select(l => l.Trim())
                .Where(l => !string.IsNullOrWhiteSpace(l))
                .Select(ParseIngredientLine)
                .Where(x => !string.IsNullOrWhiteSpace(x.nom))
                .ToList();
        }

        // Supporte:
        // - "Tomate"
        // - "200 g Farine"
        // - "2 pcs Tomate"
        // - "Farine - 200 g"
        private static (string nom, string? quantite, string? unite) ParseIngredientLine(string line)
        {
            // "Nom - Quantite Unite"
            var dashSplit = line.Split(" - ", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
            if (dashSplit.Length >= 2)
            {
                var nomPart = dashSplit[0];
                var qtePart = dashSplit[1];

                var parts = qtePart.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                if (parts.Length >= 2)
                    return (nomPart, parts[0], string.Join(" ", parts.Skip(1)));

                return (nomPart, qtePart, null);
            }

            // "200 g Farine"
            var tokens = line.Split(' ', StringSplitOptions.RemoveEmptyEntries);
            if (tokens.Length >= 3 && char.IsDigit(tokens[0][0]))
            {
                var quantite = tokens[0];
                var unite = tokens[1];
                var nom = string.Join(" ", tokens.Skip(2));
                return (nom, quantite, unite);
            }

            // Sinon : juste le nom
            return (line, null, null);
        }

        private async void OnScanClicked(object sender, EventArgs e)
        {
            try
            {
                // Permission camÔøΩra (Android 6+)
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                // Capture supportÔøΩe ?
                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                var photo = await MediaPicker.Default.CapturePhotoAsync(new MediaPickerOptions
                {
                    Title = LocalizationResourceManager.Instance["Recipes_Add_ScanTitle"]
                });

                if (photo == null)
                    return;

                byte[] bytes;
                using (var stream = await photo.OpenReadAsync())
                using (var ms = new MemoryStream())
                {
                    await stream.CopyToAsync(ms);
                    bytes = ms.ToArray();
                }

                Debug.WriteLine($"Image originale: {bytes.Length / 1024} KB");

                // Compression pour rester sous la limite OCR.Space (souvent 1024 KB)
                bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1600, jpegQuality: 75);
                Debug.WriteLine($"Image compressÔøΩe: {bytes.Length / 1024} KB");

                // Si encore trop gros, on retente plus agressif automatiquement
                if (bytes.Length > 1024 * 1024)
                {
                    bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1200, jpegQuality: 65);
                    Debug.WriteLine($"Image recompressÔøΩe: {bytes.Length / 1024} KB");
                }

                if (bytes.Length > 1024 * 1024)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                // OCR
                var ocrKey = LoGeCuiShared.Services.ConfigurationHelper.GetOcrApiKey();
                var ocr = new OcrService(ocrKey);

                var fullText = await ocr.ExtractTextFromImageAsync(bytes, photo.FileName);

                if (string.IsNullOrWhiteSpace(fullText))
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["OcrTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NoTextDetected"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                fullText = NormalizeOcrText(fullText);

                var (ingredients, instructions) = SplitRecipeText(fullText);

                if (!string.IsNullOrWhiteSpace(instructions))
                    InstructionsEditor.Text = instructions.Trim();

                if (!string.IsNullOrWhiteSpace(ingredients))
                    IngredientsEditor.Text = ingredients.Trim();

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    var title = GuessTitle(fullText);
                    if (!string.IsNullOrWhiteSpace(title))
                        NomEntry.Text = title;
                }

                await DisplayAlert(
                    LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_OcrSuccess"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
            catch (Exception ex)
            {
                var msg = ex.Message ?? LocalizationResourceManager.Instance["UnknownError"];

                if (msg.Contains("File failed validation", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("maximum permissible file size", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("1024kb", StringComparison.OrdinalIgnoreCase))
                {
                    msg = LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"];
                }

                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    msg,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        private static string NormalizeOcrText(string s)
        {
            s = s.Replace("\r\n", "\n").Replace("\r", "\n");
            while (s.Contains("\n\n\n")) s = s.Replace("\n\n\n", "\n\n");
            return s.Trim();
        }

        private static (string ingredients, string instructions) SplitRecipeText(string text)
        {
            var lower = text.ToLowerInvariant();

            int idxIng = IndexOfAny(lower, "ingrÔøΩdients", "ingredients");
            int idxPrep = IndexOfAny(lower, "prÔøΩparation", "preparation", "instructions", "rÔøΩalisation", "realisation", "ÔøΩtapes", "etapes");

            if (idxIng >= 0 && idxPrep > idxIng)
            {
                var ingPart = text.Substring(idxIng, idxPrep - idxIng);
                var prepPart = text.Substring(idxPrep);

                ingPart = RemoveHeaderLine(ingPart);
                prepPart = RemoveHeaderLine(prepPart);

                return (CleanupListLike(ingPart), CleanupParagraph(prepPart));
            }

            if (idxPrep >= 0)
            {
                var before = text.Substring(0, idxPrep);
                var after = text.Substring(idxPrep);

                after = RemoveHeaderLine(after);
                return (CleanupListLike(before), CleanupParagraph(after));
            }

            var lines = text.Split('\n').Select(l => l.Trim()).Where(l => l.Length > 0).ToList();

            var ingLines = new List<string>();
            var instrLines = new List<string>();

            bool inInstructions = false;
            foreach (var line in lines)
            {
                if (!inInstructions && LooksLikeStep(line))
                    inInstructions = true;

                if (!inInstructions && LooksLikeIngredientLine(line))
                    ingLines.Add(line);
                else
                    instrLines.Add(line);
            }

            return (string.Join("\n", ingLines), string.Join("\n", instrLines));
        }

        private static int IndexOfAny(string haystack, params string[] needles)
        {
            int best = -1;
            foreach (var n in needles)
            {
                var i = haystack.IndexOf(n, StringComparison.OrdinalIgnoreCase);
                if (i >= 0 && (best < 0 || i < best)) best = i;
            }
            return best;
        }

        private static string RemoveHeaderLine(string block)
        {
            var lines = block.Replace("\r\n", "\n").Split('\n').ToList();
            if (lines.Count == 0) return block;
            lines.RemoveAt(0);
            return string.Join("\n", lines).Trim();
        }

        private static string CleanupListLike(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0)
                .Select(l => l.TrimStart('-', 'ÔøΩ', '*', 'ÔøΩ', 'ÔøΩ', 'ÔøΩ', ' '))
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static string CleanupParagraph(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static bool LooksLikeIngredientLine(string line)
        {
            if (line.StartsWith("-") || line.StartsWith("ÔøΩ") || line.StartsWith("*")) return true;

            var l = line.ToLowerInvariant();
            string[] units = { " g", "kg", " ml", "cl", " l", "cÔøΩs", "cas", "cÔøΩc", "cac", "cuillÔøΩre", "pincÔøΩe", "tranche", "sachet" };
            if (units.Any(u => l.Contains(u))) return true;

            if (char.IsDigit(line.FirstOrDefault())) return true;

            return false;
        }

        private static bool LooksLikeStep(string line)
        {
            var l = line.Trim();
            if (l.StartsWith("1)") || l.StartsWith("1.") ||
                l.StartsWith("ÔøΩtape", StringComparison.OrdinalIgnoreCase) ||
                l.StartsWith("Etape", StringComparison.OrdinalIgnoreCase))
                return true;

            if (l.Length >= 2 && char.IsDigit(l[0]) && (l[1] == ')' || l[1] == '.'))
                return true;

            return false;
        }

        private static string GuessTitle(string text)
        {
            var first = text.Split('\n').Select(l => l.Trim()).FirstOrDefault(l => l.Length > 0) ?? "";
            if (first.Length >= 3 && first.Length <= 50) return first;
            return "";
        }
    }
}

================================================================================
FILE: Pages\ListeCoursesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ListeCoursesPage"
             Title="{tr:Translate Shopping_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:BoolToStrikethroughConverter x:Key="BoolToStrikethroughConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Checkbox Tout s√©lectionner -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Label Grid.Row="0"
               Text="{tr:Translate Shopping_Header}"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10,0,10"/>

        <!-- Buttons -->
        <Grid Grid.Row="1" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Shopping_AddItem}"
                    BackgroundColor="#27AE60"
                    FontAttributes="Bold"
                    Clicked="BtnAjouter_Clicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelection"
                    Text="{tr:Translate Shopping_DeleteSelection}"
                    BackgroundColor="#E67E22"
                    FontAttributes="Bold"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="2"
                               Spacing="10"
                               Padding="4,6"
                               VerticalOptions="Center">
            <CheckBox x:Name="ChkToutSelectionner"
                      CheckedChanged="ChkToutSelectionner_CheckedChanged"/>
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray"/>
        </HorizontalStackLayout>

        <!-- Liste des courses -->
        <CollectionView Grid.Row="3"
                        x:Name="ListeCourses"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Shopping_Empty}"
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="6"
                           Padding="14"
                           BorderColor="#DDDDDD"
                           CornerRadius="12"
                           HasShadow="True"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}">

                        <VerticalStackLayout Spacing="8">

                            <!-- Nom -->
                            <Label Text="{Binding Nom}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextDecorations="{Binding EstAchete, Converter={StaticResource BoolToStrikethroughConverter}}"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                            <!-- Quantit√© -->
                            <Label FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Quantite}"/>
                                        <Span Text=" "/>
                                        <Span Text="{Binding Unite}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Actions -->
                            <HorizontalStackLayout Spacing="20">

                                <!-- Achet√© -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstAchete, Mode=TwoWay}"
                                              CheckedChanged="CheckBox_CheckedChanged"/>
                                    <Label Text="{tr:Translate Shopping_Bought}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                                <!-- S√©lection pour suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}"/>
                                    <Label Text="{tr:Translate Shopping_Delete}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: Pages\ListeCoursesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiMobile.Models;

namespace LoGeCuiMobile.Pages
{
    public partial class ListeCoursesPage : ContentPage
    {
        private readonly ObservableCollection<ArticleCourseUi> _articles = new();
        private readonly SupabaseService _supabase;

        // Emp√™che la checkbox "Tout s√©lectionner" de d√©clencher une s√©lection de masse
        // quand on la met √† jour depuis le code.
        private bool _suppressSelectAllEvent;

        public ListeCoursesPage()
        {
            InitializeComponent();

            _supabase = ((App)Application.Current).Supabase
                ?? throw new InvalidOperationException("Supabase non initialis√©.");

            // IMPORTANT : ne pas re-s'abonner ici si ton XAML a d√©j√† Clicked="BtnSupprimerSelection_Clicked"
            // BtnSupprimerSelection.Clicked += BtnSupprimerSelection_Clicked;  <-- SUPPRIM√â

            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private async void ChargerDonnees()
        {
            try
            {
                // 1Ô∏è‚É£ Charger depuis le cache local
                var local = await App.LocalDb.GetArticlesAsync();
                _articles.Clear();
                foreach (var a in local)
                    _articles.Add(new ArticleCourseUi(a.ToModel()));

                // 2Ô∏è‚É£ Si internet ‚Üí rafra√Æchir depuis Supabase
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var remote = await _supabase.GetArticlesAsync();

                    _articles.Clear();
                    foreach (var a in remote)
                        _articles.Add(new ArticleCourseUi(a));

                    // üîÑ Mettre √† jour le cache
                    await App.LocalDb.SaveArticlesAsync(remote);
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Chargement impossible : {ex.Message}", "OK");
            }
        }

        private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
        {
            var selected = _articles.Where(a => a.IsSelectedForDelete).ToList();

            if (selected.Count == 0)
            {
                await DisplayAlert("Information", "Aucun article s√©lectionn√©.", "OK");
                return;
            }

            bool confirm = await DisplayAlert(
                "Confirmation",
                $"Supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Oui",
                "Non");

            if (!confirm)
                return;

            try
            {
                foreach (var articleUi in selected)
                {
                    await _supabase.DeleteArticleAsync(articleUi.Id);
                    _articles.Remove(articleUi);
                }

                RefreshSelectAllCheckBox();

                await DisplayAlert("Succ√®s", $"{selected.Count} article(s) supprim√©(s).", "OK");
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Suppression impossible : {ex.Message}", "OK");
                ChargerDonnees();
            }
        }

        private async void CheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            // Checkbox "Achet√©"
            if (sender is not CheckBox checkbox) return;
            if (checkbox.BindingContext is not ArticleCourseUi articleUi) return;

            var article = articleUi.Model;

            checkbox.IsEnabled = false;
            var oldValue = !e.Value;

            try
            {
                await _supabase.UpdateArticleAsync(article.Id, article);
            }
            catch (Exception ex)
            {
                article.EstAchete = oldValue;
                checkbox.IsChecked = oldValue;

                await DisplayAlert("Erreur", $"Synchronisation √©chou√©e : {ex.Message}", "OK");
            }
            finally
            {
                checkbox.IsEnabled = true;
            }
        }

        // Checkbox "Tout s√©lectionner" (pour suppression)
        private void ChkToutSelectionner_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (_suppressSelectAllEvent) return;

            foreach (var a in _articles)
                a.IsSelectedForDelete = e.Value;

            // Optionnel : si tu veux d√©sactiver le bouton supprimer quand rien n'est coch√©,
            // il faudra √©couter les changements de IsSelectedForDelete (INotifyPropertyChanged).
            // Ici on se contente de garder la checkbox coh√©rente.
        }

        private void RefreshSelectAllCheckBox()
        {
            if (ChkToutSelectionner == null) return;

            _suppressSelectAllEvent = true;
            try
            {
                if (_articles.Count == 0)
                {
                    ChkToutSelectionner.IsEnabled = false;
                    ChkToutSelectionner.IsChecked = false;
                    return;
                }

                ChkToutSelectionner.IsEnabled = true;

                // MAUI CheckBox n'a pas de tri-state :
                // on met "checked" seulement si TOUT est s√©lectionn√©.
                bool allSelected = _articles.All(a => a.IsSelectedForDelete);
                ChkToutSelectionner.IsChecked = allSelected;
            }
            finally
            {
                _suppressSelectAllEvent = false;
            }
        }

        private async void BtnAjouter_Clicked(object sender, EventArgs e)
        {
            string nom = await DisplayPromptAsync("Ajouter", "Nom de l'article :");
            if (string.IsNullOrWhiteSpace(nom))
                return;

            string quantite = await DisplayPromptAsync("Ajouter", "Quantit√© :");
            if (string.IsNullOrWhiteSpace(quantite))
                return;

            string unite = await DisplayPromptAsync("Ajouter", "Unit√© (g, kg, L, pi√®ces...) :");
            if (string.IsNullOrWhiteSpace(unite))
                return;

            try
            {
                var app = (App)Application.Current;
                if (app.CurrentUserId == null)
                {
                    await DisplayAlert("Erreur", "Vous devez √™tre connect√©.", "OK");
                    return;
                }

                var article = new ArticleCourse
                {
                    UserId = app.CurrentUserId.Value,
                    Nom = nom,
                    Quantite = quantite,
                    Unite = unite,
                    EstAchete = false
                };

                var added = await _supabase.AddArticleAsync(article);
                if (added != null)
                {
                    _articles.Add(new ArticleCourseUi(added));

                    // Nouveau item => on met √† jour la checkbox "Tout s√©lectionner"
                    RefreshSelectAllCheckBox();

                    await DisplayAlert("Succ√®s", $"'{added.Nom}' ajout√© !", "OK");
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Impossible d'ajouter : {ex.Message}", "OK");
            }
        }
    }
}

================================================================================
FILE: Pages\MenuAleatoirePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.MenuAleatoirePage"
             Title="{tr:Translate RandomMenu_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Button
                Text="{tr:Translate RandomMenu_GenerateButton}"
                Clicked="OnMenuAleatoireClicked" />

            <Label
                x:Name="ResultLabel"
                Text="{tr:Translate RandomMenu_DefaultText}"
                FontSize="18"
                HorizontalTextAlignment="Center" />

            <!-- Bouton visible uniquement apr√®s g√©n√©ration si ingr√©dients manquants -->
            <Button x:Name="SendMissingButton"
                    Text="{tr:Translate RandomMenu_SendMissingToShopping}"
                    Clicked="OnSendMissingClicked"
                    HorizontalOptions="FillAndExpand"
                    IsVisible="False"
                    IsEnabled="False" />

            <Button
                Text="{tr:Translate RandomMenu_OpenShopping}"
                Clicked="OnOpenListeCoursesClicked"
                HorizontalOptions="FillAndExpand" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: Pages\MenuAleatoirePage.xaml.cs
================================================================================

Ôªøusing CommunityToolkit.Maui.Views;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace LoGeCuiMobile.Pages;

public partial class MenuAleatoirePage : ContentPage
{
    private static readonly Random _random = new();
    public record MenuOptionsResult(bool Entree, bool Plat, bool Dessert);


    private List<string> _lastMissing = new();
    private Guid? _lastUserId;
    private bool _lastIngredientsKnown = false;

    public MenuAleatoirePage()
    {
        InitializeComponent();

        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
    }

    // ------------------ UTIL ------------------

    private static string Norm(string s)
    {
        if (string.IsNullOrWhiteSpace(s))
            return "";

        var normalized = s.Trim().ToLowerInvariant().Normalize(NormalizationForm.FormD);
        var sb = new StringBuilder();

        foreach (var c in normalized)
            if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
                sb.Append(c);

        return sb.ToString();
    }

    private sealed class RecetteIngredientRow
    {
        public string? ingredient_nom { get; set; }
    }

    private async Task<List<string>> GetRecetteIngredientsAsync(App app, Guid recetteId)
    {
        if (app.RestClient == null)
            return new List<string>();

        // recette_ingredients(recette_id, ingredient_nom, quantite, unite)
        var q = $"recette_ingredients?select=ingredient_nom&recette_id=eq.{recetteId}";

        var rows = await app.RestClient.GetAsync<List<RecetteIngredientRow>>(q)
                   ?? new List<RecetteIngredientRow>();

        return rows
            .Select(r => r.ingredient_nom ?? "")
            .Select(s => s.Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private async Task<List<string>> GetUserIngredientsAsync(App app, Guid userId)
    {
        if (app.IngredientsService == null)
            return new List<string>();

        var rows = await app.IngredientsService.GetIngredientsAsync(userId)
                   ?? new List<Ingredient>();

        return rows
            .Where(i => i.EstDisponible)
            .Select(i => (i.Nom ?? "").Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private static Recette? PickRandom(List<Recette> list)
    {
        if (list == null || list.Count == 0) return null;
        return list[_random.Next(list.Count)];
    }

    // ------------------ EVENTS ------------------

    private async void OnMenuAleatoireClicked(object sender, EventArgs e)
    {
        try
        {
            // Choix initial : on d√©marre tout coch√©
            bool wantEntree = true;
            bool wantPlat = true;
            bool wantDessert = true;

            while (true)
            {
                string entreeTxt = wantEntree ? "‚úÖ Entr√©e" : "‚¨ú Entr√©e";
                string platTxt = wantPlat ? "‚úÖ Plat" : "‚¨ú Plat";
                string dessertTxt = wantDessert ? "‚úÖ Dessert" : "‚¨ú Dessert";

                var choice = await DisplayActionSheet(
                    "Choisis les cat√©gories",
                    "Annuler",
                    "G√©n√©rer",
                    entreeTxt,
                    platTxt,
                    dessertTxt
                );

                if (choice == "Annuler")
                    return;

                if (choice == "G√©n√©rer")
                {
                    if (!wantEntree && !wantPlat && !wantDessert)
                    {
                        await DisplayAlert("Info", "Coche au moins une cat√©gorie.", "OK");
                        continue;
                    }

                    var opts = new MenuOptionsResult(wantEntree, wantPlat, wantDessert);
                    await RunMenuAleatoireAsync(opts);
                    return;
                }

                if (choice == entreeTxt) wantEntree = !wantEntree;
                else if (choice == platTxt) wantPlat = !wantPlat;
                else if (choice == dessertTxt) wantDessert = !wantDessert;
            }
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }



    private async void OnOpenListeCoursesClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;
            if (app?.ListeCoursesSupabaseService == null)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["ServiceUnavailable"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            await Shell.Current.GoToAsync(nameof(ListeCoursesPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private async void OnSendMissingClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;

            if (app?.ListeCoursesSupabaseService == null || app.CurrentUserId == null)
                return;

            if (!_lastIngredientsKnown || _lastMissing.Count == 0)
                return;

            bool confirm = await DisplayAlert(
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmTitle"],
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmBody"] + "\n- " + string.Join("\n- ", _lastMissing),
                LocalizationResourceManager.Instance["Dialog_Yes"],
                LocalizationResourceManager.Instance["Dialog_No"]
            );

            if (!confirm)
                return;

            await app.ListeCoursesSupabaseService.AddMissingAsync(
                app.CurrentUserId.Value,
                _lastMissing);

            SendMissingButton.IsEnabled = false;
            SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SentButton"];
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // ------------------ LOGIQUE ------------------

    private async Task RunMenuAleatoireAsync(MenuOptionsResult opts)
    {
        var app = Application.Current as App;
        if (app == null)
            return;

        // Reset UI
        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
        SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SendMissingToShopping"];
        _lastMissing = new List<string>();
        _lastIngredientsKnown = false;
        _lastUserId = app.CurrentUserId;

        if (app.CurrentUserId == null ||
            app.RestClient == null ||
            app.RecipesService == null ||
            app.IngredientsService == null ||
            app.ListeCoursesSupabaseService == null)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["LoginRequired"];
            return;
        }

        var userId = app.CurrentUserId.Value;
        ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_Generating"];

        // 1) Recettes utilisateur
        // (tu utilises GetMyRecettesAsync dans ton code : je le garde)
        var recettes = await app.RecipesService.GetMyRecettesAsync();

        if (recettes == null || recettes.Count == 0)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_NoRecipes"];
            return;
        }

        // 2) Listes par type (si l'option est coch√©e)
        var entrees = opts.Entree ? recettes.Where(r => r.Type == TypePlat.Entree).ToList() : new List<Recette>();
        var plats = opts.Plat ? recettes.Where(r => r.Type == TypePlat.Plat).ToList() : new List<Recette>();
        var desserts = opts.Dessert ? recettes.Where(r => r.Type == TypePlat.Dessert).ToList() : new List<Recette>();

        // 3) Tirage (uniquement si demand√©)
        var entree = opts.Entree ? PickRandom(entrees) : null;
        var plat = opts.Plat ? PickRandom(plats) : null;
        var dessert = opts.Dessert ? PickRandom(desserts) : null;

        // Si une cat√©gorie coch√©e n'a aucune recette
        if ((opts.Entree && entree == null) || (opts.Plat && plat == null) || (opts.Dessert && dessert == null))
        {
            var sbErr = new StringBuilder();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotGenerate"]);
            sbErr.AppendLine();

            if (opts.Entree && entree == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Entr√©e");
            if (opts.Plat && plat == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Plat");
            if (opts.Dessert && dessert == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Dessert");

            sbErr.AppendLine();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CheckCategories"]);

            ResultLabel.Text = sbErr.ToString();
            return;
        }

        // 4) Ingr√©dients utilisateur disponibles
        var userIngredients = await GetUserIngredientsAsync(app, userId);
        var userSet = userIngredients
            .Select(Norm)
            .Where(x => !string.IsNullOrWhiteSpace(x))
            .ToHashSet();

        // 5) Analyse d'une recette
        async Task<(List<string> ingredients, List<string> missing, bool hasData)> AnalyzeAsync(Recette r)
        {
            var ingredients = await GetRecetteIngredientsAsync(app, r.Id);
            var distinct = ingredients
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (distinct.Count == 0)
                return (distinct, new List<string>(), false);

            var missing = distinct
                .Where(i => !userSet.Contains(Norm(i)))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            return (distinct, missing, true);
        }

        // 6) Analyse seulement des recettes r√©ellement tir√©es
        var chosen = new List<Recette>();
        if (entree != null) chosen.Add(entree);
        if (plat != null) chosen.Add(plat);
        if (dessert != null) chosen.Add(dessert);

        var analyses = new Dictionary<Guid, (List<string> ingredients, List<string> missing, bool hasData)>();
        foreach (var r in chosen)
            analyses[r.Id] = await AnalyzeAsync(r);

        // 7) Agr√©gation manquants (uniquement si on a des donn√©es pour toutes les recettes choisies)
        var allHaveData = chosen.All(r => analyses[r.Id].hasData);

        if (allHaveData)
        {
            _lastMissing = chosen
                .SelectMany(r => analyses[r.Id].missing)
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            _lastIngredientsKnown = true;
        }
        else
        {
            _lastMissing = new List<string>();
            _lastIngredientsKnown = false;
        }

        // 8) UI texte
        var sb = new StringBuilder();

        sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GeneratedHeader"]);

        if (entree != null) sb.AppendLine($"- {entree.TypeTexte} : {entree.Nom}");
        if (plat != null) sb.AppendLine($"- {plat.TypeTexte} : {plat.Nom}");
        if (dessert != null) sb.AppendLine($"- {dessert.TypeTexte} : {dessert.Nom}");
        sb.AppendLine();

        void AppendRecetteBlock(Recette r)
        {
            var a = analyses[r.Id];

            sb.AppendLine($"{r.TypeTexte} ‚Äî {r.Nom}");

            if (!a.hasData)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_NoIngredientsForRecipe"]);
                sb.AppendLine();
                return;
            }

            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_IngredientsHeader"]);
            foreach (var i in a.ingredients)
                sb.AppendLine("- " + i);

            if (a.missing.Count == 0)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingNone"]);
            }
            else
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingHeader"]);
                foreach (var m in a.missing)
                    sb.AppendLine("- " + m);
            }

            sb.AppendLine();
        }

        foreach (var r in chosen)
            AppendRecetteBlock(r);

        // 9) Bouton ‚Äúenvoyer manquants‚Äù
        if (!allHaveData)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotComputeMissing"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else if (_lastMissing.Count == 0)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_AllAvailable"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GlobalMissingHeader"]);
            foreach (var m in _lastMissing)
                sb.AppendLine("- " + m);

            SendMissingButton.IsVisible = true;
            SendMissingButton.IsEnabled = true;
        }

        ResultLabel.Text = sb.ToString();
    }
}

================================================================================
FILE: Pages\MesIngredientsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
    x:Class="LoGeCuiMobile.Pages.MesIngredientsPage"
    Title="{tr:Translate Ingredients_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:QuantityFormatConverter x:Key="QuantityFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="16" RowDefinitions="Auto,Auto,*" RowSpacing="12">

        <!-- Boutons -->
        <Grid Grid.Row="0" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Ingredients_AddButton}"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    Clicked="OnAddIngredientClicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelectionIngredients"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="OnDeleteSelectedIngredientsClicked" />
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Padding="4,0">
            <CheckBox x:Name="ChkToutSelectionnerIngredients"
                      CheckedChanged="ChkToutSelectionnerIngredients_CheckedChanged" />
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray" />
        </HorizontalStackLayout>

        <!-- Liste -->
        <CollectionView Grid.Row="2"
                        x:Name="IngredientsCollection"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="Aucun ingr√©dient."
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12"
                           Margin="0,4"
                           BorderColor="#ddd"
                           CornerRadius="10">

                        <Grid ColumnDefinitions="*,Auto">

                            <VerticalStackLayout Spacing="6">

                                <Label Text="{Binding Nom}"
                                       FontSize="18"
                                       FontAttributes="Bold" />

                                <Label FontSize="14" TextColor="Gray">
                                    <Label.Text>
                                        <MultiBinding Converter="{StaticResource QuantityFormatConverter}">
                                            <Binding Path="Quantite"/>
                                            <Binding Path="Unite"/>
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>

                                <!-- Disponible -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstDisponible}"
                                                CheckedChanged="OnDisponibleChanged" />
                                    <Label Text="{tr:Translate Ingredients_Available}"
                                           VerticalTextAlignment="Center"/>
                                </HorizontalStackLayout>

                                <!-- S√©lection suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}" />
                                    <Label Text="Supprimer"
                                           VerticalTextAlignment="Center"
                                           TextColor="Gray"/>
                                </HorizontalStackLayout>

                            </VerticalStackLayout>

                            <!-- Supprimer item -->
                            <Button Grid.Column="1"
                                    Text="üóë"
                                    BackgroundColor="#e74c3c"
                                    Clicked="OnDeleteIngredientClicked" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: Pages\MesIngredientsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Models;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Networking;


namespace LoGeCuiMobile.Pages;

public partial class MesIngredientsPage : ContentPage
{
    private readonly ObservableCollection<IngredientUi> _ingredients = new();

    private bool _isLoading;
    private bool _suppressSelectAllEvent;

    public MesIngredientsPage()
    {
        InitializeComponent();
        IngredientsCollection.ItemsSource = _ingredients;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();
        await LoadIngredientsAsync();
    }

    private async Task LoadIngredientsAsync()
    {
        if (_isLoading) return;

        try
        {
            _isLoading = true;

            // 0) Toujours tenter d'afficher le cache local en premier (offline-friendly)
            var local = await App.LocalDb.GetIngredientsAsync();
            _ingredients.Clear();
            foreach (var li in local)
                _ingredients.Add(new IngredientUi(li.ToModel()));

            RefreshSelectAllCheckBox();

            // 1) Si pas connect√© (session) -> on s'arr√™te apr√®s le cache
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            // 2) Si pas internet -> on s'arr√™te apr√®s le cache
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return;

            var userId = app.CurrentUserId.Value;

            // 3) Refresh depuis Supabase
            var remote = await app.IngredientsService.GetIngredientsAsync(userId);

            // 4) Mettre √† jour l'UI avec remote
            _ingredients.Clear();
            foreach (var ing in remote)
                _ingredients.Add(new IngredientUi(ing));

            // 5) Sauver remote dans SQLite
            await App.LocalDb.SaveIngredientsAsync(remote);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        finally
        {
            _isLoading = false;
        }
    }


    private async void OnAddIngredientClicked(object sender, EventArgs e)
    {
        try
        {
            await Shell.Current.GoToAsync(nameof(AjouterIngredientPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // Suppression d'un seul ingr√©dient via l'ic√¥ne üóë
    private async void OnDeleteIngredientClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        if (sender is not Button btn || btn.BindingContext is not IngredientUi ingredientUi)
            return;

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"{LocalizationResourceManager.Instance["Dialog_DeleteConfirm"]}\n{ingredientUi.Nom}",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            _ingredients.Remove(ingredientUi);

            if (ingredientUi.Id != Guid.Empty)
                await app.IngredientsService.DeleteIngredientAsync(ingredientUi.Id);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Checkbox "Tout s√©lectionner" (s√©lection suppression)
    private void ChkToutSelectionnerIngredients_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_suppressSelectAllEvent) return;

        foreach (var ing in _ingredients)
            ing.IsSelectedForDelete = e.Value;
    }

    private void RefreshSelectAllCheckBox()
    {
        if (ChkToutSelectionnerIngredients == null) return;

        _suppressSelectAllEvent = true;
        try
        {
            if (_ingredients.Count == 0)
            {
                ChkToutSelectionnerIngredients.IsEnabled = false;
                ChkToutSelectionnerIngredients.IsChecked = false;
                return;
            }

            ChkToutSelectionnerIngredients.IsEnabled = true;
            ChkToutSelectionnerIngredients.IsChecked = _ingredients.All(i => i.IsSelectedForDelete);
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    // Supprimer s√©lection
    private async void OnDeleteSelectedIngredientsClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        var selected = _ingredients.Where(i => i.IsSelectedForDelete).ToList();

        if (selected.Count == 0)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                "Aucun ingr√©dient s√©lectionn√©.",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"Supprimer {selected.Count} ingr√©dient(s) s√©lectionn√©(s) ?",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            foreach (var ingUi in selected)
            {
                if (ingUi.Id != Guid.Empty)
                    await app.IngredientsService.DeleteIngredientAsync(ingUi.Id);

                _ingredients.Remove(ingUi);
            }

            RefreshSelectAllCheckBox();

            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                $"{selected.Count} ingr√©dient(s) supprim√©(s).",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Mise √† jour "Disponible" -> synchro Supabase (si tu as une m√©thode UpdateIngredientAsync)
    private async void OnDisponibleChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_isLoading) return;

        if (sender is not CheckBox cb || cb.BindingContext is not IngredientUi ingUi)
            return;

        try
        {
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null)
                return;

            // Ici il faut une m√©thode d'update dans IngredientsService.
            // Si tu l'as d√©j√† : await app.IngredientsService.UpdateIngredientAsync(ingUi.Model.Id, ingUi.Model);
            // Sinon : on ne fait rien (l'UI reste locale). Dis-moi et je te donne l'impl√©mentation c√¥t√© service.
        }
        catch
        {
            // Optionnel : rollback si update √©choue
        }
    }
}

================================================================================
FILE: Pages\MesRecettesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="LoGeCuiMobile.Pages.MesRecettesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:vm="clr-namespace:LoGeCuiMobile.ViewModels"
    Title="{tr:Translate Recipes_Title}">

    <Grid Padding="12" RowDefinitions="Auto,Auto,*" RowSpacing="10">

        <!-- ====== FILTRES + ACTIONS HAUT ====== -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">

            <Picker Title="{tr:Translate Recipes_Category}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategorie}" />

            <HorizontalStackLayout Spacing="10">
                <Button Text="{tr:Translate Recipes_Refresh}"
                        Command="{Binding RefreshCommand}"
                        HorizontalOptions="StartAndExpand" />

                <Button Text="{tr:Translate Recipes_Add}"
                        Clicked="OnAjouterRecetteClicked"
                        HorizontalOptions="EndAndExpand" />
            </HorizontalStackLayout>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}" />

        </VerticalStackLayout>

        <!-- ====== LIGNE S√âLECTION MULTIPLE ====== -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" VerticalOptions="Center">

            <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">
                <CheckBox x:Name="ChkToutSelectionnerRecettes"
                          CheckedChanged="ChkToutSelectionnerRecettes_CheckedChanged"/>
                <Label Text="Tout s√©lectionner"
                       VerticalTextAlignment="Center"
                       TextColor="Gray"/>
            </HorizontalStackLayout>

            <Label Grid.Column="1"
                   x:Name="SelectionInfoLabel"
                   Text=""
                   TextColor="Gray"
                   VerticalTextAlignment="Center"/>

            <Button Grid.Column="2"
                    x:Name="BtnSupprimerSelection"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- ====== LISTE DES RECETTES ====== -->
        <CollectionView Grid.Row="2"
                        x:Name="RecettesCollection"
                        ItemsSource="{Binding Recettes}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Recipes_Empty}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       Margin="0,30,0,0" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10"
                           Margin="0,6"
                           HasShadow="False">

                        <!-- üî¥üü¢ Couleur bordure selon disponibilit√© -->
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Unknown}">
                                <Setter Property="BorderColor" Value="#B0B0B0"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.AllAvailable}">
                                <Setter Property="BorderColor" Value="#27AE60"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Missing}">
                                <Setter Property="BorderColor" Value="#E74C3C"/>
                            </DataTrigger>
                        </Frame.Triggers>

                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">

                            <!-- Checkbox suppression multiple -->
                            <CheckBox Grid.Column="0"
                                      Grid.RowSpan="2"
                                      IsChecked="{Binding IsSelectedForDelete}"
                                      CheckedChanged="RecetteDeleteCheckBox_CheckedChanged"
                                      VerticalOptions="Center" />

                            <!-- Zone infos recette (tap = d√©tails) -->
                            <Grid Grid.Column="1" Grid.RowSpan="2">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRecetteTapped"
                                                          CommandParameter="{Binding Model}" />
                                </Grid.GestureRecognizers>

                                <VerticalStackLayout Spacing="4">

                                    <Label Text="{Binding Nom}"
                                           FontSize="18"
                                           FontAttributes="Bold" />

                                    <Label Text="{Binding TypeTexte}" />

                                    <Label Text="{Binding TempsPreparation, StringFormat='{tr:Translate Recipes_TimeFormat}'}" />

                                    <Label Text="{Binding DifficulteTexte}" />

                                    <Label Text="{Binding AvailabilityLabel}"
                                           FontSize="12"
                                           TextColor="Gray"/>

                                </VerticalStackLayout>
                            </Grid>

                            <!-- Boutons actions -->
                            <HorizontalStackLayout Grid.Column="2" Grid.RowSpan="2"
                                                   Spacing="8"
                                                   VerticalOptions="Center">

                                <!-- Ajouter ingr√©dients manquants -->
                                <Button Text="üõí"
                                        BackgroundColor="#3498DB"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnAjouterManquants_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <!-- Supprimer une recette -->
                                <Button Text="üóë"
                                        BackgroundColor="#e74c3c"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnSupprimerRecette_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <!-- Modifier recette -->
                                <Button Text="‚úèÔ∏è"
                                        BackgroundColor="#F1C40F"
                                        TextColor="Black"
                                        Padding="8"
                                        Clicked="BtnModifierRecette_Clicked"
                                        CommandParameter="{Binding Model}"/>

                            </HorizontalStackLayout>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>
</ContentPage>

================================================================================
FILE: Pages\MesRecettesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.ViewModels;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Pages;

public partial class MesRecettesPage : ContentPage
{
    private MesRecettesViewModel? _vm;
    private bool _suppressSelectAllEvent;

    public MesRecettesPage()
    {
        InitializeComponent();

        var app = (App)Application.Current;

        if (app.RecipesService == null)
        {
            MainThread.BeginInvokeOnMainThread(async () =>
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Recipes_ServiceNull"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                ));

            return;
        }

        _vm = new MesRecettesViewModel(app.RecipesService);
        BindingContext = _vm;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        if (_vm == null)
            return;

        await _vm.LoadAsync();

        // Recalcule vert/rouge si ton VM le fait (et si tu l‚Äôas impl√©ment√©)
        // Sinon tu peux commenter la ligne.
        await _vm.RefreshAvailabilityAsync();

        RefreshSelectionUi();
    }

    private async void OnAjouterRecetteClicked(object sender, EventArgs e)
    {
        await Navigation.PushAsync(new AjouterRecettePage());
    }

    // Tap recette -> d√©tails
    private async void OnRecetteTapped(object sender, TappedEventArgs e)
    {
        // Ici on accepte RecetteUi OU Recette
        Recette? recette = e.Parameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        var app = (App)Application.Current;

        if (app.RecetteIngredientsService == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Recipes_IngredientsServiceNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var items = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

        var ingredientsText = (items.Count == 0)
            ? LocalizationResourceManager.Instance["Recipes_NoIngredients"]
            : string.Join("\n", items.Select(x =>
                string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                    ? $"‚Ä¢ {x.nom}"
                    : $"‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
            ));

        var details = string.Format(
            LocalizationResourceManager.Instance["Recipes_DetailsFormat"],
            recette.CategorieDb,
            recette.TempsPreparation,
            ingredientsText,
            recette.Instructions ?? ""
        );

        await DisplayAlert(recette.Nom, details, LocalizationResourceManager.Instance["Dialog_Ok"]);
    }

    // ----------- S√©lection / suppression -----------

    private void ChkToutSelectionnerRecettes_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_vm == null) return;
        if (_suppressSelectAllEvent) return;

        foreach (var r in _vm.Recettes)
            r.IsSelectedForDelete = e.Value;

        RefreshSelectionUi();
    }

    private void RecetteDeleteCheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        RefreshSelectionUi();
    }

    private void RefreshSelectionUi()
    {
        if (_vm == null) return;

        // ‚ö†Ô∏è si ton XAML n‚Äôa pas ces x:Name, √ßa crash => je prot√®ge
        var selectedCount = _vm.Recettes.Count(x => x.IsSelectedForDelete);

        if (SelectionInfoLabel != null)
            SelectionInfoLabel.Text = selectedCount == 0 ? "" : $"{selectedCount} s√©lectionn√©(s)";

        _suppressSelectAllEvent = true;
        try
        {
            if (ChkToutSelectionnerRecettes != null)
            {
                if (_vm.Recettes.Count == 0)
                {
                    ChkToutSelectionnerRecettes.IsEnabled = false;
                    ChkToutSelectionnerRecettes.IsChecked = false;
                }
                else
                {
                    ChkToutSelectionnerRecettes.IsEnabled = true;
                    ChkToutSelectionnerRecettes.IsChecked = _vm.Recettes.All(x => x.IsSelectedForDelete);
                }
            }
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        var selected = _vm.Recettes.Where(r => r.IsSelectedForDelete).ToList();
        if (selected.Count == 0)
        {
            await DisplayAlert("Info", "Aucune recette s√©lectionn√©e.", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer {selected.Count} recette(s) s√©lectionn√©e(s) ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteSelectedAsync(selected);

        RefreshSelectionUi();
    }

    private async void BtnSupprimerRecette_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        if (sender is not Button btn)
            return;

        // Accepte RecetteUi OU Recette (pratique si tu changes le XAML)
        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null)
            return;

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer '{recetteUi.Nom}' ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteOneAsync(recetteUi);
        RefreshSelectionUi();
    }

    // ----------- Modifier -----------

    private async void BtnModifierRecette_Clicked(object sender, EventArgs e)
    {
        if (sender is not Button btn)
            return;

        Recette? recette = btn.CommandParameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        await Navigation.PushAsync(new AjouterRecettePage(recette));
    }

    // ----------- Ajouter manquants √† la liste de courses -----------

    private async void BtnAjouterManquants_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        var missing = await _vm.GetMissingIngredientsForRecipeAsync(recetteUi.Model);
        if (missing == null)
        {
            await DisplayAlert("Info", "Impossible de calculer les ingr√©dients (offline ou donn√©es manquantes).", "OK");
            return;
        }

        if (missing.Count == 0)
        {
            await DisplayAlert("Info", "Tu as d√©j√† tous les ingr√©dients pour cette recette ‚úÖ", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Ajouter √† la liste",
            "Ajouter ces ingr√©dients manquants ?\n- " + string.Join("\n- ", missing),
            "Oui",
            "Non");

        if (!confirm) return;

        var ok = await _vm.SendMissingToShoppingAsync(missing);

        if (ok)
            await DisplayAlert("Succ√®s", $"{missing.Count} ingr√©dient(s) ajout√©(s) √† la liste de courses.", "OK");
        else
            await DisplayAlert("Erreur", "Impossible d‚Äôajouter √† la liste de courses.", "OK");
    }
}

================================================================================
FILE: Pages\ResetPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ResetPasswordPage"
             Title="{tr:Translate Reset_Title}">

    <VerticalStackLayout Padding="24" Spacing="12">

        <Label Text="{tr:Translate Reset_Header}"
               FontSize="20"
               FontAttributes="Bold" />

        <Entry x:Name="Pwd1"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_NewPassword}" />

        <Entry x:Name="Pwd2"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_ConfirmPassword}" />

        <Button Text="{tr:Translate Reset_Submit}"
                Clicked="OnSubmit" />

        <Label x:Name="Msg" />

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: Pages\ResetPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages;

public partial class ResetPasswordPage : ContentPage
{
    private readonly string _accessToken;
    private readonly SupabaseService _supabase;

    public ResetPasswordPage(string accessToken)
    {
        InitializeComponent();
        _accessToken = accessToken;

        string url = ConfigurationHelper.GetSupabaseUrl();
        string key = ConfigurationHelper.GetSupabaseKey();
        _supabase = new SupabaseService(url, key);
    }

    private async void OnSubmit(object sender, EventArgs e)
    {
        var p1 = Pwd1.Text ?? "";
        var p2 = Pwd2.Text ?? "";

        if (string.IsNullOrWhiteSpace(p1) || p1.Length < 6)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMinLength"];
            Msg.TextColor = Colors.Red;
            return;
        }

        if (p1 != p2)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMismatch"];
            Msg.TextColor = Colors.Red;
            return;
        }

        Msg.Text = LocalizationResourceManager.Instance["Reset_Updating"];
        Msg.TextColor = Colors.Blue;

        var (success, error) = await _supabase.UpdatePasswordAsync(_accessToken, p1);

        if (success)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Reset_DoneTitle"],
                LocalizationResourceManager.Instance["Reset_DoneBody"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await Navigation.PopToRootAsync();
        }
        else
        {
            Msg.Text = string.IsNullOrWhiteSpace(error)
                ? LocalizationResourceManager.Instance["Reset_Failed"]
                : error;

            Msg.TextColor = Colors.Red;
        }
    }
}

================================================================================
FILE: Pages\SettingsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.SettingsPage"
             Title="{tr:Translate Settings_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <Label Text="{tr:Translate Settings_Account}"
                   FontSize="18"
                   FontAttributes="Bold" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">

                    <Button Text="{tr:Translate Settings_Logout}"
                            BackgroundColor="#34495E"
                            FontAttributes="Bold"
                            Clicked="OnLogoutClicked" />

                    <Label Text="{tr:Translate Settings_DangerZone}"
                           FontSize="14"
                           TextColor="Gray"
                           Margin="0,6,0,0" />

                    <Button Text="{tr:Translate Settings_Unsubscribe}"
                            BackgroundColor="IndianRed"
                            FontAttributes="Bold"
                            Clicked="OnDesinscriptionClicked" />

                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: Pages\SettingsPage.xaml.cs
================================================================================

Ôªøusing System;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages;

public partial class SettingsPage : ContentPage
{
    public SettingsPage()
    {
        InitializeComponent();
    }

    private async void OnDesinscriptionClicked(object sender, EventArgs e)
    {
        bool confirm = await DisplayAlert(
            LocalizationResourceManager.Instance["Settings_DeleteConfirmTitle"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmBody"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmYes"],
            LocalizationResourceManager.Instance["Dialog_Cancel"]);

        if (!confirm) return;

        var app = (App)Application.Current;

        if (app.Supabase == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Settings_SupabaseNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        // 1) Lire la session stock√©e
        var token = await SecureStorage.GetAsync("sb_access_token");
        var userId = await SecureStorage.GetAsync("sb_user_id");

        if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["SessionTitle"],
                LocalizationResourceManager.Instance["SessionExpired"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        // 2) R√©injecter la session AVANT delete
        app.Supabase.SetSession(token, userId);

        // 3) Appel Edge Function
        var (ok, err) = await app.Supabase.DeleteAccountAsync();

        if (!ok)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                string.Format(LocalizationResourceManager.Instance["Settings_DeleteFailed"], err),
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            if (!string.IsNullOrWhiteSpace(err) &&
                err.Contains("Invalid JWT", StringComparison.OrdinalIgnoreCase))
            {
                app.ShowLogin();
            }

            return;
        }

        // Nettoyage local
        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        await DisplayAlert(
            LocalizationResourceManager.Instance["Dialog_Ok"],
            LocalizationResourceManager.Instance["Settings_DeleteSuccess"],
            LocalizationResourceManager.Instance["Dialog_Ok"]);

        app.ShowLogin();
    }

    private void OnLogoutClicked(object sender, EventArgs e)
    {
        var app = (App)Application.Current;

        app.Supabase?.ClearSession();

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        app.ShowLogin();
    }
}

================================================================================
FILE: Platforms\Android\AndroidManifest.xml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
	<application android:allowBackup="true" android:icon="@mipmap/postriticone" android:supportsRtl="true"></application>
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.CAMERA" />
	<queries>
		<intent>
			<action android:name="android.intent.action.VIEW" />
			<data android:scheme="logecui" />
		</intent>
	</queries>
</manifest>

================================================================================
FILE: Platforms\Android\MainActivity.cs
================================================================================

Ôªøusing Android.App;
using Android.Content;
using Android.Content.PM;
using Android.OS;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile
{
    [Activity(
        Theme = "@style/Maui.SplashTheme",
        MainLauncher = true,
        LaunchMode = LaunchMode.SingleTop,
        ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | ConfigChanges.SmallestScreenSize | ConfigChanges.Density)]

    // Configuration du Deep Link pour la confirmation email
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "confirm",
        AutoVerify = true)]

    // Deep Link - reset password
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "reset-password")]

    public class MainActivity : MauiAppCompatActivity
    {
        protected override void OnCreate(Bundle? savedInstanceState)
        {
            base.OnCreate(savedInstanceState);

            // G√©rer le deep link si l'app est lanc√©e via un lien
            HandleIntent(Intent);
        }

        protected override void OnNewIntent(Intent? intent)
        {
            base.OnNewIntent(intent);

            if (intent != null)
            {
                Intent = intent;
                HandleIntent(intent);
            }
        }

        private void HandleIntent(Intent? intent)
        {
            var data = intent?.DataString;
            if (string.IsNullOrEmpty(data))
                return;

            var uri = new Uri(data);

            MainThread.BeginInvokeOnMainThread(async () =>
            {
                if (Microsoft.Maui.Controls.Application.Current is App app)
                    await app.HandleDeepLinkAsync(uri);
            });
        }
    }
}

================================================================================
FILE: Platforms\Android\MainApplication.cs
================================================================================

Ôªøusing Android.App;
using Android.Runtime;

namespace LoGeCuiMobile
{
    [Application]
    public class MainApplication : MauiApplication
    {
        public MainApplication(IntPtr handle, JniHandleOwnership ownership)
            : base(handle, ownership)
        {
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\Android\Resources\values\colors.xml
================================================================================

<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="colorPrimary">#512BD4</color>
    <color name="colorPrimaryDark">#2B0B98</color>
    <color name="colorAccent">#2B0B98</color>
</resources>

================================================================================
FILE: Platforms\iOS\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\iOS\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: Platforms\MacCatalyst\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\MacCatalyst\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: Platforms\Windows\App.xaml
================================================================================

Ôªø<maui:MauiWinUIApplication
    x:Class="LoGeCuiMobile.WinUI.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:maui="using:Microsoft.Maui"
    xmlns:local="using:LoGeCuiMobile.WinUI">

</maui:MauiWinUIApplication>

================================================================================
FILE: Platforms\Windows\App.xaml.cs
================================================================================

Ôªøusing Microsoft.UI.Xaml;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace LoGeCuiMobile.WinUI
{
    /// <summary>
    /// Provides application-specific behavior to supplement the default Application class.
    /// </summary>
    public partial class App : MauiWinUIApplication
    {
        /// <summary>
        /// Initializes the singleton application object.  This is the first line of authored code
        /// executed, and as such is the logical equivalent of main() or WinMain().
        /// </summary>
        public App()
        {
            this.InitializeComponent();
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }

}

================================================================================
FILE: Properties\launchSettings.json
================================================================================

{
  "profiles": {
    "Windows Machine": {
      "commandName": "Project",
      "nativeDebugging": false
    }
  }
}

================================================================================
FILE: Resources\Lang\AppResources.Designer.cs
================================================================================

Ôªø//------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a √©t√© g√©n√©r√© par un outil.
//     Version du runtime :4.0.30319.42000
//
//     Les modifications apport√©es √† ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est r√©g√©n√©r√©.
// </auto-generated>
//------------------------------------------------------------------------------

namespace LoGeCuiMobile.Resources.Lang {
    using System;
    
    
    /// <summary>
    ///   Une classe de ressource fortement typ√©e destin√©e, entre autres, √† la consultation des cha√Ænes localis√©es.
    /// </summary>
    // Cette classe a √©t√© g√©n√©r√©e automatiquement par la classe StronglyTypedResourceBuilder
    // √† l'aide d'un outil, tel que ResGen ou Visual Studio.
    // Pour ajouter ou supprimer un membre, modifiez votre fichier .ResX, puis r√©ex√©cutez ResGen
    // avec l'option /str ou r√©g√©n√©rez votre projet VS.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "18.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    public class AppResources {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal AppResources() {
        }
        
        /// <summary>
        ///   Retourne l'instance ResourceManager mise en cache utilis√©e par cette classe.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("LoGeCuiMobile.Resources.Lang.AppResources", typeof(AppResources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   Remplace la propri√©t√© CurrentUICulture du thread actuel pour toutes
        ///   les recherches de ressources √† l'aide de cette classe de ressource fortement typ√©e.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mauvais mot de passe.
        /// </summary>
        public static string BadPassword {
            get {
                return ResourceManager.GetString("BadPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Connexion en cours....
        /// </summary>
        public static string Connecting {
            get {
                return ResourceManager.GetString("Connecting", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur de connexion.
        /// </summary>
        public static string ConnectionError {
            get {
                return ResourceManager.GetString("ConnectionError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©ation du compte....
        /// </summary>
        public static string CreatingAccount {
            get {
                return ResourceManager.GetString("CreatingAccount", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Annuler.
        /// </summary>
        public static string Dialog_Cancel {
            get {
                return ResourceManager.GetString("Dialog_Cancel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer cet ingr√©dient ?.
        /// </summary>
        public static string Dialog_DeleteConfirm {
            get {
                return ResourceManager.GetString("Dialog_DeleteConfirm", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Non.
        /// </summary>
        public static string Dialog_No {
            get {
                return ResourceManager.GetString("Dialog_No", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OK.
        /// </summary>
        public static string Dialog_Ok {
            get {
                return ResourceManager.GetString("Dialog_Ok", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui.
        /// </summary>
        public static string Dialog_Yes {
            get {
                return ResourceManager.GetString("Dialog_Yes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Email.
        /// </summary>
        public static string Email {
            get {
                return ResourceManager.GetString("Email", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur.
        /// </summary>
        public static string ErrorTitle {
            get {
                return ResourceManager.GetString("ErrorTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Veuillez remplir tous les champs.
        /// </summary>
        public static string FillAllFields {
            get {
                return ResourceManager.GetString("FillAllFields", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe oubli√© ?.
        /// </summary>
        public static string ForgotPassword {
            get {
                return ResourceManager.GetString("ForgotPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Add_Available {
            get {
                return ResourceManager.GetString("Ingredients_Add_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de l‚Äôingr√©dient.
        /// </summary>
        public static string Ingredients_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Ingredients_Add_NameRequired {
            get {
                return ResourceManager.GetString("Ingredients_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© (ex : 10).
        /// </summary>
        public static string Ingredients_Add_QuantityPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_QuantityPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üíæ Enregistrer.
        /// </summary>
        public static string Ingredients_Add_Save {
            get {
                return ResourceManager.GetString("Ingredients_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_Add_Title {
            get {
                return ResourceManager.GetString("Ingredients_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Unit√© (ex : kg, pi√®ces).
        /// </summary>
        public static string Ingredients_Add_UnitPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_UnitPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_AddButton {
            get {
                return ResourceManager.GetString("Ingredients_AddButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Available {
            get {
                return ResourceManager.GetString("Ingredients_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dient.
        /// </summary>
        public static string Ingredients_DialogTitle {
            get {
                return ResourceManager.GetString("Ingredients_DialogTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© : {0} {1}.
        /// </summary>
        public static string Ingredients_QuantityFormat {
            get {
                return ResourceManager.GetString("Ingredients_QuantityFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Gestion des ingr√©dients.
        /// </summary>
        public static string Ingredients_Title {
            get {
                return ResourceManager.GetString("Ingredients_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Se connecter.
        /// </summary>
        public static string LoginButton {
            get {
                return ResourceManager.GetString("LoginButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string LoginRequired {
            get {
                return ResourceManager.GetString("LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients.
        /// </summary>
        public static string Nav_Ingredients {
            get {
                return ResourceManager.GetString("Nav_Ingredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Menu al√©atoire.
        /// </summary>
        public static string Nav_RandomMenu {
            get {
                return ResourceManager.GetString("Nav_RandomMenu", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Nav_Recipes {
            get {
                return ResourceManager.GetString("Nav_Recipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Nav_Settings {
            get {
                return ResourceManager.GetString("Nav_Settings", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste de courses.
        /// </summary>
        public static string Nav_ShoppingList {
            get {
                return ResourceManager.GetString("Nav_ShoppingList", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OCR.
        /// </summary>
        public static string OcrTitle {
            get {
                return ResourceManager.GetString("OcrTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe.
        /// </summary>
        public static string Password {
            get {
                return ResourceManager.GetString("Password", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üîí Permission.
        /// </summary>
        public static string PermissionTitle {
            get {
                return ResourceManager.GetString("PermissionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Tout est disponible. Aucun ingr√©dient manquant..
        /// </summary>
        public static string RandomMenu_AllAvailable {
            get {
                return ResourceManager.GetString("RandomMenu_AllAvailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de calculer les ingr√©dients manquants : certaines recettes n‚Äôont pas d‚Äôingr√©dients enregistr√©s..
        /// </summary>
        public static string RandomMenu_CannotComputeMissing {
            get {
                return ResourceManager.GetString("RandomMenu_CannotComputeMissing", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de g√©n√©rer un menu Entr√©e/Plat/Dessert..
        /// </summary>
        public static string RandomMenu_CannotGenerate {
            get {
                return ResourceManager.GetString("RandomMenu_CannotGenerate", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† V√©rifie que tes recettes ont bien &apos;categorie&apos; = Entree / Plat / Dessert en DB..
        /// </summary>
        public static string RandomMenu_CheckCategories {
            get {
                return ResourceManager.GetString("RandomMenu_CheckCategories", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Entr√©es: {0}
        ///Plats: {1}
        ///Desserts: {2}.
        /// </summary>
        public static string RandomMenu_CountsFormat {
            get {
                return ResourceManager.GetString("RandomMenu_CountsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Appuyez sur le bouton pour g√©n√©rer un menu.
        /// </summary>
        public static string RandomMenu_DefaultText {
            get {
                return ResourceManager.GetString("RandomMenu_DefaultText", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_GenerateButton {
            get {
                return ResourceManager.GetString("RandomMenu_GenerateButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Menu g√©n√©r√© :.
        /// </summary>
        public static string RandomMenu_GeneratedHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GeneratedHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ G√©n√©ration du menu (Entr√©e / Plat / Dessert)‚Ä¶.
        /// </summary>
        public static string RandomMenu_Generating {
            get {
                return ResourceManager.GetString("RandomMenu_Generating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste globale des ingr√©dients manquants :.
        /// </summary>
        public static string RandomMenu_GlobalMissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GlobalMissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients :.
        /// </summary>
        public static string RandomMenu_IngredientsHeader {
            get {
                return ResourceManager.GetString("RandomMenu_IngredientsHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants :.
        /// </summary>
        public static string RandomMenu_MissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_MissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants : aucun.
        /// </summary>
        public static string RandomMenu_MissingNone {
            get {
                return ResourceManager.GetString("RandomMenu_MissingNone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients : (aucun ingr√©dient enregistr√© pour cette recette).
        /// </summary>
        public static string RandomMenu_NoIngredientsForRecipe {
            get {
                return ResourceManager.GetString("RandomMenu_NoIngredientsForRecipe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette disponible..
        /// </summary>
        public static string RandomMenu_NoRecipes {
            get {
                return ResourceManager.GetString("RandomMenu_NoRecipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ouvrir la liste de courses.
        /// </summary>
        public static string RandomMenu_OpenShopping {
            get {
                return ResourceManager.GetString("RandomMenu_OpenShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Il manque :.
        /// </summary>
        public static string RandomMenu_SendConfirmBody {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Envoyer ?.
        /// </summary>
        public static string RandomMenu_SendConfirmTitle {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Envoyer les ingr√©dients manquants dans la liste de courses.
        /// </summary>
        public static string RandomMenu_SendMissingToShopping {
            get {
                return ResourceManager.GetString("RandomMenu_SendMissingToShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ingr√©dients envoy√©s.
        /// </summary>
        public static string RandomMenu_SentButton {
            get {
                return ResourceManager.GetString("RandomMenu_SentButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_Title {
            get {
                return ResourceManager.GetString("RandomMenu_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add {
            get {
                return ResourceManager.GetString("Recipes_Add", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;acc√®s √† la cam√©ra est requis pour scanner..
        /// </summary>
        public static string Recipes_Add_CameraPermission {
            get {
                return ResourceManager.GetString("Recipes_Add_CameraPermission", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Capture photo non support√©e sur cet appareil..
        /// </summary>
        public static string Recipes_Add_CaptureNotSupported {
            get {
                return ResourceManager.GetString("Recipes_Add_CaptureNotSupported", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Choisir une cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de retrouver l&apos;ID de la recette apr√®s sauvegarde..
        /// </summary>
        public static string Recipes_Add_IdNotFound {
            get {
                return ResourceManager.GetString("Recipes_Add_IdNotFound", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;image est trop lourde pour l&apos;OCR. Essayez de cadrer plus serr√© ou baissez la r√©solution..
        /// </summary>
        public static string Recipes_Add_ImageTooLarge {
            get {
                return ResourceManager.GetString("Recipes_Add_ImageTooLarge", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients (1 par ligne).
        /// </summary>
        public static string Recipes_Add_IngredientsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex :
        ///2 ≈ìufs
        ///100g farine
        ///1 pinc√©e de sel.
        /// </summary>
        public static string Recipes_Add_IngredientsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Instructions.
        /// </summary>
        public static string Recipes_Add_InstructionsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : M√©langer, cuire 10 min....
        /// </summary>
        public static string Recipes_Add_InstructionsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string Recipes_Add_LoginRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom.
        /// </summary>
        public static string Recipes_Add_NameLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_NameLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de la recette.
        /// </summary>
        public static string Recipes_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Recipes_Add_NameRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun texte d√©tect√©. Essayez avec plus de lumi√®re et sans flou..
        /// </summary>
        public static string Recipes_Add_NoTextDetected {
            get {
                return ResourceManager.GetString("Recipes_Add_NoTextDetected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Texte scann√© et champs pr√©-remplis. V√©rifiez et corrigez si besoin..
        /// </summary>
        public static string Recipes_Add_OcrSuccess {
            get {
                return ResourceManager.GetString("Recipes_Add_OcrSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Enregistrer.
        /// </summary>
        public static string Recipes_Add_Save {
            get {
                return ResourceManager.GetString("Recipes_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Recette enregistr√©e..
        /// </summary>
        public static string Recipes_Add_Saved {
            get {
                return ResourceManager.GetString("Recipes_Add_Saved", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Scanner (OCR).
        /// </summary>
        public static string Recipes_Add_ScanOcr {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanOcr", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üì∏ Scanner une recette.
        /// </summary>
        public static string Recipes_Add_ScanTitle {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_Add_ServiceNotReady {
            get {
                return ResourceManager.GetString("Recipes_Add_ServiceNotReady", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps (minutes).
        /// </summary>
        public static string Recipes_Add_TimeLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_TimeLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : 30.
        /// </summary>
        public static string Recipes_Add_TimePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_TimePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add_Title {
            get {
                return ResourceManager.GetString("Recipes_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Category {
            get {
                return ResourceManager.GetString("Recipes_Category", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie: {0}
        ///Temps: {1} min
        ///
        ///Ingr√©dients:
        ///{2}
        ///
        ///Instructions:
        ///{3}.
        /// </summary>
        public static string Recipes_DetailsFormat {
            get {
                return ResourceManager.GetString("Recipes_DetailsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette pour l&apos;instant..
        /// </summary>
        public static string Recipes_Empty {
            get {
                return ResourceManager.GetString("Recipes_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_IngredientsServiceNull {
            get {
                return ResourceManager.GetString("Recipes_IngredientsServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† (aucun ingr√©dient renseign√©).
        /// </summary>
        public static string Recipes_NoIngredients {
            get {
                return ResourceManager.GetString("Recipes_NoIngredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rafra√Æchir.
        /// </summary>
        public static string Recipes_Refresh {
            get {
                return ResourceManager.GetString("Recipes_Refresh", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecipesService est NULL (InitRestServices n&apos;a pas √©t√© appel√© apr√®s login)..
        /// </summary>
        public static string Recipes_ServiceNull {
            get {
                return ResourceManager.GetString("Recipes_ServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps : {0} min.
        /// </summary>
        public static string Recipes_TimeFormat {
            get {
                return ResourceManager.GetString("Recipes_TimeFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Recipes_Title {
            get {
                return ResourceManager.GetString("Recipes_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Confirmer le mot de passe.
        /// </summary>
        public static string Reset_ConfirmPassword {
            get {
                return ResourceManager.GetString("Reset_ConfirmPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Votre mot de passe a √©t√© modifi√©. Vous pouvez vous connecter..
        /// </summary>
        public static string Reset_DoneBody {
            get {
                return ResourceManager.GetString("Reset_DoneBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Termin√©.
        /// </summary>
        public static string Reset_DoneTitle {
            get {
                return ResourceManager.GetString("Reset_DoneTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de modifier le mot de passe..
        /// </summary>
        public static string Reset_Failed {
            get {
                return ResourceManager.GetString("Reset_Failed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialiser votre mot de passe.
        /// </summary>
        public static string Reset_Header {
            get {
                return ResourceManager.GetString("Reset_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nouveau mot de passe.
        /// </summary>
        public static string Reset_NewPassword {
            get {
                return ResourceManager.GetString("Reset_NewPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le mot de passe doit contenir au moins 6 caract√®res..
        /// </summary>
        public static string Reset_PwdMinLength {
            get {
                return ResourceManager.GetString("Reset_PwdMinLength", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Les mots de passe ne correspondent pas..
        /// </summary>
        public static string Reset_PwdMismatch {
            get {
                return ResourceManager.GetString("Reset_PwdMismatch", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Valider.
        /// </summary>
        public static string Reset_Submit {
            get {
                return ResourceManager.GetString("Reset_Submit", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialisation.
        /// </summary>
        public static string Reset_Title {
            get {
                return ResourceManager.GetString("Reset_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ Mise √† jour en cours....
        /// </summary>
        public static string Reset_Updating {
            get {
                return ResourceManager.GetString("Reset_Updating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Service indisponible..
        /// </summary>
        public static string ServiceUnavailable {
            get {
                return ResourceManager.GetString("ServiceUnavailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session absente ou expir√©e. Veuillez vous reconnecter..
        /// </summary>
        public static string SessionExpired {
            get {
                return ResourceManager.GetString("SessionExpired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session.
        /// </summary>
        public static string SessionTitle {
            get {
                return ResourceManager.GetString("SessionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Compte.
        /// </summary>
        public static string Settings_Account {
            get {
                return ResourceManager.GetString("Settings_Account", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Zone dangereuse.
        /// </summary>
        public static string Settings_DangerZone {
            get {
                return ResourceManager.GetString("Settings_DangerZone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Es-tu s√ªr de vouloir supprimer ton compte ? Cette action est irr√©versible..
        /// </summary>
        public static string Settings_DeleteConfirmBody {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_DeleteConfirmTitle {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui, supprimer.
        /// </summary>
        public static string Settings_DeleteConfirmYes {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmYes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Suppression impossible : {0}.
        /// </summary>
        public static string Settings_DeleteFailed {
            get {
                return ResourceManager.GetString("Settings_DeleteFailed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Votre compte a √©t√© supprim√©..
        /// </summary>
        public static string Settings_DeleteSuccess {
            get {
                return ResourceManager.GetString("Settings_DeleteSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©connexion.
        /// </summary>
        public static string Settings_Logout {
            get {
                return ResourceManager.GetString("Settings_Logout", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supabase non initialis√©. Reconnectez-vous..
        /// </summary>
        public static string Settings_SupabaseNull {
            get {
                return ResourceManager.GetString("Settings_SupabaseNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Settings_Title {
            get {
                return ResourceManager.GetString("Settings_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_Unsubscribe {
            get {
                return ResourceManager.GetString("Settings_Unsubscribe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un article.
        /// </summary>
        public static string Shopping_AddItem {
            get {
                return ResourceManager.GetString("Shopping_AddItem", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Achet√©.
        /// </summary>
        public static string Shopping_Bought {
            get {
                return ResourceManager.GetString("Shopping_Bought", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer.
        /// </summary>
        public static string Shopping_Delete {
            get {
                return ResourceManager.GetString("Shopping_Delete", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üóëÔ∏è Supprimer s√©lection.
        /// </summary>
        public static string Shopping_DeleteSelection {
            get {
                return ResourceManager.GetString("Shopping_DeleteSelection", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun article pour l‚Äôinstant..
        /// </summary>
        public static string Shopping_Empty {
            get {
                return ResourceManager.GetString("Shopping_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ma liste de courses.
        /// </summary>
        public static string Shopping_Header {
            get {
                return ResourceManager.GetString("Shopping_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Liste de Courses.
        /// </summary>
        public static string Shopping_Title {
            get {
                return ResourceManager.GetString("Shopping_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©er un compte.
        /// </summary>
        public static string SignupButton {
            get {
                return ResourceManager.GetString("SignupButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur lors de l&apos;inscription.
        /// </summary>
        public static string SignupError {
            get {
                return ResourceManager.GetString("SignupError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rester connect√©.
        /// </summary>
        public static string StayConnected {
            get {
                return ResourceManager.GetString("StayConnected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ OK.
        /// </summary>
        public static string SuccessTitle {
            get {
                return ResourceManager.GetString("SuccessTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur inconnue..
        /// </summary>
        public static string UnknownError {
            get {
                return ResourceManager.GetString("UnknownError", resourceCulture);
            }
        }
    }
}

================================================================================
FILE: Resources\Lang\LocalizationResourceManager.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Globalization;
using System.Resources;

namespace LoGeCuiMobile.Resources.Lang;

public class LocalizationResourceManager : INotifyPropertyChanged
{
    public static LocalizationResourceManager Instance { get; } = new();

    private readonly ResourceManager _resourceManager = AppResources.ResourceManager;

    public event PropertyChangedEventHandler? PropertyChanged;

    public string this[string key] => _resourceManager.GetString(key, CultureInfo.CurrentUICulture) ?? key;

    public void SetCulture(CultureInfo culture)
    {
        if (culture == null) return;

        CultureInfo.CurrentUICulture = culture;
        CultureInfo.CurrentCulture = culture;

        CultureInfo.DefaultThreadCurrentCulture = culture;
        CultureInfo.DefaultThreadCurrentUICulture = culture;

        // ‚úÖ Notifie toute l‚ÄôUI : toutes les bindings se r√©√©valuent
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(null));
    }
}

================================================================================
FILE: Resources\Lang\TranslateExtension.cs
================================================================================

Ôªøusing Microsoft.Maui.Controls;
using System;

namespace LoGeCuiMobile.Resources.Lang;

[ContentProperty(nameof(Key))]
public class TranslateExtension : IMarkupExtension<BindingBase>
{
    public string Key { get; set; } = "";

    public BindingBase ProvideValue(IServiceProvider serviceProvider)
        => new Binding($"[{Key}]", source: LocalizationResourceManager.Instance);

    object IMarkupExtension.ProvideValue(IServiceProvider serviceProvider)
        => ProvideValue(serviceProvider);
}

================================================================================
FILE: Resources\Raw\AboutAssets.txt
================================================================================

ÔªøAny raw assets you want to be deployed with your application can be placed in
this directory (and child directories). Deployment of the asset to your application
is automatically handled by the following `MauiAsset` Build Action within your `.csproj`.

	<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />

These files will be deployed with your package and will be accessible using Essentials:

	async Task LoadMauiAsset()
	{
		using var stream = await FileSystem.OpenAppPackageFileAsync("AboutAssets.txt");
		using var reader = new StreamReader(stream);

		var contents = reader.ReadToEnd();
	}

================================================================================
FILE: Resources\Styles\Colors.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- Couleurs fixes -->
    <Color x:Key="AccentColor">#FF6B00</Color>

    <!-- Couleurs Light -->
    <Color x:Key="LightPageBackground">#FFFFFF</Color>
    <Color x:Key="LightTextPrimary">#111111</Color>
    <Color x:Key="LightCardBackground">#F2F2F2</Color>

    <!-- Couleurs Dark -->
    <Color x:Key="DarkPageBackground">#121212</Color>
    <Color x:Key="DarkTextPrimary">#FFFFFF</Color>
    <Color x:Key="DarkCardBackground">#1E1E1E</Color>

    <!-- Texte sur cartes -->
    <Color x:Key="LightCardText">#111111</Color>
    <Color x:Key="DarkCardText">#FFFFFF</Color>

</ResourceDictionary>


================================================================================
FILE: Resources\Styles\Styles.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- PAGE -->
    <Style TargetType="ContentPage">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightPageBackground}"
                                 Dark="{StaticResource DarkPageBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- LABEL -->
    <Style TargetType="Label">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- ENTRY -->
    <Style TargetType="Entry">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- FRAME -->
    <Style TargetType="Frame">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- BUTTON -->
    <Style TargetType="Button">
        <Setter Property="TextColor" Value="White" />
        <Setter Property="BackgroundColor" Value="{StaticResource AccentColor}" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Padding" Value="14,10" />
        <Setter Property="MinimumHeightRequest" Value="44" />
        <Setter Property="MinimumWidthRequest" Value="44" />
    </Style>

    <!-- LABEL DANS UNE CARTE -->
    <Style TargetType="Label" x:Key="CardLabel">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardText}"
                             Dark="{StaticResource DarkCardText}" />
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>

================================================================================
FILE: RootPage.cs
================================================================================

namespace LoGeCuiMobile;

public static class RootPage
{
    public static Page CreateLoginRoot()
        => new NavigationPage(new Pages.LoginPage());

    public static Page CreateAppShellRoot()
        => new AppShell();
}

================================================================================
FILE: Services\Local\ArticleLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class ArticleLocal
    {
        [PrimaryKey]
        public int Id { get; set; }   // int

        public string Nom { get; set; } = "";
        public string Quantite { get; set; } = "";
        public string Unite { get; set; } = "";
        public bool EstAchete { get; set; }

        public ArticleLocal() { }

        public ArticleLocal(ArticleCourse a)
        {
            Id = a.Id;                 // int -> int ‚úÖ
            Nom = a.Nom ?? "";
            Quantite = a.Quantite ?? "";
            Unite = a.Unite ?? "";
            EstAchete = a.EstAchete;
        }

        public ArticleCourse ToModel()
        {
            return new ArticleCourse
            {
                Id = Id,              // int -> int ‚úÖ
                Nom = Nom,
                Quantite = Quantite,
                Unite = Unite,
                EstAchete = EstAchete
            };
        }
    }
}

================================================================================
FILE: Services\Local\IngredientLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

public class IngredientLocal
{
    [PrimaryKey]
    public Guid Id { get; set; }
    public string Nom { get; set; } = "";
    public string? Quantite { get; set; }
    public string? Unite { get; set; }
    public bool EstDisponible { get; set; }

    public IngredientLocal() { }

    public IngredientLocal(Ingredient i)
    {
        Id = i.Id;
        Nom = i.Nom;
        Quantite = i.Quantite;
        Unite = i.Unite;
        EstDisponible = i.EstDisponible;
    }

    public Ingredient ToModel() => new Ingredient
    {
        Id = Id,
        Nom = Nom,
        Quantite = Quantite,
        Unite = Unite,
        EstDisponible = EstDisponible
    };
}

================================================================================
FILE: Services\Local\LocalDatabase.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local;

public class LocalDatabase
{
    private readonly SQLiteAsyncConnection _db;

    public LocalDatabase(string path)
    {
        _db = new SQLiteAsyncConnection(path);
        _db.CreateTableAsync<IngredientLocal>().Wait();
        _db.CreateTableAsync<ArticleLocal>().Wait();
        _db.CreateTableAsync<RecetteLocal>().Wait();

    }

    // ---------- INGREDIENTS ----------
    public Task<List<IngredientLocal>> GetIngredientsAsync() =>
        _db.Table<IngredientLocal>().ToListAsync();

    public Task SaveIngredientsAsync(IEnumerable<Ingredient> ingredients)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<IngredientLocal>();
            foreach (var i in ingredients)
                tran.Insert(new IngredientLocal(i));
        });
    }

    // ---------- ARTICLES ----------
    public Task<List<ArticleLocal>> GetArticlesAsync() =>
        _db.Table<ArticleLocal>().ToListAsync();

    public Task SaveArticlesAsync(IEnumerable<ArticleCourse> articles)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<ArticleLocal>();
            foreach (var a in articles)
                tran.Insert(new ArticleLocal(a));
        });
    }

    public Task<List<RecetteLocal>> GetRecettesAsync() =>
    _db.Table<RecetteLocal>().ToListAsync();

    public Task SaveRecettesAsync(IEnumerable<Recette> recettes)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<RecetteLocal>();
            foreach (var r in recettes)
                tran.Insert(new RecetteLocal(r));
        });
    }
}

================================================================================
FILE: Services\Local\RecetteLocal.cs
================================================================================

Ôªøusing System;
using SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class RecetteLocal
    {
        [PrimaryKey]
        public string Id { get; set; } = ""; // Guid stock√© en texte

        public string Nom { get; set; } = "";
        public int TempsPreparation { get; set; }
        public string Instructions { get; set; } = "";
        public string CategorieDb { get; set; } = "";
        public int Type { get; set; } // enum -> int

        public RecetteLocal() { }

        public RecetteLocal(Recette r)
        {
            // adapte selon ton type r√©el :
            // si r.Id est Guid => r.Id.ToString()
            // si r.Id est string => r.Id
            // si r.Id est int => r.Id.ToString()
            Id = r.Id.ToString();

            Nom = r.Nom ?? "";
            TempsPreparation = r.TempsPreparation;
            Instructions = r.Instructions ?? "";
            CategorieDb = r.CategorieDb ?? "";
            Type = (int)r.Type;
        }

        public Recette ToModel()
        {
            // si Recette.Id est Guid, remets Guid.Parse
            // sinon adapte.
            Guid.TryParse(Id, out var guid);

            return new Recette
            {
                Id = guid,
                Nom = Nom,
                TempsPreparation = TempsPreparation,
                Instructions = Instructions,
                CategorieDb = CategorieDb,
                Type = (TypePlat)Type
            };
        }
    }
}

================================================================================
FILE: Services\OcrService.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text.Json;

namespace LoGeCuiMobile.Services
{
    public sealed class OcrService
    {
        private readonly HttpClient _http;
        private readonly string _apiKey;

        public OcrService(string apiKey)
        {
            _apiKey = apiKey ?? throw new ArgumentNullException(nameof(apiKey));
            _http = new HttpClient { Timeout = TimeSpan.FromSeconds(60) };
        }

        public async Task<string> ExtractTextFromImageAsync(byte[] imageBytes, string fileName = "scan.jpg")
        {
            if (imageBytes is null || imageBytes.Length == 0)
                throw new ArgumentException("Image vide.", nameof(imageBytes));

            if (string.IsNullOrWhiteSpace(_apiKey))
                throw new InvalidOperationException("Cl√© OCR manquante (apiKey).");

            var url = "https://api.ocr.space/parse/image";

            using var content = new MultipartFormDataContent();

            // Param√®tres utiles
            content.Add(new StringContent("fre"), "language");          // fre = fran√ßais
            content.Add(new StringContent("false"), "isOverlayRequired");
            content.Add(new StringContent("2"), "OCREngine");           // 1 ou 2 (2 souvent meilleur)
            content.Add(new StringContent("true"), "scale");
            content.Add(new StringContent("true"), "detectOrientation");

            var fileContent = new ByteArrayContent(imageBytes);
            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("image/jpeg");
            content.Add(fileContent, "file", fileName);

            using var request = new HttpRequestMessage(HttpMethod.Post, url);
            request.Headers.Add("apikey", _apiKey); // ‚úÖ endroit le plus fiable
            request.Content = content;

            using var resp = await _http.SendAsync(request);
            var json = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"OCR HTTP {(int)resp.StatusCode}: {json}");

            using var doc = JsonDocument.Parse(json);

            // Si l‚ÄôAPI retourne une erreur applicative
            if (doc.RootElement.TryGetProperty("IsErroredOnProcessing", out var errored)
                && errored.ValueKind == JsonValueKind.True)
            {
                string msg = "Erreur OCR.";
                if (doc.RootElement.TryGetProperty("ErrorMessage", out var em))
                {
                    // ErrorMessage peut √™tre string ou tableau selon les cas
                    msg = em.ValueKind switch
                    {
                        JsonValueKind.Array => string.Join(" | ", em.EnumerateArray().Select(x => x.ToString())),
                        _ => em.ToString()
                    };
                }
                throw new Exception(msg);
            }

            if (!doc.RootElement.TryGetProperty("ParsedResults", out var parsedResults)
                || parsedResults.ValueKind != JsonValueKind.Array
                || parsedResults.GetArrayLength() == 0)
            {
                return "";
            }

            var first = parsedResults[0];
            if (!first.TryGetProperty("ParsedText", out var parsedTextEl))
                return "";

            return parsedTextEl.GetString() ?? "";
        }
    }
}



================================================================================
FILE: Services\Skiasharp.cs
================================================================================

Ôªøusing SkiaSharp;

namespace LoGeCuiMobile.Services
{
    public static class ImageCompressionHelper
    {
        public static byte[] CompressJpeg(
            byte[] input,
            int maxWidth = 1600,
            int jpegQuality = 75)
        {
            using var inputStream = new SKMemoryStream(input);
            using var codec = SKCodec.Create(inputStream);
            using var bitmap = SKBitmap.Decode(codec);

            if (bitmap == null)
                throw new InvalidOperationException("Impossible de d√©coder l'image.");

            var width = bitmap.Width;
            var height = bitmap.Height;

            if (width > maxWidth)
            {
                var ratio = (float)maxWidth / width;
                var newW = maxWidth;
                var newH = (int)(height * ratio);

                using var resized = bitmap.Resize(
                    new SKImageInfo(newW, newH),
                    SKFilterQuality.Medium);

                using var image = SKImage.FromBitmap(resized);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
            else
            {
                using var image = SKImage.FromBitmap(bitmap);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
        }
    }
}


================================================================================
FILE: Services\SupabaseConfig.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public static class SupabaseConfig
    {
        public static string Url { get; } = ConfigurationHelper.GetSupabaseUrl();
        public static string Key { get; } = ConfigurationHelper.GetSupabaseKey();
    }
}

================================================================================
FILE: ViewModels\ArticleCourseUi.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    // Wrapper UI: on conserve ArticleCourse et on ajoute une s√©lection locale (non persist√©e)
    public class ArticleCourseUi : INotifyPropertyChanged
    {
        public ArticleCourseUi(ArticleCourse model) => Model = model;

        public ArticleCourse Model { get; }

        public int Id => Model.Id;

        public string Nom
        {
            get => Model.Nom;
            set { if (Model.Nom != value) { Model.Nom = value; OnPropertyChanged(); } }
        }

        public string Quantite
        {
            get => Model.Quantite;
            set { if (Model.Quantite != value) { Model.Quantite = value; OnPropertyChanged(); } }
        }

        public string Unite
        {
            get => Model.Unite;
            set { if (Model.Unite != value) { Model.Unite = value; OnPropertyChanged(); } }
        }

        public bool EstAchete
        {
            get => Model.EstAchete;
            set { if (Model.EstAchete != value) { Model.EstAchete = value; OnPropertyChanged(); } }
        }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set { if (_isSelectedForDelete != value) { _isSelectedForDelete = value; OnPropertyChanged(); } }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}


================================================================================
FILE: ViewModels\MesRecettesViewModel.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.ViewModels
{
    public enum AvailabilityState
    {
        Unknown,
        AllAvailable,
        Missing
    }

    // ‚úÖ UI wrapper (selection, couleurs, etc.)
    public class RecetteUi : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        public Recette Model { get; }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(IsSelectedForDelete)));
            }
        }

        private AvailabilityState _availabilityState = AvailabilityState.Unknown;
        public AvailabilityState AvailabilityState
        {
            get => _availabilityState;
            set
            {
                if (_availabilityState == value) return;
                _availabilityState = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityState)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        private int _missingCount;
        public int MissingCount
        {
            get => _missingCount;
            set
            {
                if (_missingCount == value) return;
                _missingCount = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(MissingCount)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        public string AvailabilityLabel =>
            AvailabilityState == AvailabilityState.Unknown ? "Disponibilit√© inconnue"
            : AvailabilityState == AvailabilityState.AllAvailable ? "‚úÖ Tous ingr√©dients disponibles"
            : $"‚ùå Manque {MissingCount} ingr√©dient(s)";

        public Guid Id => Model.Id;
        public string Nom => Model.Nom;
        public string TypeTexte => Model.TypeTexte;
        public int TempsPreparation => Model.TempsPreparation;
        public string DifficulteTexte => Model.DifficulteTexte;

        public RecetteUi(Recette r) => Model = r;
    }

    public class MesRecettesViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));

        private readonly RecipesService _recipesService;

        public ObservableCollection<RecetteUi> Recettes { get; } = new();

        public ObservableCollection<string> Categories { get; } =
            new() { "Toutes", "Entr√©es", "Plats", "Desserts" };

        private string _selectedCategorie = "Toutes";
        public string SelectedCategorie
        {
            get => _selectedCategorie;
            set
            {
                if (_selectedCategorie == value) return;
                _selectedCategorie = value;
                OnPropertyChanged(nameof(SelectedCategorie));
                ApplyFilter(); // ‚úÖ synchro
            }
        }

        public ICommand RefreshCommand { get; }

        private bool _isBusy;
        public bool IsBusy
        {
            get => _isBusy;
            private set
            {
                if (_isBusy == value) return;
                _isBusy = value;
                OnPropertyChanged(nameof(IsBusy));
            }
        }

        private List<Recette> _all = new();

        public MesRecettesViewModel(RecipesService recipesService)
        {
            _recipesService = recipesService;
            RefreshCommand = new Command(async () => await LoadAsync(forceRemote: true));
        }

        // ------------------ HELPERS erreurs Supabase ------------------

        private static bool IsJwtExpired(Exception ex)
        {
            // On d√©tecte "JWT expired" m√™me si c'est encapsul√© dans une exception
            var msg = ex.ToString();
            return msg.Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        private static bool IsNetworkRelated(Exception ex)
        {
            // Large: HttpRequestException, timeout, etc.
            // On fait simple: si on est online mais l'appel rate, on fallback cache.
            // (Si tu veux, on peut raffiner apr√®s.)
            var msg = ex.ToString();
            return msg.Contains("HttpRequestException", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timed out", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timeout", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("network", StringComparison.OrdinalIgnoreCase);
        }

        // ------------------ LOAD ------------------

        public async Task LoadAsync(bool forceRemote = false)
        {
            if (IsBusy) return;

            try
            {
                IsBusy = true;

                // 0) Cache local d‚Äôabord (offline friendly)
                var local = await App.LocalDb.GetRecettesAsync();
                _all = local.Select(x => x.ToModel()).ToList();

                // 1) Si internet + connect√© : refresh
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var app = (App)Microsoft.Maui.Controls.Application.Current;

                    if (app.IsConnected && app.CurrentUserId != null)
                    {
                        try
                        {
                            var remote = await _recipesService.GetRecettesAsync(app.CurrentUserId.Value)
                                         ?? new List<Recette>();

                            // Si forceRemote on remplace toujours
                            // Sinon: on remplace si remote non vide (√©vite d‚Äô√©craser cache avec vide)
                            if (forceRemote || remote.Count > 0)
                            {
                                _all = remote;
                                await App.LocalDb.SaveRecettesAsync(remote);
                            }
                        }
                        catch (Exception ex)
                        {
                            // ‚úÖ IMPORTANT : si JWT expir√©, on reste sur cache (ne pas crasher l'app)
                            if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                            {
                                // Optionnel: tu peux d√©clencher une UI "Reconnecte-toi"
                                // mais ici on reste silencieux pour que l'app d√©marre.
                            }
                            else
                            {
                                // Autres erreurs: on laisse remonter (ou tu peux aussi fallback)
                                throw;
                            }
                        }
                    }
                }

                ApplyFilter();
            }
            finally
            {
                IsBusy = false;
            }
        }

        private void ApplyFilter()
        {
            IEnumerable<Recette> filtered = _all;

            if (SelectedCategorie == "Entr√©es")
                filtered = _all.Where(r => r.Type == TypePlat.Entree);
            else if (SelectedCategorie == "Plats")
                filtered = _all.Where(r => r.Type == TypePlat.Plat);
            else if (SelectedCategorie == "Desserts")
                filtered = _all.Where(r => r.Type == TypePlat.Dessert);

            Recettes.Clear();
            foreach (var r in filtered)
                Recettes.Add(new RecetteUi(r));
        }

        // -------- Availability (vert/rouge) --------
        public async Task RefreshAvailabilityAsync()
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            // Offline => Unknown
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            try
            {
                var userId = app.CurrentUserId.Value;

                // 1) ingr√©dients dispo user
                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                // 2) pour chaque recette, calcule missing (‚ö†Ô∏è N requ√™tes - ok pour d√©marrer)
                foreach (var r in Recettes)
                {
                    var rows = await app.RecetteIngredientsService.GetForRecetteAsync(r.Model.Id);

                    var recipeNames = rows
                        .Select(x => Norm(x.nom))
                        .Where(s => !string.IsNullOrWhiteSpace(s))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    if (recipeNames.Count == 0)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                        continue;
                    }

                    var missing = recipeNames
                        .Where(n => !userSet.Contains(n))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    r.MissingCount = missing.Count;
                    r.AvailabilityState = (missing.Count == 0) ? AvailabilityState.AllAvailable : AvailabilityState.Missing;
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ si JWT expir√© => on met tout en Unknown et on sort
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                {
                    foreach (var r in Recettes)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                    }
                    return;
                }

                throw;
            }
        }

        // -------- Actions recette -> liste de courses --------
        public async Task<List<string>?> GetMissingIngredientsForRecipeAsync(Recette recette)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return null;

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
                return null;

            try
            {
                var userId = app.CurrentUserId.Value;

                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                var rows = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);
                var recipeNames = rows
                    .Select(x => (x.nom ?? "").Trim())
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                if (recipeNames.Count == 0)
                    return null;

                var missing = recipeNames
                    .Where(n => !userSet.Contains(Norm(n)))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                return missing;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return null;

                throw;
            }
        }

        public async Task<bool> SendMissingToShoppingAsync(List<string> missing)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return false;

            if (!app.IsConnected || app.CurrentUserId == null || app.ListeCoursesSupabaseService == null)
                return false;

            try
            {
                await app.ListeCoursesSupabaseService.AddMissingAsync(app.CurrentUserId.Value, missing);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return false;

                throw;
            }
        }

        // -------- Suppression --------
        public async Task DeleteSelectedAsync(List<RecetteUi> selected)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            // Optimistic UI
            foreach (var r in selected.ToList())
                Recettes.Remove(r);

            // Supabase si possible
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet && app.IsConnected && app.RecipesService != null)
            {
                try
                {
                    foreach (var r in selected)
                        await app.RecipesService.DeleteRecetteAsync(r.Model.Id);
                }
                catch (Exception ex)
                {
                    // si JWT expir√© => on ne peut pas supprimer c√¥t√© serveur.
                    // on reload depuis cache pour √™tre coh√©rent
                    if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                        throw;
                }
            }

            // Recharge (cache + remote si possible)
            await LoadAsync(forceRemote: true);

            // Refresh disponibilit√© (si possible)
            try
            {
                await RefreshAvailabilityAsync();
            }
            catch (Exception ex)
            {
                if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                    throw;
            }
        }

        public Task DeleteOneAsync(RecetteUi one)
            => DeleteSelectedAsync(new List<RecetteUi> { one });

        // -------- Helpers --------
        private static string Norm(string? s)
            => (s ?? "").Trim().ToLowerInvariant();
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterIngredientPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    x:Class="LoGeCuiMobile.Pages.AjouterIngredientPage"
    Title="{tr:Translate Ingredients_Add_Title}">

    <VerticalStackLayout Padding="20" Spacing="14">

        <Entry
            x:Name="NomEntry"
            Placeholder="{tr:Translate Ingredients_Add_NamePlaceholder}" />

        <Entry
            x:Name="QuantiteEntry"
            Placeholder="{tr:Translate Ingredients_Add_QuantityPlaceholder}"
            Keyboard="Numeric" />

        <Entry
            x:Name="UniteEntry"
            Placeholder="{tr:Translate Ingredients_Add_UnitPlaceholder}" />

        <HorizontalStackLayout Spacing="10">
            <CheckBox x:Name="DisponibleCheckBox" IsChecked="True"/>
            <Label Text="{tr:Translate Ingredients_Add_Available}"
                   VerticalTextAlignment="Center"/>
        </HorizontalStackLayout>

        <Button
            Text="{tr:Translate Ingredients_Add_Save}"
            BackgroundColor="#28a745"
            Clicked="OnSaveClicked"/>

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterIngredientPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.Pages;

public partial class AjouterIngredientPage : ContentPage
{
    public AjouterIngredientPage()
    {
        InitializeComponent();
    }

    private async void OnSaveClicked(object sender, EventArgs e)
    {
        try
        {
            if (string.IsNullOrWhiteSpace(NomEntry.Text))
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Ingredients_Add_NameRequired"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            var ingredient = new Ingredient
            {
                Nom = NomEntry.Text.Trim(),
                Quantite = QuantiteEntry.Text?.Trim() ?? "",
                Unite = UniteEntry.Text?.Trim() ?? "",
                EstDisponible = DisponibleCheckBox.IsChecked
            };

            // ‚úÖ 1) Toujours sauver dans le cache local (offline-first)
            await SaveIngredientToLocalCacheAsync(ingredient);

            // ‚úÖ 2) Si internet + connect√© => push Supabase
            var app = (App)Application.Current;

            var hasInternet = Connectivity.Current.NetworkAccess == NetworkAccess.Internet;

            if (hasInternet && app.IsConnected && app.IngredientsService != null && app.CurrentUserId != null)
            {
                await app.IngredientsService.CreateIngredientAsync(app.CurrentUserId.Value, ingredient);

            }

            // ‚úÖ Retour
            await Shell.Current.GoToAsync("..");
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private static async System.Threading.Tasks.Task SaveIngredientToLocalCacheAsync(Ingredient ingredient)
    {
        // R√©cup√®re cache local
        var local = await App.LocalDb.GetIngredientsAsync();
        var models = local.Select(x => x.ToModel()).ToList();

        // Evite doublon par Nom (tu peux adapter sur ExternalId si tu en as)
        bool exists = models.Any(x =>
            string.Equals(x.Nom?.Trim(), ingredient.Nom?.Trim(), StringComparison.OrdinalIgnoreCase));

        if (!exists)
            models.Add(ingredient);

        await App.LocalDb.SaveIngredientsAsync(models);
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterRecettePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.AjouterRecettePage"
             Title="{tr:Translate Recipes_Add_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="{tr:Translate Recipes_Add_NameLabel}" />
            <Entry x:Name="NomEntry"
                   Placeholder="{tr:Translate Recipes_Add_NamePlaceholder}" />

            <!-- PHOTO RECETTE -->
            <Label Text="Photo" />

            <Frame Padding="0"
                   CornerRadius="12"
                   HasShadow="False"
                   BorderColor="{AppThemeBinding Light=#DDD, Dark=#444}">
                <Grid RowDefinitions="180,Auto" ColumnDefinitions="*,*"
                      RowSpacing="10"
                      Padding="0">

                    <!-- Preview -->
                    <Image x:Name="PhotoImage"
                           Grid.Row="0" Grid.ColumnSpan="2"
                           Aspect="AspectFill"
                           HeightRequest="180" />

                    <!-- Actions -->
                    <Button Grid.Row="1" Grid.Column="0"
                            Text="Choisir une photo"
                            Clicked="OnPickPhotoClicked" />

                    <Button Grid.Row="1" Grid.Column="1"
                            Text="Prendre une photo"
                            Clicked="OnTakePhotoClicked" />
                </Grid>
            </Frame>

            <Button x:Name="RemovePhotoButton"
                    Text="Supprimer la photo"
                    IsVisible="False"
                    Clicked="OnRemovePhotoClicked" />

            <Label Text="{tr:Translate Recipes_Add_CategoryLabel}" />
            <Picker x:Name="CategoriePicker"
                    Title="{tr:Translate Recipes_Add_CategoryPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_TimeLabel}" />
            <Entry x:Name="TempsEntry"
                   Keyboard="Numeric"
                   Placeholder="{tr:Translate Recipes_Add_TimePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_IngredientsLabel}" />
            <Editor x:Name="IngredientsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="140"
                    Placeholder="{tr:Translate Recipes_Add_IngredientsPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_InstructionsLabel}" />
            <Editor x:Name="InstructionsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="180"
                    Placeholder="{tr:Translate Recipes_Add_InstructionsPlaceholder}" />

            <Button Text="{tr:Translate Recipes_Add_ScanOcr}"
                    Clicked="OnScanClicked" />

            <Button Text="{tr:Translate Recipes_Add_Save}"
                    Clicked="OnSaveClicked" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterRecettePage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Text.Json;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.Services;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiShared.Utils;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Media;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages
{
    public partial class AjouterRecettePage : ContentPage
    {
        private Recette? _editingRecette;
        private string? _photoLocalPath;

        private readonly SupabaseStorageService _storage = new SupabaseStorageService();

        // ‚úÖ HttpClient r√©utilis√© (√©vite ANR/sockets)
        private static readonly HttpClient _http = new HttpClient
        {
            Timeout = TimeSpan.FromSeconds(60)
        };

        public AjouterRecettePage(Recette? recette = null)
        {
            InitializeComponent();

            CategoriePicker.ItemsSource = new List<string> { "Entree", "Plat", "Dessert" };
            CategoriePicker.SelectedIndex = 1;

            _editingRecette = recette;

            if (_editingRecette != null)
            {
                Title = "Modifier recette";
                _ = LoadRecetteForEditAsync();
            }
            else
            {
                Title = "Ajouter recette";
                SetPhotoPreview(null);
            }
        }

        private async System.Threading.Tasks.Task LoadRecetteForEditAsync()
        {
            try
            {
                if (_editingRecette == null)
                    return;

                NomEntry.Text = _editingRecette.Nom;
                TempsEntry.Text = _editingRecette.TempsPreparation.ToString(CultureInfo.InvariantCulture);
                InstructionsEditor.Text = _editingRecette.Instructions ?? "";

                var cat = string.IsNullOrWhiteSpace(_editingRecette.CategorieDb) ? "Plat" : _editingRecette.CategorieDb.Trim();
                if (CategoriePicker.ItemsSource is List<string> cats && cats.Contains(cat))
                    CategoriePicker.SelectedItem = cat;
                else
                    CategoriePicker.SelectedItem = "Plat";

                // Photo : local d'abord, sinon URL
                if (!string.IsNullOrWhiteSpace(_editingRecette.PhotoLocalPath) && File.Exists(_editingRecette.PhotoLocalPath))
                {
                    _photoLocalPath = _editingRecette.PhotoLocalPath;
                    SetPhotoPreview(_photoLocalPath);
                }
                else if (!string.IsNullOrWhiteSpace(_editingRecette.PhotoUrl))
                {
                    _photoLocalPath = null;
                    PhotoImage.Source = ImageSource.FromUri(new Uri(_editingRecette.PhotoUrl));
                    RemovePhotoButton.IsVisible = true;
                }
                else
                {
                    _photoLocalPath = null;
                    SetPhotoPreview(null);
                }

                // Ingr√©dients (depuis Supabase)
                var app = (App)Application.Current;
                if (app.RecetteIngredientsService != null && _editingRecette.Id != Guid.Empty)
                {
                    var items = await app.RecetteIngredientsService.GetForRecetteAsync(_editingRecette.Id);

                    IngredientsEditor.Text = (items.Count == 0)
                        ? ""
                        : string.Join("\n", items.Select(x =>
                            string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                                ? x.nom
                                : $"{x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                        ));
                }
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        // ---------- PHOTO ----------
        private async void OnPickPhotoClicked(object sender, EventArgs e)
        {
            try
            {
                var path = await PickOrTakeAsync(takePhoto: false);
                if (path == null) return;

                _photoLocalPath = path;
                SetPhotoPreview(path);
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        private async void OnTakePhotoClicked(object sender, EventArgs e)
        {
            try
            {
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var path = await PickOrTakeAsync(takePhoto: true);
                if (path == null) return;

                _photoLocalPath = path;
                SetPhotoPreview(path);
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        private void OnRemovePhotoClicked(object sender, EventArgs e)
        {
            _photoLocalPath = null;

            if (_editingRecette != null)
            {
                _editingRecette.PhotoLocalPath = null;
                _editingRecette.PhotoUrl = null;
            }

            SetPhotoPreview(null);
        }

        private void SetPhotoPreview(string? path)
        {
            if (!string.IsNullOrWhiteSpace(path) && File.Exists(path))
            {
                PhotoImage.Source = ImageSource.FromFile(path);
                RemovePhotoButton.IsVisible = true;
            }
            else
            {
                PhotoImage.Source = null;
                RemovePhotoButton.IsVisible = false;
            }
        }

        private async System.Threading.Tasks.Task<string?> PickOrTakeAsync(bool takePhoto)
        {
            FileResult? result = takePhoto
                ? await MediaPicker.Default.CapturePhotoAsync()
                : await MediaPicker.Default.PickPhotoAsync();

            if (result == null) return null;

            var ext = Path.GetExtension(result.FileName);
            if (string.IsNullOrWhiteSpace(ext)) ext = ".jpg";

            var fileName = $"recipe_{DateTime.UtcNow:yyyyMMdd_HHmmss}{ext}";
            var destPath = Path.Combine(FileSystem.AppDataDirectory, fileName);

            await using var src = await result.OpenReadAsync();
            await using var dest = File.OpenWrite(destPath);
            await src.CopyToAsync(dest);

            return destPath;
        }

        // ‚úÖ UPDATE par ID (anti-duplicata)
        private static async System.Threading.Tasks.Task UpdateRecetteByIdAsync(
            string supabaseUrl,
            string supabaseKey,
            string accessToken,
            Guid recetteId,
            Guid userId,
            Recette recette)
        {
            supabaseUrl = supabaseUrl.TrimEnd('/');

            var url = $"{supabaseUrl}/rest/v1/recettes?id=eq.{recetteId}";

            using var req = new HttpRequestMessage(HttpMethod.Patch, url);
            req.Headers.Add("apikey", supabaseKey);
            req.Headers.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
            req.Headers.Add("Prefer", "return=representation");

            var payload = new
            {
                owner_user_id = userId,
                external_id = recette.ExternalId,
                nom = recette.Nom,
                categorie = recette.CategorieDb,
                temps_minutes = recette.TempsPreparation,
                note = recette.Difficulte,
                is_favorite = recette.IsFavorite,
                instructions = recette.Instructions,
                photo_url = recette.PhotoUrl
            };

            req.Content = new StringContent(JsonSerializer.Serialize(payload), Encoding.UTF8, "application/json");

            using var res = await _http.SendAsync(req);
            var body = await res.Content.ReadAsStringAsync();

            if (!res.IsSuccessStatusCode)
                throw new Exception($"Update recette failed ({(int)res.StatusCode}): {body}");
        }

        // ---------- SAVE ----------
        private async void OnSaveClicked(object sender, EventArgs e)
        {
            try
            {
                var app = (App)Application.Current;

                if (app.CurrentUserId == null || app.RecipesService == null)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_LoginRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (app.RecetteIngredientsService == null)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ServiceNotReady"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NameRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var userId = app.CurrentUserId.Value;
                var categorie = (CategoriePicker.SelectedItem as string) ?? "Plat";
                int temps = int.TryParse(TempsEntry.Text, out var t) ? t : 0;

                bool isEdit = (_editingRecette != null && _editingRecette.Id != Guid.Empty);

                var recette = _editingRecette ?? new Recette();

                // ‚úÖ ExternalId stable : seulement si nouveau
                if (string.IsNullOrWhiteSpace(recette.ExternalId))
                    recette.ExternalId = Guid.NewGuid().ToString("N");

                // ‚úÖ owner
                recette.OwnerUserId = userId;

                // ‚úÖ champs
                recette.Nom = NomEntry.Text.Trim();
                recette.CategorieDb = categorie;
                recette.TempsPreparation = temps;
                recette.Difficulte = 1;
                recette.Instructions = InstructionsEditor.Text ?? "";
                recette.IsFavorite = false;

                // photo locale
                recette.PhotoLocalPath = _photoLocalPath;

                // 1) Save recette (anti-duplicata)
                if (isEdit)
                {
                    if (string.IsNullOrWhiteSpace(app.CurrentAccessToken))
                    {
                        await DisplayAlert("Erreur", "Session invalide, reconnecte-toi.", "OK");
                        return;
                    }

                    recette.Id = _editingRecette!.Id;

                    await UpdateRecetteByIdAsync(
                        ConfigurationHelper.GetSupabaseUrl(),
                        ConfigurationHelper.GetSupabaseKey(),
                        app.CurrentAccessToken!,
                        recette.Id,
                        userId,
                        recette);
                }
                else
                {
                    // CREATE via upsert(external_id)
                    await app.RecipesService.UpsertRecetteAsync(userId, recette);
                }

                // 2) R√©cup√©rer l'ID DB
                Guid recetteId;
                if (isEdit)
                {
                    recetteId = _editingRecette!.Id;
                }
                else
                {
                    // ‚úÖ ta signature actuelle: (Guid userId, string externalId)
                    var rid = await app.RecipesService.GetRecetteIdByExternalIdAsync(userId, recette.ExternalId!);

                    if (rid == null)
                    {
                        await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                            LocalizationResourceManager.Instance["Recipes_Add_IdNotFound"],
                            LocalizationResourceManager.Instance["Dialog_Ok"]);
                        return;
                    }

                    recetteId = rid.Value;
                }

                // stabiliser
                recette.Id = recetteId;
                if (_editingRecette != null) _editingRecette.Id = recetteId;

                // 3) Upload photo + UPDATE photo_url (jamais upsert ici)
                if (!string.IsNullOrWhiteSpace(_photoLocalPath) && File.Exists(_photoLocalPath))
                {
                    if (string.IsNullOrWhiteSpace(app.CurrentAccessToken))
                    {
                        await DisplayAlert("Erreur", "Session invalide, reconnecte-toi.", "OK");
                        return;
                    }

                    var url = await _storage.UploadRecipePhotoAndGetPublicUrlAsync(
                        app.CurrentAccessToken!, userId, recetteId, _photoLocalPath);

                    recette.PhotoUrl = url;

                    await UpdateRecetteByIdAsync(
                        ConfigurationHelper.GetSupabaseUrl(),
                        ConfigurationHelper.GetSupabaseKey(),
                        app.CurrentAccessToken!,
                        recetteId,
                        userId,
                        recette);
                }

                // 4) Ingr√©dients (NORMALIS√âS)
                var items = ParseIngredientsEditorNormalized(IngredientsEditor.Text);

                await app.RecetteIngredientsService.ReplaceForRecetteAsync(recetteId, items);

                await DisplayAlert(LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_Saved"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]);

                await Navigation.PopAsync();
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex.ToString());
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        // ---------- INGREDIENTS PARSER (NORMALIS√â) ----------
        private static List<(string nom, string? quantite, string? unite)> ParseIngredientsEditorNormalized(string? text)
        {
            text ??= "";

            return text
                .Replace("\r\n", "\n")
                .Replace("\r", "\n")
                .Split('\n', StringSplitOptions.RemoveEmptyEntries)
                .Select(l => l.Trim())
                .Where(l => !string.IsNullOrWhiteSpace(l))
                .Select(ParseIngredientLineNormalized)
                .Where(x => !string.IsNullOrWhiteSpace(x.nom))
                .ToList();
        }

        private static (string nom, string? quantite, string? unite) ParseIngredientLineNormalized(string line)
        {
            // "Nom - Quantite Unite"
            var dashSplit = line.Split(" - ", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
            if (dashSplit.Length >= 2)
            {
                var nomPart = IngredientNormalizer.Normalize(dashSplit[0]); // ‚úÖ normalize
                var qtePart = dashSplit[1];

                var parts = qtePart.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                if (parts.Length >= 2)
                    return (nomPart, parts[0], string.Join(" ", parts.Skip(1)));

                return (nomPart, qtePart, null);
            }

            // "200 g Farine"
            var tokens = line.Split(' ', StringSplitOptions.RemoveEmptyEntries);
            if (tokens.Length >= 3 && char.IsDigit(tokens[0][0]))
            {
                var quantite = tokens[0];
                var unite = tokens[1];
                var nom = IngredientNormalizer.Normalize(string.Join(" ", tokens.Skip(2))); // ‚úÖ normalize
                return (nom, quantite, unite);
            }

            // Sinon : juste le nom
            return (IngredientNormalizer.Normalize(line), null, null); // ‚úÖ normalize
        }

        // ---------- OCR ----------
        private async void OnScanClicked(object sender, EventArgs e)
        {
            try
            {
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var photo = await MediaPicker.Default.CapturePhotoAsync(new MediaPickerOptions
                {
                    Title = LocalizationResourceManager.Instance["Recipes_Add_ScanTitle"]
                });

                if (photo == null)
                    return;

                byte[] bytes;
                using (var stream = await photo.OpenReadAsync())
                using (var ms = new MemoryStream())
                {
                    await stream.CopyToAsync(ms);
                    bytes = ms.ToArray();
                }

                bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1600, jpegQuality: 75);
                if (bytes.Length > 1024 * 1024)
                    bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1200, jpegQuality: 65);

                if (bytes.Length > 1024 * 1024)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var ocrKey = ConfigurationHelper.GetOcrApiKey();
                var ocr = new OcrService(ocrKey);

                var fullText = await ocr.ExtractTextFromImageAsync(bytes, photo.FileName);
                if (string.IsNullOrWhiteSpace(fullText))
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["OcrTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NoTextDetected"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                fullText = NormalizeOcrText(fullText);
                var (ingredients, instructions) = SplitRecipeText(fullText);

                if (!string.IsNullOrWhiteSpace(instructions))
                    InstructionsEditor.Text = instructions.Trim();

                if (!string.IsNullOrWhiteSpace(ingredients))
                    IngredientsEditor.Text = ingredients.Trim();

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    var title = GuessTitle(fullText);
                    if (!string.IsNullOrWhiteSpace(title))
                        NomEntry.Text = title;
                }

                await DisplayAlert(LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_OcrSuccess"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
            catch (Exception ex)
            {
                var msg = ex.Message ?? LocalizationResourceManager.Instance["UnknownError"];

                if (msg.Contains("File failed validation", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("maximum permissible file size", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("1024kb", StringComparison.OrdinalIgnoreCase))
                {
                    msg = LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"];
                }

                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], msg, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        // ---------- OCR HELPERS ----------
        private static string NormalizeOcrText(string s)
        {
            s = s.Replace("\r\n", "\n").Replace("\r", "\n");
            while (s.Contains("\n\n\n")) s = s.Replace("\n\n\n", "\n\n");
            return s.Trim();
        }

        private static (string ingredients, string instructions) SplitRecipeText(string text)
        {
            var lower = text.ToLowerInvariant();

            int idxIng = IndexOfAny(lower, "ingr√©dients", "ingredients");
            int idxPrep = IndexOfAny(lower, "pr√©paration", "preparation", "instructions", "r√©alisation", "realisation", "√©tapes", "etapes");

            if (idxIng >= 0 && idxPrep > idxIng)
            {
                var ingPart = text.Substring(idxIng, idxPrep - idxIng);
                var prepPart = text.Substring(idxPrep);

                ingPart = RemoveHeaderLine(ingPart);
                prepPart = RemoveHeaderLine(prepPart);

                return (CleanupListLike(ingPart), CleanupParagraph(prepPart));
            }

            if (idxPrep >= 0)
            {
                var before = text.Substring(0, idxPrep);
                var after = text.Substring(idxPrep);

                after = RemoveHeaderLine(after);
                return (CleanupListLike(before), CleanupParagraph(after));
            }

            var lines = text.Split('\n').Select(l => l.Trim()).Where(l => l.Length > 0).ToList();

            var ingLines = new List<string>();
            var instrLines = new List<string>();

            bool inInstructions = false;
            foreach (var line in lines)
            {
                if (!inInstructions && LooksLikeStep(line))
                    inInstructions = true;

                if (!inInstructions && LooksLikeIngredientLine(line))
                    ingLines.Add(line);
                else
                    instrLines.Add(line);
            }

            return (string.Join("\n", ingLines), string.Join("\n", instrLines));
        }

        private static int IndexOfAny(string haystack, params string[] needles)
        {
            int best = -1;
            foreach (var n in needles)
            {
                var i = haystack.IndexOf(n, StringComparison.OrdinalIgnoreCase);
                if (i >= 0 && (best < 0 || i < best)) best = i;
            }
            return best;
        }

        private static string RemoveHeaderLine(string block)
        {
            var lines = block.Replace("\r\n", "\n").Split('\n').ToList();
            if (lines.Count == 0) return block;
            lines.RemoveAt(0);
            return string.Join("\n", lines).Trim();
        }

        private static string CleanupListLike(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0)
                .Select(l => l.TrimStart('-', '‚Ä¢', '*', '‚Äì', '‚Äî', '¬∑', ' '))
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static string CleanupParagraph(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static bool LooksLikeIngredientLine(string line)
        {
            if (line.StartsWith("-") || line.StartsWith("‚Ä¢") || line.StartsWith("*")) return true;

            var l = line.ToLowerInvariant();
            string[] units = { " g", "kg", " ml", "cl", " l", "c√†s", "cas", "c√†c", "cac", "cuill√®re", "pinc√©e", "tranche", "sachet" };
            if (units.Any(u => l.Contains(u))) return true;

            if (char.IsDigit(line.FirstOrDefault())) return true;

            return false;
        }

        private static bool LooksLikeStep(string line)
        {
            var l = line.Trim();
            if (l.StartsWith("1)") || l.StartsWith("1.") ||
                l.StartsWith("√âtape", StringComparison.OrdinalIgnoreCase) ||
                l.StartsWith("Etape", StringComparison.OrdinalIgnoreCase))
                return true;

            if (l.Length >= 2 && char.IsDigit(l[0]) && (l[1] == ')' || l[1] == '.'))
                return true;

            return false;
        }

        private static string GuessTitle(string text)
        {
            var first = text.Split('\n').Select(l => l.Trim()).FirstOrDefault(l => l.Length > 0) ?? "";
            if (first.Length >= 3 && first.Length <= 50) return first;
            return "";
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\ListeCoursesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ListeCoursesPage"
             Title="{tr:Translate Shopping_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:BoolToStrikethroughConverter x:Key="BoolToStrikethroughConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Checkbox Tout s√©lectionner -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Label Grid.Row="0"
               Text="{tr:Translate Shopping_Header}"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10,0,10"/>

        <!-- Buttons -->
        <Grid Grid.Row="1" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Shopping_AddItem}"
                    BackgroundColor="#27AE60"
                    FontAttributes="Bold"
                    Clicked="BtnAjouter_Clicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelection"
                    Text="{tr:Translate Shopping_DeleteSelection}"
                    BackgroundColor="#E67E22"
                    FontAttributes="Bold"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="2"
                               Spacing="10"
                               Padding="4,6"
                               VerticalOptions="Center">
            <CheckBox x:Name="ChkToutSelectionner"
                      CheckedChanged="ChkToutSelectionner_CheckedChanged"/>
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray"/>
        </HorizontalStackLayout>

        <!-- Liste des courses -->
        <CollectionView Grid.Row="3"
                        x:Name="ListeCourses"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Shopping_Empty}"
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="6"
                           Padding="14"
                           BorderColor="#DDDDDD"
                           CornerRadius="12"
                           HasShadow="True"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}">

                        <VerticalStackLayout Spacing="8">

                            <!-- Nom -->
                            <Label Text="{Binding Nom}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextDecorations="{Binding EstAchete, Converter={StaticResource BoolToStrikethroughConverter}}"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                            <!-- Quantit√© -->
                            <Label FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Quantite}"/>
                                        <Span Text=" "/>
                                        <Span Text="{Binding Unite}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Actions -->
                            <HorizontalStackLayout Spacing="20">

                                <!-- Achet√© -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstAchete, Mode=TwoWay}"
                                              CheckedChanged="CheckBox_CheckedChanged"/>
                                    <Label Text="{tr:Translate Shopping_Bought}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                                <!-- S√©lection pour suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}"/>
                                    <Label Text="{tr:Translate Shopping_Delete}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\ListeCoursesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;
using LoGeCuiMobile.Models;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages
{
    public partial class ListeCoursesPage : ContentPage
    {
        private readonly ObservableCollection<ArticleCourseUi> _articles = new();
        private readonly ListeCoursesSupabaseService _svc;

        private bool _suppressSelectAllEvent;

        public ListeCoursesPage()
        {
            InitializeComponent();

            var app = (App)Application.Current;

            if (app.CurrentUserId == null)
                throw new InvalidOperationException("Utilisateur non connect√©.");

            _svc = app.ListeCoursesSupabaseService
                ?? throw new InvalidOperationException("ListeCoursesSupabaseService non initialis√©.");

            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private Guid? GetActiveListIdOrNull()
        {
            var app = (App)Application.Current;
            if (app.CurrentShoppingListId == null || app.CurrentShoppingListId == Guid.Empty)
                return null;

            return app.CurrentShoppingListId.Value;
        }

        private static ArticleCourse MapToModel(ListeCoursesSupabaseService.ArticleCourseRow row)
        {
            // si ton ArticleCourse.Id est int, on cast.
            // sinon change ArticleCourse.Id en long et supprime checked().
            int idInt = checked((int)row.id);

            return new ArticleCourse
            {
                Id = idInt,
                Nom = row.nom ?? "",
                Quantite = row.quantite,
                Unite = row.unite,
                EstAchete = row.est_achete,
                UserId = row.user_id
            };
        }

        private async void ChargerDonnees()
        {
            try
            {
                if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                {
                    await DisplayAlert("Info", "Pas d'internet : chargement impossible.", "OK");
                    return;
                }

                var app = (App)Application.Current;
                var userId = app.CurrentUserId!.Value;
                var listId = GetActiveListIdOrNull();

                var remote = await _svc.GetArticlesAsync(userId, listId);

                _articles.Clear();
                foreach (var row in remote)
                    _articles.Add(new ArticleCourseUi(MapToModel(row)));

                RefreshSelectAllCheckBox();
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Chargement impossible : {ex.Message}", "OK");
            }
        }

        private async void BtnAjouter_Clicked(object sender, EventArgs e)
        {
            string nom = await DisplayPromptAsync("Ajouter", "Nom de l'article :");
            if (string.IsNullOrWhiteSpace(nom))
                return;

            string quantite = await DisplayPromptAsync("Ajouter", "Quantit√© (optionnel) :");
            string unite = await DisplayPromptAsync("Ajouter", "Unit√© (optionnel) :");

            try
            {
                if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                {
                    await DisplayAlert("Info", "Pas d'internet : ajout impossible.", "OK");
                    return;
                }

                var app = (App)Application.Current;
                var userId = app.CurrentUserId!.Value;
                var listId = GetActiveListIdOrNull();

                var addedRow = await _svc.AddArticleAsync(
                    userId,
                    nom.Trim(),
                    string.IsNullOrWhiteSpace(quantite) ? null : quantite.Trim(),
                    string.IsNullOrWhiteSpace(unite) ? null : unite.Trim(),
                    listId
                );

                if (addedRow != null)
                {
                    _articles.Add(new ArticleCourseUi(MapToModel(addedRow)));
                    RefreshSelectAllCheckBox();
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Impossible d'ajouter : {ex.Message}", "OK");
            }
        }

        private async void CheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (sender is not CheckBox checkbox) return;
            if (checkbox.BindingContext is not ArticleCourseUi articleUi) return;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                await DisplayAlert("Info", "Pas d'internet : mise √† jour impossible.", "OK");
                checkbox.IsChecked = !e.Value;
                return;
            }

            checkbox.IsEnabled = false;
            try
            {
                await _svc.UpdateArticleAsync(articleUi.Id, e.Value);
                articleUi.Model.EstAchete = e.Value;
            }
            catch (Exception ex)
            {
                checkbox.IsChecked = !e.Value;
                articleUi.Model.EstAchete = !e.Value;
                await DisplayAlert("Erreur", $"Synchronisation √©chou√©e : {ex.Message}", "OK");
            }
            finally
            {
                checkbox.IsEnabled = true;
            }
        }

        private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
        {
            var selected = _articles.Where(a => a.IsSelectedForDelete).ToList();

            if (selected.Count == 0)
            {
                await DisplayAlert("Information", "Aucun article s√©lectionn√©.", "OK");
                return;
            }

            bool confirm = await DisplayAlert(
                "Confirmation",
                $"Supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Oui",
                "Non");

            if (!confirm)
                return;

            try
            {
                if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                {
                    await DisplayAlert("Info", "Pas d'internet : suppression impossible.", "OK");
                    return;
                }

                foreach (var articleUi in selected)
                    _articles.Remove(articleUi);

                RefreshSelectAllCheckBox();

                foreach (var articleUi in selected)
                    await _svc.DeleteArticleAsync(articleUi.Id);
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Suppression impossible : {ex.Message}", "OK");
                ChargerDonnees();
            }
        }

        private void ChkToutSelectionner_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (_suppressSelectAllEvent) return;

            foreach (var a in _articles)
                a.IsSelectedForDelete = e.Value;
        }

        private void RefreshSelectAllCheckBox()
        {
            if (ChkToutSelectionner == null) return;

            _suppressSelectAllEvent = true;
            try
            {
                if (_articles.Count == 0)
                {
                    ChkToutSelectionner.IsEnabled = false;
                    ChkToutSelectionner.IsChecked = false;
                    return;
                }

                ChkToutSelectionner.IsEnabled = true;
                ChkToutSelectionner.IsChecked = _articles.All(a => a.IsSelectedForDelete);
            }
            finally
            {
                _suppressSelectAllEvent = false;
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\MenuAleatoirePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.MenuAleatoirePage"
             Title="{tr:Translate RandomMenu_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Button
                Text="{tr:Translate RandomMenu_GenerateButton}"
                Clicked="OnMenuAleatoireClicked" />

            <Label
                x:Name="ResultLabel"
                Text="{tr:Translate RandomMenu_DefaultText}"
                FontSize="18"
                HorizontalTextAlignment="Center" />

            <!-- Bouton visible uniquement apr√®s g√©n√©ration si ingr√©dients manquants -->
            <Button x:Name="SendMissingButton"
                    Text="{tr:Translate RandomMenu_SendMissingToShopping}"
                    Clicked="OnSendMissingClicked"
                    HorizontalOptions="FillAndExpand"
                    IsVisible="False"
                    IsEnabled="False" />

            <Button
                Text="{tr:Translate RandomMenu_OpenShopping}"
                Clicked="OnOpenListeCoursesClicked"
                HorizontalOptions="FillAndExpand" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\MenuAleatoirePage.xaml.cs
================================================================================

Ôªøusing CommunityToolkit.Maui.Views;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace LoGeCuiMobile.Pages;

public partial class MenuAleatoirePage : ContentPage
{
    private static readonly Random _random = new();
    public record MenuOptionsResult(bool Entree, bool Plat, bool Dessert);


    private List<string> _lastMissing = new();
    private Guid? _lastUserId;
    private bool _lastIngredientsKnown = false;

    public MenuAleatoirePage()
    {
        InitializeComponent();

        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
    }

    // ------------------ UTIL ------------------

    private static string Norm(string s)
    {
        if (string.IsNullOrWhiteSpace(s))
            return "";

        var normalized = s.Trim().ToLowerInvariant().Normalize(NormalizationForm.FormD);
        var sb = new StringBuilder();

        foreach (var c in normalized)
            if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
                sb.Append(c);

        return sb.ToString();
    }

    private sealed class RecetteIngredientRow
    {
        public string? ingredient_nom { get; set; }
    }

    private async Task<List<string>> GetRecetteIngredientsAsync(App app, Guid recetteId)
    {
        if (app.RestClient == null)
            return new List<string>();

        // recette_ingredients(recette_id, ingredient_nom, quantite, unite)
        var q = $"recette_ingredients?select=ingredient_nom&recette_id=eq.{recetteId}";

        var rows = await app.RestClient.GetAsync<List<RecetteIngredientRow>>(q)
                   ?? new List<RecetteIngredientRow>();

        return rows
            .Select(r => r.ingredient_nom ?? "")
            .Select(s => s.Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private async Task<List<string>> GetUserIngredientsAsync(App app, Guid userId)
    {
        if (app.IngredientsService == null)
            return new List<string>();

        var rows = await app.IngredientsService.GetIngredientsAsync(userId)
                   ?? new List<Ingredient>();

        return rows
            .Where(i => i.EstDisponible)
            .Select(i => (i.Nom ?? "").Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private static Recette? PickRandom(List<Recette> list)
    {
        if (list == null || list.Count == 0) return null;
        return list[_random.Next(list.Count)];
    }

    // ------------------ EVENTS ------------------

    private async void OnMenuAleatoireClicked(object sender, EventArgs e)
    {
        try
        {
            // Choix initial : on d√©marre tout coch√©
            bool wantEntree = true;
            bool wantPlat = true;
            bool wantDessert = true;

            while (true)
            {
                string entreeTxt = wantEntree ? "‚úÖ Entr√©e" : "‚¨ú Entr√©e";
                string platTxt = wantPlat ? "‚úÖ Plat" : "‚¨ú Plat";
                string dessertTxt = wantDessert ? "‚úÖ Dessert" : "‚¨ú Dessert";

                var choice = await DisplayActionSheet(
                    "Choisis les cat√©gories",
                    "Annuler",
                    "G√©n√©rer",
                    entreeTxt,
                    platTxt,
                    dessertTxt
                );

                if (choice == "Annuler")
                    return;

                if (choice == "G√©n√©rer")
                {
                    if (!wantEntree && !wantPlat && !wantDessert)
                    {
                        await DisplayAlert("Info", "Coche au moins une cat√©gorie.", "OK");
                        continue;
                    }

                    var opts = new MenuOptionsResult(wantEntree, wantPlat, wantDessert);
                    await RunMenuAleatoireAsync(opts);
                    return;
                }

                if (choice == entreeTxt) wantEntree = !wantEntree;
                else if (choice == platTxt) wantPlat = !wantPlat;
                else if (choice == dessertTxt) wantDessert = !wantDessert;
            }
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }



    private async void OnOpenListeCoursesClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;
            if (app?.ListeCoursesSupabaseService == null)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["ServiceUnavailable"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            await Shell.Current.GoToAsync(nameof(ListeCoursesPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private async void OnSendMissingClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;

            if (app?.ListeCoursesSupabaseService == null || app.CurrentUserId == null)
                return;

            if (!_lastIngredientsKnown || _lastMissing.Count == 0)
                return;

            // ‚úÖ list_id obligatoire dans articles_courses
            var listId = app.CurrentShoppingListId;
            if (listId == null || listId.Value == Guid.Empty)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    "Aucune liste active. Cr√©e ou rejoins une liste avant d'envoyer les ingr√©dients.",
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            bool confirm = await DisplayAlert(
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmTitle"],
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmBody"] + "\n- " + string.Join("\n- ", _lastMissing),
                LocalizationResourceManager.Instance["Dialog_Yes"],
                LocalizationResourceManager.Instance["Dialog_No"]
            );

            if (!confirm)
                return;

            await app.ListeCoursesSupabaseService.AddMissingAsync(
                app.CurrentUserId.Value,
                _lastMissing,
                listId.Value); // ‚úÖ on passe list_id

            SendMissingButton.IsEnabled = false;
            SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SentButton"];
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }


    private Guid? GetActiveListIdOrNull()
    {
        var app = (App)Application.Current;
        if (app.CurrentShoppingListId == null || app.CurrentShoppingListId == Guid.Empty)
            return null;

        return app.CurrentShoppingListId.Value;
    }

    // ------------------ LOGIQUE ------------------

    private async Task RunMenuAleatoireAsync(MenuOptionsResult opts)
    {
        var app = Application.Current as App;
        if (app == null)
            return;

        // Reset UI
        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
        SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SendMissingToShopping"];
        _lastMissing = new List<string>();
        _lastIngredientsKnown = false;
        _lastUserId = app.CurrentUserId;

        if (app.CurrentUserId == null ||
            app.RestClient == null ||
            app.RecipesService == null ||
            app.IngredientsService == null ||
            app.ListeCoursesSupabaseService == null)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["LoginRequired"];
            return;
        }

        var userId = app.CurrentUserId.Value;
        ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_Generating"];

        // 1) Recettes utilisateur
        // (tu utilises GetMyRecettesAsync dans ton code : je le garde)
        var recettes = await app.RecipesService.GetMyRecettesAsync(app.CurrentUserId!.Value, null);



        if (recettes == null || recettes.Count == 0)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_NoRecipes"];
            return;
        }

        // 2) Listes par type (si l'option est coch√©e)
        var entrees = opts.Entree ? recettes.Where(r => r.Type == TypePlat.Entree).ToList() : new List<Recette>();
        var plats = opts.Plat ? recettes.Where(r => r.Type == TypePlat.Plat).ToList() : new List<Recette>();
        var desserts = opts.Dessert ? recettes.Where(r => r.Type == TypePlat.Dessert).ToList() : new List<Recette>();

        // 3) Tirage (uniquement si demand√©)
        var entree = opts.Entree ? PickRandom(entrees) : null;
        var plat = opts.Plat ? PickRandom(plats) : null;
        var dessert = opts.Dessert ? PickRandom(desserts) : null;

        // Si une cat√©gorie coch√©e n'a aucune recette
        if ((opts.Entree && entree == null) || (opts.Plat && plat == null) || (opts.Dessert && dessert == null))
        {
            var sbErr = new StringBuilder();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotGenerate"]);
            sbErr.AppendLine();

            if (opts.Entree && entree == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Entr√©e");
            if (opts.Plat && plat == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Plat");
            if (opts.Dessert && dessert == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Dessert");

            sbErr.AppendLine();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CheckCategories"]);

            ResultLabel.Text = sbErr.ToString();
            return;
        }

        // 4) Ingr√©dients utilisateur disponibles
        var userIngredients = await GetUserIngredientsAsync(app, userId);
        var userSet = userIngredients
            .Select(Norm)
            .Where(x => !string.IsNullOrWhiteSpace(x))
            .ToHashSet();

        // 5) Analyse d'une recette
        async Task<(List<string> ingredients, List<string> missing, bool hasData)> AnalyzeAsync(Recette r)
        {
            var ingredients = await GetRecetteIngredientsAsync(app, r.Id);
            var distinct = ingredients
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (distinct.Count == 0)
                return (distinct, new List<string>(), false);

            var missing = distinct
                .Where(i => !userSet.Contains(Norm(i)))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            return (distinct, missing, true);
        }

        // 6) Analyse seulement des recettes r√©ellement tir√©es
        var chosen = new List<Recette>();
        if (entree != null) chosen.Add(entree);
        if (plat != null) chosen.Add(plat);
        if (dessert != null) chosen.Add(dessert);

        var analyses = new Dictionary<Guid, (List<string> ingredients, List<string> missing, bool hasData)>();
        foreach (var r in chosen)
            analyses[r.Id] = await AnalyzeAsync(r);

        // 7) Agr√©gation manquants (uniquement si on a des donn√©es pour toutes les recettes choisies)
        var allHaveData = chosen.All(r => analyses[r.Id].hasData);

        if (allHaveData)
        {
            _lastMissing = chosen
                .SelectMany(r => analyses[r.Id].missing)
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            _lastIngredientsKnown = true;
        }
        else
        {
            _lastMissing = new List<string>();
            _lastIngredientsKnown = false;
        }

        // 8) UI texte
        var sb = new StringBuilder();

        sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GeneratedHeader"]);

        if (entree != null) sb.AppendLine($"- {entree.TypeTexte} : {entree.Nom}");
        if (plat != null) sb.AppendLine($"- {plat.TypeTexte} : {plat.Nom}");
        if (dessert != null) sb.AppendLine($"- {dessert.TypeTexte} : {dessert.Nom}");
        sb.AppendLine();

        void AppendRecetteBlock(Recette r)
        {
            var a = analyses[r.Id];

            sb.AppendLine($"{r.TypeTexte} ‚Äî {r.Nom}");

            if (!a.hasData)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_NoIngredientsForRecipe"]);
                sb.AppendLine();
                return;
            }

            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_IngredientsHeader"]);
            foreach (var i in a.ingredients)
                sb.AppendLine("- " + i);

            if (a.missing.Count == 0)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingNone"]);
            }
            else
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingHeader"]);
                foreach (var m in a.missing)
                    sb.AppendLine("- " + m);
            }

            sb.AppendLine();
        }

        foreach (var r in chosen)
            AppendRecetteBlock(r);

        // 9) Bouton ‚Äúenvoyer manquants‚Äù
        if (!allHaveData)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotComputeMissing"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else if (_lastMissing.Count == 0)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_AllAvailable"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GlobalMissingHeader"]);
            foreach (var m in _lastMissing)
                sb.AppendLine("- " + m);

            SendMissingButton.IsVisible = true;
            SendMissingButton.IsEnabled = true;
        }

        ResultLabel.Text = sb.ToString();
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\MesIngredientsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
    x:Class="LoGeCuiMobile.Pages.MesIngredientsPage"
    Title="{tr:Translate Ingredients_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:QuantityFormatConverter x:Key="QuantityFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="16" RowDefinitions="Auto,Auto,*" RowSpacing="12">

        <!-- Boutons -->
        <Grid Grid.Row="0" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Ingredients_AddButton}"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    Clicked="OnAddIngredientClicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelectionIngredients"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="OnDeleteSelectedIngredientsClicked" />
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Padding="4,0">
            <CheckBox x:Name="ChkToutSelectionnerIngredients"
                      CheckedChanged="ChkToutSelectionnerIngredients_CheckedChanged" />
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray" />
        </HorizontalStackLayout>

        <!-- Liste -->
        <CollectionView Grid.Row="2"
                        x:Name="IngredientsCollection"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="Aucun ingr√©dient."
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12"
                           Margin="0,4"
                           BorderColor="#ddd"
                           CornerRadius="10">

                        <Grid ColumnDefinitions="*,Auto">

                            <VerticalStackLayout Spacing="6">

                                <Label Text="{Binding Nom}"
                                       FontSize="18"
                                       FontAttributes="Bold" />

                                <Label FontSize="14" TextColor="Gray">
                                    <Label.Text>
                                        <MultiBinding Converter="{StaticResource QuantityFormatConverter}">
                                            <Binding Path="Quantite"/>
                                            <Binding Path="Unite"/>
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>

                                <!-- Disponible -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstDisponible}"
                                                CheckedChanged="OnDisponibleChanged" />
                                    <Label Text="{tr:Translate Ingredients_Available}"
                                           VerticalTextAlignment="Center"/>
                                </HorizontalStackLayout>

                                <!-- S√©lection suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}" />
                                    <Label Text="Supprimer"
                                           VerticalTextAlignment="Center"
                                           TextColor="Gray"/>
                                </HorizontalStackLayout>

                            </VerticalStackLayout>

                            <!-- Supprimer item -->
                            <Button Grid.Column="1"
                                    Text="üóë"
                                    BackgroundColor="#e74c3c"
                                    Clicked="OnDeleteIngredientClicked" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\MesIngredientsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Models;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Networking;


namespace LoGeCuiMobile.Pages;

public partial class MesIngredientsPage : ContentPage
{
    private readonly ObservableCollection<IngredientUi> _ingredients = new();

    private bool _isLoading;
    private bool _suppressSelectAllEvent;

    public MesIngredientsPage()
    {
        InitializeComponent();
        IngredientsCollection.ItemsSource = _ingredients;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();
        await LoadIngredientsAsync();
    }

    private async Task LoadIngredientsAsync()
    {
        if (_isLoading) return;

        try
        {
            _isLoading = true;

            // 0) Toujours tenter d'afficher le cache local en premier (offline-friendly)
            var local = await App.LocalDb.GetIngredientsAsync();
            _ingredients.Clear();
            foreach (var li in local)
                _ingredients.Add(new IngredientUi(li.ToModel()));

            RefreshSelectAllCheckBox();

            // 1) Si pas connect√© (session) -> on s'arr√™te apr√®s le cache
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            // 2) Si pas internet -> on s'arr√™te apr√®s le cache
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return;

            var userId = app.CurrentUserId.Value;

            // 3) Refresh depuis Supabase
            var remote = await app.IngredientsService.GetIngredientsAsync(userId);

            // 4) Mettre √† jour l'UI avec remote
            _ingredients.Clear();
            foreach (var ing in remote)
                _ingredients.Add(new IngredientUi(ing));

            // 5) Sauver remote dans SQLite
            await App.LocalDb.SaveIngredientsAsync(remote);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        finally
        {
            _isLoading = false;
        }
    }


    private async void OnAddIngredientClicked(object sender, EventArgs e)
    {
        try
        {
            await Shell.Current.GoToAsync(nameof(AjouterIngredientPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // Suppression d'un seul ingr√©dient via l'ic√¥ne üóë
    private async void OnDeleteIngredientClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        if (sender is not Button btn || btn.BindingContext is not IngredientUi ingredientUi)
            return;

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"{LocalizationResourceManager.Instance["Dialog_DeleteConfirm"]}\n{ingredientUi.Nom}",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            _ingredients.Remove(ingredientUi);

            if (ingredientUi.Id != Guid.Empty)
                await app.IngredientsService.DeleteIngredientAsync(ingredientUi.Id);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Checkbox "Tout s√©lectionner" (s√©lection suppression)
    private void ChkToutSelectionnerIngredients_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_suppressSelectAllEvent) return;

        foreach (var ing in _ingredients)
            ing.IsSelectedForDelete = e.Value;
    }

    private void RefreshSelectAllCheckBox()
    {
        if (ChkToutSelectionnerIngredients == null) return;

        _suppressSelectAllEvent = true;
        try
        {
            if (_ingredients.Count == 0)
            {
                ChkToutSelectionnerIngredients.IsEnabled = false;
                ChkToutSelectionnerIngredients.IsChecked = false;
                return;
            }

            ChkToutSelectionnerIngredients.IsEnabled = true;
            ChkToutSelectionnerIngredients.IsChecked = _ingredients.All(i => i.IsSelectedForDelete);
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    // Supprimer s√©lection
    private async void OnDeleteSelectedIngredientsClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        var selected = _ingredients.Where(i => i.IsSelectedForDelete).ToList();

        if (selected.Count == 0)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                "Aucun ingr√©dient s√©lectionn√©.",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"Supprimer {selected.Count} ingr√©dient(s) s√©lectionn√©(s) ?",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            foreach (var ingUi in selected)
            {
                if (ingUi.Id != Guid.Empty)
                    await app.IngredientsService.DeleteIngredientAsync(ingUi.Id);

                _ingredients.Remove(ingUi);
            }

            RefreshSelectAllCheckBox();

            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                $"{selected.Count} ingr√©dient(s) supprim√©(s).",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Mise √† jour "Disponible" -> synchro Supabase (si tu as une m√©thode UpdateIngredientAsync)
    private async void OnDisponibleChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_isLoading) return;

        if (sender is not CheckBox cb || cb.BindingContext is not IngredientUi ingUi)
            return;

        try
        {
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null)
                return;

            // Ici il faut une m√©thode d'update dans IngredientsService.
            // Si tu l'as d√©j√† : await app.IngredientsService.UpdateIngredientAsync(ingUi.Model.Id, ingUi.Model);
            // Sinon : on ne fait rien (l'UI reste locale). Dis-moi et je te donne l'impl√©mentation c√¥t√© service.
        }
        catch
        {
            // Optionnel : rollback si update √©choue
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\MesRecettesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="LoGeCuiMobile.Pages.MesRecettesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:vm="clr-namespace:LoGeCuiMobile.ViewModels"
    Title="{tr:Translate Recipes_Title}">

    <Grid Padding="12" RowDefinitions="Auto,Auto,*" RowSpacing="10">

        <!-- ====== FILTRES + ACTIONS HAUT ====== -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">

            <Picker Title="{tr:Translate Recipes_Category}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategorie}" />

            <HorizontalStackLayout Spacing="10">
                <Button Text="{tr:Translate Recipes_Refresh}"
                        Command="{Binding RefreshCommand}"
                        HorizontalOptions="StartAndExpand" />

                <Button Text="{tr:Translate Recipes_Add}"
                        Clicked="OnAjouterRecetteClicked"
                        HorizontalOptions="EndAndExpand" />
            </HorizontalStackLayout>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}" />

        </VerticalStackLayout>

        <!-- ====== LIGNE S√âLECTION MULTIPLE ====== -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" VerticalOptions="Center">

            <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">
                <CheckBox x:Name="ChkToutSelectionnerRecettes"
                          CheckedChanged="ChkToutSelectionnerRecettes_CheckedChanged"/>
                <Label Text="Tout s√©lectionner"
                       VerticalTextAlignment="Center"
                       TextColor="Gray"/>
            </HorizontalStackLayout>

            <Label Grid.Column="1"
                   x:Name="SelectionInfoLabel"
                   Text=""
                   TextColor="Gray"
                   VerticalTextAlignment="Center"/>

            <Button Grid.Column="2"
                    x:Name="BtnSupprimerSelection"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- ====== LISTE DES RECETTES ====== -->
        <CollectionView Grid.Row="2"
                        x:Name="RecettesCollection"
                        ItemsSource="{Binding Recettes}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Recipes_Empty}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       Margin="0,30,0,0" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10"
                           Margin="0,6"
                           HasShadow="False">

                        <!-- üî¥üü¢ Couleur bordure selon disponibilit√© -->
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Unknown}">
                                <Setter Property="BorderColor" Value="#B0B0B0"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.AllAvailable}">
                                <Setter Property="BorderColor" Value="#27AE60"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Missing}">
                                <Setter Property="BorderColor" Value="#E74C3C"/>
                            </DataTrigger>
                        </Frame.Triggers>

                        <!-- ‚úÖ Ajout d'une colonne pour la photo -->
                        <Grid ColumnDefinitions="Auto,Auto,*,Auto"
                              RowDefinitions="Auto,Auto"
                              ColumnSpacing="10">

                            <!-- Checkbox suppression multiple -->
                            <CheckBox Grid.Column="0"
                                      Grid.RowSpan="2"
                                      IsChecked="{Binding IsSelectedForDelete}"
                                      CheckedChanged="RecetteDeleteCheckBox_CheckedChanged"
                                      VerticalOptions="Center" />

                            <!-- ‚úÖ Photo miniature -->
                            <Frame Grid.Column="1"
                                       Grid.RowSpan="2"
                                       WidthRequest="44"
                                       HeightRequest="44"
                                       CornerRadius="22"
                                       Padding="0"
                                       HasShadow="False"
                                       IsClippedToBounds="True"
                                       BorderColor="#DDDDDD"
                                       BackgroundColor="#F2F2F2"
                                       VerticalOptions="Center"
                                       IsVisible="{Binding HasPhoto}">
                                                                <Image Source="{Binding PhotoSource}"
                                           WidthRequest="44"
                                           HeightRequest="44"
                                           Aspect="AspectFill" />
                            </Frame>

                            <!-- Zone infos recette (tap = d√©tails) -->
                            <Grid Grid.Column="2" Grid.RowSpan="2">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRecetteTapped"
                                                          CommandParameter="{Binding Model}" />
                                </Grid.GestureRecognizers>

                                <VerticalStackLayout Spacing="4">

                                    <Label Text="{Binding Nom}"
                                           FontSize="18"
                                           FontAttributes="Bold" />

                                    <Label Text="{Binding TypeTexte}" />

                                    <Label Text="{Binding TempsPreparation, StringFormat='{tr:Translate Recipes_TimeFormat}'}" />

                                    <Label Text="{Binding DifficulteTexte}" />

                                    <Label Text="{Binding AvailabilityLabel}"
                                           FontSize="12"
                                           TextColor="Gray"/>

                                </VerticalStackLayout>
                            </Grid>

                            <!-- Boutons actions -->
                            <HorizontalStackLayout Grid.Column="3" Grid.RowSpan="2"
                                                   Spacing="8"
                                                   VerticalOptions="Center">

                                <Button Text="üõí"
                                        BackgroundColor="#3498DB"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnAjouterManquants_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <Button Text="üóë"
                                        BackgroundColor="#e74c3c"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnSupprimerRecette_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <Button Text="‚úèÔ∏è"
                                        BackgroundColor="#F1C40F"
                                        TextColor="Black"
                                        Padding="8"
                                        Clicked="BtnModifierRecette_Clicked"
                                        CommandParameter="{Binding Model}"/>

                            </HorizontalStackLayout>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\MesRecettesPage.xaml.cs
================================================================================

Ôªøusing System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.ViewModels;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Pages;

public partial class MesRecettesPage : ContentPage
{
    private MesRecettesViewModel? _vm;
    private bool _suppressSelectAllEvent;

    public MesRecettesPage()
    {
        InitializeComponent();

        var app = (App)Application.Current;

        if (app.RecipesService == null)
        {
            MainThread.BeginInvokeOnMainThread(async () =>
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Recipes_ServiceNull"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                ));

            return;
        }

        _vm = new MesRecettesViewModel(app.RecipesService);
        BindingContext = _vm;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        if (_vm == null)
            return;

        // ‚úÖ UN SEUL chargement propre
        await _vm.LoadAsync(forceRemote: true);

        // ‚úÖ Puis recalcul des ingr√©dients dispo ‚Üí bordures vert/rouge
        await _vm.RefreshAvailabilityAsync();

        RefreshSelectionUi();
    }

    private async void OnAjouterRecetteClicked(object sender, EventArgs e)
    {
        await Navigation.PushAsync(new AjouterRecettePage());
    }

    // ---------------- TAP RECETTE ----------------
    private async void OnRecetteTapped(object sender, TappedEventArgs e)
    {
        Recette? recette = e.Parameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        var app = (App)Application.Current;

        if (app.RecetteIngredientsService == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Recipes_IngredientsServiceNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var items = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

        var ingredientsText = (items.Count == 0)
            ? LocalizationResourceManager.Instance["Recipes_NoIngredients"]
            : string.Join("\n", items.Select(x =>
                string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                    ? $"‚Ä¢ {x.nom}"
                    : $"‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
            ));

        var details = string.Format(
            LocalizationResourceManager.Instance["Recipes_DetailsFormat"],
            recette.CategorieDb,
            recette.TempsPreparation,
            ingredientsText,
            recette.Instructions ?? ""
        );

        await DisplayAlert(recette.Nom, details, LocalizationResourceManager.Instance["Dialog_Ok"]);
    }

    // ---------------- SELECTION MULTIPLE ----------------

    private void ChkToutSelectionnerRecettes_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_vm == null || _suppressSelectAllEvent) return;

        foreach (var r in _vm.Recettes)
            r.IsSelectedForDelete = e.Value;

        RefreshSelectionUi();
    }

    private void RecetteDeleteCheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        RefreshSelectionUi();
    }

    private void RefreshSelectionUi()
    {
        if (_vm == null) return;

        var selectedCount = _vm.Recettes.Count(x => x.IsSelectedForDelete);

        if (SelectionInfoLabel != null)
            SelectionInfoLabel.Text = selectedCount == 0 ? "" : $"{selectedCount} s√©lectionn√©(s)";

        _suppressSelectAllEvent = true;
        try
        {
            if (ChkToutSelectionnerRecettes != null)
            {
                if (_vm.Recettes.Count == 0)
                {
                    ChkToutSelectionnerRecettes.IsEnabled = false;
                    ChkToutSelectionnerRecettes.IsChecked = false;
                }
                else
                {
                    ChkToutSelectionnerRecettes.IsEnabled = true;
                    ChkToutSelectionnerRecettes.IsChecked = _vm.Recettes.All(x => x.IsSelectedForDelete);
                }
            }
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        var selected = _vm.Recettes.Where(r => r.IsSelectedForDelete).ToList();
        if (selected.Count == 0)
        {
            await DisplayAlert("Info", "Aucune recette s√©lectionn√©e.", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer {selected.Count} recette(s) s√©lectionn√©e(s) ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteSelectedAsync(selected);
        RefreshSelectionUi();
    }

    private async void BtnSupprimerRecette_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer '{recetteUi.Nom}' ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteOneAsync(recetteUi);
        RefreshSelectionUi();
    }

    // ---------------- MODIFIER ----------------

    private async void BtnModifierRecette_Clicked(object sender, EventArgs e)
    {
        if (sender is not Button btn) return;

        Recette? recette = btn.CommandParameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null) return;

        await Navigation.PushAsync(new AjouterRecettePage(recette));
    }

    // ---------------- AJOUTER MANQUANTS ----------------

    private async void BtnAjouterManquants_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        var missing = await _vm.GetMissingIngredientsForRecipeAsync(recetteUi.Model);
        if (missing == null)
        {
            await DisplayAlert("Info", "Impossible de calculer les ingr√©dients (offline ou donn√©es manquantes).", "OK");
            return;
        }

        if (missing.Count == 0)
        {
            await DisplayAlert("Info", "Tu as d√©j√† tous les ingr√©dients pour cette recette ‚úÖ", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Ajouter √† la liste",
            "Ajouter ces ingr√©dients manquants ?\n- " + string.Join("\n- ", missing),
            "Oui",
            "Non");

        if (!confirm) return;

        var ok = await _vm.SendMissingToShoppingAsync(missing);

        if (ok)
            await DisplayAlert("Succ√®s", $"{missing.Count} ingr√©dient(s) ajout√©(s) √† la liste de courses.", "OK");
        else
            await DisplayAlert("Erreur", "Impossible d‚Äôajouter √† la liste de courses.", "OK");
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\ResetPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ResetPasswordPage"
             Title="{tr:Translate Reset_Title}">

    <VerticalStackLayout Padding="24" Spacing="12">

        <Label Text="{tr:Translate Reset_Header}"
               FontSize="20"
               FontAttributes="Bold" />

        <Entry x:Name="Pwd1"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_NewPassword}" />

        <Entry x:Name="Pwd2"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_ConfirmPassword}" />

        <Button Text="{tr:Translate Reset_Submit}"
                Clicked="OnSubmit" />

        <Label x:Name="Msg" />

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\ResetPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages;

public partial class ResetPasswordPage : ContentPage
{
    private readonly string _accessToken;
    private readonly SupabaseService _supabase;

    public ResetPasswordPage(string accessToken)
    {
        InitializeComponent();
        _accessToken = accessToken;

        string url = ConfigurationHelper.GetSupabaseUrl();
        string key = ConfigurationHelper.GetSupabaseKey();
        _supabase = new SupabaseService(url, key);
    }

    private async void OnSubmit(object sender, EventArgs e)
    {
        var p1 = Pwd1.Text ?? "";
        var p2 = Pwd2.Text ?? "";

        if (string.IsNullOrWhiteSpace(p1) || p1.Length < 6)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMinLength"];
            Msg.TextColor = Colors.Red;
            return;
        }

        if (p1 != p2)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMismatch"];
            Msg.TextColor = Colors.Red;
            return;
        }

        Msg.Text = LocalizationResourceManager.Instance["Reset_Updating"];
        Msg.TextColor = Colors.Blue;

        var (success, error) = await _supabase.UpdatePasswordAsync(_accessToken, p1);

        if (success)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Reset_DoneTitle"],
                LocalizationResourceManager.Instance["Reset_DoneBody"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await Navigation.PopToRootAsync();
        }
        else
        {
            Msg.Text = string.IsNullOrWhiteSpace(error)
                ? LocalizationResourceManager.Instance["Reset_Failed"]
                : error;

            Msg.TextColor = Colors.Red;
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\SettingsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.SettingsPage"
             Title="{tr:Translate Settings_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- ========================= -->
            <!-- PARTAGE LISTE DE COURSES  -->
            <!-- ========================= -->
            <Label Text="Liste de courses partag√©e"
                   FontSize="18"
                   FontAttributes="Bold" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="10">

                    <Label Text="Liste active :"
                           FontAttributes="Bold" />

                    <Label x:Name="LblActiveList"
                           Text="(aucune)"
                           TextColor="Gray" />

                    <Label Text="Code de partage :"
                           FontAttributes="Bold"
                           Margin="0,6,0,0"/>

                    <Label x:Name="LblShareCode"
                           Text="(aucun)"
                           TextColor="Gray" />

                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Cr√©er/voir mon code"
                                Clicked="OnCreateOrShowMyCodeClicked"
                                HorizontalOptions="FillAndExpand"/>

                        <Button Text="Copier"
                                Clicked="OnCopyCodeClicked"
                                HorizontalOptions="End"/>
                    </HorizontalStackLayout>

                    <Button Text="Rejoindre avec un code"
                            Clicked="OnJoinWithCodeClicked" />

                    <Button Text="Choisir une liste active"
                            Clicked="OnPickActiveListClicked" />

                    <Button Text="Revenir √† ma liste perso"
                            BackgroundColor="#E67E22"
                            TextColor="White"
                            Clicked="OnDisableSharedListClicked" />

                </VerticalStackLayout>
            </Frame>

            <!-- ========================= -->
            <!-- COMPTE                    -->
            <!-- ========================= -->
            <Label Text="{tr:Translate Settings_Account}"
                   FontSize="18"
                   FontAttributes="Bold"
                   Margin="0,10,0,0" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">

                    <Button Text="{tr:Translate Settings_Logout}"
                            BackgroundColor="#34495E"
                            TextColor="White"
                            FontAttributes="Bold"
                            Clicked="OnLogoutClicked" />

                    <Label Text="{tr:Translate Settings_DangerZone}"
                           FontSize="14"
                           TextColor="Gray"
                           Margin="0,6,0,0" />

                    <Button Text="{tr:Translate Settings_Unsubscribe}"
                            BackgroundColor="IndianRed"
                            TextColor="White"
                            FontAttributes="Bold"
                            Clicked="OnDesinscriptionClicked" />

                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\SettingsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages;

public partial class SettingsPage : ContentPage
{
    private const string ListsTable = "shopping_lists";
    private const string MembersTable = "shopping_list_members";

    // RPC recommand√©e (SECURITY DEFINER)
    private const string JoinRpc = "join_shopping_list";

    public SettingsPage()
    {
        InitializeComponent();
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        try
        {
            await RefreshSharingUiAsync();
        }
        catch (Exception ex)
        {
            // IMPORTANT : √©vite crash dans OnAppearing
            await DisplayAlert("Erreur", ex.Message, "OK");
        }
    }

    // =========================
    // UI actions (partage)
    // =========================

    private async void OnCreateOrShowMyCodeClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            if (app.CurrentUserId == null || app.RestClient == null)
            {
                await DisplayAlert("Erreur", "Tu dois √™tre connect√©.", "OK");
                return;
            }

            // 1) Cr√©e ou r√©cup√®re la liste dont je suis owner
            var myList = await GetOrCreateMyOwnedListAsync(app.CurrentUserId.Value);

            // 2) Active la liste
            app.SetCurrentShoppingListId(myList.id);

            await RefreshSharingUiAsync();

            await DisplayAlert("OK", $"Ton code de partage : {myList.share_code}", "OK");
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnCopyCodeClicked(object sender, EventArgs e)
    {
        try
        {
            var code = LblShareCode?.Text?.Trim();

            if (string.IsNullOrWhiteSpace(code) || code == "(aucun)")
            {
                await DisplayAlert("Info", "Aucun code √† copier.", "OK");
                return;
            }

            await Clipboard.SetTextAsync(code);
            await DisplayAlert("OK", "Code copi√© ‚úÖ", "OK");
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnJoinWithCodeClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            if (app.CurrentUserId == null || app.RestClient == null || !app.IsConnected)
            {
                await DisplayAlert("Erreur", "Tu dois √™tre connect√© pour rejoindre une liste.", "OK");
                return;
            }

            var code = await DisplayPromptAsync("Rejoindre une liste", "Entre le code de partage :");
            if (string.IsNullOrWhiteSpace(code))
                return;

            code = code.Trim();

            // ‚úÖ JOIN via RPC (recommand√© avec RLS)
            var joined = await JoinByCodeViaRpcAsync(code);

            if (joined == null)
            {
                await DisplayAlert("Erreur", "Code invalide (liste introuvable).", "OK");
                return;
            }

            app.SetCurrentShoppingListId(joined.Value.listId);

            await RefreshSharingUiAsync();

            await DisplayAlert("Succ√®s", $"Tu as rejoint la liste : {joined.Value.name}", "OK");
        }
        catch (Exception ex)
        {
            // ‚úÖ Affiche l'erreur r√©elle (au lieu de javaProxyThrowable)
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnPickActiveListClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            if (app.CurrentUserId == null || app.RestClient == null)
            {
                await DisplayAlert("Erreur", "Tu dois √™tre connect√©.", "OK");
                return;
            }

            var lists = await GetMyAccessibleListsAsync(app.CurrentUserId.Value);

            if (lists.Count == 0)
            {
                await DisplayAlert("Info", "Tu n‚Äôas aucune liste partag√©e.", "OK");
                return;
            }

            var labels = lists
                .Select(l => $"{(string.IsNullOrWhiteSpace(l.name) ? "Liste partag√©e" : l.name)}  ({l.share_code})")
                .ToArray();

            var chosen = await DisplayActionSheet("Choisir la liste active", "Annuler", null, labels);
            if (string.IsNullOrWhiteSpace(chosen) || chosen == "Annuler")
                return;

            var idx = Array.IndexOf(labels, chosen);
            if (idx < 0) return;

            app.SetCurrentShoppingListId(lists[idx].id);

            await RefreshSharingUiAsync();
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnDisableSharedListClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            // Guid.Empty = d√©sactiv√©
            app.SetCurrentShoppingListId(Guid.Empty);

            await RefreshSharingUiAsync();

            await DisplayAlert("OK", "Retour √† ta liste perso ‚úÖ", "OK");
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    // =========================
    // UI actions (compte)
    // =========================

    private async void OnDesinscriptionClicked(object sender, EventArgs e)
    {
        bool confirm = await DisplayAlert(
            LocalizationResourceManager.Instance["Settings_DeleteConfirmTitle"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmBody"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmYes"],
            LocalizationResourceManager.Instance["Dialog_Cancel"]);

        if (!confirm) return;

        var app = (App)Application.Current;

        if (app.Supabase == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Settings_SupabaseNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        var token = await SecureStorage.GetAsync("sb_access_token");
        var userId = await SecureStorage.GetAsync("sb_user_id");

        if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["SessionTitle"],
                LocalizationResourceManager.Instance["SessionExpired"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        app.Supabase.SetSession(token, userId);

        var (ok, err) = await app.Supabase.DeleteAccountAsync();

        if (!ok)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                string.Format(LocalizationResourceManager.Instance["Settings_DeleteFailed"], err),
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            if (!string.IsNullOrWhiteSpace(err) &&
                err.Contains("Invalid JWT", StringComparison.OrdinalIgnoreCase))
            {
                app.ShowLogin();
            }

            return;
        }

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        await DisplayAlert(
            LocalizationResourceManager.Instance["Dialog_Ok"],
            LocalizationResourceManager.Instance["Settings_DeleteSuccess"],
            LocalizationResourceManager.Instance["Dialog_Ok"]);

        app.ShowLogin();
    }

    private void OnLogoutClicked(object sender, EventArgs e)
    {
        var app = (App)Application.Current;

        app.Supabase?.ClearSession();

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        app.ShowLogin();
    }

    // =========================
    // Helpers: refresh UI
    // =========================

    private async Task RefreshSharingUiAsync()
    {
        var app = (App)Application.Current;

        if (app.CurrentUserId == null || app.RestClient == null)
        {
            LblActiveList.Text = "(non connect√©)";
            LblShareCode.Text = "(aucun)";
            return;
        }

        if (app.CurrentShoppingListId == null || app.CurrentShoppingListId == Guid.Empty)
        {
            LblActiveList.Text = "Liste perso (non partag√©e)";
            LblShareCode.Text = "(aucun)";
            return;
        }

        var list = await GetListByIdAsync(app.CurrentShoppingListId.Value);
        if (list == null)
        {
            LblActiveList.Text = "Liste introuvable";
            LblShareCode.Text = "(aucun)";
            return;
        }

        LblActiveList.Text = $"{(string.IsNullOrWhiteSpace(list.name) ? "Liste partag√©e" : list.name)}";
        LblShareCode.Text = list.share_code ?? "(aucun)";
    }

    // =========================
    // JOIN via RPC (recommand√©)
    // =========================

    private async Task<(Guid listId, string name)?> JoinByCodeViaRpcAsync(string code)
    {
        var app = (App)Application.Current;

        // Payload attendu c√¥t√© SQL : p_share_code (ou share_code selon ta fonction)
        // Je g√®re les 2 cas: tu peux adapter dans la fonction SQL ensuite.
        var payload = new
        {
            p_share_code = code
        };

        try
        {
            // PostgREST RPC: POST /rest/v1/rpc/<fn>
            // Ton SupabaseRestClient doit accepter "rpc/<fn>"
            var rows = await app.RestClient!.PostAsync<List<JoinResultRow>>(
                $"rpc/{JoinRpc}",
                payload,
                returnRepresentation: true);

            var row = rows?.FirstOrDefault();
            if (row == null || row.list_id == Guid.Empty)
                return null;

            return (row.list_id, row.name ?? "Liste partag√©e");
        }
        catch (Exception ex)
        {
            // Si la RPC n'existe pas (404), ou policy/401, on veut le voir clairement
            var msg = ex.ToString();

            if (msg.Contains("404", StringComparison.OrdinalIgnoreCase) ||
                msg.Contains("Not Found", StringComparison.OrdinalIgnoreCase) ||
                msg.Contains("could not find the function", StringComparison.OrdinalIgnoreCase))
            {
                throw new Exception(
                    "La fonction RPC 'join_shopping_list' n‚Äôexiste pas c√¥t√© Supabase.\n" +
                    "Il faut la cr√©er (SECURITY DEFINER) pour rejoindre une liste par share_code avec RLS.\n\n" +
                    "Dis-moi et je te donne le SQL exact √† coller.",
                    ex);
            }

            throw;
        }
    }

    // =========================
    // Supabase queries (liste)
    // =========================

    private async Task<ShoppingListRow?> GetListByIdAsync(Guid id)
    {
        var app = (App)Application.Current;
        var q = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&id=eq.{id}&limit=1";

        var rows = await app.RestClient!.GetAsync<List<ShoppingListRow>>(q);
        return rows?.FirstOrDefault();
    }

    private async Task<ShoppingListRow> GetOrCreateMyOwnedListAsync(Guid userId)
    {
        var app = (App)Application.Current;

        // 1) Essayer de r√©cup√©rer une liste dont je suis owner
        var q = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&owner_user_id=eq.{userId}&order=created_at.asc&limit=1";
        var existing = await app.RestClient!.GetAsync<List<ShoppingListRow>>(q);
        var row = existing?.FirstOrDefault();
        if (row != null)
            return row;

        // 2) Sinon cr√©er une liste (share_code mis par trigger)
        var payload = new
        {
            owner_user_id = userId,
            name = "Liste partag√©e"
        };

        var created = await app.RestClient!.PostAsync<List<ShoppingListRow>>(
            $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at",
            payload,
            returnRepresentation: true);

        var createdRow = created?.FirstOrDefault()
            ?? throw new Exception("Cr√©ation de liste impossible.");

        // 3) Owner devient membre aussi
        await UpsertMemberAsync(createdRow.id, userId, role: "owner");

        return createdRow;
    }

    private async Task<List<ShoppingListRow>> GetMyAccessibleListsAsync(Guid userId)
    {
        var app = (App)Application.Current;

        // memberships o√π user_id == moi
        var mq = $"{MembersTable}?select=list_id,role&user_id=eq.{userId}";
        var memberships = await app.RestClient!.GetAsync<List<MemberRow>>(mq) ?? new List<MemberRow>();

        var ids = memberships.Select(m => m.list_id).Distinct().ToList();

        // listes dont je suis owner
        var oq = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&owner_user_id=eq.{userId}";
        var owned = await app.RestClient!.GetAsync<List<ShoppingListRow>>(oq) ?? new List<ShoppingListRow>();

        foreach (var o in owned)
            if (!ids.Contains(o.id))
                ids.Add(o.id);

        if (ids.Count == 0)
            return owned;

        var inList = string.Join(",", ids.Select(x => x.ToString()));
        var q = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&id=in.({inList})&order=created_at.desc";

        var rows = await app.RestClient!.GetAsync<List<ShoppingListRow>>(q);
        return rows ?? new List<ShoppingListRow>();
    }

    private async Task UpsertMemberAsync(Guid listId, Guid userId, string role = "member")
    {
        var app = (App)Application.Current;

        var payload = new[]
        {
            new { list_id = listId, user_id = userId, role = role }
        };

        await app.RestClient!.PostAsync<object>(
            $"{MembersTable}?on_conflict=list_id,user_id",
            payload,
            returnRepresentation: false,
            mergeDuplicates: true);
    }

    // =========================
    // DTOs
    // =========================

    private sealed class ShoppingListRow
    {
        public Guid id { get; set; }
        public Guid owner_user_id { get; set; }
        public string? name { get; set; }
        public string? share_code { get; set; }
        public DateTimeOffset created_at { get; set; }
    }

    private sealed class MemberRow
    {
        public Guid list_id { get; set; }
        public string? role { get; set; }
    }

    private sealed class JoinResultRow
    {
        public Guid list_id { get; set; }
        public string? name { get; set; }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\AndroidManifest.xml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
	<application android:allowBackup="true" android:icon="@mipmap/postriticone" android:supportsRtl="true"></application>
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.CAMERA" />
	<queries>
		<intent>
			<action android:name="android.intent.action.VIEW" />
			<data android:scheme="logecui" />
		</intent>
	</queries>
</manifest>

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\MainActivity.cs
================================================================================

Ôªøusing Android.App;
using Android.Content;
using Android.Content.PM;
using Android.OS;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile
{
    [Activity(
        Theme = "@style/Maui.SplashTheme",
        MainLauncher = true,
        LaunchMode = LaunchMode.SingleTop,
        ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | ConfigChanges.SmallestScreenSize | ConfigChanges.Density)]

    // Configuration du Deep Link pour la confirmation email
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "confirm",
        AutoVerify = true)]

    // Deep Link - reset password
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "reset-password")]

    public class MainActivity : MauiAppCompatActivity
    {
        protected override void OnCreate(Bundle? savedInstanceState)
        {
            base.OnCreate(savedInstanceState);

            // G√©rer le deep link si l'app est lanc√©e via un lien
            HandleIntent(Intent);
        }

        protected override void OnNewIntent(Intent? intent)
        {
            base.OnNewIntent(intent);

            if (intent != null)
            {
                Intent = intent;
                HandleIntent(intent);
            }
        }

        private void HandleIntent(Intent? intent)
        {
            var data = intent?.DataString;
            if (string.IsNullOrEmpty(data))
                return;

            var uri = new Uri(data);

            MainThread.BeginInvokeOnMainThread(async () =>
            {
                if (Microsoft.Maui.Controls.Application.Current is App app)
                    await app.HandleDeepLinkAsync(uri);
            });
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\MainApplication.cs
================================================================================

Ôªøusing Android.App;
using Android.Runtime;

namespace LoGeCuiMobile
{
    [Application]
    public class MainApplication : MauiApplication
    {
        public MainApplication(IntPtr handle, JniHandleOwnership ownership)
            : base(handle, ownership)
        {
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\Resources\values\colors.xml
================================================================================

<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="colorPrimary">#512BD4</color>
    <color name="colorPrimaryDark">#2B0B98</color>
    <color name="colorAccent">#2B0B98</color>
</resources>

================================================================================
FILE: LoGeCuiMobile\Platforms\iOS\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\iOS\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\MacCatalyst\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\MacCatalyst\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Windows\App.xaml
================================================================================

Ôªø<maui:MauiWinUIApplication
    x:Class="LoGeCuiMobile.WinUI.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:maui="using:Microsoft.Maui"
    xmlns:local="using:LoGeCuiMobile.WinUI">

</maui:MauiWinUIApplication>

================================================================================
FILE: LoGeCuiMobile\Platforms\Windows\App.xaml.cs
================================================================================

Ôªøusing Microsoft.UI.Xaml;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace LoGeCuiMobile.WinUI
{
    /// <summary>
    /// Provides application-specific behavior to supplement the default Application class.
    /// </summary>
    public partial class App : MauiWinUIApplication
    {
        /// <summary>
        /// Initializes the singleton application object.  This is the first line of authored code
        /// executed, and as such is the logical equivalent of main() or WinMain().
        /// </summary>
        public App()
        {
            this.InitializeComponent();
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }

}

================================================================================
FILE: LoGeCuiMobile\Properties\launchSettings.json
================================================================================

{
  "profiles": {
    "Windows Machine": {
      "commandName": "Project",
      "nativeDebugging": false
    }
  }
}

================================================================================
FILE: LoGeCuiMobile\Resources\Lang\AppResources.Designer.cs
================================================================================

Ôªø//------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a √©t√© g√©n√©r√© par un outil.
//     Version du runtime :4.0.30319.42000
//
//     Les modifications apport√©es √† ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est r√©g√©n√©r√©.
// </auto-generated>
//------------------------------------------------------------------------------

namespace LoGeCuiMobile.Resources.Lang {
    using System;
    
    
    /// <summary>
    ///   Une classe de ressource fortement typ√©e destin√©e, entre autres, √† la consultation des cha√Ænes localis√©es.
    /// </summary>
    // Cette classe a √©t√© g√©n√©r√©e automatiquement par la classe StronglyTypedResourceBuilder
    // √† l'aide d'un outil, tel que ResGen ou Visual Studio.
    // Pour ajouter ou supprimer un membre, modifiez votre fichier .ResX, puis r√©ex√©cutez ResGen
    // avec l'option /str ou r√©g√©n√©rez votre projet VS.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "18.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    public class AppResources {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal AppResources() {
        }
        
        /// <summary>
        ///   Retourne l'instance ResourceManager mise en cache utilis√©e par cette classe.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("LoGeCuiMobile.Resources.Lang.AppResources", typeof(AppResources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   Remplace la propri√©t√© CurrentUICulture du thread actuel pour toutes
        ///   les recherches de ressources √† l'aide de cette classe de ressource fortement typ√©e.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mauvais mot de passe.
        /// </summary>
        public static string BadPassword {
            get {
                return ResourceManager.GetString("BadPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Connexion en cours....
        /// </summary>
        public static string Connecting {
            get {
                return ResourceManager.GetString("Connecting", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur de connexion.
        /// </summary>
        public static string ConnectionError {
            get {
                return ResourceManager.GetString("ConnectionError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©ation du compte....
        /// </summary>
        public static string CreatingAccount {
            get {
                return ResourceManager.GetString("CreatingAccount", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Annuler.
        /// </summary>
        public static string Dialog_Cancel {
            get {
                return ResourceManager.GetString("Dialog_Cancel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer cet ingr√©dient ?.
        /// </summary>
        public static string Dialog_DeleteConfirm {
            get {
                return ResourceManager.GetString("Dialog_DeleteConfirm", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Non.
        /// </summary>
        public static string Dialog_No {
            get {
                return ResourceManager.GetString("Dialog_No", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OK.
        /// </summary>
        public static string Dialog_Ok {
            get {
                return ResourceManager.GetString("Dialog_Ok", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui.
        /// </summary>
        public static string Dialog_Yes {
            get {
                return ResourceManager.GetString("Dialog_Yes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Email.
        /// </summary>
        public static string Email {
            get {
                return ResourceManager.GetString("Email", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur.
        /// </summary>
        public static string ErrorTitle {
            get {
                return ResourceManager.GetString("ErrorTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Veuillez remplir tous les champs.
        /// </summary>
        public static string FillAllFields {
            get {
                return ResourceManager.GetString("FillAllFields", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe oubli√© ?.
        /// </summary>
        public static string ForgotPassword {
            get {
                return ResourceManager.GetString("ForgotPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Add_Available {
            get {
                return ResourceManager.GetString("Ingredients_Add_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de l‚Äôingr√©dient.
        /// </summary>
        public static string Ingredients_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Ingredients_Add_NameRequired {
            get {
                return ResourceManager.GetString("Ingredients_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© (ex : 10).
        /// </summary>
        public static string Ingredients_Add_QuantityPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_QuantityPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üíæ Enregistrer.
        /// </summary>
        public static string Ingredients_Add_Save {
            get {
                return ResourceManager.GetString("Ingredients_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_Add_Title {
            get {
                return ResourceManager.GetString("Ingredients_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Unit√© (ex : kg, pi√®ces).
        /// </summary>
        public static string Ingredients_Add_UnitPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_UnitPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_AddButton {
            get {
                return ResourceManager.GetString("Ingredients_AddButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Available {
            get {
                return ResourceManager.GetString("Ingredients_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dient.
        /// </summary>
        public static string Ingredients_DialogTitle {
            get {
                return ResourceManager.GetString("Ingredients_DialogTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© : {0} {1}.
        /// </summary>
        public static string Ingredients_QuantityFormat {
            get {
                return ResourceManager.GetString("Ingredients_QuantityFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Gestion des ingr√©dients.
        /// </summary>
        public static string Ingredients_Title {
            get {
                return ResourceManager.GetString("Ingredients_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Se connecter.
        /// </summary>
        public static string LoginButton {
            get {
                return ResourceManager.GetString("LoginButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string LoginRequired {
            get {
                return ResourceManager.GetString("LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients.
        /// </summary>
        public static string Nav_Ingredients {
            get {
                return ResourceManager.GetString("Nav_Ingredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Menu al√©atoire.
        /// </summary>
        public static string Nav_RandomMenu {
            get {
                return ResourceManager.GetString("Nav_RandomMenu", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Nav_Recipes {
            get {
                return ResourceManager.GetString("Nav_Recipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Nav_Settings {
            get {
                return ResourceManager.GetString("Nav_Settings", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste de courses.
        /// </summary>
        public static string Nav_ShoppingList {
            get {
                return ResourceManager.GetString("Nav_ShoppingList", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OCR.
        /// </summary>
        public static string OcrTitle {
            get {
                return ResourceManager.GetString("OcrTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe.
        /// </summary>
        public static string Password {
            get {
                return ResourceManager.GetString("Password", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üîí Permission.
        /// </summary>
        public static string PermissionTitle {
            get {
                return ResourceManager.GetString("PermissionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Tout est disponible. Aucun ingr√©dient manquant..
        /// </summary>
        public static string RandomMenu_AllAvailable {
            get {
                return ResourceManager.GetString("RandomMenu_AllAvailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de calculer les ingr√©dients manquants : certaines recettes n‚Äôont pas d‚Äôingr√©dients enregistr√©s..
        /// </summary>
        public static string RandomMenu_CannotComputeMissing {
            get {
                return ResourceManager.GetString("RandomMenu_CannotComputeMissing", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de g√©n√©rer un menu Entr√©e/Plat/Dessert..
        /// </summary>
        public static string RandomMenu_CannotGenerate {
            get {
                return ResourceManager.GetString("RandomMenu_CannotGenerate", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† V√©rifie que tes recettes ont bien &apos;categorie&apos; = Entree / Plat / Dessert en DB..
        /// </summary>
        public static string RandomMenu_CheckCategories {
            get {
                return ResourceManager.GetString("RandomMenu_CheckCategories", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Entr√©es: {0}
        ///Plats: {1}
        ///Desserts: {2}.
        /// </summary>
        public static string RandomMenu_CountsFormat {
            get {
                return ResourceManager.GetString("RandomMenu_CountsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Appuyez sur le bouton pour g√©n√©rer un menu.
        /// </summary>
        public static string RandomMenu_DefaultText {
            get {
                return ResourceManager.GetString("RandomMenu_DefaultText", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_GenerateButton {
            get {
                return ResourceManager.GetString("RandomMenu_GenerateButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Menu g√©n√©r√© :.
        /// </summary>
        public static string RandomMenu_GeneratedHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GeneratedHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ G√©n√©ration du menu (Entr√©e / Plat / Dessert)‚Ä¶.
        /// </summary>
        public static string RandomMenu_Generating {
            get {
                return ResourceManager.GetString("RandomMenu_Generating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste globale des ingr√©dients manquants :.
        /// </summary>
        public static string RandomMenu_GlobalMissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GlobalMissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients :.
        /// </summary>
        public static string RandomMenu_IngredientsHeader {
            get {
                return ResourceManager.GetString("RandomMenu_IngredientsHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants :.
        /// </summary>
        public static string RandomMenu_MissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_MissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants : aucun.
        /// </summary>
        public static string RandomMenu_MissingNone {
            get {
                return ResourceManager.GetString("RandomMenu_MissingNone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients : (aucun ingr√©dient enregistr√© pour cette recette).
        /// </summary>
        public static string RandomMenu_NoIngredientsForRecipe {
            get {
                return ResourceManager.GetString("RandomMenu_NoIngredientsForRecipe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette disponible..
        /// </summary>
        public static string RandomMenu_NoRecipes {
            get {
                return ResourceManager.GetString("RandomMenu_NoRecipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ouvrir la liste de courses.
        /// </summary>
        public static string RandomMenu_OpenShopping {
            get {
                return ResourceManager.GetString("RandomMenu_OpenShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Il manque :.
        /// </summary>
        public static string RandomMenu_SendConfirmBody {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Envoyer ?.
        /// </summary>
        public static string RandomMenu_SendConfirmTitle {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Envoyer les ingr√©dients manquants dans la liste de courses.
        /// </summary>
        public static string RandomMenu_SendMissingToShopping {
            get {
                return ResourceManager.GetString("RandomMenu_SendMissingToShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ingr√©dients envoy√©s.
        /// </summary>
        public static string RandomMenu_SentButton {
            get {
                return ResourceManager.GetString("RandomMenu_SentButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_Title {
            get {
                return ResourceManager.GetString("RandomMenu_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add {
            get {
                return ResourceManager.GetString("Recipes_Add", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;acc√®s √† la cam√©ra est requis pour scanner..
        /// </summary>
        public static string Recipes_Add_CameraPermission {
            get {
                return ResourceManager.GetString("Recipes_Add_CameraPermission", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Capture photo non support√©e sur cet appareil..
        /// </summary>
        public static string Recipes_Add_CaptureNotSupported {
            get {
                return ResourceManager.GetString("Recipes_Add_CaptureNotSupported", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Choisir une cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de retrouver l&apos;ID de la recette apr√®s sauvegarde..
        /// </summary>
        public static string Recipes_Add_IdNotFound {
            get {
                return ResourceManager.GetString("Recipes_Add_IdNotFound", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;image est trop lourde pour l&apos;OCR. Essayez de cadrer plus serr√© ou baissez la r√©solution..
        /// </summary>
        public static string Recipes_Add_ImageTooLarge {
            get {
                return ResourceManager.GetString("Recipes_Add_ImageTooLarge", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients (1 par ligne).
        /// </summary>
        public static string Recipes_Add_IngredientsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex :
        ///2 ≈ìufs
        ///100g farine
        ///1 pinc√©e de sel.
        /// </summary>
        public static string Recipes_Add_IngredientsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Instructions.
        /// </summary>
        public static string Recipes_Add_InstructionsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : M√©langer, cuire 10 min....
        /// </summary>
        public static string Recipes_Add_InstructionsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string Recipes_Add_LoginRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom.
        /// </summary>
        public static string Recipes_Add_NameLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_NameLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de la recette.
        /// </summary>
        public static string Recipes_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Recipes_Add_NameRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun texte d√©tect√©. Essayez avec plus de lumi√®re et sans flou..
        /// </summary>
        public static string Recipes_Add_NoTextDetected {
            get {
                return ResourceManager.GetString("Recipes_Add_NoTextDetected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Texte scann√© et champs pr√©-remplis. V√©rifiez et corrigez si besoin..
        /// </summary>
        public static string Recipes_Add_OcrSuccess {
            get {
                return ResourceManager.GetString("Recipes_Add_OcrSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Enregistrer.
        /// </summary>
        public static string Recipes_Add_Save {
            get {
                return ResourceManager.GetString("Recipes_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Recette enregistr√©e..
        /// </summary>
        public static string Recipes_Add_Saved {
            get {
                return ResourceManager.GetString("Recipes_Add_Saved", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Scanner (OCR).
        /// </summary>
        public static string Recipes_Add_ScanOcr {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanOcr", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üì∏ Scanner une recette.
        /// </summary>
        public static string Recipes_Add_ScanTitle {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_Add_ServiceNotReady {
            get {
                return ResourceManager.GetString("Recipes_Add_ServiceNotReady", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps (minutes).
        /// </summary>
        public static string Recipes_Add_TimeLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_TimeLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : 30.
        /// </summary>
        public static string Recipes_Add_TimePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_TimePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add_Title {
            get {
                return ResourceManager.GetString("Recipes_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Category {
            get {
                return ResourceManager.GetString("Recipes_Category", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie: {0}
        ///Temps: {1} min
        ///
        ///Ingr√©dients:
        ///{2}
        ///
        ///Instructions:
        ///{3}.
        /// </summary>
        public static string Recipes_DetailsFormat {
            get {
                return ResourceManager.GetString("Recipes_DetailsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette pour l&apos;instant..
        /// </summary>
        public static string Recipes_Empty {
            get {
                return ResourceManager.GetString("Recipes_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_IngredientsServiceNull {
            get {
                return ResourceManager.GetString("Recipes_IngredientsServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† (aucun ingr√©dient renseign√©).
        /// </summary>
        public static string Recipes_NoIngredients {
            get {
                return ResourceManager.GetString("Recipes_NoIngredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rafra√Æchir.
        /// </summary>
        public static string Recipes_Refresh {
            get {
                return ResourceManager.GetString("Recipes_Refresh", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecipesService est NULL (InitRestServices n&apos;a pas √©t√© appel√© apr√®s login)..
        /// </summary>
        public static string Recipes_ServiceNull {
            get {
                return ResourceManager.GetString("Recipes_ServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps : {0} min.
        /// </summary>
        public static string Recipes_TimeFormat {
            get {
                return ResourceManager.GetString("Recipes_TimeFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Recipes_Title {
            get {
                return ResourceManager.GetString("Recipes_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Confirmer le mot de passe.
        /// </summary>
        public static string Reset_ConfirmPassword {
            get {
                return ResourceManager.GetString("Reset_ConfirmPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Votre mot de passe a √©t√© modifi√©. Vous pouvez vous connecter..
        /// </summary>
        public static string Reset_DoneBody {
            get {
                return ResourceManager.GetString("Reset_DoneBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Termin√©.
        /// </summary>
        public static string Reset_DoneTitle {
            get {
                return ResourceManager.GetString("Reset_DoneTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de modifier le mot de passe..
        /// </summary>
        public static string Reset_Failed {
            get {
                return ResourceManager.GetString("Reset_Failed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialiser votre mot de passe.
        /// </summary>
        public static string Reset_Header {
            get {
                return ResourceManager.GetString("Reset_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nouveau mot de passe.
        /// </summary>
        public static string Reset_NewPassword {
            get {
                return ResourceManager.GetString("Reset_NewPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le mot de passe doit contenir au moins 6 caract√®res..
        /// </summary>
        public static string Reset_PwdMinLength {
            get {
                return ResourceManager.GetString("Reset_PwdMinLength", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Les mots de passe ne correspondent pas..
        /// </summary>
        public static string Reset_PwdMismatch {
            get {
                return ResourceManager.GetString("Reset_PwdMismatch", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Valider.
        /// </summary>
        public static string Reset_Submit {
            get {
                return ResourceManager.GetString("Reset_Submit", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialisation.
        /// </summary>
        public static string Reset_Title {
            get {
                return ResourceManager.GetString("Reset_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ Mise √† jour en cours....
        /// </summary>
        public static string Reset_Updating {
            get {
                return ResourceManager.GetString("Reset_Updating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Service indisponible..
        /// </summary>
        public static string ServiceUnavailable {
            get {
                return ResourceManager.GetString("ServiceUnavailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session absente ou expir√©e. Veuillez vous reconnecter..
        /// </summary>
        public static string SessionExpired {
            get {
                return ResourceManager.GetString("SessionExpired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session.
        /// </summary>
        public static string SessionTitle {
            get {
                return ResourceManager.GetString("SessionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Compte.
        /// </summary>
        public static string Settings_Account {
            get {
                return ResourceManager.GetString("Settings_Account", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Zone dangereuse.
        /// </summary>
        public static string Settings_DangerZone {
            get {
                return ResourceManager.GetString("Settings_DangerZone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Es-tu s√ªr de vouloir supprimer ton compte ? Cette action est irr√©versible..
        /// </summary>
        public static string Settings_DeleteConfirmBody {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_DeleteConfirmTitle {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui, supprimer.
        /// </summary>
        public static string Settings_DeleteConfirmYes {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmYes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Suppression impossible : {0}.
        /// </summary>
        public static string Settings_DeleteFailed {
            get {
                return ResourceManager.GetString("Settings_DeleteFailed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Votre compte a √©t√© supprim√©..
        /// </summary>
        public static string Settings_DeleteSuccess {
            get {
                return ResourceManager.GetString("Settings_DeleteSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©connexion.
        /// </summary>
        public static string Settings_Logout {
            get {
                return ResourceManager.GetString("Settings_Logout", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supabase non initialis√©. Reconnectez-vous..
        /// </summary>
        public static string Settings_SupabaseNull {
            get {
                return ResourceManager.GetString("Settings_SupabaseNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Settings_Title {
            get {
                return ResourceManager.GetString("Settings_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_Unsubscribe {
            get {
                return ResourceManager.GetString("Settings_Unsubscribe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un article.
        /// </summary>
        public static string Shopping_AddItem {
            get {
                return ResourceManager.GetString("Shopping_AddItem", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Achet√©.
        /// </summary>
        public static string Shopping_Bought {
            get {
                return ResourceManager.GetString("Shopping_Bought", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer.
        /// </summary>
        public static string Shopping_Delete {
            get {
                return ResourceManager.GetString("Shopping_Delete", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üóëÔ∏è Supprimer s√©lection.
        /// </summary>
        public static string Shopping_DeleteSelection {
            get {
                return ResourceManager.GetString("Shopping_DeleteSelection", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun article pour l‚Äôinstant..
        /// </summary>
        public static string Shopping_Empty {
            get {
                return ResourceManager.GetString("Shopping_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ma liste de courses.
        /// </summary>
        public static string Shopping_Header {
            get {
                return ResourceManager.GetString("Shopping_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Liste de Courses.
        /// </summary>
        public static string Shopping_Title {
            get {
                return ResourceManager.GetString("Shopping_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©er un compte.
        /// </summary>
        public static string SignupButton {
            get {
                return ResourceManager.GetString("SignupButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur lors de l&apos;inscription.
        /// </summary>
        public static string SignupError {
            get {
                return ResourceManager.GetString("SignupError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rester connect√©.
        /// </summary>
        public static string StayConnected {
            get {
                return ResourceManager.GetString("StayConnected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ OK.
        /// </summary>
        public static string SuccessTitle {
            get {
                return ResourceManager.GetString("SuccessTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur inconnue..
        /// </summary>
        public static string UnknownError {
            get {
                return ResourceManager.GetString("UnknownError", resourceCulture);
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Resources\Lang\LocalizationResourceManager.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Globalization;
using System.Resources;

namespace LoGeCuiMobile.Resources.Lang;

public class LocalizationResourceManager : INotifyPropertyChanged
{
    public static LocalizationResourceManager Instance { get; } = new();

    private readonly ResourceManager _resourceManager = AppResources.ResourceManager;

    public event PropertyChangedEventHandler? PropertyChanged;

    public string this[string key] => _resourceManager.GetString(key, CultureInfo.CurrentUICulture) ?? key;

    public void SetCulture(CultureInfo culture)
    {
        if (culture == null) return;

        CultureInfo.CurrentUICulture = culture;
        CultureInfo.CurrentCulture = culture;

        CultureInfo.DefaultThreadCurrentCulture = culture;
        CultureInfo.DefaultThreadCurrentUICulture = culture;

        // ‚úÖ Notifie toute l‚ÄôUI : toutes les bindings se r√©√©valuent
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(null));
    }
}

================================================================================
FILE: LoGeCuiMobile\Resources\Lang\TranslateExtension.cs
================================================================================

Ôªøusing Microsoft.Maui.Controls;
using System;

namespace LoGeCuiMobile.Resources.Lang;

[ContentProperty(nameof(Key))]
public class TranslateExtension : IMarkupExtension<BindingBase>
{
    public string Key { get; set; } = "";

    public BindingBase ProvideValue(IServiceProvider serviceProvider)
        => new Binding($"[{Key}]", source: LocalizationResourceManager.Instance);

    object IMarkupExtension.ProvideValue(IServiceProvider serviceProvider)
        => ProvideValue(serviceProvider);
}

================================================================================
FILE: LoGeCuiMobile\Resources\Raw\AboutAssets.txt
================================================================================

ÔªøAny raw assets you want to be deployed with your application can be placed in
this directory (and child directories). Deployment of the asset to your application
is automatically handled by the following `MauiAsset` Build Action within your `.csproj`.

	<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />

These files will be deployed with your package and will be accessible using Essentials:

	async Task LoadMauiAsset()
	{
		using var stream = await FileSystem.OpenAppPackageFileAsync("AboutAssets.txt");
		using var reader = new StreamReader(stream);

		var contents = reader.ReadToEnd();
	}

================================================================================
FILE: LoGeCuiMobile\Resources\Styles\Colors.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- Couleurs fixes -->
    <Color x:Key="AccentColor">#FF6B00</Color>

    <!-- Couleurs Light -->
    <Color x:Key="LightPageBackground">#FFFFFF</Color>
    <Color x:Key="LightTextPrimary">#111111</Color>
    <Color x:Key="LightCardBackground">#F2F2F2</Color>

    <!-- Couleurs Dark -->
    <Color x:Key="DarkPageBackground">#121212</Color>
    <Color x:Key="DarkTextPrimary">#FFFFFF</Color>
    <Color x:Key="DarkCardBackground">#1E1E1E</Color>

    <!-- Texte sur cartes -->
    <Color x:Key="LightCardText">#111111</Color>
    <Color x:Key="DarkCardText">#FFFFFF</Color>

</ResourceDictionary>


================================================================================
FILE: LoGeCuiMobile\Resources\Styles\Styles.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- PAGE -->
    <Style TargetType="ContentPage">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightPageBackground}"
                                 Dark="{StaticResource DarkPageBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- LABEL -->
    <Style TargetType="Label">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- ENTRY -->
    <Style TargetType="Entry">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- FRAME -->
    <Style TargetType="Frame">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- BUTTON -->
    <Style TargetType="Button">
        <Setter Property="TextColor" Value="White" />
        <Setter Property="BackgroundColor" Value="{StaticResource AccentColor}" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Padding" Value="14,10" />
        <Setter Property="MinimumHeightRequest" Value="44" />
        <Setter Property="MinimumWidthRequest" Value="44" />
    </Style>

    <!-- LABEL DANS UNE CARTE -->
    <Style TargetType="Label" x:Key="CardLabel">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardText}"
                             Dark="{StaticResource DarkCardText}" />
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>

================================================================================
FILE: LoGeCuiMobile\RootPage.cs
================================================================================

namespace LoGeCuiMobile;

public static class RootPage
{
    public static Page CreateLoginRoot()
        => new NavigationPage(new Pages.LoginPage());

    public static Page CreateAppShellRoot()
        => new AppShell();
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\ArticleLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class ArticleLocal
    {
        [PrimaryKey]
        public int Id { get; set; }   // int

        public string Nom { get; set; } = "";
        public string Quantite { get; set; } = "";
        public string Unite { get; set; } = "";
        public bool EstAchete { get; set; }

        public ArticleLocal() { }

        public ArticleLocal(ArticleCourse a)
        {
            Id = a.Id;                 // int -> int ‚úÖ
            Nom = a.Nom ?? "";
            Quantite = a.Quantite ?? "";
            Unite = a.Unite ?? "";
            EstAchete = a.EstAchete;
        }

        public ArticleCourse ToModel()
        {
            return new ArticleCourse
            {
                Id = Id,              // int -> int ‚úÖ
                Nom = Nom,
                Quantite = Quantite,
                Unite = Unite,
                EstAchete = EstAchete
            };
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\IngredientLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

public class IngredientLocal
{
    [PrimaryKey]
    public Guid Id { get; set; }
    public string Nom { get; set; } = "";
    public string? Quantite { get; set; }
    public string? Unite { get; set; }
    public bool EstDisponible { get; set; }

    public IngredientLocal() { }

    public IngredientLocal(Ingredient i)
    {
        Id = i.Id;
        Nom = i.Nom;
        Quantite = i.Quantite;
        Unite = i.Unite;
        EstDisponible = i.EstDisponible;
    }

    public Ingredient ToModel() => new Ingredient
    {
        Id = Id,
        Nom = Nom,
        Quantite = Quantite,
        Unite = Unite,
        EstDisponible = EstDisponible
    };
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\LocalDatabase.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local;

public class LocalDatabase
{
    private readonly SQLiteAsyncConnection _db;

    public LocalDatabase(string path)
    {
        _db = new SQLiteAsyncConnection(path);
        _db.CreateTableAsync<IngredientLocal>().Wait();
        _db.CreateTableAsync<ArticleLocal>().Wait();
        _db.CreateTableAsync<RecetteLocal>().Wait();

    }

    // ---------- INGREDIENTS ----------
    public Task<List<IngredientLocal>> GetIngredientsAsync() =>
        _db.Table<IngredientLocal>().ToListAsync();

    public Task SaveIngredientsAsync(IEnumerable<Ingredient> ingredients)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<IngredientLocal>();
            foreach (var i in ingredients)
                tran.Insert(new IngredientLocal(i));
        });
    }

    // ---------- ARTICLES ----------
    public Task<List<ArticleLocal>> GetArticlesAsync() =>
        _db.Table<ArticleLocal>().ToListAsync();

    public Task SaveArticlesAsync(IEnumerable<ArticleCourse> articles)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<ArticleLocal>();
            foreach (var a in articles)
                tran.Insert(new ArticleLocal(a));
        });
    }

    public Task<List<RecetteLocal>> GetRecettesAsync() =>
    _db.Table<RecetteLocal>().ToListAsync();

    public Task SaveRecettesAsync(IEnumerable<Recette> recettes)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<RecetteLocal>();
            foreach (var r in recettes)
                tran.Insert(new RecetteLocal(r));
        });
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\RecetteLocal.cs
================================================================================

Ôªøusing System;
using SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class RecetteLocal
    {
        [PrimaryKey]
        public string Id { get; set; } = ""; // Guid stock√© en texte

        public string Nom { get; set; } = "";
        public int TempsPreparation { get; set; }
        public string Instructions { get; set; } = "";
        public string CategorieDb { get; set; } = "";
        public int Type { get; set; } // enum -> int

        // ‚úÖ Pour √©viter les doublons √† l‚Äô√©dition (upsert stable)
        public string? ExternalId { get; set; }

        // ‚úÖ utile pour coh√©rence (optionnel)
        public string? OwnerUserId { get; set; }

        // ‚úÖ Photos (sync + cache)
        public string? PhotoUrl { get; set; }
        public string? PhotoLocalPath { get; set; }

        public RecetteLocal() { }

        public RecetteLocal(Recette r)
        {
            Id = r.Id.ToString();

            Nom = r.Nom ?? "";
            TempsPreparation = r.TempsPreparation;
            Instructions = r.Instructions ?? "";
            CategorieDb = r.CategorieDb ?? "";
            Type = (int)r.Type;

            ExternalId = r.ExternalId;
            OwnerUserId = r.OwnerUserId?.ToString();

            PhotoUrl = r.PhotoUrl;
            PhotoLocalPath = r.PhotoLocalPath;
        }

        public Recette ToModel()
        {
            Guid.TryParse(Id, out var guid);

            Guid? owner = null;
            if (!string.IsNullOrWhiteSpace(OwnerUserId) && Guid.TryParse(OwnerUserId, out var ouid))
                owner = ouid;

            return new Recette
            {
                Id = guid,
                Nom = Nom,
                TempsPreparation = TempsPreparation,
                Instructions = Instructions,
                CategorieDb = CategorieDb,
                Type = (TypePlat)Type,

                ExternalId = ExternalId,
                OwnerUserId = owner,

                PhotoUrl = PhotoUrl,
                PhotoLocalPath = PhotoLocalPath
            };
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\OcrService.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text.Json;

namespace LoGeCuiMobile.Services
{
    public sealed class OcrService
    {
        private readonly HttpClient _http;
        private readonly string _apiKey;

        public OcrService(string apiKey)
        {
            _apiKey = apiKey ?? throw new ArgumentNullException(nameof(apiKey));
            _http = new HttpClient { Timeout = TimeSpan.FromSeconds(60) };
        }

        public async Task<string> ExtractTextFromImageAsync(byte[] imageBytes, string fileName = "scan.jpg")
        {
            if (imageBytes is null || imageBytes.Length == 0)
                throw new ArgumentException("Image vide.", nameof(imageBytes));

            if (string.IsNullOrWhiteSpace(_apiKey))
                throw new InvalidOperationException("Cl√© OCR manquante (apiKey).");

            var url = "https://api.ocr.space/parse/image";

            using var content = new MultipartFormDataContent();

            // Param√®tres utiles
            content.Add(new StringContent("fre"), "language");          // fre = fran√ßais
            content.Add(new StringContent("false"), "isOverlayRequired");
            content.Add(new StringContent("2"), "OCREngine");           // 1 ou 2 (2 souvent meilleur)
            content.Add(new StringContent("true"), "scale");
            content.Add(new StringContent("true"), "detectOrientation");

            var fileContent = new ByteArrayContent(imageBytes);
            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("image/jpeg");
            content.Add(fileContent, "file", fileName);

            using var request = new HttpRequestMessage(HttpMethod.Post, url);
            request.Headers.Add("apikey", _apiKey); // ‚úÖ endroit le plus fiable
            request.Content = content;

            using var resp = await _http.SendAsync(request);
            var json = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"OCR HTTP {(int)resp.StatusCode}: {json}");

            using var doc = JsonDocument.Parse(json);

            // Si l‚ÄôAPI retourne une erreur applicative
            if (doc.RootElement.TryGetProperty("IsErroredOnProcessing", out var errored)
                && errored.ValueKind == JsonValueKind.True)
            {
                string msg = "Erreur OCR.";
                if (doc.RootElement.TryGetProperty("ErrorMessage", out var em))
                {
                    // ErrorMessage peut √™tre string ou tableau selon les cas
                    msg = em.ValueKind switch
                    {
                        JsonValueKind.Array => string.Join(" | ", em.EnumerateArray().Select(x => x.ToString())),
                        _ => em.ToString()
                    };
                }
                throw new Exception(msg);
            }

            if (!doc.RootElement.TryGetProperty("ParsedResults", out var parsedResults)
                || parsedResults.ValueKind != JsonValueKind.Array
                || parsedResults.GetArrayLength() == 0)
            {
                return "";
            }

            var first = parsedResults[0];
            if (!first.TryGetProperty("ParsedText", out var parsedTextEl))
                return "";

            return parsedTextEl.GetString() ?? "";
        }
    }
}



================================================================================
FILE: LoGeCuiMobile\Services\Skiasharp.cs
================================================================================

Ôªøusing SkiaSharp;

namespace LoGeCuiMobile.Services
{
    public static class ImageCompressionHelper
    {
        public static byte[] CompressJpeg(
            byte[] input,
            int maxWidth = 1600,
            int jpegQuality = 75)
        {
            using var inputStream = new SKMemoryStream(input);
            using var codec = SKCodec.Create(inputStream);
            using var bitmap = SKBitmap.Decode(codec);

            if (bitmap == null)
                throw new InvalidOperationException("Impossible de d√©coder l'image.");

            var width = bitmap.Width;
            var height = bitmap.Height;

            if (width > maxWidth)
            {
                var ratio = (float)maxWidth / width;
                var newW = maxWidth;
                var newH = (int)(height * ratio);

                using var resized = bitmap.Resize(
                    new SKImageInfo(newW, newH),
                    SKFilterQuality.Medium);

                using var image = SKImage.FromBitmap(resized);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
            else
            {
                using var image = SKImage.FromBitmap(bitmap);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
        }
    }
}


================================================================================
FILE: LoGeCuiMobile\Services\SupabaseConfig.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public static class SupabaseConfig
    {
        public static string Url { get; } = ConfigurationHelper.GetSupabaseUrl();
        public static string Key { get; } = ConfigurationHelper.GetSupabaseKey();
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\SupabaseStorageService.cs
================================================================================

Ôªøusing System;
using System.IO;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Threading.Tasks;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public class SupabaseStorageService
    {
        private readonly string _supabaseUrl;
        private readonly string _supabaseKey;
        private const string Bucket = "recipe-photos";

        // ‚úÖ r√©utiliser HttpClient (√©vite sockets leak)
        private static readonly HttpClient _http = new HttpClient
        {
            Timeout = TimeSpan.FromSeconds(60)
        };

        public SupabaseStorageService()
        {
            _supabaseUrl = ConfigurationHelper.GetSupabaseUrl().TrimEnd('/');
            _supabaseKey = ConfigurationHelper.GetSupabaseKey();
        }

        /// <summary>
        /// Upload une photo dans Supabase Storage et retourne l'URL publique.
        /// Bucket = recipe-photos (public).
        /// </summary>
        public async Task<string> UploadRecipePhotoAndGetPublicUrlAsync(
            string accessToken,
            Guid userId,
            Guid recetteId,
            string localPath)
        {
            if (string.IsNullOrWhiteSpace(accessToken))
                throw new InvalidOperationException("Token manquant. Reconnecte-toi.");

            if (!File.Exists(localPath))
                throw new FileNotFoundException("Photo introuvable", localPath);

            var ext = Path.GetExtension(localPath);
            if (string.IsNullOrWhiteSpace(ext)) ext = ".jpg";

            // Range tes fichiers par user -> plus simple pour les policies
            var objectPath = $"{userId}/recipes/{recetteId}/{DateTime.UtcNow:yyyyMMdd_HHmmss}{ext}";

            var uploadUrl = $"{_supabaseUrl}/storage/v1/object/{Bucket}/{objectPath}";
            var publicUrl = $"{_supabaseUrl}/storage/v1/object/public/{Bucket}/{objectPath}";

            await using var stream = File.OpenRead(localPath);

            using var req = new HttpRequestMessage(HttpMethod.Put, uploadUrl);
            req.Headers.Add("apikey", _supabaseKey);
            req.Headers.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);

            // Permet d'√©craser si le fichier existe d√©j√† (selon comportement Storage)
            req.Headers.Add("x-upsert", "true");

            req.Content = new StreamContent(stream);
            req.Content.Headers.ContentType = new MediaTypeHeaderValue(GetMimeType(ext));

            using var res = await _http.SendAsync(req);
            var body = await res.Content.ReadAsStringAsync();

            if (!res.IsSuccessStatusCode)
                throw new Exception($"Upload Storage failed ({(int)res.StatusCode}): {body}");

            return publicUrl;
        }

        private static string GetMimeType(string ext)
        {
            ext = (ext ?? "").ToLowerInvariant();
            return ext switch
            {
                ".png" => "image/png",
                ".webp" => "image/webp",
                _ => "image/jpeg"
            };
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\ViewModels\ArticleCourseUi.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    // Wrapper UI: on conserve ArticleCourse et on ajoute une s√©lection locale (non persist√©e)
    public class ArticleCourseUi : INotifyPropertyChanged
    {
        public ArticleCourseUi(ArticleCourse model) => Model = model;

        public ArticleCourse Model { get; }

        public int Id => Model.Id;

        public string Nom
        {
            get => Model.Nom;
            set { if (Model.Nom != value) { Model.Nom = value; OnPropertyChanged(); } }
        }

        public string Quantite
        {
            get => Model.Quantite;
            set { if (Model.Quantite != value) { Model.Quantite = value; OnPropertyChanged(); } }
        }

        public string Unite
        {
            get => Model.Unite;
            set { if (Model.Unite != value) { Model.Unite = value; OnPropertyChanged(); } }
        }

        public bool EstAchete
        {
            get => Model.EstAchete;
            set { if (Model.EstAchete != value) { Model.EstAchete = value; OnPropertyChanged(); } }
        }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set { if (_isSelectedForDelete != value) { _isSelectedForDelete = value; OnPropertyChanged(); } }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}


================================================================================
FILE: LoGeCuiMobile\ViewModels\MesRecettesViewModel.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiShared.Utils;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.ViewModels
{
    public enum AvailabilityState
    {
        Unknown,
        AllAvailable,
        Missing
    }

    // ‚úÖ UI wrapper
    public class RecetteUi : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        public Recette Model { get; }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(IsSelectedForDelete)));
            }
        }

        private AvailabilityState _availabilityState = AvailabilityState.Unknown;
        public AvailabilityState AvailabilityState
        {
            get => _availabilityState;
            set
            {
                if (_availabilityState == value) return;
                _availabilityState = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityState)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        private int _missingCount;
        public int MissingCount
        {
            get => _missingCount;
            set
            {
                if (_missingCount == value) return;
                _missingCount = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(MissingCount)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        public string AvailabilityLabel =>
            AvailabilityState == AvailabilityState.Unknown ? "Disponibilit√© inconnue"
            : AvailabilityState == AvailabilityState.AllAvailable ? "‚úÖ Tous ingr√©dients disponibles"
            : $"‚ùå Manque {MissingCount} ingr√©dient(s)";

        public Guid Id => Model.Id;
        public string Nom => Model.Nom;
        public string TypeTexte => Model.TypeTexte;
        public int TempsPreparation => Model.TempsPreparation;
        public string DifficulteTexte => Model.DifficulteTexte;

        // ‚úÖ Image pour la liste (local > url + cache busting optionnel)
        public ImageSource? PhotoSource
        {
            get
            {
                try
                {
                    if (!string.IsNullOrWhiteSpace(Model.PhotoLocalPath) && File.Exists(Model.PhotoLocalPath))
                        return ImageSource.FromFile(Model.PhotoLocalPath);

                    if (!string.IsNullOrWhiteSpace(Model.PhotoUrl))
                        return ImageSource.FromUri(new Uri(Model.PhotoUrl));

                    return null;
                }
                catch
                {
                    return null;
                }
            }
        }

        public void NotifyPhotoChanged()
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(PhotoSource)));

        public RecetteUi(Recette r) => Model = r;
    }

    public class MesRecettesViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));

        private readonly RecipesService _recipesService;

        public ObservableCollection<RecetteUi> Recettes { get; } = new();

        public ObservableCollection<string> Categories { get; } =
            new() { "Toutes", "Entr√©es", "Plats", "Desserts" };

        private string _selectedCategorie = "Toutes";
        public string SelectedCategorie
        {
            get => _selectedCategorie;
            set
            {
                if (_selectedCategorie == value) return;
                _selectedCategorie = value;
                OnPropertyChanged(nameof(SelectedCategorie));
                ApplyFilter();
            }
        }

        public ICommand RefreshCommand { get; }

        private bool _isBusy;
        public bool IsBusy
        {
            get => _isBusy;
            private set
            {
                if (_isBusy == value) return;
                _isBusy = value;
                OnPropertyChanged(nameof(IsBusy));
            }
        }

        private List<Recette> _all = new();

        public MesRecettesViewModel(RecipesService recipesService)
        {
            _recipesService = recipesService;
            RefreshCommand = new Command(async () => await LoadAsync(forceRemote: true));
        }

        private static bool IsJwtExpired(Exception ex)
            => ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);

        private static bool IsNetworkRelated(Exception ex)
        {
            var msg = ex.ToString();
            return msg.Contains("HttpRequestException", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timed out", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timeout", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("network", StringComparison.OrdinalIgnoreCase);
        }

        // ‚úÖ Normalisation unique partout (safe)
        private static string Norm(string? s)
        {
            var n = IngredientNormalizer.Normalize(s);
            return string.IsNullOrWhiteSpace(n) ? "" : n;
        }

        public async Task LoadAsync(bool forceRemote = false)
        {
            if (IsBusy) return;

            try
            {
                IsBusy = true;

                // 0) Cache local d'abord
                var local = await App.LocalDb.GetRecettesAsync();
                _all = local.Select(x => x.ToModel()).ToList();

                // 1) Remote si internet + connect√©
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var app = (App)Application.Current;

                    if (app.IsConnected && app.CurrentUserId != null)
                    {
                        try
                        {
                            var remote = await _recipesService.GetRecettesAsync(app.CurrentUserId.Value)
                                         ?? new List<Recette>();

                            // Ne pas √©craser le cache par vide si pas force
                            if (forceRemote || remote.Count > 0)
                            {
                                _all = remote;
                                await App.LocalDb.SaveRecettesAsync(remote);
                            }
                        }
                        catch (Exception ex)
                        {
                            if (!(IsJwtExpired(ex) || IsNetworkRelated(ex)))
                                throw;
                        }
                    }
                }

                ApplyFilter();
            }
            finally
            {
                IsBusy = false;
            }
        }

        private void ApplyFilter()
        {
            IEnumerable<Recette> filtered = _all;

            if (SelectedCategorie == "Entr√©es")
                filtered = _all.Where(r => r.Type == TypePlat.Entree);
            else if (SelectedCategorie == "Plats")
                filtered = _all.Where(r => r.Type == TypePlat.Plat);
            else if (SelectedCategorie == "Desserts")
                filtered = _all.Where(r => r.Type == TypePlat.Dessert);

            Recettes.Clear();
            foreach (var r in filtered)
                Recettes.Add(new RecetteUi(r));
        }

        public async Task RefreshAvailabilityAsync()
        {
            var app = (App)Application.Current;

            // Offline => Unknown
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            try
            {
                var userId = app.CurrentUserId.Value;

                // ‚úÖ ingr√©dients utilisateur disponibles
                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                foreach (var r in Recettes)
                {
                    var rows = await app.RecetteIngredientsService.GetForRecetteAsync(r.Model.Id);

                    var recipeNames = rows
                        .Select(x => Norm(x.nom))
                        .Where(s => !string.IsNullOrWhiteSpace(s))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    if (recipeNames.Count == 0)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                        continue;
                    }

                    var missing = recipeNames
                        .Where(n => !userSet.Contains(n))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    r.MissingCount = missing.Count;
                    r.AvailabilityState = (missing.Count == 0)
                        ? AvailabilityState.AllAvailable
                        : AvailabilityState.Missing;
                }
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                {
                    foreach (var r in Recettes)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                    }
                    return;
                }

                throw;
            }
        }

        public async Task<List<string>?> GetMissingIngredientsForRecipeAsync(Recette recette)
        {
            var app = (App)Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return null;

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
                return null;

            try
            {
                var userId = app.CurrentUserId.Value;

                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                var rows = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

                var recipeNames = rows
                    .Select(x => Norm(x.nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                if (recipeNames.Count == 0)
                    return new List<string>(); // pas null => "aucun ingr√©dient renseign√©"

                var missing = recipeNames
                    .Where(n => !userSet.Contains(n))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                return missing;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return null;

                throw;
            }
        }

        public async Task<bool> SendMissingToShoppingAsync(List<string> missing)
        {
            var app = (App)Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return false;

            if (!app.IsConnected || app.CurrentUserId == null || app.ListeCoursesSupabaseService == null)
                return false;

            try
            {
                await app.ListeCoursesSupabaseService.AddMissingAsync(app.CurrentUserId.Value, missing);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return false;

                throw;
            }
        }

        public async Task DeleteSelectedAsync(List<RecetteUi> selected)
        {
            var app = (App)Application.Current;

            // Optimistic UI
            foreach (var r in selected.ToList())
                Recettes.Remove(r);

            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet && app.IsConnected && app.RecipesService != null)
            {
                try
                {
                    foreach (var r in selected)
                        await app.RecipesService.DeleteRecetteAsync(r.Model.Id);
                }
                catch (Exception ex)
                {
                    if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                        throw;
                }
            }

            await LoadAsync(forceRemote: true);

            try
            {
                await RefreshAvailabilityAsync();
            }
            catch (Exception ex)
            {
                if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                    throw;
            }
        }

        public Task DeleteOneAsync(RecetteUi one)
            => DeleteSelectedAsync(new List<RecetteUi> { one });
    }
}

================================================================================
FILE: LoGeCuiShared\LoGeCuiShared.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Supabase" Version="1.1.1" />
    <PackageReference Include="Supabase.Core" Version="1.0.0" />
    <PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
  </ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiShared\Models\ArticleCourse.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Text.Json.Serialization;
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace LoGeCuiShared.Models
{
    public class ArticleCourse : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        private int _id;
        private Guid _userId;
        private string _nom = "";
        private string _quantite = "";
        private string _unite = "";
        private bool _estAchete;

        [JsonPropertyName("id")]
        public int Id
        {
            get => _id;
            set { _id = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("user_id")]
        public Guid UserId
        {
            get => _userId;
            set { _userId = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("nom")]
        public string Nom
        {
            get => _nom;
            set { _nom = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("quantite")]
        public string Quantite
        {
            get => _quantite;
            set { _quantite = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("unite")]
        public string Unite
        {
            get => _unite;
            set { _unite = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("est_achete")]
        public bool EstAchete
        {
            get => _estAchete;
            set { _estAchete = value; OnPropertyChanged(); }
        }

        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: LoGeCuiShared\Models\Ingredient.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiShared.Models
{
    public class Ingredient
    {
        public bool EstFavori { get; set; }

        public Guid Id { get; set; }          // id (uuid) dans Supabase
        public Guid? UserId { get; set; }     // user_id (uuid) dans Supabase
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }
        public bool EstDisponible { get; set; }

        public Ingredient()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
            EstDisponible = true;
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Models\IngredientRecette.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiShared.Models
{
    public class IngredientRecette
    {
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }

        public IngredientRecette()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
        }

        public override string ToString()
        {
            return $"{Nom} - {Quantite} {Unite}";
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Models\MenuJournalier.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiShared.Models
{
    public class MenuJournalier
    {
        public DateTime Date { get; set; }
        public Recette? Entree { get; set; }
        public Recette? Plat { get; set; }
        public Recette? Dessert { get; set; }
        public List<IngredientRecette> IngredientsManquants { get; set; }

        public MenuJournalier()
        {
            Date = DateTime.Now;
            IngredientsManquants = new List<IngredientRecette>();
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Models\Recette.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text.Json.Serialization;

namespace LoGeCuiShared.Models
{
    public enum TypePlat
    {
        Entree,
        Plat,
        Dessert
    }

    public class Recette
    {
        // ----------------------------
        // Champs DB / JSON (Supabase)
        // ----------------------------

        [JsonPropertyName("id")]
        public Guid Id { get; set; }

        [JsonPropertyName("created_at")]
        public DateTimeOffset CreatedAt { get; set; }

        [JsonPropertyName("owner_user_id")]
        public Guid? OwnerUserId { get; set; }

        [JsonPropertyName("external_id")]
        public string? ExternalId { get; set; }

        [JsonPropertyName("nom")]
        public string Nom { get; set; } = "";

        [JsonPropertyName("categorie")]
        public string CategorieDb
        {
            get => Type switch
            {
                TypePlat.Entree => "Entree",
                TypePlat.Plat => "Plat",
                TypePlat.Dessert => "Dessert",
                _ => "Plat"
            };
            set
            {
                Type = value switch
                {
                    "Entree" => TypePlat.Entree,
                    "Plat" => TypePlat.Plat,
                    "Dessert" => TypePlat.Dessert,
                    _ => TypePlat.Plat
                };
            }
        }

        // Colonne DB: temps_minutes
        [JsonPropertyName("temps_minutes")]
        public int TempsMinutesDb
        {
            get => TempsPreparation;
            set => TempsPreparation = value;
        }

        // Colonne DB: note (1..5)
        [JsonPropertyName("note")]
        public int? NoteDb
        {
            get => Difficulte;
            set => Difficulte = Math.Clamp(value ?? 1, 1, 5);
        }

        [JsonPropertyName("is_favorite")]
        public bool IsFavorite { get; set; }

        [JsonPropertyName("instructions")]
        public string InstructionsDb
        {
            get => Instructions;
            set => Instructions = value ?? "";
        }

        // ‚úÖ Photo synchronis√©e (DB Supabase: photo_url)
        [JsonPropertyName("photo_url")]
        public string? PhotoUrl { get; set; }

        // ‚úÖ Photo locale (cache sur l'appareil) - NON envoy√©e √† Supabase
        [JsonIgnore]
        public string? PhotoLocalPath { get; set; }

        // ----------------------------
        // Propri√©t√©s m√©tier (non DB)
        // ----------------------------

        [JsonIgnore]
        public TypePlat Type { get; set; } = TypePlat.Plat;

        [JsonIgnore]
        public int TempsPreparation { get; set; } = 0;

        [JsonIgnore]
        public int Difficulte { get; set; } = 1;

        [JsonIgnore]
        public List<IngredientRecette> Ingredients { get; set; } = new();

        [JsonIgnore]
        public string Instructions { get; set; } = "";

        [JsonIgnore]
        public string TypeTexte => Type switch
        {
            TypePlat.Entree => "Entr√©e",
            TypePlat.Plat => "Plat",
            TypePlat.Dessert => "Dessert",
            _ => "Inconnu"
        };

        [JsonIgnore]
        public string DifficulteTexte => new string('‚≠ê', Math.Clamp(Difficulte, 1, 5));
    }
}

================================================================================
FILE: LoGeCuiShared\Services\ConfigurationHelper.cs
================================================================================

Ôªøusing System;

namespace LoGeCuiShared.Services
{
    public static class ConfigurationHelper
    {
        private static Func<string, string?>? _get;

        // Appel√© 1 fois au d√©marrage par le projet MAUI
        public static void Configure(Func<string, string?> getValue)
        {
            _get = getValue ?? throw new ArgumentNullException(nameof(getValue));
        }

        private static string Get(string key)
        {
            if (_get == null)
                throw new InvalidOperationException("ConfigurationHelper n'est pas configur√©. Appelez ConfigurationHelper.Configure(...) au d√©marrage.");

            return _get(key) ?? throw new InvalidOperationException($"Cl√© manquante : {key}");
        }

        // Versions s√ªres qui renvoient null si la cl√© est absente (pour permettre un d√©marrage sans crash)
        public static string? GetSupabaseUrlSafe() => _get?.Invoke("Supabase:Url");
        public static string? GetSupabaseKeySafe() => _get?.Invoke("Supabase:AnonKey");
        public static string? GetOcrApiKeySafe() => _get?.Invoke("OCR:ApiKey");

        // Les anciennes m√©thodes conservent le comportement strict (throw) ‚Äî vous pouvez les remplacer par les versions Safe si n√©cessaire.
        public static string GetSupabaseUrl() => Get("Supabase:Url");
        public static string GetSupabaseKey() => Get("Supabase:AnonKey");
        public static string GetOcrApiKey() => Get("OCR:ApiKey");
    }
}



================================================================================
FILE: LoGeCuiShared\Services\IngredientsService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Threading.Tasks;
using LoGeCuiShared.Models;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class IngredientsService
    {
        private readonly SupabaseRestClient _client;
        private const string Table = "ingredients";

        public IngredientsService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        public async Task<List<Ingredient>> GetIngredientsAsync(Guid userId)
        {
            var q =
                $"{Table}?" +
                "select=id,user_id,nom,quantite,unite,est_disponible,est_favori,created_at" +
                $"&user_id=eq.{userId}" +
                "&order=created_at.desc";

            return await _client.GetAsync<List<Ingredient>>(q) ?? new List<Ingredient>();
        }

        public async Task<Ingredient?> CreateIngredientAsync(Guid userId, Ingredient i)
        {
            var payload = new
            {
                user_id = userId,
                nom = i.Nom,
                quantite = string.IsNullOrWhiteSpace(i.Quantite) ? null : i.Quantite,
                unite = string.IsNullOrWhiteSpace(i.Unite) ? null : i.Unite,
                est_disponible = i.EstDisponible,
                est_favori = i.EstFavori
            };

            var created = await _client.PostAsync<List<Ingredient>>(
                $"{Table}?select=id,user_id,nom,quantite,unite,est_disponible,est_favori,created_at",
                payload,
                returnRepresentation: true);

            return created?.Count > 0 ? created[0] : null;
        }


        public async Task UpdateDisponibiliteAsync(Guid ingredientId, bool estDisponible)
        {
            var payload = new { est_disponible = estDisponible };
            await _client.PatchAsync($"{Table}?id=eq.{ingredientId}", payload);
        }

        public async Task DeleteIngredientAsync(Guid ingredientId)
        {
            await _client.DeleteAsync($"{Table}?id=eq.{ingredientId}");
        }

        public async Task UpdateFavoriAsync(Guid ingredientId, bool estFavori)
        {
            var payload = new { est_favori = estFavori };
            await _client.PatchAsync($"{Table}?id=eq.{ingredientId}", payload);
        }

    }
}



================================================================================
FILE: LoGeCuiShared\Services\ListeCoursesService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;

namespace LoGeCuiShared.Services
{
    public class ListeCoursesService
    {
        private readonly string _cheminFichier;

        public ListeCoursesService(string cheminFichier)
        {
            _cheminFichier = cheminFichier;
        }

        public List<ArticleCourse> ChargerListeCourses()
        {
            try
            {
                if (!File.Exists(_cheminFichier))
                {
                    return new List<ArticleCourse>();
                }

                string json = File.ReadAllText(_cheminFichier);
                var liste = JsonSerializer.Deserialize<List<ArticleCourse>>(json);
                return liste ?? new List<ArticleCourse>();
            }
            catch (Exception)
            {
                return new List<ArticleCourse>();
            }
        }

        public void SauvegarderListeCourses(List<ArticleCourse> articles)
        {
            try
            {
                var options = new JsonSerializerOptions { WriteIndented = true };
                string json = JsonSerializer.Serialize(articles, options);

                // Cr√©er le dossier si n√©cessaire
                var dossier = Path.GetDirectoryName(_cheminFichier);
                if (!string.IsNullOrEmpty(dossier) && !Directory.Exists(dossier))
                {
                    Directory.CreateDirectory(dossier);
                }

                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception)
            {
                throw;
            }
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\ListeCoursesSupabaseService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class ListeCoursesSupabaseService
    {
        private readonly SupabaseRestClient _client;
        private const string Table = "articles_courses";

        public ListeCoursesSupabaseService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        private static bool IsShared(Guid? listId) => listId.HasValue && listId.Value != Guid.Empty;

        // =========================
        // GET
        // =========================
        public async Task<List<ArticleCourseRow>> GetArticlesAsync(Guid userId, Guid? listId = null)
        {
            var q = IsShared(listId)
                ? $"{Table}?select=id,created_at,nom,quantite,unite,est_achete,user_id,list_id" +
                  $"&list_id=eq.{listId!.Value}" +
                  "&order=created_at.desc"
                : $"{Table}?select=id,created_at,nom,quantite,unite,est_achete,user_id,list_id" +
                  $"&user_id=eq.{userId}" +
                  "&order=created_at.desc";

            return await _client.GetAsync<List<ArticleCourseRow>>(q) ?? new List<ArticleCourseRow>();
        }

        // =========================
        // INSERT
        // ‚úÖ IMPORTANT: on envoie user_id explicitement => √©vite 403 RLS
        // =========================
        public async Task<ArticleCourseRow?> AddArticleAsync(Guid userId, string nom, string? quantite, string? unite, Guid? listId = null)
        {
            if (string.IsNullOrWhiteSpace(nom))
                throw new ArgumentException("nom requis", nameof(nom));

            if (listId == null || listId == Guid.Empty)
                throw new InvalidOperationException("Aucune liste active (list_id requis).");

            var payloadRow = new
            {
                user_id = userId,
                list_id = listId.Value,
                nom = nom.Trim(),
                quantite = quantite,
                unite = unite,
                est_achete = false
            };

            var created = await _client.PostAsync<List<ArticleCourseRow>>(
                $"{Table}?select=id,created_at,nom,quantite,unite,est_achete,user_id,list_id",
                new[] { payloadRow },
                returnRepresentation: true);

            return created?.FirstOrDefault();
        }


        // =========================
        // UPDATE (PATCH)
        // =========================
        public async Task UpdateArticleAsync(long id, bool estAchete)
        {
            var q = $"{Table}?id=eq.{id}";
            var payload = new { est_achete = estAchete };
            await _client.PatchAsync(q, payload);
        }

        // =========================
        // DELETE
        // =========================
        public async Task DeleteArticleAsync(long id)
        {
            await _client.DeleteAsync($"{Table}?id=eq.{id}");
        }

        // =========================
        // ADD MISSING (batch)
        // ‚úÖ Envoie user_id + list_id si partag√©
        // =========================
        public async Task AddMissingAsync(Guid userId, IEnumerable<string> missingNames, Guid? listId = null)
        {
            if (listId == null || listId == Guid.Empty)
                throw new InvalidOperationException("Aucune liste active (list_id requis).");

            var names = (missingNames ?? Enumerable.Empty<string>())
                .Where(n => !string.IsNullOrWhiteSpace(n))
                .Select(n => n.Trim())
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (names.Count == 0)
                return;

            bool shared = IsShared(listId);

            // 1) Lire ce qui existe d√©j√† (non achet√©)
            string existingQuery = shared
                ? $"{Table}?select=nom&list_id=eq.{listId!.Value}&est_achete=eq.false"
                : $"{Table}?select=nom&user_id=eq.{userId}&est_achete=eq.false";

            var existingRows = await _client.GetAsync<List<NomRow>>(existingQuery) ?? new List<NomRow>();

            var existing = existingRows
                .Where(r => !string.IsNullOrWhiteSpace(r.nom))
                .Select(r => r.nom!.Trim())
                .ToHashSet(StringComparer.OrdinalIgnoreCase);

            // 2) Construire payload
            var payload = new List<object>();

            foreach (var n in names)
            {
                if (existing.Contains(n))
                    continue;

                if (shared)
                {
                    payload.Add(new
                    {
                        user_id = userId,
                        list_id = listId!.Value,
                        nom = n,
                        quantite = (string?)null,
                        unite = (string?)null,
                        est_achete = false
                    });
                }
                else
                {
                    payload.Add(new
                    {
                        user_id = userId,
                        nom = n,
                        quantite = (string?)null,
                        unite = (string?)null,
                        est_achete = false
                    });
                }
            }

            if (payload.Count == 0)
                return;

            await _client.PostAsync<object>(
                Table,
                payload.ToArray(),
                returnRepresentation: false);
        }

        // =========================
        // RPC: join shared list
        // =========================
        public async Task<(Guid listId, string name, string code)?> JoinByCodeAsync(string shareCode)
        {
            if (string.IsNullOrWhiteSpace(shareCode))
                return null;

            var payload = new { p_share_code = shareCode.Trim() };

            var result = await _client.PostAsync<List<JoinResult>>(
                "rpc/join_shopping_list",
                payload,
                returnRepresentation: true);

            var row = result?.FirstOrDefault();
            if (row == null)
                return null;

            return (row.list_id, row.name ?? "Liste partag√©e", row.share_code ?? shareCode.Trim());
        }

        // =========================
        // DTOs
        // =========================
        private sealed class NomRow
        {
            public string? nom { get; set; }
        }

        private sealed class JoinResult
        {
            public Guid list_id { get; set; }
            public string? name { get; set; }
            public string? share_code { get; set; }
        }

        public sealed class ArticleCourseRow
        {
            public long id { get; set; }
            public DateTimeOffset created_at { get; set; }
            public string? nom { get; set; }
            public string? quantite { get; set; }
            public string? unite { get; set; }
            public bool est_achete { get; set; }
            public Guid user_id { get; set; }
            public Guid? list_id { get; set; }
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\RecetteIngredientsService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class RecetteIngredientsService
    {
        private readonly SupabaseRestClient _client;
        private const string Table = "recette_ingredients";

        public RecetteIngredientsService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        // DTO conforme au sch√©ma DB
        private sealed class Row
        {
            public string? ingredient_nom { get; set; }
            public string? quantite { get; set; }
            public string? unite { get; set; }
        }

        public async Task<List<(string nom, string? quantite, string? unite)>> GetForRecetteAsync(Guid recetteId)
        {
            var q = $"{Table}?select=ingredient_nom,quantite,unite&recette_id=eq.{recetteId}&order=created_at.asc";
            var rows = await _client.GetAsync<List<Row>>(q) ?? new List<Row>();

            return rows
                .Where(r => !string.IsNullOrWhiteSpace(r.ingredient_nom))
                .Select(r => (r.ingredient_nom!.Trim(), r.quantite, r.unite))
                .ToList();
        }

        // Remplace la liste compl√®te (simple et robuste)
        public async Task ReplaceForRecetteAsync(Guid recetteId, IEnumerable<(string nom, string? quantite, string? unite)> items)
        {
            // 1) delete
            await _client.DeleteAsync($"{Table}?recette_id=eq.{recetteId}");

            // 2) insert
            var payload = items
                .Where(i => !string.IsNullOrWhiteSpace(i.nom))
                .Select(i => new
                {
                    recette_id = recetteId,
                    ingredient_nom = i.nom.Trim(),
                    quantite = string.IsNullOrWhiteSpace(i.quantite) ? null : i.quantite.Trim(),
                    unite = string.IsNullOrWhiteSpace(i.unite) ? null : i.unite.Trim()
                })
                .ToArray();

            if (payload.Length == 0)
                return;

            await _client.PostAsync<object>(Table, payload, returnRepresentation: false);
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\RecipesService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiShared.Models;

namespace LoGeCuiShared.Services
{
    public sealed class RecipesService
    {
        private readonly SupabaseRestClient _client;

        public RecipesService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        // ‚úÖ Toujours s√©lectionner ces colonnes (sinon: pas de photo + pas d'external_id)
        private const string SelectCols =
            "id,created_at,owner_user_id,nom,categorie,temps_minutes,note,is_favorite,instructions,external_id,photo_url";

        /// <summary>
        /// R√©cup√®re TOUTES les recettes de l‚Äôutilisateur courant
        /// </summary>
        public async Task<List<Recette>> GetRecettesAsync(Guid userId)
        {
            var q =
                "recettes?" +
                $"select={SelectCols}" +
                $"&owner_user_id=eq.{userId}" +
                "&order=created_at.desc";

            return await _client.GetAsync<List<Recette>>(q)
                   ?? new List<Recette>();
        }

        /// <summary>
        /// R√©cup√®re les recettes (optionnellement filtr√©es par cat√©gorie)
        /// </summary>
        public async Task<List<Recette>> GetMyRecettesAsync(Guid userId, string? categorie = null)
        {
            var q =
                "recettes?" +
                $"select={SelectCols}" +
                $"&owner_user_id=eq.{userId}" +
                "&order=created_at.desc";

            if (!string.IsNullOrWhiteSpace(categorie) &&
                !string.Equals(categorie, "Toutes", StringComparison.OrdinalIgnoreCase))
            {
                q += $"&categorie=eq.{Uri.EscapeDataString(categorie)}";
            }

            return await _client.GetAsync<List<Recette>>(q)
                   ?? new List<Recette>();
        }

        /// <summary>
        /// Cr√©e une recette et retourne la recette cr√©√©e
        /// </summary>
        public async Task<Recette?> CreateRecetteAsync(Guid ownerUserId, Recette r)
        {
            if (r == null) throw new ArgumentNullException(nameof(r));

            // ‚úÖ external_id obligatoire pour √©viter les futurs doublons
            if (string.IsNullOrWhiteSpace(r.ExternalId))
                r.ExternalId = Guid.NewGuid().ToString("N");

            var payload = new
            {
                owner_user_id = ownerUserId,
                external_id = r.ExternalId,
                nom = r.Nom,
                categorie = r.CategorieDb,
                temps_minutes = r.TempsMinutesDb,
                note = r.NoteDb,
                is_favorite = r.IsFavorite,
                instructions = r.InstructionsDb,
                photo_url = r.PhotoUrl
            };

            var created = await _client.PostAsync<List<Recette>>(
                $"recettes?select={SelectCols}",
                payload,
                returnRepresentation: true);

            return created?.FirstOrDefault();
        }

        /// <summary>
        /// Supprime une recette
        /// </summary>
        public async Task DeleteRecetteAsync(Guid recetteId)
        {
            await _client.DeleteAsync($"recettes?id=eq.{recetteId}");
        }

        /// <summary>
        /// Insert ou met √† jour une recette via (owner_user_id, external_id)
        /// ‚úÖ √©vite les doublons si external_id n'est pas unique globalement
        /// </summary>
        public async Task UpsertRecetteAsync(Guid ownerUserId, Recette r)
        {
            if (r == null) throw new ArgumentNullException(nameof(r));

            if (string.IsNullOrWhiteSpace(r.ExternalId))
                throw new ArgumentException("ExternalId est requis pour upsert.", nameof(r));

            var payload = new[]
            {
                new
                {
                    owner_user_id = ownerUserId,
                    external_id = r.ExternalId,
                    nom = r.Nom,
                    categorie = r.CategorieDb,
                    temps_minutes = r.TempsMinutesDb,
                    note = r.NoteDb,
                    is_favorite = r.IsFavorite,
                    instructions = r.InstructionsDb,
                    photo_url = r.PhotoUrl
                }
            };

            // ‚úÖ IMPORTANT :
            // n√©cessite une contrainte unique sur (owner_user_id, external_id) c√¥t√© DB.
            await _client.PostAsync<object>(
                "recettes?on_conflict=owner_user_id,external_id",
                payload,
                returnRepresentation: false,
                mergeDuplicates: true);
        }

        public async Task<Guid?> GetRecetteIdByExternalIdAsync(Guid userId, string externalId)
        {
            if (string.IsNullOrWhiteSpace(externalId))
                throw new ArgumentException("externalId requis", nameof(externalId));

            var q =
                "recettes?" +
                "select=id" +
                $"&owner_user_id=eq.{userId}" +
                $"&external_id=eq.{Uri.EscapeDataString(externalId)}" +
                "&limit=1";

            var rows = await _client.GetAsync<List<RecetteIdRow>>(q);

            return rows?.FirstOrDefault()?.id;
        }

        private sealed class RecetteIdRow
        {
            public Guid id { get; set; }
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\ShoppingListBootstrapService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace LoGeCuiShared.Services
{
    public sealed class ShoppingListBootstrapService
    {
        private readonly SupabaseRestClient _client;

        public ShoppingListBootstrapService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        private sealed class Row
        {
            public Guid list_id { get; set; }
        }

        public async Task<Guid?> GetFirstListIdForUserAsync(Guid userId)
        {
            var q =
                "shopping_list_members?select=list_id" +
                $"&user_id=eq.{userId}" +
                "&limit=1";

            var rows = await _client.GetAsync<List<Row>>(q);
            return rows?.FirstOrDefault()?.list_id;
        }
    }
}


================================================================================
FILE: LoGeCuiShared\Services\ShoppingListsService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class ShoppingListsService
    {
        private readonly SupabaseRestClient _client;

        public ShoppingListsService(SupabaseRestClient client)
        {
            _client = client;
        }

        private sealed class ShoppingListRow
        {
            public Guid id { get; set; }
            public Guid owner_user_id { get; set; }
            public string? name { get; set; }
            public string? share_code { get; set; }
        }

        public async Task<Guid> EnsurePersonalListIdAsync(Guid userId)
        {
            // 1) Chercher une liste existante
            var q = "shopping_lists?select=id,owner_user_id,name,share_code" +
                    $"&owner_user_id=eq.{userId}" +
                    "&order=created_at.asc&limit=1";

            var existing = await _client.GetAsync<List<ShoppingListRow>>(q);
            var row = existing?.FirstOrDefault();
            if (row != null)
                return row.id;

            // 2) Sinon cr√©er une liste perso
            var payload = new[]
            {
                new
                {
                    owner_user_id = userId,
                    name = "Ma liste"
                    // share_code g√©n√©r√© automatiquement par le trigger SQL
                }
            };

            var created = await _client.PostAsync<List<ShoppingListRow>>(
                "shopping_lists?select=id,owner_user_id,name,share_code",
                payload,
                returnRepresentation: true);

            return created!.First().id;
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\SupabaseRestClient.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text;
using System.Text.Json;

namespace LoGeCuiShared.Services
{
    public sealed class SupabaseRestClient
    {
        private readonly HttpClient _http;
        private readonly string _baseRestUrl;

        public SupabaseRestClient(string supabaseUrl, string supabaseAnonKey)
        {
            if (string.IsNullOrWhiteSpace(supabaseUrl)) throw new ArgumentException("supabaseUrl is required");
            if (string.IsNullOrWhiteSpace(supabaseAnonKey)) throw new ArgumentException("supabaseAnonKey is required");

            _baseRestUrl = supabaseUrl.TrimEnd('/') + "/rest/v1/";

            _http = new HttpClient();
            _http.DefaultRequestHeaders.Add("apikey", supabaseAnonKey);
            _http.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
        }

        public void SetBearerToken(string accessToken)
        {
            _http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
        }

        public async Task<T?> GetAsync<T>(string pathAndQuery)
        {
            var url = _baseRestUrl + pathAndQuery;

            using var resp = await _http.GetAsync(url);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase GET failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");

            return JsonSerializer.Deserialize<T>(body, JsonOptions());
        }

        public async Task<T?> PostAsync<T>(string pathAndQuery, object payload, bool returnRepresentation = false)
        {
            var url = _baseRestUrl + pathAndQuery;
            var json = JsonSerializer.Serialize(payload, JsonOptions());

            using var req = new HttpRequestMessage(HttpMethod.Post, url)
            {
                Content = new StringContent(json, Encoding.UTF8, "application/json")
            };

            if (returnRepresentation)
                req.Headers.Add("Prefer", "return=representation");

            using var resp = await _http.SendAsync(req);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase POST failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");

            if (string.IsNullOrWhiteSpace(body))
                return default;

            return JsonSerializer.Deserialize<T>(body, JsonOptions());
        }

        public async Task PatchAsync(string pathAndQuery, object payload)
        {
            var url = _baseRestUrl + pathAndQuery;
            var json = JsonSerializer.Serialize(payload, JsonOptions());

            using var req = new HttpRequestMessage(new HttpMethod("PATCH"), url)
            {
                Content = new StringContent(json, Encoding.UTF8, "application/json")
            };

            using var resp = await _http.SendAsync(req);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase PATCH failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");
        }

        public async Task DeleteAsync(string pathAndQuery)
        {
            var url = _baseRestUrl + pathAndQuery;

            using var resp = await _http.DeleteAsync(url);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase DELETE failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");
        }

        private static JsonSerializerOptions JsonOptions() => new()
        {
            PropertyNameCaseInsensitive = true
        };

        public async Task<T?> PostAsync<T>(
        string pathAndQuery,
        object payload,
        bool returnRepresentation = false,
        bool mergeDuplicates = false)
        {
            var url = _baseRestUrl + pathAndQuery;
            var json = JsonSerializer.Serialize(payload, JsonOptions());

            using var req = new HttpRequestMessage(HttpMethod.Post, url)
            {
                Content = new StringContent(json, Encoding.UTF8, "application/json")
            };

            // PostgREST Prefer headers
            if (returnRepresentation)
                req.Headers.Add("Prefer", "return=representation");

            if (mergeDuplicates)
                req.Headers.Add("Prefer", "resolution=merge-duplicates");

            using var resp = await _http.SendAsync(req);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase POST failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");

            if (string.IsNullOrWhiteSpace(body))
                return default;

            return JsonSerializer.Deserialize<T>(body, JsonOptions());
        }

    }
}


================================================================================
FILE: LoGeCuiShared\Services\SupabaseService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Json;
using System.Text.Json;
using System.Threading.Tasks;
using LoGeCuiShared.Models;
using Supabase.Postgrest;
using Supabase.Postgrest.Attributes;
using Supabase.Postgrest.Models;
using System.Net.Http.Headers;


namespace LoGeCuiShared.Services
{
    public class SupabaseService
    {
        private readonly HttpClient _httpClient;
        private readonly string _supabaseUrl;
        private readonly string _supabaseKey;

        // Session courante (apr√®s login)
        private string? _accessToken;    // JWT utilisateur
        private string? _currentUserId;  // GUID string

        private readonly Client _client;

        public SupabaseService(string url, string key)
        {
            _supabaseUrl = url ?? throw new ArgumentNullException(nameof(url));
            _supabaseKey = key ?? throw new ArgumentNullException(nameof(key));

            _httpClient = new HttpClient { Timeout = TimeSpan.FromSeconds(30) };

            var options = new ClientOptions
            {
                Headers = new Dictionary<string, string>
                {
                    { "apikey", key },
                    // Tant qu'on n'est pas connect√©, on reste en "anon"
                    { "Authorization", $"Bearer {key}" }
                }
            };

            _client = new Client($"{url}/rest/v1", options);
        }

        // =========================
        // SESSION
        // =========================

        public void SetSession(string accessToken, string userId)
        {
            if (string.IsNullOrWhiteSpace(accessToken))
                throw new ArgumentException("accessToken manquant", nameof(accessToken));

            if (string.IsNullOrWhiteSpace(userId))
                throw new ArgumentException("userId manquant", nameof(userId));

            _accessToken = accessToken;
            _currentUserId = userId;

            // IMPORTANT: PostgREST doit utiliser le JWT utilisateur pour RLS
            _client.Options.Headers["Authorization"] = $"Bearer {_accessToken}";
        }

        public void ClearSession()
        {
            _accessToken = null;
            _currentUserId = null;

            // Retour "anon"
            _client.Options.Headers["Authorization"] = $"Bearer {_supabaseKey}";
        }

        public string? GetCurrentUserId() => _currentUserId;

        private Guid RequireCurrentUserGuid()
        {
            if (string.IsNullOrWhiteSpace(_currentUserId))
                throw new InvalidOperationException("Utilisateur non connect√©. Veuillez vous reconnecter.");

            if (!Guid.TryParse(_currentUserId, out var guid))
                throw new InvalidOperationException("Identifiant utilisateur invalide. Veuillez vous reconnecter.");

            return guid;
        }

        private void RequireAccessToken()
        {
            if (string.IsNullOrWhiteSpace(_accessToken))
                throw new InvalidOperationException("Session invalide. Veuillez vous reconnecter.");
        }

        // =========================
        // AUTH REST
        // =========================

        public async Task<(bool success, string? userId, string? error)> SignUpAsync(string email, string password)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
                    return (false, null, "Adresse email invalide");

                if (string.IsNullOrWhiteSpace(password) || password.Length < 6)
                    return (false, null, "Le mot de passe doit contenir au moins 6 caract√®res");

                var request = new { email = email.Trim(), password };

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);
                _httpClient.DefaultRequestHeaders.Authorization =
                    new AuthenticationHeaderValue("Bearer", _supabaseKey);

                var response = await _httpClient.PostAsJsonAsync($"{_supabaseUrl}/auth/v1/signup", request);
                var content = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                    return (false, null, ExtractSupabaseError(content, response.StatusCode));

                // Supabase renvoie souvent { user: { id: ... } }, parfois { id: ... }
                try
                {
                    var json = JsonDocument.Parse(content);

                    if (json.RootElement.TryGetProperty("user", out var userEl) &&
                        userEl.TryGetProperty("id", out var uidEl))
                    {
                        var uid = uidEl.GetString();
                        if (!string.IsNullOrWhiteSpace(uid))
                            return (true, uid, null);
                    }

                    if (json.RootElement.TryGetProperty("id", out var idEl))
                    {
                        var uid = idEl.GetString();
                        if (!string.IsNullOrWhiteSpace(uid))
                            return (true, uid, null);
                    }

                    return (true, "unknown", null);
                }
                catch
                {
                    return (true, "unknown", null);
                }
            }
            catch (HttpRequestException)
            {
                return (false, null, "Erreur de connexion au serveur. V√©rifiez votre connexion internet.");
            }
            catch (TaskCanceledException)
            {
                return (false, null, "La requ√™te a expir√©. V√©rifiez votre connexion internet.");
            }
            catch (Exception ex)
            {
                return (false, null, $"Erreur inattendue : {ex.Message}");
            }
        }

        public async Task<(bool success, string? accessToken, string? userId, string? error)> SignInAsync(string email, string password)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
                    return (false, null, null, "Adresse email invalide");

                if (string.IsNullOrWhiteSpace(password))
                    return (false, null, null, "Le mot de passe est requis");

                var request = new { email = email.Trim(), password };

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);

                var response = await _httpClient.PostAsJsonAsync(
                    $"{_supabaseUrl}/auth/v1/token?grant_type=password",
                    request);

                var content = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                    return (false, null, null, ExtractSupabaseError(content, response.StatusCode));

                var json = JsonDocument.Parse(content);

                var token = json.RootElement.GetProperty("access_token").GetString();
                var userId = json.RootElement.GetProperty("user").GetProperty("id").GetString();

                if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
                    return (false, null, null, "R√©ponse Supabase invalide (token/userId manquant).");

                SetSession(token, userId);
                return (true, token, userId, null);
            }
            catch (HttpRequestException)
            {
                return (false, null, null, "Erreur de connexion au serveur. V√©rifiez votre connexion internet.");
            }
            catch (TaskCanceledException)
            {
                return (false, null, null, "La requ√™te a expir√©. V√©rifiez votre connexion internet.");
            }
            catch (Exception ex)
            {
                return (false, null, null, $"Erreur inattendue : {ex.Message}");
            }
        }

        public async Task<(bool success, string? accessToken, string? userId, string? error)>
            SignUpThenSignInAsync(string email, string password)
        {
            var (signUpSuccess, _, signUpError) = await SignUpAsync(email, password);
            if (!signUpSuccess)
                return (false, null, null, signUpError);

            var (signInSuccess, accessToken, userId, signInError) = await SignInAsync(email, password);
            if (!signInSuccess)
                return (false, null, null, signInError);

            return (true, accessToken, userId, null);
        }

        public async Task<(bool success, string? error)> SendPasswordResetAsync(string email)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
                    return (false, "Adresse email invalide");

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);

                var request = new
                {
                    email = email.Trim(),
                    redirect_to = "https://logecui.fr/logecui-reset-password/index.html"
                };

                var response = await _httpClient.PostAsJsonAsync($"{_supabaseUrl}/auth/v1/recover", request);
                var content = await response.Content.ReadAsStringAsync();

                return response.IsSuccessStatusCode
                    ? (true, null)
                    : (false, ExtractSupabaseError(content, response.StatusCode));
            }
            catch
            {
                return (false, "Erreur r√©seau. R√©essayez plus tard.");
            }
        }

        public async Task<(bool success, string? error)> UpdatePasswordAsync(string accessToken, string newPassword)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(newPassword) || newPassword.Length < 6)
                    return (false, "Le mot de passe doit contenir au moins 6 caract√®res.");

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);
                _httpClient.DefaultRequestHeaders.Add("Authorization", $"Bearer {accessToken}");

                var response = await _httpClient.PutAsJsonAsync(
                    $"{_supabaseUrl}/auth/v1/user",
                    new { password = newPassword });

                var content = await response.Content.ReadAsStringAsync();

                return response.IsSuccessStatusCode
                    ? (true, null)
                    : (false, ExtractSupabaseError(content, response.StatusCode));
            }
            catch
            {
                return (false, "Erreur r√©seau.");
            }
        }

        // =========================
        // EDGE FUNCTION : DELETE ACCOUNT
        // =========================

        public async Task<(bool success, string? error)> DeleteAccountAsync()
        {
            try
            {
                RequireAccessToken();

                System.Diagnostics.Debug.WriteLine("=== DELETE ACCOUNT DEBUG ===");
                System.Diagnostics.Debug.WriteLine($"Token: {_accessToken?.Substring(0, 30)}");

                // ‚úÖ IMPORTANT : Cr√©er une nouvelle requ√™te √† chaque fois
                using var request = new HttpRequestMessage(HttpMethod.Post,
                    $"{_supabaseUrl}/functions/v1/delete-account");

                // ‚úÖ Ajouter les headers dans le bon ordre
                request.Headers.TryAddWithoutValidation("apikey", _supabaseKey);
                request.Headers.TryAddWithoutValidation("Authorization", $"Bearer {_accessToken}");

                System.Diagnostics.Debug.WriteLine($"Headers added: {request.Headers.Count()}");

                var response = await _httpClient.SendAsync(request);
                var content = await response.Content.ReadAsStringAsync();

                System.Diagnostics.Debug.WriteLine($"Response: {(int)response.StatusCode} - {content}");

                if (!response.IsSuccessStatusCode)
                {
                    return (false, $"Erreur : {content}");
                }

                // Nettoyage local
                var userGuid = RequireCurrentUserGuid();
                await _client.Table<ArticleCourseDb>()
                    .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                    .Delete();

                await _client.Table<IngredientDb>()
                    .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                    .Delete();

                ClearSession();
                return (true, null);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Exception: {ex.Message}");
                return (false, $"Erreur : {ex.Message}");
            }
        }



        // =========================
        // ARTICLES (Liste de courses)
        // =========================

        public async Task<List<ArticleCourse>> GetArticlesAsync()
        {
            var userGuid = RequireCurrentUserGuid();

            var response = await _client
                .Table<ArticleCourseDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Get();

            return response.Models.Select(db => new ArticleCourse
            {
                Id = db.Id,
                Nom = db.Nom ?? "",
                Quantite = db.Quantite ?? "",
                Unite = db.Unite ?? "",
                EstAchete = db.EstAchete,
                // IMPORTANT: si ton mod√®le ArticleCourse.UserId est Guid (non nullable),
                // on prot√®ge avec ?? Guid.Empty
                UserId = db.UserId ?? Guid.Empty
            }).ToList();
        }

        public async Task<ArticleCourse?> AddArticleAsync(ArticleCourse article)
        {
            var userGuid = RequireCurrentUserGuid();

            var dbArticle = new ArticleCourseDb
            {
                Nom = article.Nom,
                Quantite = article.Quantite,
                Unite = article.Unite,
                EstAchete = article.EstAchete,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            var response = await _client.Table<ArticleCourseDb>().Insert(dbArticle);
            var inserted = response.Models.FirstOrDefault();
            if (inserted == null) return null;

            return new ArticleCourse
            {
                Id = inserted.Id,
                Nom = inserted.Nom ?? "",
                Quantite = inserted.Quantite ?? "",
                Unite = inserted.Unite ?? "",
                EstAchete = inserted.EstAchete,
                UserId = inserted.UserId ?? Guid.Empty
            };
        }

        public async Task<bool> UpdateArticleAsync(int id, ArticleCourse article)
        {
            var userGuid = RequireCurrentUserGuid();

            var dbArticle = new ArticleCourseDb
            {
                Id = id,
                Nom = article.Nom,
                Quantite = article.Quantite,
                Unite = article.Unite,
                EstAchete = article.EstAchete,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            await _client.Table<ArticleCourseDb>().Update(dbArticle);
            return true;
        }

        public async Task<bool> DeleteArticleAsync(int id)
        {
            var userGuid = RequireCurrentUserGuid();

            // S√©curise par user_id (sinon RLS peut bloquer ou pire, toucher autre chose si policy permissive)
            await _client.Table<ArticleCourseDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Filter("id", Supabase.Postgrest.Constants.Operator.Equals, id)
                .Delete();

            return true;
        }

        public async Task<bool> DeleteAchetesAsync()
        {
            var userGuid = RequireCurrentUserGuid();

            await _client.Table<ArticleCourseDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Filter("est_achete", Supabase.Postgrest.Constants.Operator.Equals, true)
                .Delete();

            return true;
        }

        // =========================
        // INGREDIENTS
        // =========================

        public async Task<List<Ingredient>> GetIngredientsAsync()
        {
            var userGuid = RequireCurrentUserGuid();

            var response = await _client
                .Table<IngredientDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Get();

            return response.Models.Select(db => new Ingredient
            {
                Id = db.Id,
                // Si Ingredient.UserId est Guid (non nullable), on prot√®ge :
                UserId = db.UserId ?? Guid.Empty,
                Nom = db.Nom ?? "",
                Quantite = db.Quantite ?? "",
                Unite = db.Unite ?? "",
                EstDisponible = db.EstDisponible
            }).ToList();
        }

        public async Task<Ingredient?> AddIngredientAsync(Ingredient ingredient)
        {
            var userGuid = RequireCurrentUserGuid();

            var db = new IngredientDb
            {
                Nom = ingredient.Nom,
                Quantite = ingredient.Quantite,
                Unite = ingredient.Unite,
                EstDisponible = ingredient.EstDisponible,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            var response = await _client.Table<IngredientDb>().Insert(db);
            var inserted = response.Models.FirstOrDefault();
            if (inserted == null) return null;

            return new Ingredient
            {
                Id = inserted.Id,
                UserId = inserted.UserId ?? Guid.Empty,
                Nom = inserted.Nom ?? "",
                Quantite = inserted.Quantite ?? "",
                Unite = inserted.Unite ?? "",
                EstDisponible = inserted.EstDisponible
            };
        }

        public async Task<bool> UpdateIngredientAsync(Ingredient ingredient)
        {
            var userGuid = RequireCurrentUserGuid();

            if (ingredient.Id == Guid.Empty)
                throw new InvalidOperationException("Id ingr√©dient manquant.");

            var db = new IngredientDb
            {
                Id = ingredient.Id,
                Nom = ingredient.Nom,
                Quantite = ingredient.Quantite,
                Unite = ingredient.Unite,
                EstDisponible = ingredient.EstDisponible,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            await _client.Table<IngredientDb>().Update(db);
            return true;
        }

        public async Task<bool> DeleteIngredientAsync(Guid id)
        {
            var userGuid = RequireCurrentUserGuid();

            if (id == Guid.Empty)
                throw new InvalidOperationException("Id ingr√©dient manquant.");

            await _client.Table<IngredientDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Filter("id", Supabase.Postgrest.Constants.Operator.Equals, id.ToString())
                .Delete();

            return true;
        }

        // =========================
        // UTIL
        // =========================

        private static string ExtractSupabaseError(string content, System.Net.HttpStatusCode code)
        {
            if (!string.IsNullOrWhiteSpace(content))
            {
                try
                {
                    var json = JsonDocument.Parse(content);

                    if (json.RootElement.TryGetProperty("msg", out var msg)) return msg.GetString() ?? $"Erreur {code}";
                    if (json.RootElement.TryGetProperty("error_description", out var ed)) return ed.GetString() ?? $"Erreur {code}";
                    if (json.RootElement.TryGetProperty("message", out var m)) return m.GetString() ?? $"Erreur {code}";
                    if (json.RootElement.TryGetProperty("error", out var e)) return e.GetString() ?? $"Erreur {code}";
                }
                catch
                {
                    if (content.Length < 400) return content;
                }
            }

            return $"Erreur {code}";
        }
    }

    // =========================
    // MODELES DB
    // =========================

    [Table("articles_courses")]
    public class ArticleCourseDb : BaseModel
    {
        [PrimaryKey("id", false)]
        public int Id { get; set; }

        [Column("nom")]
        public string? Nom { get; set; }

        [Column("quantite")]
        public string? Quantite { get; set; }

        [Column("unite")]
        public string? Unite { get; set; }

        [Column("est_achete")]
        public bool EstAchete { get; set; }

        [Column("user_id")]
        public Guid? UserId { get; set; } // DB nullable -> mapping prot√®ge avec ?? Guid.Empty
    }

    [Table("ingredients")]
    public class IngredientDb : BaseModel
    {
        [PrimaryKey("id", false)]
        public Guid Id { get; set; }

        [Column("nom")]
        public string? Nom { get; set; }

        [Column("quantite")]
        public string? Quantite { get; set; }

        [Column("unite")]
        public string? Unite { get; set; }

        [Column("est_disponible")]
        public bool EstDisponible { get; set; }

        [Column("user_id")]
        public Guid? UserId { get; set; } // DB nullable -> mapping prot√®ge avec ?? Guid.Empty
    }
}



================================================================================
FILE: LoGeCuiShared\Services\updateService.cs
================================================================================

Ôªøusing System;
using System.Linq;
using System.Threading.Tasks;
using Supabase.Postgrest;
using Supabase.Postgrest.Attributes;
using Supabase.Postgrest.Models;

namespace LoGeCuiShared.Services
{
    public class UpdateService
    {
        private readonly Client _client;

        public UpdateService(string url, string key)
        {
            var options = new ClientOptions
            {
                Headers = new Dictionary<string, string>
                {
                    { "apikey", key },
                    { "Authorization", $"Bearer {key}" }
                }
            };

            _client = new Client($"{url}/rest/v1", options);
        }

        public async Task<AppVersionInfo?> CheckForUpdateAsync(string platform, string currentVersion)
        {
            try
            {
                var response = await _client
                    .Table<AppVersionDb>()
                    .Filter("platform", Supabase.Postgrest.Constants.Operator.Equals, platform)
                    .Order("created_at", Supabase.Postgrest.Constants.Ordering.Descending)
                    .Limit(1)
                    .Get();

                var latestVersion = response.Models.FirstOrDefault();

                if (latestVersion == null)
                    return null;

                // Comparer les versions
                if (IsNewerVersion(latestVersion.Version, currentVersion))
                {
                    return new AppVersionInfo
                    {
                        Version = latestVersion.Version ?? "",
                        DownloadUrl = latestVersion.DownloadUrl ?? "",
                        IsMandatory = latestVersion.IsMandatory,
                        ReleaseNotes = latestVersion.ReleaseNotes ?? ""
                    };
                }

                return null; // Pas de mise √† jour disponible
            }
            catch
            {
                return null;
            }
        }

        private bool IsNewerVersion(string? latestVersion, string currentVersion)
        {
            if (string.IsNullOrEmpty(latestVersion))
                return false;

            try
            {
                var latest = new Version(latestVersion);
                var current = new Version(currentVersion);
                return latest > current;
            }
            catch
            {
                return false;
            }
        }
    }

    // Mod√®le pour la table app_versions
    [Table("app_versions")]
    public class AppVersionDb : BaseModel
    {
        [PrimaryKey("id", false)]
        public int Id { get; set; }

        [Column("platform")]
        public string? Platform { get; set; }

        [Column("version")]
        public string? Version { get; set; }

        [Column("download_url")]
        public string? DownloadUrl { get; set; }

        [Column("is_mandatory")]
        public bool IsMandatory { get; set; }

        [Column("release_notes")]
        public string? ReleaseNotes { get; set; }

        [Column("created_at")]
        public DateTime CreatedAt { get; set; }
    }

    // Classe pour retourner les infos de version
    public class AppVersionInfo
    {
        public string Version { get; set; } = "";
        public string DownloadUrl { get; set; } = "";
        public bool IsMandatory { get; set; }
        public string ReleaseNotes { get; set; } = "";
    }
}

================================================================================
FILE: LoGeCuiShared\Utils\IngredientNormalizer.cs
================================================================================

Ôªøusing System.Globalization;
using System.Text;

namespace LoGeCuiShared.Utils
{
    public static class IngredientNormalizer
    {
        public static string Normalize(string? s)
        {
            if (string.IsNullOrWhiteSpace(s))
                return "";

            s = s.Trim().ToLowerInvariant();

            // üîπ Enlever les accents
            s = s.Normalize(NormalizationForm.FormD);
            var sb = new StringBuilder(s.Length);
            foreach (var ch in s)
            {
                var uc = CharUnicodeInfo.GetUnicodeCategory(ch);
                if (uc != UnicodeCategory.NonSpacingMark)
                    sb.Append(ch);
            }
            s = sb.ToString().Normalize(NormalizationForm.FormC);

            // üîπ Remplacer la ponctuation par des espaces
            var sb2 = new StringBuilder(s.Length);
            foreach (var ch in s)
            {
                if (char.IsLetterOrDigit(ch) || ch == ' ')
                    sb2.Append(ch);
                else
                    sb2.Append(' ');
            }
            s = sb2.ToString();

            // üîπ Nettoyer espaces multiples
            while (s.Contains("  "))
                s = s.Replace("  ", " ");

            s = s.Trim();

            // üîπ Pluriels simples
            if (s.EndsWith("s") && s.Length > 3)
                s = s[..^1];

            // üîπ Pluriels irr√©guliers courants
            if (s == "oeufs") return "oeuf";

            return s;
        }
    }
}

================================================================================
FILE: output_concat.txt
================================================================================

# CONCAT OUTPUT
# Root: C:\Users\Francois\source\repos\LoGeCui
# Files: 118


================================================================================
FILE: LoGeCui\App.xaml
================================================================================

Ôªø<Application x:Class="LoGeCui.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Application.Resources>
         
    </Application.Resources>
</Application>

================================================================================
FILE: LoGeCui\App.xaml.cs
================================================================================

Ôªøusing System;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCui
{
    public partial class App : Application
    {
        // AJOUT√â : Instance unique de SupabaseService
        public static SupabaseService SupabaseService { get; private set; }
        public static SupabaseRestClient? RestClient { get; private set; }
        public static RecipesService? RecipesService { get; private set; }
        public static Guid? CurrentUserId { get; private set; }

        protected override void OnStartup(StartupEventArgs e)
        {
            base.OnStartup(e);

            // AJOUT√â : Initialiser le service Supabase UNE SEULE FOIS
            string url = ConfigurationHelper.GetSupabaseUrl();
            string key = ConfigurationHelper.GetSupabaseKey(); // Remplace par ta cl√© anon

            // Cr√©er l'instance UNE SEULE FOIS
            SupabaseService = new SupabaseService(url, key);

            // Ouvrir la fen√™tre de connexion en premier
            var loginWindow = new LoginWindow();
            loginWindow.Show();
        }

        public static void InitRestServices(string accessToken, Guid userId)
        {
            string url = ConfigurationHelper.GetSupabaseUrl();
            string key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            RestClient = client;
            RecipesService = new RecipesService(client);
            CurrentUserId = userId;
        }
    }
}

================================================================================
FILE: LoGeCui\appsettings.example.json
================================================================================

Ôªø{
  "Supabase": {
    "Url": "https://VOTRE_PROJECT_ID.supabase.co",
    "Key": "VOTRE_PUBLISHABLE_KEY"
  }
}

================================================================================
FILE: LoGeCui\appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  }

}

================================================================================
FILE: LoGeCui\AssemblyInfo.cs
================================================================================

using System.Windows;

[assembly: ThemeInfo(
    ResourceDictionaryLocation.None,            //where theme specific resource dictionaries are located
                                                //(used if a resource is not found in the page,
                                                // or application resource dictionaries)
    ResourceDictionaryLocation.SourceAssembly   //where the generic resource dictionary is located
                                                //(used if a resource is not found in the page,
                                                // app, or any theme specific resource dictionaries)
)]

================================================================================
FILE: LoGeCui\ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using System;
using System.IO;

namespace LoGeCui
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;

        public static IConfiguration Configuration
        {
            get
            {
                if (_configuration == null)
                {
                    var builder = new ConfigurationBuilder()
                        .SetBasePath(AppDomain.CurrentDomain.BaseDirectory)
                        .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true);

                    _configuration = builder.Build();
                }
                return _configuration;
            }
        }

        public static string GetSupabaseUrl()
        {
            return Configuration["Supabase:Url"] ?? throw new Exception("Supabase URL non configur√©e");
        }

        public static string GetSupabaseKey()
        {
            return Configuration["Supabase:Key"] ?? throw new Exception("Supabase Key non configur√©e");
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterArticleCourseDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterArticleCourseDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter un article" 
        Height="400" 
        Width="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0"
                   Text="üõí Ajouter √† la liste de courses"
                   FontSize="18"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <StackPanel Grid.Row="1" Margin="0,0,0,10">
            <TextBlock Text="Nom *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtNom"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <StackPanel Grid.Row="2" Margin="0,0,0,10">
            <TextBlock Text="Quantit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtQuantite"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <StackPanel Grid.Row="3" Margin="0,0,0,10">
            <TextBlock Text="Unit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <ComboBox x:Name="CmbUnite"
                      Height="30"
                      FontSize="13"
                      Padding="5">
                <ComboBoxItem Content="g"/>
                <ComboBoxItem Content="kg"/>
                <ComboBoxItem Content="ml"/>
                <ComboBoxItem Content="L"/>
                <ComboBoxItem Content="pi√®ces" IsSelected="True"/>
                <ComboBoxItem Content="bo√Ætes"/>
                <ComboBoxItem Content="sachets"/>
            </ComboBox>
        </StackPanel>

        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">

            <Button Content="Annuler"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAnnuler_Click"/>

            <Button Content="Ajouter"
                    Width="100"
                    Height="35"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAjouter_Click"/>

        </StackPanel>

    </Grid>

</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterArticleCourseDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using LoGeCuiShared.Models;

namespace LoGeCui.Dialogs
{
    public partial class AjouterArticleCourseDialog : Window
    {
        public ArticleCourse? NouvelArticle { get; private set; }

        public AjouterArticleCourseDialog()
        {
            InitializeComponent();
            TxtNom.Focus();
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtQuantite.Text))
            {
                MessageBox.Show("Veuillez entrer une quantit√©.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            NouvelArticle = new ArticleCourse
            {
                Nom = TxtNom.Text.Trim(),
                Quantite = TxtQuantite.Text.Trim(),
                Unite = (CmbUnite.SelectedItem as System.Windows.Controls.ComboBoxItem)?.Content.ToString() ?? "pi√®ces",
                EstAchete = false
            };

            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterIngredientDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter un ingr√©dient" 
        Height="700" 
        Width="450"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Titre -->
        <TextBlock Grid.Row="0"
                   Text="‚ûï Nouvel ingr√©dient"
                   FontSize="22"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,20"/>
        
        <!-- Nom -->
        <StackPanel Grid.Row="1" Margin="0,0,0,15">
            <TextBlock Text="Nom de l'ingr√©dient *"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Foreground="#34495E"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtNom"
                     Height="35"
                     FontSize="14"
                     Padding="8"
                     BorderBrush="#BDC3C7"
                     BorderThickness="1"/>
        </StackPanel>
        
        <!-- Quantit√© -->
        <StackPanel Grid.Row="2" Margin="0,0,0,15">
            <TextBlock Text="Quantit√© *"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Foreground="#34495E"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtQuantite"
                     Height="35"
                     FontSize="14"
                     Padding="8"
                     BorderBrush="#BDC3C7"
                     BorderThickness="1"/>
        </StackPanel>
        
        <!-- Unit√© -->
        <StackPanel Grid.Row="3" Margin="0,0,0,15">
            <TextBlock Text="Unit√© *"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Foreground="#34495E"
                       Margin="0,0,0,5"/>
            <ComboBox x:Name="CmbUnite"
                      Height="35"
                      FontSize="14"
                      Padding="8,5"
                      BorderBrush="#BDC3C7"
                      BorderThickness="1">
                <ComboBoxItem Content="kg" IsSelected="True"/>
                <ComboBoxItem Content="g"/>
                <ComboBoxItem Content="L"/>
                <ComboBoxItem Content="ml"/>
                <ComboBoxItem Content="pi√®ces"/>
                <ComboBoxItem Content="sachets"/>
                <ComboBoxItem Content="bo√Ætes"/>
            </ComboBox>
        </StackPanel>
        
        <!-- Boutons -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right">
            
            <Button Content="‚ùå Annuler"
                    Width="120"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnAnnuler_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#95A5A6"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#7F8C8D"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            
            <Button Content="‚úÖ Ajouter"
                    Width="120"
                    Height="40"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnAjouter_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            
        </StackPanel>
        
    </Grid>
    
</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using LoGeCuiShared.Models;

namespace LoGeCui.Dialogs
{
    public partial class AjouterIngredientDialog : Window
    {
        // Propri√©t√© pour r√©cup√©rer l'ingr√©dient cr√©√©
        public Ingredient? NouvelIngredient { get; private set; }

        public AjouterIngredientDialog()
        {
            InitializeComponent();

            // Focus sur le premier champ
            TxtNom.Focus();
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            // Validation : v√©rifier que tous les champs sont remplis
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom d'ingr√©dient.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtNom.Focus();
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtQuantite.Text))
            {
                MessageBox.Show("Veuillez entrer une quantit√©.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtQuantite.Focus();
                return;
            }

            // Cr√©er l'ingr√©dient
            NouvelIngredient = new Ingredient
            {
                Nom = TxtNom.Text.Trim(),
                Quantite = TxtQuantite.Text.Trim(),
                Unite = (CmbUnite.SelectedItem as ComboBoxItem)?.Content.ToString() ?? "pi√®ces",
                EstDisponible = true
            };

            // Fermer la fen√™tre avec succ√®s
            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            // Fermer sans rien faire
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientRecetteDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterIngredientRecetteDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter un ingr√©dient" 
        Height="400" 
        Width="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Titre -->
        <TextBlock Grid.Row="0"
                   Text="ü•ò Ajouter un ingr√©dient"
                   FontSize="18"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <!-- Nom -->
        <StackPanel Grid.Row="1" Margin="0,0,0,10">
            <TextBlock Text="Nom *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtNom"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <!-- Quantit√© -->
        <StackPanel Grid.Row="2" Margin="0,0,0,10">
            <TextBlock Text="Quantit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <TextBox x:Name="TxtQuantite"
                     Height="30"
                     FontSize="13"
                     Padding="5"/>
        </StackPanel>

        <!-- Unit√© -->
        <StackPanel Grid.Row="3" Margin="0,0,0,10">
            <TextBlock Text="Unit√© *"
                       FontSize="13"
                       FontWeight="SemiBold"
                       Margin="0,0,0,5"/>
            <ComboBox x:Name="CmbUnite"
                      Height="30"
                      FontSize="13"
                      Padding="5">
                <ComboBoxItem Content="g"/>
                <ComboBoxItem Content="kg"/>
                <ComboBoxItem Content="ml"/>
                <ComboBoxItem Content="L"/>
                <ComboBoxItem Content="pi√®ces" IsSelected="True"/>
                <ComboBoxItem Content="cuill√®res √† soupe"/>
                <ComboBoxItem Content="cuill√®res √† caf√©"/>
            </ComboBox>
        </StackPanel>

        <!-- Boutons -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">

            <Button Content="Annuler"
                    Width="100"
                    Height="35"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAnnuler_Click"/>

            <Button Content="Ajouter"
                    Width="100"
                    Height="35"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="13"
                    BorderThickness="0"
                    Click="BtnAjouter_Click"/>

        </StackPanel>

    </Grid>

</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterIngredientRecetteDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using LoGeCuiShared.Models;

namespace LoGeCui.Dialogs
{
    /// <summary>
    /// Logique d'interaction pour AjouterIngredientRecetteDialog.xaml
    /// </summary>
    public partial class AjouterIngredientRecetteDialog : Window
    {
        public IngredientRecette? NouvelIngredient { get; private set; }  // ‚Üê LIGNE AJOUT√âE !

        public AjouterIngredientRecetteDialog()
        {
            InitializeComponent();
            TxtNom.Focus();
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtQuantite.Text))
            {
                MessageBox.Show("Veuillez entrer une quantit√©.", "Champ requis", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            NouvelIngredient = new IngredientRecette  // ‚Üê CHANG√â aussi ici !
            {
                Nom = TxtNom.Text.Trim(),
                Quantite = TxtQuantite.Text.Trim(),
                Unite = (CmbUnite.SelectedItem as System.Windows.Controls.ComboBoxItem)?.Content.ToString() ?? "pi√®ces"
            };

            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\Dialogs\AjouterRecetteDialog.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.Dialogs.AjouterRecetteDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ajouter une recette" 
        Height="700" 
        Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#ECF0F1">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Titre -->
            <TextBlock Grid.Row="0"
                       Text="‚ûï Nouvelle recette"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#2C3E50"
                       Margin="0,0,0,20"/>

            <!-- Nom -->
            <StackPanel Grid.Row="1" Margin="0,0,0,15">
                <TextBlock Text="Nom de la recette *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>
                <TextBox x:Name="TxtNom"
                         Height="35"
                         FontSize="14"
                         Padding="8"
                         BorderBrush="#BDC3C7"
                         BorderThickness="1"/>
            </StackPanel>

            <!-- Type et Temps sur la m√™me ligne -->
            <Grid Grid.Row="2" Margin="0,0,0,15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Type -->
                <StackPanel Grid.Column="0">
                    <TextBlock Text="Type *"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="#34495E"
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="CmbType"
                              Height="35"
                              FontSize="14"
                              Padding="8,5"
                              BorderBrush="#BDC3C7"
                              BorderThickness="1">
                        <ComboBoxItem Content="Entr√©e" Tag="Entree"/>
                        <ComboBoxItem Content="Plat" Tag="Plat" IsSelected="True"/>
                        <ComboBoxItem Content="Dessert" Tag="Dessert"/>
                    </ComboBox>
                </StackPanel>

                <!-- Temps -->
                <StackPanel Grid.Column="2">
                    <TextBlock Text="Temps (minutes) *"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="#34495E"
                               Margin="0,0,0,5"/>
                    <TextBox x:Name="TxtTemps"
                             Height="35"
                             FontSize="14"
                             Padding="8"
                             BorderBrush="#BDC3C7"
                             BorderThickness="1"/>
                </StackPanel>
            </Grid>

            <!-- Difficult√© -->
            <StackPanel Grid.Row="3" Margin="0,0,0,15">
                <TextBlock Text="Difficult√© *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>
                <StackPanel Orientation="Horizontal">
                    <Slider x:Name="SliderDifficulte"
                            Width="400"
                            Minimum="1"
                            Maximum="5"
                            Value="3"
                            TickFrequency="1"
                            IsSnapToTickEnabled="True"
                            VerticalAlignment="Center"
                            ValueChanged="SliderDifficulte_ValueChanged"/>
                    <TextBlock x:Name="TxtDifficulte"
                               Text="‚≠ê‚≠ê‚≠ê"
                               FontSize="18"
                               Margin="10,0,0,0"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <!-- Ingr√©dients -->
            <StackPanel Grid.Row="4" Margin="0,0,0,15">
                <TextBlock Text="Ingr√©dients *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>

                <!-- Liste des ingr√©dients ajout√©s -->
                <Border BorderBrush="#BDC3C7"
                        BorderThickness="1"
                        CornerRadius="3"
                        Background="White"
                        MinHeight="100"
                        MaxHeight="150"
                        Margin="0,0,0,10">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ListBox x:Name="ListeIngredients"
                                 BorderThickness="0"
                                 Background="Transparent">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding}"
                                                   VerticalAlignment="Center"/>

                                        <Button Grid.Column="1"
                                                Content="‚ùå"
                                                Width="25"
                                                Height="25"
                                                FontSize="10"
                                                Background="#E74C3C"
                                                Foreground="White"
                                                BorderThickness="0"
                                                Cursor="Hand"
                                                Click="BtnSupprimerIngredient_Click"
                                                Tag="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </ScrollViewer>
                </Border>

                <Button Content="‚ûï Ajouter un ingr√©dient"
                        Height="35"
                        Background="#27AE60"
                        Foreground="White"
                        FontSize="13"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAjouterIngredient_Click"/>
            </StackPanel>

            <!-- Instructions -->
            <StackPanel Grid.Row="5" Margin="0,0,0,15">
                <TextBlock Text="Instructions *"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#34495E"
                           Margin="0,0,0,5"/>
                <TextBox x:Name="TxtInstructions"
                         Height="100"
                         FontSize="14"
                         Padding="8"
                         BorderBrush="#BDC3C7"
                         BorderThickness="1"
                         TextWrapping="Wrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"/>
            </StackPanel>

            <!-- Boutons -->
            <StackPanel Grid.Row="8"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,20,0,0">

                <Button Content="‚ùå Annuler"
                        Width="120"
                        Height="40"
                        Margin="0,0,10,0"
                        Background="#95A5A6"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAnnuler_Click"/>

                <Button Content="‚úÖ Ajouter"
                        Width="120"
                        Height="40"
                        Background="#27AE60"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAjouter_Click"/>

            </StackPanel>

        </Grid>
    </ScrollViewer>

</Window>

================================================================================
FILE: LoGeCui\Dialogs\AjouterRecetteDialog.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using System.Collections.ObjectModel;
using LoGeCuiShared.Models;


namespace LoGeCui.Dialogs
{
    /// <summary>
    /// Logique d'interaction pour AjouterRecetteDialog.xaml
    /// </summary>
    public partial class AjouterRecetteDialog : Window
    {

        public Recette? NouvelleRecette { get; private set; }
        private ObservableCollection<IngredientRecette> _ingredients;

        public AjouterRecetteDialog()
        {
            InitializeComponent();

            _ingredients = new ObservableCollection<IngredientRecette>();
            ListeIngredients.ItemsSource = _ingredients;

            TxtNom.Focus();
        }

        private void SliderDifficulte_ValueChanged(object sender, RoutedPropertyChangedEventArgs<double> e)
        {
            if (TxtDifficulte != null)
            {
                int valeur = (int)SliderDifficulte.Value;
                TxtDifficulte.Text = new string('‚≠ê', valeur);
            }
        }

        private void BtnAjouterIngredient_Click(object sender, RoutedEventArgs e)
        {
            // Cr√©er une petite fen√™tre pour ajouter un ingr√©dient
            var dialogIngredient = new AjouterIngredientRecetteDialog();
            dialogIngredient.Owner = this;

            bool? resultat = dialogIngredient.ShowDialog();

            if (resultat == true && dialogIngredient.NouvelIngredient != null)
            {
                _ingredients.Add(dialogIngredient.NouvelIngredient);
            }
        }

        private void BtnSupprimerIngredient_Click(object sender, RoutedEventArgs e)
        {
            var bouton = sender as System.Windows.Controls.Button;
            var ingredient = bouton?.Tag as IngredientRecette;

            if (ingredient != null)
            {
                _ingredients.Remove(ingredient);
            }
        }

        private void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            // Validation
            if (string.IsNullOrWhiteSpace(TxtNom.Text))
            {
                MessageBox.Show("Veuillez entrer un nom de recette.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtNom.Focus();
                return;
            }

            if (!int.TryParse(TxtTemps.Text, out int temps) || temps <= 0)
            {
                MessageBox.Show("Veuillez entrer un temps de pr√©paration valide.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtTemps.Focus();
                return;
            }

            if (_ingredients.Count == 0)
            {
                MessageBox.Show("Veuillez ajouter au moins un ingr√©dient.",
                    "Ingr√©dients requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                return;
            }

            if (string.IsNullOrWhiteSpace(TxtInstructions.Text))
            {
                MessageBox.Show("Veuillez entrer les instructions.",
                    "Champ requis",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                TxtInstructions.Focus();
                return;
            }

            // R√©cup√©rer le type
            var selectedItem = CmbType.SelectedItem as System.Windows.Controls.ComboBoxItem;
            var typeTag = selectedItem?.Tag?.ToString() ?? "Plat";

            TypePlat type = typeTag switch
            {
                "Entree" => TypePlat.Entree,
                "Dessert" => TypePlat.Dessert,
                _ => TypePlat.Plat
            };

            // Cr√©er la recette
            NouvelleRecette = new Recette
            {
                Nom = TxtNom.Text.Trim(),
                Type = type,
                TempsPreparation = temps,
                Difficulte = (int)SliderDifficulte.Value,
                Ingredients = new System.Collections.Generic.List<IngredientRecette>(_ingredients),
                Instructions = TxtInstructions.Text.Trim()
            };

            DialogResult = true;
            Close();
        }

        private void BtnAnnuler_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}

================================================================================
FILE: LoGeCui\LoGeCui.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net10.0-windows</TargetFramework>
	  <SelfContained>true</SelfContained>
	  <PublishSingleFile>true</PublishSingleFile>
	  <IncludeNativeLibrariesForSelfExtract>true</IncludeNativeLibrariesForSelfExtract>
	  <IncludeAllContentForSelfExtract>true</IncludeAllContentForSelfExtract>
	  <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <UseWPF>true</UseWPF>
    <Version>1.1.5</Version>
	  <ApplicationIcon>postriticone.ico</ApplicationIcon>
  </PropertyGroup>

	<ItemGroup>
		<EmbeddedResource Include="appsettings.json" />
	</ItemGroup>

  <ItemGroup>
    <None Remove="appsettings.json" />
    <None Remove="postriticone.ico" />
  </ItemGroup>

  <ItemGroup>
    <Content Include="appsettings.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
    <PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
  </ItemGroup>

  <ItemGroup>
    <Resource Include="postriticone.ico">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Resource>
  </ItemGroup>

</Project>

================================================================================
FILE: LoGeCui\LoginWindow.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.LoginWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="LoGeCui - Connexion"
        Height="600" Width="500"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Grid Background="#F5F5F5">
        <Border Background="White"
                CornerRadius="10"
                Padding="40"
                Margin="40">
            <StackPanel>
                <!-- Logo / Titre -->
                <TextBlock Text="üõí LoGeCui"
                          FontSize="48"
                          FontWeight="Bold"
                          HorizontalAlignment="Center"
                          Foreground="#27AE60"
                          Margin="0,0,0,40"/>

                <!-- Email -->
                <TextBlock Text="Email :" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox x:Name="TxtEmail"
                        Padding="10"
                        FontSize="14"
                        Margin="0,0,0,15"/>

                <!-- Mot de passe -->
                <TextBlock Text="Mot de passe :" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <PasswordBox x:Name="TxtPassword"
                            Padding="10"
                            FontSize="14"
                            Margin="0,0,0,20"/>

                <!-- Boutons -->
                <Button x:Name="BtnConnexion"
                       Content="Se connecter"
                       Background="#27AE60"
                       Foreground="White"
                       Padding="15"
                       FontSize="16"
                       FontWeight="SemiBold"
                       BorderThickness="0"
                       Cursor="Hand"
                       Margin="0,0,0,10"
                       Click="BtnConnexion_Click"/>

                <Button x:Name="BtnInscription"
                       Content="Cr√©er un compte"
                       Background="#3498DB"
                       Foreground="White"
                       Padding="15"
                       FontSize="16"
                       FontWeight="SemiBold"
                       BorderThickness="0"
                       Cursor="Hand"
                       Click="BtnInscription_Click"/>

                <!-- Message -->
                <TextBlock x:Name="TxtMessage"
                          Foreground="Red"
                          TextWrapping="Wrap"
                          HorizontalAlignment="Center"
                          Margin="0,15,0,0"
                          FontSize="12"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>

================================================================================
FILE: LoGeCui\LoginWindow.xaml.cs
================================================================================

Ôªøusing System;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCui
{
    public partial class LoginWindow : Window
    {
        public LoginWindow()
        {
            InitializeComponent();
        }

        private async void BtnConnexion_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                SetStatus("Connexion en cours...", isError: false);

                string email = TxtEmail.Text.Trim();
                string password = TxtPassword.Password;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus("Veuillez remplir tous les champs.", isError: true);
                    return;
                }

                var (success, accessToken, userIdString, error) = await App.SupabaseService.SignInAsync(email, password);


                if (!success)
                {
                    SetStatus(error ?? "Erreur de connexion", isError: true);
                    return;
                }
                if (!Guid.TryParse(userIdString, out var userId))
                {
                    SetStatus("ID utilisateur invalide.", isError: true);
                    return;
                }

                App.InitRestServices(accessToken, userId);


                // ‚¨áÔ∏è ICI : import des recettes locales vers Supabase (une seule fois)
                await ImporterRecettesLocalVersSupabaseSiBesoinAsync(userId);

                // V√©rifier les mises √† jour (optionnel)
                await CheckForUpdatesAsync();

                // Ouvrir l'app
                var mainWindow = new MainWindow();
                mainWindow.Show();
                Close();
            }
            catch (Exception ex)
            {
                SetStatus($"Erreur : {ex.Message}", isError: true);
            }
        }

        private async void BtnInscription_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                SetStatus("Inscription en cours...", isError: false);

                string email = TxtEmail.Text.Trim();
                string password = TxtPassword.Password;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus("Veuillez remplir tous les champs.", isError: true);
                    return;
                }

                if (password.Length < 6)
                {
                    SetStatus("Le mot de passe doit contenir au moins 6 caract√®res.", isError: true);
                    return;
                }

                var (success, userId, error) = await App.SupabaseService.SignUpAsync(email, password);

                if (success)
                {
                    MessageBox.Show(
                        "Compte cr√©√© avec succ√®s !\n\nVous pouvez maintenant vous connecter.",
                        "Inscription r√©ussie",
                        MessageBoxButton.OK,
                        MessageBoxImage.Information);

                    TxtPassword.Password = "";
                    SetStatus("Compte cr√©√© ! Connectez-vous.", isError: false);
                }
                else
                {
                    SetStatus(error ?? "Erreur lors de l'inscription", isError: true);
                }
            }
            catch (Exception ex)
            {
                SetStatus($"Erreur : {ex.Message}", isError: true);
            }
        }

        private void SetStatus(string message, bool isError)
        {
            TxtMessage.Text = message;
            TxtMessage.Foreground = isError
                ? System.Windows.Media.Brushes.Red
                : System.Windows.Media.Brushes.Blue;
        }

        private async Task CheckForUpdatesAsync()
        {
            try
            {
                string url = ConfigurationHelper.GetSupabaseUrl();
                string key = ConfigurationHelper.GetSupabaseKey();

                var updateService = new LoGeCuiShared.Services.UpdateService(url, key);
                var updateInfo = await updateService.CheckForUpdateAsync("wpf", "1.0.0");

                if (updateInfo != null)
                {
                    var result = MessageBox.Show(
                        $"Une nouvelle version {updateInfo.Version} est disponible !\n\n" +
                        $"Notes de version :\n{updateInfo.ReleaseNotes}\n\n" +
                        $"Voulez-vous t√©l√©charger la mise √† jour ?",
                        "Mise √† jour disponible",
                        MessageBoxButton.YesNo,
                        MessageBoxImage.Information);

                    if (result == MessageBoxResult.Yes)
                    {
                        System.Diagnostics.Process.Start(new System.Diagnostics.ProcessStartInfo
                        {
                            FileName = updateInfo.DownloadUrl,
                            UseShellExecute = true
                        });
                    }
                }
            }
            catch
            {
                // Erreur silencieuse
            }
        }

        private async Task ImporterRecettesLocalVersSupabaseSiBesoinAsync(Guid userId)
        {
            try
            {
                // üìÅ M√™me chemin que ton ancien RecetteService (JSON)
                string dossier = System.IO.Path.Combine(
                    Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                    "LoGeCui"
                );

                string cheminJson = System.IO.Path.Combine(dossier, "recettes.json");

                // ‚ùå Pas de fichier ‚Üí rien √† importer
                if (!System.IO.File.Exists(cheminJson))
                    return;

                // üè∑Ô∏è Fichier "flag" pour √©viter de r√©importer √† chaque login
                string flagPath = System.IO.Path.Combine(dossier, "recettes_import_done.txt");
                if (System.IO.File.Exists(flagPath))
                    return;

                // üìñ Lecture du JSON
                var json = await System.IO.File.ReadAllTextAsync(cheminJson);

                var options = new System.Text.Json.JsonSerializerOptions
                {
                    PropertyNameCaseInsensitive = true
                };

                var recettes = System.Text.Json.JsonSerializer
                    .Deserialize<List<LoGeCuiShared.Models.Recette>>(json, options)
                    ?? new List<LoGeCuiShared.Models.Recette>();

                if (recettes.Count == 0)
                {
                    // Rien √† importer mais on marque comme fait
                    await System.IO.File.WriteAllTextAsync(flagPath, "empty");
                    return;
                }

                // üîå Service Supabase d√©j√† initialis√© dans App.InitRestServices
                var recipesService = App.RecipesService;
                if (recipesService == null)
                    return;

                // üöÄ Import / upsert
                foreach (var r in recettes)
                {
                    // ExternalId obligatoire pour l'upsert
                    if (string.IsNullOrWhiteSpace(r.ExternalId))
                        r.ExternalId = Guid.NewGuid().ToString("N");

                    // Nettoyage cat√©gorie (important pour mobile)
                    if (!string.IsNullOrWhiteSpace(r.CategorieDb))
                        r.CategorieDb = r.CategorieDb.Trim();

                    await recipesService.UpsertRecetteAsync(userId, r);
                }

                // ‚úÖ Marqueur "import termin√©"
                await System.IO.File.WriteAllTextAsync(
                    flagPath,
                    $"done:{DateTime.UtcNow:O}"
                );
            }
            catch (Exception ex)
            {
                // ‚ö†Ô∏è Import non bloquant : on log mais on n'emp√™che pas le login
                System.Diagnostics.Debug.WriteLine("[ImportRecettes] " + ex);
            }
        }
    }
}


================================================================================
FILE: LoGeCui\MainWindow.xaml
================================================================================

Ôªø<Window x:Class="LoGeCui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LoGeCui"
        xmlns:views="clr-namespace:LoGeCui.Views"
        mc:Ignorable="d"
        Title="LoGeCui" Height="900" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#ECF0F1">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- En T√™te (sur toute la largeur -->
        <Border Grid.Row="0"
                Grid.ColumnSpan="2"
                Background="#2C3E50">
            <StackPanel Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="20 , 0">
                <TextBlock Text="üç≥"
                           FontSize="40"
                           Margin="0, 0,15,0"/>
                <StackPanel>
                    <TextBlock Text="LoGeCui"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="White"/>
                    <TextBlock Text=" Logiciel de Gestion de Cuisine"
                           FontSize="12"
                           Foreground="#BDC3C7"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- MENU GAUCHE -->
        <Border Grid.Row="1" 
                Grid.Column="0"
                Background="#34495E"
                BorderBrush="#2C3E50"
                BorderThickness="0,0,1,0">

            <StackPanel Margin="0,20,0,0">

                <!-- Bouton Ingr√©dients -->
                <Button Content="üì¶ Mes Ingr√©dients"
                        Height="60"
                        Background="#3498DB"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnIngredients_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#3498DB"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2980B9"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bouton Recettes -->
                <Button Content="üìñ Mes Recettes"
                        Height="60"
                        Background="#2ECC71"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnRecettes_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#2ECC71"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#27AE60"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bouton Ajouter Recette -->
                <Button Content="‚ûï Ajouter Recette"
                        Height="60"
                        Background="#F39C12"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnAjouterRecette_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#F39C12"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#E67E22"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <!-- Bouton Menu Al√©atoire -->
                <Button Content="üé≤ Menu Al√©atoire"
                        Height="60"
                        Background="#9B59B6"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnMenuAleatoire_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#9B59B6"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#8E44AD"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Bouton Liste de Courses -->
                <Button Content="üõí Liste de Courses"
                        Height="60"
                        Background="#E74C3C"
                        Foreground="White"
                        FontSize="16"
                        FontWeight="Bold"
                        Margin="10,5"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="BtnListeCourses_Click">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#E74C3C"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#C0392B"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Content="Synchroniser recettes"
                    Click="BtnSyncRecettes_Click"
                    Margin="10"/>

            </StackPanel>
        </Border>

        <!-- ZONE DE CONTENU PRINCIPAL -->
        <Border Grid.Row="1" 
        Grid.Column="1"
        Background="White"
        Margin="10">

            <ContentControl x:Name="MainContent">
                <TextBlock Text="Bienvenue dans LoGeCui ! üç≥&#x0a;&#x0a;S√©lectionnez une option dans le menu."
                   FontSize="24"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   TextAlignment="Center"
                   Foreground="#7F8C8D"/>
            </ContentControl>

        </Border>



    </Grid>
</Window>

================================================================================
FILE: LoGeCui\MainWindow.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using LoGeCui.Services;
using LoGeCui.Views;

namespace LoGeCui
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        // SUPPRIM√â : private SupabaseService _supabase;

        public MainWindow()
        {
            InitializeComponent();

            // SUPPRIM√â : Ne plus cr√©er une nouvelle instance !
            // _supabase = new SupabaseService(url, key);

            // Maintenant on utilisera App.SupabaseService partout
        }

        private void BtnIngredients_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.IngredientsView();
        }

        private void BtnRecettes_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.RecettesView();
        }

        private async void BtnAjouterRecette_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterRecetteDialog();
            dialog.Owner = this;

            bool? resultat = dialog.ShowDialog();

            if (resultat == true && dialog.NouvelleRecette != null)
            {
                try
                {
                    if (App.RecipesService == null || App.CurrentUserId == null)
                    {
                        MessageBox.Show("Utilisateur non connect√© ou services non initialis√©s.");
                        return;
                    }

                    var r = dialog.NouvelleRecette;

                    // ExternalId obligatoire pour l'upsert (√©vite les doublons)
                    if (string.IsNullOrWhiteSpace(r.ExternalId))
                        r.ExternalId = Guid.NewGuid().ToString("N");

                    // Sauvegarde vers Supabase
                    await App.RecipesService.UpsertRecetteAsync(App.CurrentUserId.Value, r);

                    // Recharge la vue Recettes (qui doit lire Supabase)
                    var view = new RecettesView();
                    MainContent.Content = view;

                    MessageBox.Show(
                        $"La recette '{r.Nom}' a √©t√© ajout√©e avec succ√®s !",
                        "Succ√®s",
                        MessageBoxButton.OK,
                        MessageBoxImage.Information);
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Erreur lors de l'ajout :\n{ex}", "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
        }


        private void BtnMenuAleatoire_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.MenuAleatoireView();
        }

        private void BtnListeCourses_Click(object sender, RoutedEventArgs e)
        {
            MainContent.Content = new Views.ListeCoursesView();
        }

        public async Task SyncRecettesToSupabaseAsync(IEnumerable<LoGeCuiShared.Models.Recette> recettesLocales)
        {
            if (App.RecipesService == null || App.CurrentUserId == null)
                throw new InvalidOperationException("Services REST non initialis√©s. Connecte-toi d'abord.");

            foreach (var r in recettesLocales)
            {
                if (string.IsNullOrWhiteSpace(r.ExternalId))
                    throw new InvalidOperationException($"Recette '{r.Nom}' sans ExternalId. Il faut un identifiant stable pour √©viter les doublons.");

                await App.RecipesService.UpsertRecetteAsync(App.CurrentUserId.Value, r);
            }
        }

        private async void BtnSyncRecettes_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                if (App.RecipesService == null || App.CurrentUserId == null)
                {
                    MessageBox.Show("Utilisateur non connect√© ou services non initialis√©s.");
                    return;
                }

                // üîπ ICI tu dois r√©cup√©rer TA liste de recettes WPF
                // Adapte cette ligne √† TON code existant

                MessageBox.Show("Synchronisation termin√©e avec succ√®s.");
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur de synchronisation :\n{ex.Message}");
            }
        }


    }
}

================================================================================
FILE: LoGeCui\Models\ArticleCourse.cs
================================================================================

Ôªønamespace LoGeCui.Models
{
    public class ArticleCourse
    {
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }
        public bool EstAchete { get; set; }

        public ArticleCourse()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
            EstAchete = false;
        }

        // Pour l'affichage
        public override string ToString()
        {
            return $"{Nom} - {Quantite} {Unite}";
        }
    }
}

================================================================================
FILE: LoGeCui\Models\Ingredient.cs
================================================================================

Ôªønamespace LoGeCui.Models
{
    public class Ingredient
    {
        public Guid Id { get; set; }          // correspond √† id
        public Guid? UserId { get; set; }
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }
        public bool EstDisponible { get; set; }

        // Constructeur (optionnel mais pratique)
        public Ingredient()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
            EstDisponible = true;
        }
    }
}

================================================================================
FILE: LoGeCui\Models\IngredientRecette.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;


namespace LoGeCui.Models
{
    public class IngredientRecette
    {
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }

        public IngredientRecette()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
        }

        // Pour l'affichage
        public override string ToString()
        {
            return $"{Nom} - {Quantite} {Unite}";
        }
    }
}

================================================================================
FILE: LoGeCui\Models\MenuJournalier.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using LoGeCuiShared.Models;

namespace LoGeCui.Models
{
    public class MenuJournalier
    {
        public DateTime Date { get; set; }
        public Recette? Entree { get; set; }
        public Recette? Plat { get; set; }
        public Recette? Dessert { get; set; }
        public List<IngredientRecette> IngredientsManquants { get; set; }

        public MenuJournalier()
        {
            Date = DateTime.Now;
            IngredientsManquants = new List<IngredientRecette>();
        }
    }
}

================================================================================
FILE: LoGeCui\Services\IngredientService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;
using System.Linq;

namespace LoGeCui.Services
{
    public class IngredientService
    {
        // Chemin du fichier de sauvegarde
        private readonly string _cheminFichier;
        private List<Ingredient> _ingredients = new List<Ingredient>();

        public IngredientService()
        {
            // Le fichier sera sauvegard√© dans AppData de l'utilisateur
            string dossier = Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                "LoGeCui"
            );

            // Cr√©er le dossier s'il n'existe pas
            Directory.CreateDirectory(dossier);

            _cheminFichier = Path.Combine(dossier, "ingredients.json");
        }

        /// <summary>
        /// Charge les ingr√©dients depuis le fichier JSON
        /// </summary>
        public List<Ingredient> ChargerIngredients()
        {
            try
            {
                // V√©rifier si le fichier existe
                if (!File.Exists(_cheminFichier))
                {
                    // Pas de fichier = liste vide
                    return new List<Ingredient>();
                }

                // Lire le contenu du fichier
                string json = File.ReadAllText(_cheminFichier);

                // Convertir le JSON en liste d'ingr√©dients
                var ingredients = JsonSerializer.Deserialize<List<Ingredient>>(json);

                return ingredients ?? new List<Ingredient>();
            }
            catch (Exception ex)
            {
                // En cas d'erreur, afficher un message et retourner une liste vide
                System.Windows.MessageBox.Show(
                    $"Erreur lors du chargement des ingr√©dients : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);

                return new List<Ingredient>();
            }
        }

        public List<Ingredient> ObtenirTousLesIngredients()
        {
            return _ingredients.ToList();
        }

        public List<Ingredient> ObtenirIngredientsDisponibles()
        {
            return _ingredients.Where(i => i.EstDisponible).ToList();
        }

        /// <summary>
        /// Sauvegarde les ingr√©dients dans le fichier JSON
        /// </summary>
        public void SauvegarderIngredients(List<Ingredient> ingredients)
        {
            try
            {
                // Options pour rendre le JSON lisible (avec indentation)
                var options = new JsonSerializerOptions
                {
                    WriteIndented = true  // Pour avoir un JSON "joli"
                };

                // Convertir la liste en JSON
                string json = JsonSerializer.Serialize(ingredients, options);

                // √âcrire dans le fichier
                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception ex)
            {
                // En cas d'erreur, afficher un message
                System.Windows.MessageBox.Show(
                    $"Erreur lors de la sauvegarde des ingr√©dients : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
            }
        }

        /// <summary>
        /// Retourne le chemin du fichier de sauvegarde
        /// </summary>
        public string ObtenirCheminFichier()
        {
            return _cheminFichier;
        }
    }
}

================================================================================
FILE: LoGeCui\Services\ListeCoursesService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;

namespace LoGeCui.Services
{
    public class ListeCoursesService
    {
        private readonly string _cheminFichier;

        public ListeCoursesService()
        {
            string dossier = Path.Combine(
                Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                "LoGeCui"
            );
                    Directory.CreateDirectory(dossier);
                    _cheminFichier = Path.Combine(dossier, "liste_courses.json");
        }

        public List<ArticleCourse> ChargerListeCourses()
        {
            try
            {
                if (!File.Exists(_cheminFichier))
                {
                    return new List<ArticleCourse>();
                }

                string json = File.ReadAllText(_cheminFichier);
                var liste = JsonSerializer.Deserialize<List<ArticleCourse>>(json);
                return liste ?? new List<ArticleCourse>();
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors du chargement de la liste de courses : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
                return new List<ArticleCourse>();
            }
        }

        public void SauvegarderListeCourses(List<ArticleCourse> articles)
        {
            try
            {
                var options = new JsonSerializerOptions { WriteIndented = true };
                string json = JsonSerializer.Serialize(articles, options);
                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors de la sauvegarde de la liste de courses : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
            }
        }
    }
}

================================================================================
FILE: LoGeCui\Services\RecetteService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;

namespace LoGeCui.Services
{
    public class RecetteService
    {
        private readonly string _cheminFichier;

        public RecetteService()
        {
            string dossier = Path.Combine(
             Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
             "LoGeCui"
            );
            Directory.CreateDirectory(dossier);
            _cheminFichier = Path.Combine(dossier, "recettes.json");
        }

        public List<Recette> ChargerRecettes()
        {
            try
            {
                if (!File.Exists(_cheminFichier))
                {
                    return new List<Recette>();
                }

                string json = File.ReadAllText(_cheminFichier);
                var options = new JsonSerializerOptions
                {
                    PropertyNameCaseInsensitive = true
                };

                var recettes = JsonSerializer.Deserialize<List<Recette>>(json, options);
                return recettes ?? new List<Recette>();
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors du chargement des recettes : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
                return new List<Recette>();
            }
        }

        public void SauvegarderRecettes(List<Recette> recettes)
        {
            try
            {
                var options = new JsonSerializerOptions
                {
                    WriteIndented = true
                };
                string json = JsonSerializer.Serialize(recettes, options);
                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception ex)
            {
                System.Windows.MessageBox.Show(
                    $"Erreur lors de la sauvegarde des recettes : {ex.Message}",
                    "Erreur",
                    System.Windows.MessageBoxButton.OK,
                    System.Windows.MessageBoxImage.Error);
            }
        }
    }
}

================================================================================
FILE: LoGeCui\Views\IngredientsView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.IngredientsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Titre -->
            <RowDefinition Height="Auto"/>
            <!-- Boutons -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- TITRE -->
        <TextBlock Grid.Row="0"
                   Text="üì¶ Gestion des Ingr√©dients"
                   FontSize="28"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,20"/>

        <!-- ZONE DE BOUTONS -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal"
                    Margin="0,0,0,20">

            <Button Content="‚ûï Ajouter un ingr√©dient"
                    Height="40"
                    Width="200"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnAjouter_Click"/>

        </StackPanel>

        <!-- LISTE DES INGR√âDIENTS -->
        <Border Grid.Row="2"
                BorderBrush="#BDC3C7"
                BorderThickness="1"
                CornerRadius="5">

            <ListBox x:Name="ListeIngredients"
                     Background="#F8F9FA"
                     BorderThickness="0">

                <!-- Template pour afficher chaque ingr√©dient -->
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
            BorderBrush="#E0E0E0"
            BorderThickness="1"
            CornerRadius="5"
            Margin="5"
            Padding="15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Informations de l'ingr√©dient -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Nom}"
                           FontSize="16"
                           FontWeight="Bold"
                           Foreground="#2C3E50"/>
                                    <TextBlock Foreground="#7F8C8D"
                           FontSize="14">
                    <Run Text="Quantit√© : "/>
                    <Run Text="{Binding Quantite}"/>
                    <Run Text=" "/>
                    <Run Text="{Binding Unite}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- CheckBox Disponible -->
                                <CheckBox Grid.Column="1"
                     IsChecked="{Binding EstDisponible}"
                     Content="Disponible"
                     VerticalAlignment="Center"
                     Margin="10,0"
                     Checked="ChkDisponible_Changed"
                     Unchecked="ChkDisponible_Changed"/>

                                <!-- Bouton Supprimer -->
                                <Button Grid.Column="2"
                    Content="üóëÔ∏è"
                    Width="40"
                    Height="40"
                    Background="#E74C3C"
                    Foreground="White"
                    FontSize="18"
                    BorderThickness="0"
                    Cursor="Hand"
                    ToolTip="Supprimer cet ingr√©dient"
                    Click="BtnSupprimer_Click"
                    Tag="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#E74C3C"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#C0392B"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>

    </Grid>

</UserControl>

================================================================================
FILE: LoGeCui\Views\IngredientsView.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using LoGeCuiShared.Models;

namespace LoGeCui.Views
{
    public partial class IngredientsView : UserControl
    {
        private readonly ObservableCollection<Ingredient> _ingredients = new();

        public IngredientsView()
        {
            InitializeComponent();

            ListeIngredients.ItemsSource = _ingredients;

            Loaded += IngredientsView_Loaded;
        }

        private async void IngredientsView_Loaded(object sender, RoutedEventArgs e)
        {
            // Evite de recharger plusieurs fois si Loaded se d√©clenche √† nouveau
            Loaded -= IngredientsView_Loaded;
            await ReloadIngredientsAsync();
        }

        private async Task ReloadIngredientsAsync()
        {
            try
            {
                var data = await App.SupabaseService.GetIngredientsAsync();

                _ingredients.Clear();
                foreach (var ing in data.OrderBy(i => i.Nom))
                    _ingredients.Add(ing);
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur chargement ingr√©dients (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnAjouter_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterIngredientDialog
            {
                Owner = Window.GetWindow(this)
            };

            bool? resultat = dialog.ShowDialog();
            if (resultat != true || dialog.NouvelIngredient == null)
                return;

            try
            {
                var saved = await App.SupabaseService.AddIngredientAsync(dialog.NouvelIngredient);

                if (saved == null)
                {
                    MessageBox.Show("L'ajout a √©chou√© (aucune donn√©e retourn√©e).",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                    return;
                }

                _ingredients.Add(saved);

                MessageBox.Show(
                    $"L'ingr√©dient '{saved.Nom}' a √©t√© ajout√© avec succ√®s !",
                    "Succ√®s",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur lors de l'ajout (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnSupprimer_Click(object sender, RoutedEventArgs e)
        {
            if (sender is not Button bouton)
                return;

            // On r√©cup√®re l'objet li√© √† la ligne (plus fiable que Tag si ton XAML est bind√© correctement)
            if (bouton.DataContext is not Ingredient ingredient)
                return;

            var confirmation = MessageBox.Show(
                $"Voulez-vous vraiment supprimer '{ingredient.Nom}' ?",
                "Confirmation de suppression",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (confirmation != MessageBoxResult.Yes)
                return;

            try
            {
                if (ingredient.Id == Guid.Empty)
                {
                    MessageBox.Show("Impossible de supprimer : l'ingr√©dient n'a pas d'Id.",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                    return;
                }

                bool ok = await App.SupabaseService.DeleteIngredientAsync(ingredient.Id);
                if (!ok)
                {
                    MessageBox.Show("La suppression a √©chou√© c√¥t√© serveur.",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                    return;
                }

                _ingredients.Remove(ingredient);

                MessageBox.Show(
                    $"L'ingr√©dient '{ingredient.Nom}' a √©t√© supprim√©.",
                    "Suppression r√©ussie",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur lors de la suppression (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void ChkDisponible_Changed(object sender, RoutedEventArgs e)
        {
            if (sender is not CheckBox cb)
                return;

            // Objet li√© √† la ligne
            if (cb.DataContext is not Ingredient ingredient)
                return;

            try
            {
                if (ingredient.Id == Guid.Empty)
                    return; // pas persist√© c√¥t√© Supabase

                bool ok = await App.SupabaseService.UpdateIngredientAsync(ingredient);
                if (!ok)
                {
                    MessageBox.Show("La mise √† jour a √©chou√© c√¥t√© serveur.",
                        "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
            catch (InvalidOperationException ex)
            {
                MessageBox.Show(ex.Message, "Connexion requise", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur mise √† jour (Supabase) : {ex.Message}",
                    "Erreur", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}

================================================================================
FILE: LoGeCui\Views\ListeCoursesView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.ListeCoursesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TITRE -->
        <TextBlock Grid.Row="0"
                   Text="üõí Liste de Courses"
                   FontSize="28"
                   FontWeight="Bold"
                   Foreground="#2C3E50"
                   Margin="0,0,0,20"/>

        <!-- BOUTONS -->
        <!-- BOUTONS -->
        <StackPanel Grid.Row="1"
            Orientation="Horizontal"
            Margin="0,0,0,20">

            <Button Content="‚ûï Ajouter un article"
            Height="40"
            Width="180"
            Background="#27AE60"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnAjouterArticle_Click"
            Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="üóëÔ∏è Supprimer les articles achet√©s"
            Height="40"
            Width="230"
            Background="#E74C3C"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnSupprimerAchetes_Click"
            Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#E74C3C"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#C0392B"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- NOUVEAU : Tout s√©lectionner -->
            <Button Content="‚úÖ Tout s√©lectionner"
            Height="40"
            Width="170"
            Background="#3498DB"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnToutSelectionner_Click"
            Margin="0,0,10,0">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#3498DB"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2E86C1"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- NOUVEAU : Supprimer la s√©lection -->
            <Button Content="üóëÔ∏è Supprimer la s√©lection"
            Height="40"
            Width="210"
            Background="#E67E22"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnSupprimerSelection_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#E67E22"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#D35400"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

        </StackPanel>

        <!-- LISTE DES COURSES -->
        <Border Grid.Row="2"
                BorderBrush="#BDC3C7"
                BorderThickness="1"
                CornerRadius="5">

            <ListBox x:Name="ListeCourses"
                     Background="#F8F9FA"
                     BorderThickness="0"
                     SelectionMode="Extended">

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="5"
                                Margin="5"
                                Padding="15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- CheckBox Achet√© -->
                                <CheckBox Grid.Column="0"
                                         IsChecked="{Binding EstAchete}"
                                         VerticalAlignment="Center"
                                         Margin="0,0,15,0"
                                         Checked="ChkAchete_Changed"
                                         Unchecked="ChkAchete_Changed"/>

                                <!-- Informations -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock FontSize="16"
                                               FontWeight="Bold"
                                               Foreground="#2C3E50">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="{Binding Nom}"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding EstAchete}" Value="True">
                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                        <Setter Property="Foreground" Value="#95A5A6"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <TextBlock Foreground="#7F8C8D"
                                               FontSize="14">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding EstAchete}" Value="True">
                                                        <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                        <Run Text="Quantit√© : "/>
                                        <Run Text="{Binding Quantite, Mode=OneWay}"/>
                                        <Run Text=" "/>
                                        <Run Text="{Binding Unite, Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Bouton Supprimer -->
                                <Button Grid.Column="2"
                                        Content="üóëÔ∏è"
                                        Width="40"
                                        Height="40"
                                        Background="#E74C3C"
                                        Foreground="White"
                                        FontSize="18"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        ToolTip="Supprimer cet article"
                                        Click="BtnSupprimerArticle_Click"
                                        Tag="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#E74C3C"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#C0392B"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>

    </Grid>

</UserControl>

================================================================================
FILE: LoGeCui\Views\ListeCoursesView.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using LoGeCuiShared.Models;

namespace LoGeCui.Views
{
    public partial class ListeCoursesView : UserControl
    {
        private readonly ObservableCollection<ArticleCourse> _articles = new ObservableCollection<ArticleCourse>();

        public ListeCoursesView()
        {
            InitializeComponent();

            // Binding une fois
            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private async void ChargerDonnees()
        {
            try
            {
                var articles = await App.SupabaseService.GetArticlesAsync();

                _articles.Clear();
                foreach (var article in articles)
                    _articles.Add(article);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur de chargement : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnAjouterArticle_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterArticleCourseDialog
            {
                Owner = Window.GetWindow(this)
            };

            bool? resultat = dialog.ShowDialog();

            if (resultat == true && dialog.NouvelArticle != null)
            {
                try
                {
                    var added = await App.SupabaseService.AddArticleAsync(dialog.NouvelArticle);

                    if (added != null)
                    {
                        _articles.Add(added);
                        MessageBox.Show($"'{added.Nom}' ajout√© avec succ√®s !", "Succ√®s",
                            MessageBoxButton.OK, MessageBoxImage.Information);
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                        MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
        }

        private async void BtnSupprimerArticle_Click(object sender, RoutedEventArgs e)
        {
            var bouton = sender as Button;
            var article = bouton?.Tag as ArticleCourse;

            if (article == null)
                return;

            var resultat = MessageBox.Show(
                $"Voulez-vous vraiment supprimer '{article.Nom}' ?",
                "Confirmation",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                await App.SupabaseService.DeleteArticleAsync(article.Id);
                _articles.Remove(article);

                MessageBox.Show("Article supprim√© !", "Succ√®s",
                    MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void ChkAchete_Changed(object sender, RoutedEventArgs e)
        {
            var checkbox = sender as CheckBox;
            var article = checkbox?.DataContext as ArticleCourse;

            if (article == null)
                return;

            try
            {
                await App.SupabaseService.UpdateArticleAsync(article.Id, article);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur de synchronisation : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private void BtnToutSelectionner_Click(object sender, RoutedEventArgs e)
        {
            ListeCourses.SelectAll();
        }

        private async void BtnSupprimerSelection_Click(object sender, RoutedEventArgs e)
        {
            // NOTE: SelectedItems est un IList -> on copie avant toute suppression
            var selected = ListeCourses.SelectedItems.Cast<ArticleCourse>().ToList();

            if (!selected.Any())
            {
                MessageBox.Show("Aucun article s√©lectionn√©.", "Information",
                    MessageBoxButton.OK, MessageBoxImage.Information);
                return;
            }

            var resultat = MessageBox.Show(
                $"Voulez-vous supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Confirmation",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                // Variante qui fonctionne tout de suite, sans ajouter de m√©thode Supabase en lot :
                // on supprime en boucle via la m√©thode existante DeleteArticleAsync(id).
                foreach (var article in selected)
                {
                    await App.SupabaseService.DeleteArticleAsync(article.Id);
                    _articles.Remove(article);
                }

                MessageBox.Show($"{selected.Count} article(s) supprim√©(s).", "Succ√®s",
                    MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        private async void BtnSupprimerAchetes_Click(object sender, RoutedEventArgs e)
        {
            var achetes = _articles.Where(a => a.EstAchete).ToList();

            if (!achetes.Any())
            {
                MessageBox.Show("Aucun article achet√© √† supprimer.", "Information",
                    MessageBoxButton.OK, MessageBoxImage.Information);
                return;
            }

            var resultat = MessageBox.Show(
                $"Voulez-vous supprimer les {achetes.Count} article(s) achet√©(s) ?",
                "Confirmation",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                await App.SupabaseService.DeleteAchetesAsync();

                foreach (var article in achetes)
                    _articles.Remove(article);

                MessageBox.Show($"{achetes.Count} article(s) supprim√©(s).", "Succ√®s",
                    MessageBoxButton.OK, MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur : {ex.Message}", "Erreur",
                    MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }
    }
}



================================================================================
FILE: LoGeCui\Views\MenuAleatoireView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.MenuAleatoireView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- TITRE -->
            <TextBlock Grid.Row="0"
                       Text="üé≤ Menu Al√©atoire"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="#2C3E50"
                       Margin="0,0,0,20"/>

            <!-- BOUTON GENERER -->
            <Button Grid.Row="1"
                    Content="üé≤ G√©n√©rer un nouveau menu"
                    Width="250"
                    Height="50"
                    Background="#9B59B6"
                    Foreground="White"
                    FontSize="16"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnGenererMenu_Click"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,30">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#9B59B6"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#8E44AD"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- CONTENU DU MENU -->
            <StackPanel Grid.Row="2" x:Name="MenuPanel" Visibility="Collapsed">

                <!-- Date -->
                <TextBlock x:Name="TxtDate"
                           FontSize="16"
                           Foreground="#7F8C8D"
                           Margin="0,0,0,20"
                           HorizontalAlignment="Center"/>

                <!-- Entr√©e -->
                <Border Background="#E8F5E9"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="ü•ó ENTR√âE"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#27AE60"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="TxtEntree"
                                   Text="Aucune entr√©e"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock x:Name="TxtEntreeDetails"
                                   FontSize="14"
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Plat -->
                <Border Background="#E3F2FD"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="üçΩÔ∏è PLAT PRINCIPAL"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#2196F3"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="TxtPlat"
                                   Text="Aucun plat"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock x:Name="TxtPlatDetails"
                                   FontSize="14"
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Dessert -->
                <Border Background="#FFF3E0"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="üç∞ DESSERT"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#FF9800"
                                   Margin="0,0,0,10"/>

                        <TextBlock x:Name="TxtDessert"
                                   Text="Aucun dessert"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#2C3E50"
                                   Margin="0,0,0,5"/>

                        <TextBlock x:Name="TxtDessertDetails"
                                   FontSize="14"
                                   Foreground="#7F8C8D"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Ingr√©dients manquants -->
                <Border x:Name="IngredientsManquantsPanel"
                        Background="#FFEBEE"
                        CornerRadius="10"
                        Padding="20"
                        Margin="0,0,0,20"
                        Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="‚ö†Ô∏è INGR√âDIENTS MANQUANTS"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#E74C3C"
                                   Margin="0,0,0,10"/>

                        <ListBox x:Name="ListeIngredientsManquants"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 MaxHeight="200">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"
                                               FontSize="14"
                                               Foreground="#E74C3C"
                                               Margin="5"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <Button Content="‚ûï Ajouter √† la liste de courses"
                                Height="40"
                                Background="#E74C3C"
                                Foreground="White"
                                FontSize="14"
                                FontWeight="Bold"
                                BorderThickness="0"
                                Cursor="Hand"
                                Click="BtnAjouterListeCourses_Click"
                                Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Tout est disponible -->
                <Border x:Name="ToutDisponiblePanel"
                        Background="#E8F5E9"
                        CornerRadius="10"
                        Padding="20"
                        Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal"
                               HorizontalAlignment="Center">
                        <TextBlock Text="‚úÖ"
                                   FontSize="24"
                                   Margin="0,0,10,0"/>
                        <TextBlock Text="Tous les ingr√©dients sont disponibles !"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="#27AE60"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

            </StackPanel>

        </Grid>
    </ScrollViewer>

</UserControl>

================================================================================
FILE: LoGeCui\Views\MenuAleatoireView.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using LoGeCuiShared.Models;
using LoGeCui.Services;

namespace LoGeCui.Views
{
    public partial class MenuAleatoireView : UserControl
    {
        private MenuJournalier? _menuCourant;
        private static readonly Random _random = new Random();

        public MenuAleatoireView()
        {
            InitializeComponent();
        }

        private async void BtnGenererMenu_Click(object sender, RoutedEventArgs e)
        {
            // Charger les recettes depuis Supabase
            if (App.RecipesService == null || App.CurrentUserId == null)
            {
                MessageBox.Show("Connecte-toi d'abord (services non initialis√©s).");
                return;
            }

            var recettes = await App.RecipesService.GetRecettesAsync(App.CurrentUserId.Value)
                          ?? new List<Recette>();

            if (recettes.Count == 0)
            {
                MessageBox.Show(
                    "Vous n'avez aucune recette !\n\nAjoutez des recettes d'abord.",
                    "Aucune recette",
                    MessageBoxButton.OK,
                    MessageBoxImage.Warning);
                return;
            }

            // Filtrer par type
            var entrees = recettes.Where(r => r.Type == TypePlat.Entree).ToList();
            var plats = recettes.Where(r => r.Type == TypePlat.Plat).ToList();
            var desserts = recettes.Where(r => r.Type == TypePlat.Dessert).ToList();

            // Cr√©er le menu
            _menuCourant = new MenuJournalier
            {
                Date = DateTime.Now,
                Entree = ChoisirRecetteAleatoire(entrees),
                Plat = ChoisirRecetteAleatoire(plats),
                Dessert = ChoisirRecetteAleatoire(desserts)
            };

            // Charger les ingr√©dients depuis Supabase
            if (App.RestClient == null)
            {
                MessageBox.Show("RestClient non initialis√©.");
                return;
            }

            try
            {
                var ingSvc = new LoGeCuiShared.Services.RecetteIngredientsService(App.RestClient);

                if (_menuCourant.Entree != null)
                {
                    var tuples = await ingSvc.GetForRecetteAsync(_menuCourant.Entree.Id);
                    _menuCourant.Entree.Ingredients = tuples
                        .Select(t => new IngredientRecette
                        {
                            Nom = t.nom,
                            Quantite = t.quantite,
                            Unite = t.unite
                        })
                        .ToList();
                }

                if (_menuCourant.Plat != null)
                {
                    var tuples = await ingSvc.GetForRecetteAsync(_menuCourant.Plat.Id);
                    _menuCourant.Plat.Ingredients = tuples
                        .Select(t => new IngredientRecette
                        {
                            Nom = t.nom,
                            Quantite = t.quantite,
                            Unite = t.unite
                        })
                        .ToList();
                }

                if (_menuCourant.Dessert != null)
                {
                    var tuples = await ingSvc.GetForRecetteAsync(_menuCourant.Dessert.Id);
                    _menuCourant.Dessert.Ingredients = tuples
                        .Select(t => new IngredientRecette
                        {
                            Nom = t.nom,
                            Quantite = t.quantite,
                            Unite = t.unite
                        })
                        .ToList();
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(
                    $"Erreur chargement ingr√©dients des recettes : {ex.Message}",
                    "Erreur",
                    MessageBoxButton.OK,
                    MessageBoxImage.Error);
                return;
            }

            // Afficher menu
            AfficherMenu();

            IngredientsManquantsPanel.Visibility = Visibility.Collapsed;
            ToutDisponiblePanel.Visibility = Visibility.Collapsed;
            ListeIngredientsManquants.ItemsSource = null;

            await VerifierIngredientsAsync();
        }

        private Recette? ChoisirRecetteAleatoire(List<Recette> recettes)
        {
            if (recettes == null || recettes.Count == 0)
                return null;

            return recettes[_random.Next(recettes.Count)];
        }

        private void AfficherMenu()
        {
            if (_menuCourant == null)
                return;

            MenuPanel.Visibility = Visibility.Visible;
            TxtDate.Text = $"Menu g√©n√©r√© le {_menuCourant.Date:dd/MM/yyyy √† HH:mm}";

            AfficherBlocRecette(_menuCourant.Entree, TxtEntree, TxtEntreeDetails, "entr√©e");
            AfficherBlocRecette(_menuCourant.Plat, TxtPlat, TxtPlatDetails, "plat");
            AfficherBlocRecette(_menuCourant.Dessert, TxtDessert, TxtDessertDetails, "dessert");
        }

        private void AfficherBlocRecette(Recette? recette, TextBlock titre, TextBlock details, string type)
        {
            if (recette != null)
            {
                titre.Text = recette.Nom;
                details.Text = $"{recette.DifficulteTexte} ‚Ä¢ {recette.TempsPreparation} min";
            }
            else
            {
                titre.Text = $"Aucun {type} disponible";
                details.Text = $"Ajoutez des recettes de type '{type}'";
            }
        }

        private async System.Threading.Tasks.Task VerifierIngredientsAsync()
        {
            if (_menuCourant == null)
                return;

            try
            {
                var ingredientsDisponibles = await App.SupabaseService.GetIngredientsAsync();

                var disponibles = (ingredientsDisponibles ?? new List<Ingredient>())
                    .Where(i => i.EstDisponible)
                    .Select(i => (i.Nom ?? "").Trim().ToLowerInvariant())
                    .Where(n => !string.IsNullOrWhiteSpace(n))
                    .ToHashSet();

                var necessaires = new List<IngredientRecette>();

                if (_menuCourant.Entree != null)
                    necessaires.AddRange(_menuCourant.Entree.Ingredients ?? new List<IngredientRecette>());
                if (_menuCourant.Plat != null)
                    necessaires.AddRange(_menuCourant.Plat.Ingredients ?? new List<IngredientRecette>());
                if (_menuCourant.Dessert != null)
                    necessaires.AddRange(_menuCourant.Dessert.Ingredients ?? new List<IngredientRecette>());

                if (necessaires.Count == 0)
                {
                    IngredientsManquantsPanel.Visibility = Visibility.Collapsed;
                    ToutDisponiblePanel.Visibility = Visibility.Collapsed;
                    ListeIngredientsManquants.ItemsSource = null;
                    return;
                }

                _menuCourant.IngredientsManquants.Clear();

                foreach (var ingredient in necessaires)
                {
                    var nom = (ingredient.Nom ?? "").Trim();
                    if (!disponibles.Contains(nom.ToLowerInvariant()))
                    {
                        if (!_menuCourant.IngredientsManquants.Any(i =>
                                (i.Nom ?? "").Equals(nom, StringComparison.OrdinalIgnoreCase)))
                        {
                            _menuCourant.IngredientsManquants.Add(ingredient);
                        }
                    }
                }

                if (_menuCourant.IngredientsManquants.Any())
                {
                    IngredientsManquantsPanel.Visibility = Visibility.Visible;
                    ToutDisponiblePanel.Visibility = Visibility.Collapsed;

                    ListeIngredientsManquants.ItemsSource = _menuCourant.IngredientsManquants
                        .Select(i => $"‚Ä¢ {i.Quantite} {i.Unite} {i.Nom}".Replace("  ", " ").Trim())
                        .ToList();
                }
                else
                {
                    IngredientsManquantsPanel.Visibility = Visibility.Collapsed;
                    ToutDisponiblePanel.Visibility = Visibility.Visible;
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur v√©rification ingr√©dients : {ex.Message}");
            }
        }

        private async void BtnAjouterListeCourses_Click(object sender, RoutedEventArgs e)
        {
            if (_menuCourant == null || !_menuCourant.IngredientsManquants.Any())
                return;

            var supabase = App.SupabaseService;
            var articlesExistants = await supabase.GetArticlesAsync();
            var nomsExistants = (articlesExistants ?? new List<ArticleCourse>())
                .Select(a => (a.Nom ?? "").Trim().ToLowerInvariant())
                .ToHashSet();

            foreach (var ingredient in _menuCourant.IngredientsManquants)
            {
                var nom = (ingredient.Nom ?? "").Trim();
                if (!nomsExistants.Contains(nom.ToLowerInvariant()))
                {
                    await supabase.AddArticleAsync(new ArticleCourse
                    {
                        Nom = nom,
                        Quantite = ingredient.Quantite,
                        Unite = ingredient.Unite,
                        EstAchete = false
                    });
                }
            }

            MessageBox.Show("Ingr√©dients ajout√©s √† la liste de courses !");
        }
    }
}

================================================================================
FILE: LoGeCui\Views\RecetteView.xaml
================================================================================

Ôªø<UserControl x:Class="LoGeCui.Views.RecettesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TITRE -->
        <!-- TITRE ET BOUTON -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
               Text="üìñ Mes Recettes"
               FontSize="28"
               FontWeight="Bold"
               Foreground="#2C3E50"
               VerticalAlignment="Center"/>

            <Button Grid.Column="1"
            Content="‚ûï Nouvelle recette"
            Width="180"
            Height="45"
            Background="#27AE60"
            Foreground="White"
            FontSize="14"
            FontWeight="Bold"
            BorderThickness="0"
            Cursor="Hand"
            Click="BtnNouvelleRecette_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>

        <!-- FILTRES -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal"
                    Margin="0,0,0,20">

            <Button Content="Toutes"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#95A5A6"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnTous_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#95A5A6"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#7F8C8D"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="ü•ó Entr√©es"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#27AE60"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnEntrees_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#27AE60"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#229954"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="üçΩÔ∏è Plats"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#3498DB"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnPlats_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#3498DB"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Button Content="üç∞ Desserts"
                    Width="100"
                    Height="40"
                    Margin="0,0,10,0"
                    Background="#F39C12"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="Bold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="BtnDesserts_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#F39C12"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E67E22"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="Synchroniser"
        Click="BtnSyncRecettes_Click"
        Margin="8"/>

        </StackPanel>

        <!-- LISTE DES RECETTES -->
        <Border Grid.Row="2"
                BorderBrush="#BDC3C7"
                BorderThickness="1"
                CornerRadius="5">

            <ListBox x:Name="ListeRecettes"
                     Background="#F8F9FA"
                     BorderThickness="0"
                     MouseDoubleClick="ListeRecettes_DoubleClick">

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                CornerRadius="5"
                                Margin="5"
                                Padding="15"
                                Cursor="Hand">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Informations -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Nom}"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="#2C3E50"/>

                                    <TextBlock Foreground="#7F8C8D"
                                               FontSize="13"
                                               Margin="0,5,0,0">
                                        <Run Text="{Binding TypeTexte, Mode=OneWay}"/>
                                        <Run Text=" ‚Ä¢ "/>
                                        <Run Text="{Binding TempsPreparation, Mode=OneWay}"/>
                                        <Run Text=" min"/>
                                    </TextBlock>

                                    <TextBlock Text="{Binding DifficulteTexte, Mode=OneWay}"
                                               FontSize="14"
                                               Margin="0,3,0,0"/>
                                </StackPanel>

                                <!-- Badge du type -->
                                <Border Grid.Column="1"
                                        Background="#E8F5E9"
                                        CornerRadius="10"
                                        Padding="10,5"
                                        Margin="10,0"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Type}"
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Foreground="#27AE60"/>
                                </Border>

                                <!-- Bouton Supprimer -->
                                <Button Grid.Column="2"
                                        Content="üóëÔ∏è"
                                        Width="40"
                                        Height="40"
                                        Background="#E74C3C"
                                        Foreground="White"
                                        FontSize="18"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        ToolTip="Supprimer cette recette"
                                        Click="BtnSupprimerRecette_Click"
                                        Tag="{Binding}">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#E74C3C"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#C0392B"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>

            </ListBox>
        </Border>

    </Grid>

</UserControl>

================================================================================
FILE: LoGeCui\Views\RecetteView.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;

namespace LoGeCui.Views
{
    public partial class RecettesView : UserControl
    {
        private readonly ObservableCollection<Recette> _recettesAffichees = new();
        private List<Recette> _toutesLesRecettes = new();

        public RecettesView()
        {
            InitializeComponent();

            ListeRecettes.ItemsSource = _recettesAffichees;

            Loaded += RecettesView_Loaded;
        }

        private async void RecettesView_Loaded(object sender, RoutedEventArgs e)
        {
            Loaded -= RecettesView_Loaded;
            await RefreshDepuisSupabaseAsync();
        }

        private bool EnsureConnected(out Guid userId)
        {
            userId = Guid.Empty;

            if (App.RecipesService == null || App.CurrentUserId == null)
            {
                MessageBox.Show("Connecte-toi d'abord (services non initialis√©s).");
                return false;
            }

            userId = App.CurrentUserId.Value;
            return true;
        }

        private bool EnsureRestClient()
        {
            if (App.RestClient == null)
            {
                MessageBox.Show("RestClient non initialis√©.");
                return false;
            }
            return true;
        }

        private async System.Threading.Tasks.Task RefreshDepuisSupabaseAsync()
        {
            if (!EnsureConnected(out var userId))
                return;

            var recettes = await App.RecipesService!.GetRecettesAsync(userId);
            _toutesLesRecettes = recettes ?? new List<Recette>();

            _recettesAffichees.Clear();
            foreach (var r in _toutesLesRecettes)
                _recettesAffichees.Add(r);
        }

        private void BtnTous_Click(object sender, RoutedEventArgs e)
        {
            _recettesAffichees.Clear();
            foreach (var recette in _toutesLesRecettes)
                _recettesAffichees.Add(recette);
        }

        private void BtnEntrees_Click(object sender, RoutedEventArgs e) => FiltrerParType(TypePlat.Entree);
        private void BtnPlats_Click(object sender, RoutedEventArgs e) => FiltrerParType(TypePlat.Plat);
        private void BtnDesserts_Click(object sender, RoutedEventArgs e) => FiltrerParType(TypePlat.Dessert);

        private void FiltrerParType(TypePlat type)
        {
            _recettesAffichees.Clear();
            foreach (var recette in _toutesLesRecettes.Where(r => r.Type == type))
                _recettesAffichees.Add(recette);
        }

        private void ListeRecettes_DoubleClick(object sender, MouseButtonEventArgs e)
        {
            var recette = ListeRecettes.SelectedItem as Recette;
            if (recette != null)
                AfficherDetailsRecette(recette);
        }

        private async void AfficherDetailsRecette(Recette recette)
        {
            try
            {
                if (!EnsureRestClient())
                    return;

                var ingSvc = new RecetteIngredientsService(App.RestClient!);
                var items = await ingSvc.GetForRecetteAsync(recette.Id);

                var ingredientsText = (items.Count == 0)
                    ? "(aucun ingr√©dient renseign√©)"
                    : string.Join("\n", items.Select(x =>
                        string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                            ? $"  ‚Ä¢ {x.nom}"
                            : $"  ‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                    ));

                MessageBox.Show(
                    $"üìñ {recette.Nom}\n\n" +
                    $"Cat√©gorie: {recette.CategorieDb}\n" +
                    $"Temps: {recette.TempsPreparation} minutes\n\n" +
                    $"Ingr√©dients:\n{ingredientsText}\n\n" +
                    $"Instructions:\n{recette.Instructions}",
                    "D√©tails de la recette",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur chargement ingr√©dients:\n{ex}");
            }
        }

        private async void BtnNouvelleRecette_Click(object sender, RoutedEventArgs e)
        {
            var dialog = new Dialogs.AjouterRecetteDialog();
            dialog.Owner = Window.GetWindow(this);

            bool? resultat = dialog.ShowDialog();
            if (resultat != true || dialog.NouvelleRecette == null)
                return;

            if (!EnsureConnected(out var userId))
                return;

            if (!EnsureRestClient())
                return;

            var r = dialog.NouvelleRecette;

            // ExternalId obligatoire pour upsert
            if (string.IsNullOrWhiteSpace(r.ExternalId))
                r.ExternalId = Guid.NewGuid().ToString("N");

            // owner important
            r.OwnerUserId = userId;

            // Save recette (upsert via external_id)
            await App.RecipesService!.UpsertRecetteAsync(userId, r);

            // r√©cup√©rer recetteId DB √† partir de ExternalId (‚ö†Ô∏è nouvelle signature: userId + externalId)
            var recetteId = await App.RecipesService.GetRecetteIdByExternalIdAsync(userId, r.ExternalId);
            if (recetteId == null)
                throw new Exception("Recette introuvable apr√®s upsert.");

            // envoyer ingr√©dients
            var ingSvc = new RecetteIngredientsService(App.RestClient!);
            var items = (r.Ingredients ?? new List<IngredientRecette>())
                .Select(i => (i.Nom, i.Quantite, i.Unite))
                .ToList();

            await ingSvc.ReplaceForRecetteAsync(recetteId.Value, items);

            await RefreshDepuisSupabaseAsync();

            MessageBox.Show(
                $"La recette '{r.Nom}' a √©t√© ajout√©e avec succ√®s !",
                "Succ√®s",
                MessageBoxButton.OK,
                MessageBoxImage.Information);
        }

        private async void BtnSupprimerRecette_Click(object sender, RoutedEventArgs e)
        {
            var bouton = sender as Button;
            var recette = bouton?.Tag as Recette;

            if (recette == null)
                return;

            var resultat = MessageBox.Show(
                $"Voulez-vous vraiment supprimer la recette '{recette.Nom}' ?",
                "Confirmation de suppression",
                MessageBoxButton.YesNo,
                MessageBoxImage.Question);

            if (resultat != MessageBoxResult.Yes)
                return;

            try
            {
                if (!EnsureConnected(out _))
                    return;

                await App.RecipesService!.DeleteRecetteAsync(recette.Id);

                await RefreshDepuisSupabaseAsync();

                MessageBox.Show(
                    $"La recette '{recette.Nom}' a √©t√© supprim√©e.",
                    "Suppression r√©ussie",
                    MessageBoxButton.OK,
                    MessageBoxImage.Information);
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Erreur suppression :\n{ex}");
            }
        }

        private async void BtnSyncRecettes_Click(object sender, RoutedEventArgs e)
        {
            await RefreshDepuisSupabaseAsync();
            MessageBox.Show("Recettes recharg√©es depuis Supabase.");
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\App.xaml
================================================================================

Ôªø<?xml version = "1.0" encoding = "UTF-8" ?>
<Application xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:LoGeCuiMobile"
             x:Class="LoGeCuiMobile.App">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Colors.xaml" />
                <ResourceDictionary Source="Resources/Styles/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
        </ResourceDictionary>
    </Application.Resources>
</Application>

================================================================================
FILE: LoGeCuiMobile\App.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Extensions.Configuration;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Storage;
using System;
using System.Globalization;
using System.IO;
using System.Threading.Tasks;
using LoGeCuiMobile.Services.Local;
using Microsoft.Maui.Networking;
using Supabase; // ‚úÖ pour SupabaseRestClient

namespace LoGeCuiMobile
{
    public partial class App : Application
    {
        public RecetteIngredientsService? RecetteIngredientsService { get; private set; }

        public SupabaseService? Supabase { get; private set; }
        public SupabaseRestClient? RestClient { get; private set; }

        public RecipesService? RecipesService { get; private set; }
        public IngredientsService? IngredientsService { get; private set; }
        public ListeCoursesSupabaseService? ListeCoursesSupabaseService { get; private set; }

        public ShoppingListsService? ShoppingListsService { get; private set; }

        public static LocalDatabase LocalDb { get; private set; } = null!;

        // ‚úÖ Token RAM (upload storage etc.)
        public string? CurrentAccessToken { get; private set; }

        // ‚úÖ Liste de courses active
        public Guid? CurrentShoppingListId { get; private set; }
        public void SetCurrentShoppingListId(Guid listId) => CurrentShoppingListId = listId;

        public Guid? CurrentUserId { get; private set; }
        public string OcrApiKey { get; private set; } = "";

        // ‚úÖ Inclure ShoppingListsService dans la condition ‚Äúconnect√©‚Äù
        public bool IsConnected =>
            CurrentUserId != null &&
            RestClient != null &&
            RecipesService != null &&
            IngredientsService != null &&
            ListeCoursesSupabaseService != null &&
            RecetteIngredientsService != null &&
            ShoppingListsService != null;

        private IConfigurationRoot? _config;

        public App()
        {
            InitializeComponent();

            // ‚úÖ Langue & th√®me avant l'UI
            ApplySavedLanguage();
            ApplySavedTheme();

            // ‚úÖ Local DB
            string dbPath = Path.Combine(FileSystem.AppDataDirectory, "logecui.db3");
            LocalDb = new LocalDatabase(dbPath);

            // ‚úÖ Init services de base (anon + OCR)
            InitBaseServices();

            // ‚úÖ Page par d√©faut : Login (avant auto-login)
            MainPage = RootPage.CreateLoginRoot();

            // ‚úÖ Init async (config + auto-login)
            _ = InitAsync();
        }

        // ------------------ JWT EXPIRED HANDLING ------------------

        public static bool IsJwtExpiredException(Exception ex)
        {
            return ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        public void HandleJwtExpired()
        {
            MainThread.BeginInvokeOnMainThread(async () =>
            {
                try
                {
                    await Current?.MainPage?.DisplayAlert(
                        "Session expir√©e",
                        "Ta session a expir√©. Merci de te reconnecter.",
                        "OK"
                    );
                }
                catch { }

                Logout(silent: true);
            });
        }

        // ------------------ UI SETTINGS ------------------

        private void ApplySavedLanguage()
        {
            try
            {
                var lang = Preferences.Get("app_language", "fr");
                var culture = new CultureInfo(lang);
                LocalizationResourceManager.Instance.SetCulture(culture);
            }
            catch
            {
                LocalizationResourceManager.Instance.SetCulture(new CultureInfo("fr"));
            }
        }

        private void ApplySavedTheme()
        {
            var theme = Preferences.Get("app_theme", "system");

            Current.UserAppTheme = theme switch
            {
                "light" => AppTheme.Light,
                "dark" => AppTheme.Dark,
                _ => AppTheme.Unspecified
            };
        }

        // ------------------ INIT SERVICES ------------------

        private void InitBaseServices()
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            Supabase = new SupabaseService(url, key);

            try
            {
                OcrApiKey = ConfigurationHelper.GetOcrApiKey();
                if (!string.IsNullOrWhiteSpace(OcrApiKey) && OcrApiKey.Length >= 5)
                    System.Diagnostics.Debug.WriteLine($"‚úÖ OCR Key charg√©e: {OcrApiKey.Substring(0, 5)}...");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå ERREUR OCR: {ex.Message}");
                OcrApiKey = "K86867725288957"; // ‚ö†Ô∏è debug only
            }
        }

        private async Task InitAsync()
        {
            try
            {
                await InitConfigurationAsync();
                await TryAutoLoginAsync();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå InitAsync: {ex}");
                ShowLogin();
            }
        }

        private async Task InitConfigurationAsync()
        {
            try
            {
                using var stream = await FileSystem.OpenAppPackageFileAsync("appsettings.json");
                var builder = new ConfigurationBuilder().AddJsonStream(stream);
                _config = builder.Build();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è appsettings.json introuvable ou illisible: " + ex.Message);
                _config = null;
            }
        }

        // ------------------ AUTO LOGIN ------------------

        private async Task TryAutoLoginAsync()
        {
            var rememberMe = await SecureStorage.GetAsync("remember_me");
            if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
            {
                ShowLogin();
                return;
            }

            var accessToken = await SecureStorage.GetAsync("sb_access_token");
            var userId = await SecureStorage.GetAsync("sb_user_id");

            if (string.IsNullOrWhiteSpace(accessToken) || string.IsNullOrWhiteSpace(userId))
            {
                ShowLogin();
                return;
            }

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // ‚úÖ Init services REST avec bearer + token RAM
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet : si token expir√© -> logout propre
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            // ‚úÖ Charger / assurer list_id (liste de courses active)
            await EnsureActiveShoppingListAsync();

            ShowAppShell();
        }

        public async void OnLoginSuccess(string accessToken, string userId)
        {
            // ‚úÖ Toujours garder le token dispo pour Storage (m√™me si remember_me n'est pas activ√©)
            await SecureStorage.SetAsync("sb_access_token", accessToken);
            await SecureStorage.SetAsync("sb_user_id", userId);

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // ‚úÖ Init services REST avec bearer + token RAM
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            // ‚úÖ Charger / assurer list_id (liste de courses active)
            await EnsureActiveShoppingListAsync();

            ShowAppShell();
        }

        private void InitRestServicesInternal(string accessToken)
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            // ‚úÖ Stocker le token en RAM
            CurrentAccessToken = accessToken;

            RestClient = client;

            // ‚úÖ IMPORTANT : instancier les services AVEC le client non-null
            ShoppingListsService = new ShoppingListsService(client);
            RecipesService = new RecipesService(client);
            IngredientsService = new IngredientsService(client);
            ListeCoursesSupabaseService = new ListeCoursesSupabaseService(client);
            RecetteIngredientsService = new RecetteIngredientsService(client);
        }

        // ‚úÖ Garantit qu'on a toujours une liste active (sinon cr√©ation/r√©cup√©ration)
        private async Task EnsureActiveShoppingListAsync()
        {
            try
            {
                if (RestClient == null || CurrentUserId == null)
                {
                    CurrentShoppingListId = null;
                    return;
                }

                ShoppingListsService ??= new ShoppingListsService(RestClient);

                // 1) Essayer via memberships (listes partag√©es OU owner d√©j√† membre)
                Guid? listId = null;
                try
                {
                    var bootstrap = new ShoppingListBootstrapService(RestClient);
                    listId = await bootstrap.GetFirstListIdForUserAsync(CurrentUserId.Value);
                }
                catch (Exception ex)
                {
                    // On ne bloque pas : on passera au fallback ‚Äúowner list‚Äù
                    System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è Bootstrap memberships failed: " + ex.Message);
                }

                // 2) Fallback : r√©cup√©rer/cr√©er une liste perso (owner_user_id)
                if (listId == null)
                {
                    listId = await ShoppingListsService.EnsurePersonalListIdAsync(CurrentUserId.Value);

                    // 3) Assurer qu‚Äôon est membre (utile si ton app/RLS d√©pend de shopping_list_members)
                    await EnsureMembershipAsync(listId.Value, CurrentUserId.Value);
                }

                CurrentShoppingListId = listId;
                System.Diagnostics.Debug.WriteLine($"‚úÖ Shopping list active: {CurrentShoppingListId}");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("‚ùå EnsureActiveShoppingListAsync: " + ex);
                CurrentShoppingListId = null;
            }
        }

        // ‚úÖ Test simple qui provoque JWT expired si token mort
        private async Task<bool> ValidateSessionAsync()
        {
            try
            {
                if (RecipesService == null || CurrentUserId == null)
                    return false;

                _ = await RecipesService.GetRecettesAsync(CurrentUserId.Value);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpiredException(ex))
                    return false;

                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è ValidateSessionAsync: " + ex.Message);
                return true;
            }
        }

        // ------------------ NAV ------------------

        public void ShowAppShell()
        {
            if (!IsConnected)
            {
                ShowLogin();
                return;
            }

            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = new AppShell();
            });
        }

        public void ShowLogin()
        {
            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = RootPage.CreateLoginRoot();
            });
        }

        // ------------------ LOGOUT ------------------

        public void Logout(bool silent = false)
        {
            SecureStorage.Remove("remember_me");
            SecureStorage.Remove("sb_access_token");
            SecureStorage.Remove("sb_user_id");

            Supabase?.ClearSession();
            CurrentUserId = null;
            CurrentAccessToken = null;
            CurrentShoppingListId = null;

            RestClient = null;
            RecipesService = null;
            IngredientsService = null;
            ListeCoursesSupabaseService = null;
            RecetteIngredientsService = null;
            ShoppingListsService = null;

            if (!silent)
                ShowLogin();
            else
                MainThread.BeginInvokeOnMainThread(() => MainPage = RootPage.CreateLoginRoot());
        }

        // ‚úÖ Assure que l'utilisateur est membre de la liste (utile pour bootstrap + RLS)
        private async Task EnsureMembershipAsync(Guid listId, Guid userId)
        {
            if (RestClient == null) return;

            var payload = new[]
            {
                new { list_id = listId, user_id = userId, role = "owner" }
            };

            try
            {
                await RestClient.PostAsync<object>(
                    "shopping_list_members",
                    payload,
                    returnRepresentation: false);
            }
            catch
            {
                // D√©j√† membre / conflit / policy : on ignore.
            }
        }

        // ------------------ MISC ------------------

        public Task HandleDeepLinkAsync(Uri uri) => Task.CompletedTask;

        public void SetSupabase(SupabaseService supabase) => Supabase = supabase;
        public void SetCurrentUserId(Guid userId) => CurrentUserId = userId;

        public void InitRestServices(string accessToken)
        {
            InitRestServicesInternal(accessToken);
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  },

  "OCR": {
    "ApiKey": "K86867725288957"
  }

}

================================================================================
FILE: LoGeCuiMobile\AppShell.xaml
================================================================================

<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="LoGeCuiMobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:LoGeCuiMobile.Pages"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    FlyoutBehavior="Flyout">

    <FlyoutItem Title="{tr:Translate Nav_ShoppingList}" Route="liste-courses">
        <ShellContent Route="liste-courses"
                      ContentTemplate="{DataTemplate pages:ListeCoursesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Recipes}" Route="mes-recettes">
        <ShellContent Route="mes-recettes"
                      ContentTemplate="{DataTemplate pages:MesRecettesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_RandomMenu}" Route="menu-aleatoire">
        <ShellContent Route="menu-aleatoire"
                      ContentTemplate="{DataTemplate pages:MenuAleatoirePage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Ingredients}" Route="mes-ingredients">
        <ShellContent Route="mes-ingredients"
                      ContentTemplate="{DataTemplate pages:MesIngredientsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Settings}" Route="settings">
        <ShellContent Route="settings"
                      ContentTemplate="{DataTemplate pages:SettingsPage}" />
    </FlyoutItem>

</Shell>


================================================================================
FILE: LoGeCuiMobile\AppShell.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile; // si ForgotPasswordPage est √† la racine du projet

namespace LoGeCuiMobile;

public partial class AppShell : Shell
{
    public AppShell()
    {
        InitializeComponent();

        Routing.RegisterRoute(nameof(ListeCoursesPage), typeof(ListeCoursesPage));
        Routing.RegisterRoute(nameof(ForgotPasswordPage), typeof(ForgotPasswordPage));
        Routing.RegisterRoute(nameof(AjouterIngredientPage), typeof(AjouterIngredientPage));
        Routing.RegisterRoute(nameof(AjouterRecettePage), typeof(AjouterRecettePage));
        Routing.RegisterRoute(nameof(MenuAleatoirePage), typeof(MenuAleatoirePage));

    }
}

================================================================================
FILE: LoGeCuiMobile\ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using Microsoft.Maui.Storage;
using System;
using System.IO;

namespace LoGeCuiMobile
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;
        private static readonly object _lock = new();

        private static IConfiguration Configuration
        {
            get
            {
                if (_configuration != null)
                    return _configuration;

                lock (_lock)
                {
                    if (_configuration != null)
                        return _configuration;

                    try
                    {
                        // Lire le fichier depuis le package MAUI
                        using var streamTask = FileSystem.OpenAppPackageFileAsync("appsettings.json");
                        streamTask.Wait();
                        using var stream = streamTask.Result;

                        // Copie en m√©moire pour √©viter tout souci de stream non seekable / lecture partielle
                        using var ms = new MemoryStream();
                        stream.CopyTo(ms);
                        ms.Position = 0;

                        var builder = new ConfigurationBuilder()
                            .AddJsonStream(ms);

                        _configuration = builder.Build();

#if DEBUG
                        System.Diagnostics.Debug.WriteLine("[CONFIG] appsettings.json charg√©");
                        System.Diagnostics.Debug.WriteLine("[CONFIG] Supabase:Url=" + (_configuration["Supabase:Url"] ?? "<null>"));
                        System.Diagnostics.Debug.WriteLine("[CONFIG] OCR:ApiKey present=" + (!string.IsNullOrWhiteSpace(_configuration["OCR:ApiKey"])));
#endif

                        return _configuration;
                    }
                    catch (Exception ex)
                    {
                        throw new Exception(
                            "Impossible de charger appsettings.json depuis le package MAUI. " +
                            "V√©rifie qu'il est bien dans LoGeCuiMobile, Build Action = MauiAsset, et que tu as fait Clean/Rebuild. " +
                            $"D√©tail: {ex.Message}", ex);
                    }
                }
            }
        }


        // =========================
        // SUPABASE
        // =========================

        public static string GetSupabaseUrl()
            => Configuration["Supabase:Url"]
               ?? throw new Exception("Supabase:Url manquant dans appsettings.json");

        public static string GetSupabaseKey()
            => Configuration["Supabase:Key"]
               ?? throw new Exception("Supabase:Key manquant dans appsettings.json");

        // =========================
        // OCR
        // =========================

        public static string GetOcrApiKey()
        {
            var key = Configuration["OCR:ApiKey"];

            if (string.IsNullOrWhiteSpace(key))
                throw new Exception("OCR:ApiKey manquant dans appsettings.json");

            return key;
        }
    }
}





================================================================================
FILE: LoGeCuiMobile\Converters\BoolToStrikethroughConverter.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Globalization;

namespace LoGeCuiMobile.Converters
{
    public class BoolToStrikethroughConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
            => (value is bool b && b) ? TextDecorations.Strikethrough : TextDecorations.None;

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
            => throw new NotImplementedException();
    }
}

================================================================================
FILE: LoGeCuiMobile\Converters\QuantityFormatConverter.cs
================================================================================

Ôªøusing System;
using System.Globalization;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile.Converters
{
    public class QuantityFormatConverter : IMultiValueConverter
    {
        public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
        {
            var q = values.Length > 0 ? values[0]?.ToString() ?? "" : "";
            var u = values.Length > 1 ? values[1]?.ToString() ?? "" : "";

            var fmt = LocalizationResourceManager.Instance["Ingredients_QuantityFormat"];
            // Ex: "Quantit√© : {0} {1}" / "Menge: {0} {1}"
            return string.Format(fmt, q, u).Trim();
        }

        public object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture)
            => throw new NotSupportedException();
    }
}

================================================================================
FILE: LoGeCuiMobile\ForgotPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="LoGeCuiMobile.ForgotPasswordPage"
    Title="Mot de passe oubli√©">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="Mot de passe oubli√©"
                   FontSize="20"
                   FontAttributes="Bold" />

            <Label Text="Entrez votre email pour recevoir un lien de r√©initialisation."
                   FontSize="14" />

            <Entry x:Name="EmailEntry"
                   Placeholder="Adresse email"
                   Keyboard="Email" />

            <Button x:Name="SendButton"
                    Text="Envoyer"
                    Clicked="OnSendClicked" />

            <Label x:Name="StatusLabel"
                   FontSize="13" />

            <Button Text="Retour"
                    Clicked="OnBackClicked" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\ForgotPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Graphics;
using System;

namespace LoGeCuiMobile
{
    // Optionnel : permet de pr√©-remplir l'email si tu navigues avec ?email=...
    [QueryProperty(nameof(PrefillEmail), "email")]
    public partial class ForgotPasswordPage : ContentPage
    {
        private readonly SupabaseService _supabaseService;

        // Valeur pass√©e via Shell : ?email=...
        public string PrefillEmail
        {
            set
            {
                // Evite crash si EmailEntry n'est pas encore pr√™t
                try
                {
                    var decoded = Uri.UnescapeDataString(value ?? "");
                    if (!string.IsNullOrWhiteSpace(decoded))
                        EmailEntry.Text = decoded;
                }
                catch { /* ignore */ }
            }
        }

        public ForgotPasswordPage()
        {
            InitializeComponent();

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            _supabaseService = new SupabaseService(url, key);

            StatusLabel.Text = "";
        }

        private async void OnSendClicked(object sender, EventArgs e)
        {
            try
            {
                // S√©curit√© si un contr√¥le est null (mauvais x:Name / x:Class)
                if (EmailEntry == null || SendButton == null || StatusLabel == null)
                {
                    await DisplayAlert("Erreur", "Interface non initialis√©e (XAML). V√©rifie x:Class et x:Name.", "OK");
                    return;
                }

                var email = (EmailEntry.Text ?? "").Trim();

                // ‚úÖ Validation obligatoire
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@") || !email.Contains("."))
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = "Veuillez saisir une adresse email valide.";
                    return;
                }

                SendButton.IsEnabled = false;
                StatusLabel.TextColor = Colors.Black;
                StatusLabel.Text = "Envoi en cours‚Ä¶";

                var result = await _supabaseService.SendPasswordResetAsync(email);

                if (result.success)
                {
                    StatusLabel.TextColor = Colors.Green;
                    StatusLabel.Text = "Email envoy√© ‚úÖ V√©rifiez votre bo√Æte mail (et les spams).";
                }
                else
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = result.error ?? "Impossible d'envoyer l'email.";
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ √©vite le crash et donne une erreur lisible
                StatusLabel.TextColor = Colors.Red;
                StatusLabel.Text = "Erreur : " + ex.Message;
            }
            finally
            {
                if (SendButton != null)
                    SendButton.IsEnabled = true;
            }
        }

        private async void OnBackClicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PopAsync();
            }
            catch
            {
                // au cas o√π
                await Shell.Current?.GoToAsync("..");
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\LoGeCuiMobile.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFrameworks>net10.0-android;net10.0-ios;net10.0-maccatalyst</TargetFrameworks>
		<TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('windows'))">$(TargetFrameworks);net10.0-windows10.0.19041.0</TargetFrameworks>

		<!-- Note for MacCatalyst:
		The default runtime is maccatalyst-x64, except in Release config, in which case the default is maccatalyst-x64;maccatalyst-arm64.
		When specifying both architectures, use the plural <RuntimeIdentifiers> instead of the singular <RuntimeIdentifier>.
		The Mac App Store will NOT accept apps with ONLY maccatalyst-arm64 indicated;
		either BOTH runtimes must be indicated or ONLY macatalyst-x64. -->
		<!-- For example: <RuntimeIdentifiers>maccatalyst-x64;maccatalyst-arm64</RuntimeIdentifiers> -->

		<OutputType>Exe</OutputType>
		<RootNamespace>LoGeCuiMobile</RootNamespace>
		<UseMaui>true</UseMaui>
		<SingleProject>true</SingleProject>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>

		<!-- Display name -->
		<ApplicationTitle>LoGeCuiMobile</ApplicationTitle>

		<!-- App Identifier -->
		<ApplicationId>com.companyname.logecuimobile</ApplicationId>

		<!-- Versions -->
		<ApplicationDisplayVersion>2.0.0</ApplicationDisplayVersion>
		<ApplicationVersion>6</ApplicationVersion>

		<!-- To develop, package, and publish an app to the Microsoft Store, see: https://aka.ms/MauiTemplateUnpackaged -->
		<WindowsPackageType>None</WindowsPackageType>

		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">21.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</SupportedOSPlatformVersion>
		<TargetPlatformMinVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</TargetPlatformMinVersion>
		<AndroidSigningKeyStore>logecui.keystore</AndroidSigningKeyStore>
	</PropertyGroup>

	<PropertyGroup>
		<UserSecretsId>votre-guid-unique</UserSecretsId>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <EmbedAssembliesIntoApk>False</EmbedAssembliesIntoApk>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<ItemGroup>
		<!-- App Icon -->
		<MauiIcon Include="Resources\AppIcon\postriticone.png" />

		<!-- Splash Screen -->
		<MauiSplashScreen Include="Resources\Splash\postriticone.png" Color="#FFFFFF" BaseSize="128,128" />

		<!-- Images -->
		<MauiImage Include="Resources\Images\*" />
		<MauiImage Update="Resources\Images\dotnet_bot.png" Resize="True" BaseSize="300,185" />
		
		<!-- Custom Fonts -->
		<MauiFont Include="Resources\Fonts\*" />

		<!-- Raw Assets (also remove the "Resources\Raw" prefix) -->
		<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />
	</ItemGroup>

	<ItemGroup>
		<MauiAsset Include="appsettings.json">
		  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</MauiAsset>
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="CommunityToolkit.Maui" Version="14.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
		<PackageReference Include="Microsoft.Maui.Controls" Version="10.0.30" />
		<PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="10.0.2" />
		<PackageReference Include="SkiaSharp" Version="3.119.1" />
		<PackageReference Include="sqlite-net-pcl" Version="1.9.172" />
		<PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
	</ItemGroup>

	<ItemGroup>
	  <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <MauiXaml Update="ForgotPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="LoginPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterIngredientPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterRecettePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ListeCoursesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MenuAleatoirePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesIngredientsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesRecettesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ResetPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\SettingsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	</ItemGroup>

	<ItemGroup>
	  <Folder Include="Platforms\Android\Resources\Raw\" />
	</ItemGroup>

	<ItemGroup>
	  <Compile Update="Resources\Lang\AppResources.Designer.cs">
	    <DesignTime>True</DesignTime>
	    <AutoGen>True</AutoGen>
	    <DependentUpon>AppResources.resx</DependentUpon>
	  </Compile>
	</ItemGroup>

	<ItemGroup>
	  <EmbeddedResource Update="Resources\Lang\AppResources.resx">
	    <Generator>PublicResXFileCodeGenerator</Generator>
	    <LastGenOutput>AppResources.Designer.cs</LastGenOutput>
	  </EmbeddedResource>
	</ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiMobile\LoGeCuiMobile.sln
================================================================================

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.5.2.0
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "LoGeCuiMobile", "LoGeCuiMobile.csproj", "{718860EB-0CC0-D204-6424-4B05AD96CB46}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {FE3EFD92-D10C-4693-8095-DE23E3011D74}
	EndGlobalSection
EndGlobal

================================================================================
FILE: LoGeCuiMobile\LoginPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lang="clr-namespace:LoGeCuiMobile.Resources.Lang"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.LoginPage"
             Title="LoGeCui - Connexion"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="20" VerticalOptions="Center">

            

            <!-- Logo -->
            <Label Text="üõí LoGeCui"
                   FontSize="42"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                   Margin="0,10,0,30"/>

            <!-- üåç Choix de langue -->
            <Picker x:Name="LanguagePicker"
        Title="üåç Language"
        SelectedIndexChanged="LanguagePicker_SelectedIndexChanged">
                <Picker.Items>
                    <x:String>üá´üá∑ Fran√ßais</x:String>
                    <x:String>üá¨üáß English</x:String>
                    <x:String>üá©üá™ Deutsch</x:String>
                    <x:String>üá™üá∏ Espa√±ol</x:String>
                    <x:String>üáÆüáπ Italiano</x:String>
                    <x:String>üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</x:String>
                    <x:String>üáµüá± Polski</x:String>
                    <x:String>üáπüá∑ T√ºrk√ße</x:String>
                    <x:String>üá∑üá¥ Rom√¢nƒÉ</x:String>
                    <x:String>üá®üáø ƒåe≈°tina</x:String>
                    <x:String>üá∞üá∑ ÌïúÍµ≠Ïñ¥</x:String>
                    <x:String>üáØüáµ Êó•Êú¨Ë™û</x:String>
                    <x:String>üáπüá≠ ‡πÑ‡∏ó‡∏¢</x:String>
                    <x:String>üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</x:String>
                </Picker.Items>
            </Picker>

            <!-- Email -->
            <Label Text="{tr:Translate Email}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Entry x:Name="TxtEmail"
                   Placeholder="email@example.com"
                   Keyboard="Email"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <!-- Mot de passe -->
            <Label Text="{tr:Translate Password}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Grid ColumnDefinitions="*,Auto"
                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                  Padding="8">

                <Entry x:Name="TxtPassword"
                       Placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                       IsPassword="True"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                <Button Grid.Column="1"
                        Text="üëÅ"
                        BackgroundColor="Transparent"
                        Clicked="TogglePassword"/>
            </Grid>

            <!-- Rester connect√© -->
            <HorizontalStackLayout Spacing="10">
                <CheckBox x:Name="ChkRememberMe" Color="#27AE60"/>
                <Label Text="{tr:Translate StayConnected}"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            </HorizontalStackLayout>

            <!-- Connexion -->
            <Button x:Name="BtnConnexion"
                    Text="{tr:Translate LoginButton}"
                    BackgroundColor="#27AE60"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnConnexion_Clicked"/>

            <!-- Inscription -->
            <Button x:Name="BtnInscription"
                    Text="{tr:Translate SignupButton}"
                    BackgroundColor="#3498DB"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnInscription_Clicked"/>

            <!-- Message -->
            <Label x:Name="TxtMessage"
                   TextColor="Red"
                   HorizontalOptions="Center"
                   IsVisible="False"/>

            <!-- Mot de passe oubli√© -->
            <Button Text="{tr:Translate ForgotPassword}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light=Blue, Dark=#4DA3FF}"
                    Clicked="BtnForgotPassword_Clicked"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\LoginPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile; // ForgotPasswordPage / RootPage
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;
using System.Globalization;

namespace LoGeCuiMobile.Pages
{
    public partial class LoginPage : ContentPage
    {
        private readonly SupabaseService _supabase;
        private bool _isPasswordVisible = false;

        // Emp√™che SelectedIndexChanged pendant l'init
        private bool _isInitializingLanguage = false;

        public LoginPage()
        {
            InitializeComponent();

            _isInitializingLanguage = true;
            InitLanguagePickerSelection();
            _isInitializingLanguage = false;

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            _supabase = new SupabaseService(url, key);

            _ = LoadSavedUserAsync();
        }

        // =========================
        // LANGUE (Picker)
        // =========================
        private void LanguagePicker_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (_isInitializingLanguage)
                return;

            if (LanguagePicker.SelectedIndex < 0)
                return;

            var langCode = LanguagePicker.SelectedIndex switch
            {
                0 => "fr",
                1 => "en",
                2 => "de",
                3 => "es",
                4 => "it",
                5 => "ar",
                6 => "pl",
                7 => "tr",
                8 => "ro",
                9 => "cs",
                10 => "ko",
                11 => "ja",
                12 => "th",
                13 => "hi",
                _ => "fr"
            };

            var current = Preferences.Get("app_language", "fr");
            if (string.Equals(current, langCode, StringComparison.OrdinalIgnoreCase))
                return;

            Preferences.Set("app_language", langCode);

            var culture = new CultureInfo(langCode);

            // ‚úÖ Applique la culture + notifie l'UI (si tu utilises TranslateExtension)
            LocalizationResourceManager.Instance.SetCulture(culture);

            // ‚ö†Ô∏è Si ton XAML est encore en x:Static et que tu veux quand m√™me voir le changement,
            // d√©-commente ce bloc (mais √©vite de le faire pendant l'init) :
            // MainThread.BeginInvokeOnMainThread(() =>
            // {
            //     Application.Current.MainPage = RootPage.CreateLoginRoot();
            // });
        }

        private void InitLanguagePickerSelection()
        {
            var lang = Preferences.Get("app_language", "fr");

            var index = lang switch
            {
                "fr" => 0,
                "en" => 1,
                "de" => 2,
                "es" => 3,
                "it" => 4,
                "ar" => 5,
                "pl" => 6,
                "tr" => 7,
                "ro" => 8,
                "cs" => 9,
                "ko" => 10,
                "ja" => 11,
                "th" => 12,
                "hi" => 13,
                _ => 0
            };

            LanguagePicker.SelectedIndex = index;
        }

        // =========================
        // LOGIN
        // =========================
        private async void BtnConnexion_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.Connecting, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.ConnectionError, Colors.Red);
                    await DisplayAlert(AppResources.ErrorTitle, AppResources.BadPassword, "OK");
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);


                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async Task LoadSavedUserAsync()
        {
            try
            {
                var rememberMe = await SecureStorage.GetAsync("remember_me");
                if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
                    return;

                var email = await SecureStorage.GetAsync("user_email");
                if (!string.IsNullOrEmpty(email))
                {
                    TxtEmail.Text = email;
                    ChkRememberMe.IsChecked = true;
                }
            }
            catch
            {
                // ignore SecureStorage errors
            }
        }

        private async void BtnInscription_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.CreatingAccount, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignUpThenSignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.SignupError, Colors.Red);
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);
                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async void BtnForgotPassword_Clicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PushAsync(new ForgotPasswordPage());
            }
            catch (Exception ex)
            {
                await DisplayAlert(AppResources.ErrorTitle, ex.ToString(), "OK");
            }
        }

        private void TogglePassword(object sender, EventArgs e)
        {
            _isPasswordVisible = !_isPasswordVisible;

            TxtPassword.IsPassword = !_isPasswordVisible;

            if (sender is Button btn)
                btn.Text = _isPasswordVisible ? "üôà" : "üëÅ";

            if (!string.IsNullOrEmpty(TxtPassword.Text))
            {
                var t = TxtPassword.Text;
                TxtPassword.Text = string.Empty;
                TxtPassword.Text = t;
            }
        }

        private void SetStatus(string message, Color color)
        {
            TxtMessage.Text = message;
            TxtMessage.TextColor = color;
            TxtMessage.IsVisible = true;
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\MainPage.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LoGeCuiMobile.MainPage">

    <ScrollView>
        <VerticalStackLayout
            Padding="30,0"
            Spacing="25">
            <Image
                Source="dotnet_bot.png"
                HeightRequest="185"
                Aspect="AspectFit"
                SemanticProperties.Description="dot net bot in a submarine number ten" />

            <Label
                Text="Hello, World!"
                Style="{StaticResource Headline}"
                SemanticProperties.HeadingLevel="Level1" />

            <Label
                Text="Welcome to &#10;.NET Multi-platform App UI"
                Style="{StaticResource SubHeadline}"
                SemanticProperties.HeadingLevel="Level2"
                SemanticProperties.Description="Welcome to dot net Multi platform App U I" />

            <Button
                x:Name="CounterBtn"
                Text="Click me" 
                SemanticProperties.Hint="Counts the number of times you click"
                Clicked="OnCounterClicked"
                HorizontalOptions="Fill" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\MainPage.xaml.cs
================================================================================

Ôªønamespace LoGeCuiMobile
{
    public partial class MainPage : ContentPage
    {
        int count = 0;

        public MainPage()
        {
            InitializeComponent();
        }

        private void OnCounterClicked(object? sender, EventArgs e)
        {
            count++;

            if (count == 1)
                CounterBtn.Text = $"Clicked {count} time";
            else
                CounterBtn.Text = $"Clicked {count} times";

            SemanticScreenReader.Announce(CounterBtn.Text);
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\MauiProgram.cs
================================================================================

Ôªøusing System;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.Maui.Storage;
using CommunityToolkit.Maui;

namespace LoGeCuiMobile
{
    public static class MauiProgram
    {
        public static IConfiguration Configuration { get; private set; } = new ConfigurationBuilder().Build();

        public static MauiApp CreateMauiApp()
        {
            var builder = MauiApp.CreateBuilder();

            builder
            .UseMauiApp<App>()
            .UseMauiCommunityToolkit()   // üëà AJOUT ICI
            .ConfigureFonts(fonts =>
            {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
            });

#if DEBUG
            builder.Logging.AddDebug();
#endif

            // ‚úÖ Charge appsettings.json (MauiAsset) sans faire crasher l'app si absent
            try
            {
                using var stream = FileSystem.OpenAppPackageFileAsync("appsettings.json")
                                             .GetAwaiter()
                                             .GetResult();

                builder.Configuration.AddJsonStream(stream);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIG ERROR ==========");
                System.Diagnostics.Debug.WriteLine("Impossible de charger appsettings.json depuis le package MAUI.");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("==================================");
                // On continue volontairement pour √©viter le crash.
            }

            Configuration = builder.Configuration;

            // ‚úÖ IMPORTANT: on force le namespace exact (√©vite conflits)
            try
            {
                LoGeCuiShared.Services.ConfigurationHelper.Configure(key => Configuration[key]);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIGHELPER ERROR ==========");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("========================================");
                // On continue; l'erreur r√©elle ressortira quand une cl√© sera demand√©e.
            }

            return builder.Build();
        }
    }
}


================================================================================
FILE: LoGeCuiMobile\Models\IngredientUI.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    public class IngredientUi : INotifyPropertyChanged
    {
        public Ingredient Model { get; }

        public IngredientUi(Ingredient model)
        {
            Model = model;
        }

        public System.Guid Id => Model.Id;
        public string Nom => Model.Nom ?? "";
        public string? Quantite => Model.Quantite;
        public string? Unite => Model.Unite;

        public bool EstDisponible
        {
            get => Model.EstDisponible;
            set
            {
                if (Model.EstDisponible == value) return;
                Model.EstDisponible = value;
                OnPropertyChanged();
            }
        }

        // ‚úÖ NOUVEAU : Favori (n√©cessite Model.EstFavori)
        public bool EstFavori
        {
            get => Model.EstFavori;
            set
            {
                if (Model.EstFavori == value) return;
                Model.EstFavori = value;
                OnPropertyChanged();
                OnPropertyChanged(nameof(HeartText));
            }
        }

        // ‚úÖ NOUVEAU : emoji coeur
        public string HeartText => EstFavori ? "‚ù§Ô∏è" : "ü§ç";

        bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                OnPropertyChanged();
            }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: LoGeCuiMobile\Models\LanguageItem.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiMobile.Models
{
    internal class LanguageItem
    {
        public string Name { get; set; } = "";
        public string Code { get; set; } = "";
        public string Flag { get; set; } = ""; // emoji drapeau
    }
}

================================================================================
FILE: LoGeCuiMobile\output_concat.txt
================================================================================

# CONCAT OUTPUT
# Root: C:\Users\Francois\source\repos\LoGeCui\LoGeCuiMobile
# Files: 62


================================================================================
FILE: App.xaml
================================================================================

Ôªø<?xml version = "1.0" encoding = "UTF-8" ?>
<Application xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:LoGeCuiMobile"
             x:Class="LoGeCuiMobile.App">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Colors.xaml" />
                <ResourceDictionary Source="Resources/Styles/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
        </ResourceDictionary>
    </Application.Resources>
</Application>

================================================================================
FILE: App.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Extensions.Configuration;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Storage;
using System;
using System.Globalization;
using System.IO;
using System.Threading.Tasks;
using LoGeCuiMobile.Services.Local;

namespace LoGeCuiMobile
{
    public partial class App : Application
    {
        public RecetteIngredientsService? RecetteIngredientsService { get; private set; }

        public SupabaseService? Supabase { get; private set; }
        public SupabaseRestClient? RestClient { get; private set; }

        public RecipesService? RecipesService { get; private set; }
        public IngredientsService? IngredientsService { get; private set; }
        public ListeCoursesSupabaseService? ListeCoursesSupabaseService { get; private set; }

        public static LocalDatabase LocalDb { get; private set; } = null!;

        public Guid? CurrentUserId { get; private set; }
        public string OcrApiKey { get; private set; } = "";

        public bool IsConnected =>
            CurrentUserId != null &&
            RestClient != null &&
            RecipesService != null &&
            IngredientsService != null &&
            ListeCoursesSupabaseService != null;

        private IConfigurationRoot? _config;

        public App()
        {
            InitializeComponent();

            // ‚úÖ Langue & th√®me avant l'UI
            ApplySavedLanguage();
            ApplySavedTheme();

            // ‚úÖ Local DB
            string dbPath = Path.Combine(FileSystem.AppDataDirectory, "logecui.db3");
            LocalDb = new LocalDatabase(dbPath);

            // ‚úÖ Init services de base (anon + OCR)
            InitBaseServices();

            // ‚úÖ Page par d√©faut : Login (avant auto-login)
            MainPage = RootPage.CreateLoginRoot();

            // ‚úÖ Init async (config + auto-login)
            _ = InitAsync();
        }

        // ------------------ JWT EXPIRED HANDLING ------------------

        public static bool IsJwtExpiredException(Exception ex)
        {
            // "JWT expired" est dans le message renvoy√© par PostgREST / Supabase
            return ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        public void HandleJwtExpired()
        {
            // Session expir√©e => on nettoie + retour login
            MainThread.BeginInvokeOnMainThread(async () =>
            {
                try
                {
                    await Current?.MainPage?.DisplayAlert(
                        "Session expir√©e",
                        "Ta session a expir√©. Merci de te reconnecter.",
                        "OK"
                    );
                }
                catch
                {
                    // pas bloquant
                }

                Logout(silent: true);
            });
        }

        // ------------------ UI SETTINGS ------------------

        private void ApplySavedLanguage()
        {
            try
            {
                var lang = Preferences.Get("app_language", "fr");
                var culture = new CultureInfo(lang);
                LocalizationResourceManager.Instance.SetCulture(culture);
            }
            catch
            {
                LocalizationResourceManager.Instance.SetCulture(new CultureInfo("fr"));
            }
        }

        private void ApplySavedTheme()
        {
            var theme = Preferences.Get("app_theme", "system");

            Current.UserAppTheme = theme switch
            {
                "light" => AppTheme.Light,
                "dark" => AppTheme.Dark,
                _ => AppTheme.Unspecified
            };
        }

        // ------------------ INIT SERVICES ------------------

        private void InitBaseServices()
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            Supabase = new SupabaseService(url, key);

            try
            {
                OcrApiKey = ConfigurationHelper.GetOcrApiKey();
                if (!string.IsNullOrWhiteSpace(OcrApiKey) && OcrApiKey.Length >= 5)
                    System.Diagnostics.Debug.WriteLine($"‚úÖ OCR Key charg√©e: {OcrApiKey.Substring(0, 5)}...");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå ERREUR OCR: {ex.Message}");
                OcrApiKey = "K86867725288957"; // ‚ö†Ô∏è debug only
            }
        }

        private async Task InitAsync()
        {
            try
            {
                await InitConfigurationAsync();
                await TryAutoLoginAsync();
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"‚ùå InitAsync: {ex}");
                ShowLogin();
            }
        }

        private async Task InitConfigurationAsync()
        {
            try
            {
                using var stream = await FileSystem.OpenAppPackageFileAsync("appsettings.json");
                var builder = new ConfigurationBuilder().AddJsonStream(stream);
                _config = builder.Build();
            }
            catch (Exception ex)
            {
                // ‚úÖ Ne pas crasher si appsettings absent
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è appsettings.json introuvable ou illisible: " + ex.Message);
                _config = null;
            }
        }

        // ------------------ AUTO LOGIN ------------------

        private async Task TryAutoLoginAsync()
        {
            var rememberMe = await SecureStorage.GetAsync("remember_me");
            if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
            {
                ShowLogin();
                return;
            }

            var accessToken = await SecureStorage.GetAsync("sb_access_token");
            var userId = await SecureStorage.GetAsync("sb_user_id");

            if (string.IsNullOrWhiteSpace(accessToken) || string.IsNullOrWhiteSpace(userId))
            {
                ShowLogin();
                return;
            }

            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            // Init services REST avec bearer
            InitRestServicesInternal(accessToken);

            // ‚úÖ Validation si internet : si token expir√© -> logout propre
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            ShowAppShell();
        }

        public async void OnLoginSuccess(string accessToken, string userId)
        {
            Supabase ??= new SupabaseService(
                ConfigurationHelper.GetSupabaseUrl(),
                ConfigurationHelper.GetSupabaseKey()
            );

            Supabase.SetSession(accessToken, userId);

            if (!Guid.TryParse(userId, out var guidUserId))
            {
                ShowLogin();
                return;
            }

            CurrentUserId = guidUserId;

            InitRestServicesInternal(accessToken);

            // Optionnel: validation imm√©diate si internet
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
            {
                var ok = await ValidateSessionAsync();
                if (!ok)
                {
                    HandleJwtExpired();
                    return;
                }
            }

            ShowAppShell();
        }

        private void InitRestServicesInternal(string accessToken)
        {
            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            var client = new SupabaseRestClient(url, key);
            client.SetBearerToken(accessToken);

            RestClient = client;
            RecipesService = new RecipesService(client);
            IngredientsService = new IngredientsService(client);
            ListeCoursesSupabaseService = new ListeCoursesSupabaseService(client);
            RecetteIngredientsService = new RecetteIngredientsService(client);
        }

        // ‚úÖ Test simple qui provoque JWT expired si token mort
        private async Task<bool> ValidateSessionAsync()
        {
            try
            {
                if (RecipesService == null || CurrentUserId == null)
                    return false;

                // Petit appel l√©ger: si JWT expir√©, √ßa throw
                _ = await RecipesService.GetRecettesAsync(CurrentUserId.Value);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpiredException(ex))
                    return false;

                // Autre erreur r√©seau : on ne force pas logout
                System.Diagnostics.Debug.WriteLine("‚ö†Ô∏è ValidateSessionAsync: " + ex.Message);
                return true;
            }
        }

        // ------------------ NAV ------------------

        public void ShowAppShell()
        {
            if (!IsConnected)
            {
                ShowLogin();
                return;
            }

            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = new AppShell();
            });
        }

        public void ShowLogin()
        {
            MainThread.BeginInvokeOnMainThread(() =>
            {
                MainPage = RootPage.CreateLoginRoot();
            });
        }

        // ------------------ LOGOUT ------------------

        public void Logout(bool silent = false)
        {
            SecureStorage.Remove("remember_me");
            SecureStorage.Remove("sb_access_token");
            SecureStorage.Remove("sb_user_id");

            Supabase?.ClearSession();
            CurrentUserId = null;

            RestClient = null;
            RecipesService = null;
            IngredientsService = null;
            ListeCoursesSupabaseService = null;
            RecetteIngredientsService = null;

            if (!silent)
                ShowLogin();
            else
                MainThread.BeginInvokeOnMainThread(() => MainPage = RootPage.CreateLoginRoot());
        }

        // ------------------ MISC ------------------

        public Task HandleDeepLinkAsync(Uri uri) => Task.CompletedTask;

        public void SetSupabase(SupabaseService supabase) => Supabase = supabase;
        public void SetCurrentUserId(Guid userId) => CurrentUserId = userId;

        public void InitRestServices(string accessToken)
        {
            InitRestServicesInternal(accessToken);
        }
    }
}

================================================================================
FILE: appsettings.json
================================================================================

{
  "Supabase": {
    "Url": "https://wzctiypsadqktzcnswri.supabase.co",
    "Key": "sb_publishable_ZFk8ONON5qMA0vZ3V0nVAg_TZZrO1F1"
  },

  "OCR": {
    "ApiKey": "K86867725288957"
  }

}

================================================================================
FILE: AppShell.xaml
================================================================================

<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="LoGeCuiMobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:pages="clr-namespace:LoGeCuiMobile.Pages"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    FlyoutBehavior="Flyout">

    <FlyoutItem Title="{tr:Translate Nav_ShoppingList}" Route="liste-courses">
        <ShellContent Route="liste-courses"
                      ContentTemplate="{DataTemplate pages:ListeCoursesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Recipes}" Route="mes-recettes">
        <ShellContent Route="mes-recettes"
                      ContentTemplate="{DataTemplate pages:MesRecettesPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_RandomMenu}" Route="menu-aleatoire">
        <ShellContent Route="menu-aleatoire"
                      ContentTemplate="{DataTemplate pages:MenuAleatoirePage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Ingredients}" Route="mes-ingredients">
        <ShellContent Route="mes-ingredients"
                      ContentTemplate="{DataTemplate pages:MesIngredientsPage}" />
    </FlyoutItem>

    <FlyoutItem Title="{tr:Translate Nav_Settings}" Route="settings">
        <ShellContent Route="settings"
                      ContentTemplate="{DataTemplate pages:SettingsPage}" />
    </FlyoutItem>

</Shell>


================================================================================
FILE: AppShell.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Pages;
using LoGeCuiMobile; // si ForgotPasswordPage est √† la racine du projet

namespace LoGeCuiMobile;

public partial class AppShell : Shell
{
    public AppShell()
    {
        InitializeComponent();

        Routing.RegisterRoute(nameof(ListeCoursesPage), typeof(ListeCoursesPage));
        Routing.RegisterRoute(nameof(ForgotPasswordPage), typeof(ForgotPasswordPage));
        Routing.RegisterRoute(nameof(AjouterIngredientPage), typeof(AjouterIngredientPage));
        Routing.RegisterRoute(nameof(AjouterRecettePage), typeof(AjouterRecettePage));
        Routing.RegisterRoute(nameof(MenuAleatoirePage), typeof(MenuAleatoirePage));

    }
}

================================================================================
FILE: ConfigurationHelper.cs
================================================================================

Ôªøusing Microsoft.Extensions.Configuration;
using Microsoft.Maui.Storage;
using System;
using System.IO;

namespace LoGeCuiMobile
{
    public static class ConfigurationHelper
    {
        private static IConfiguration? _configuration;
        private static readonly object _lock = new();

        private static IConfiguration Configuration
        {
            get
            {
                if (_configuration != null)
                    return _configuration;

                lock (_lock)
                {
                    if (_configuration != null)
                        return _configuration;

                    try
                    {
                        // Lire le fichier depuis le package MAUI
                        using var streamTask = FileSystem.OpenAppPackageFileAsync("appsettings.json");
                        streamTask.Wait();
                        using var stream = streamTask.Result;

                        // Copie en m√©moire pour √©viter tout souci de stream non seekable / lecture partielle
                        using var ms = new MemoryStream();
                        stream.CopyTo(ms);
                        ms.Position = 0;

                        var builder = new ConfigurationBuilder()
                            .AddJsonStream(ms);

                        _configuration = builder.Build();

#if DEBUG
                        System.Diagnostics.Debug.WriteLine("[CONFIG] appsettings.json charg√©");
                        System.Diagnostics.Debug.WriteLine("[CONFIG] Supabase:Url=" + (_configuration["Supabase:Url"] ?? "<null>"));
                        System.Diagnostics.Debug.WriteLine("[CONFIG] OCR:ApiKey present=" + (!string.IsNullOrWhiteSpace(_configuration["OCR:ApiKey"])));
#endif

                        return _configuration;
                    }
                    catch (Exception ex)
                    {
                        throw new Exception(
                            "Impossible de charger appsettings.json depuis le package MAUI. " +
                            "V√©rifie qu'il est bien dans LoGeCuiMobile, Build Action = MauiAsset, et que tu as fait Clean/Rebuild. " +
                            $"D√©tail: {ex.Message}", ex);
                    }
                }
            }
        }


        // =========================
        // SUPABASE
        // =========================

        public static string GetSupabaseUrl()
            => Configuration["Supabase:Url"]
               ?? throw new Exception("Supabase:Url manquant dans appsettings.json");

        public static string GetSupabaseKey()
            => Configuration["Supabase:Key"]
               ?? throw new Exception("Supabase:Key manquant dans appsettings.json");

        // =========================
        // OCR
        // =========================

        public static string GetOcrApiKey()
        {
            var key = Configuration["OCR:ApiKey"];

            if (string.IsNullOrWhiteSpace(key))
                throw new Exception("OCR:ApiKey manquant dans appsettings.json");

            return key;
        }
    }
}





================================================================================
FILE: Converters\BoolToStrikethroughConverter.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Globalization;

namespace LoGeCuiMobile.Converters
{
    public class BoolToStrikethroughConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
            => (value is bool b && b) ? TextDecorations.Strikethrough : TextDecorations.None;

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
            => throw new NotImplementedException();
    }
}

================================================================================
FILE: Converters\QuantityFormatConverter.cs
================================================================================

Ôªøusing System;
using System.Globalization;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile.Converters
{
    public class QuantityFormatConverter : IMultiValueConverter
    {
        public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
        {
            var q = values.Length > 0 ? values[0]?.ToString() ?? "" : "";
            var u = values.Length > 1 ? values[1]?.ToString() ?? "" : "";

            var fmt = LocalizationResourceManager.Instance["Ingredients_QuantityFormat"];
            // Ex: "Quantit√© : {0} {1}" / "Menge: {0} {1}"
            return string.Format(fmt, q, u).Trim();
        }

        public object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture)
            => throw new NotSupportedException();
    }
}

================================================================================
FILE: ForgotPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="LoGeCuiMobile.ForgotPasswordPage"
    Title="Mot de passe oubli√©">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="Mot de passe oubli√©"
                   FontSize="20"
                   FontAttributes="Bold" />

            <Label Text="Entrez votre email pour recevoir un lien de r√©initialisation."
                   FontSize="14" />

            <Entry x:Name="EmailEntry"
                   Placeholder="Adresse email"
                   Keyboard="Email" />

            <Button x:Name="SendButton"
                    Text="Envoyer"
                    Clicked="OnSendClicked" />

            <Label x:Name="StatusLabel"
                   FontSize="13" />

            <Button Text="Retour"
                    Clicked="OnBackClicked" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: ForgotPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiShared.Services;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Graphics;
using System;

namespace LoGeCuiMobile
{
    // Optionnel : permet de pr√©-remplir l'email si tu navigues avec ?email=...
    [QueryProperty(nameof(PrefillEmail), "email")]
    public partial class ForgotPasswordPage : ContentPage
    {
        private readonly SupabaseService _supabaseService;

        // Valeur pass√©e via Shell : ?email=...
        public string PrefillEmail
        {
            set
            {
                // Evite crash si EmailEntry n'est pas encore pr√™t
                try
                {
                    var decoded = Uri.UnescapeDataString(value ?? "");
                    if (!string.IsNullOrWhiteSpace(decoded))
                        EmailEntry.Text = decoded;
                }
                catch { /* ignore */ }
            }
        }

        public ForgotPasswordPage()
        {
            InitializeComponent();

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();

            _supabaseService = new SupabaseService(url, key);

            StatusLabel.Text = "";
        }

        private async void OnSendClicked(object sender, EventArgs e)
        {
            try
            {
                // S√©curit√© si un contr√¥le est null (mauvais x:Name / x:Class)
                if (EmailEntry == null || SendButton == null || StatusLabel == null)
                {
                    await DisplayAlert("Erreur", "Interface non initialis√©e (XAML). V√©rifie x:Class et x:Name.", "OK");
                    return;
                }

                var email = (EmailEntry.Text ?? "").Trim();

                // ‚úÖ Validation obligatoire
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@") || !email.Contains("."))
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = "Veuillez saisir une adresse email valide.";
                    return;
                }

                SendButton.IsEnabled = false;
                StatusLabel.TextColor = Colors.Black;
                StatusLabel.Text = "Envoi en cours‚Ä¶";

                var result = await _supabaseService.SendPasswordResetAsync(email);

                if (result.success)
                {
                    StatusLabel.TextColor = Colors.Green;
                    StatusLabel.Text = "Email envoy√© ‚úÖ V√©rifiez votre bo√Æte mail (et les spams).";
                }
                else
                {
                    StatusLabel.TextColor = Colors.Red;
                    StatusLabel.Text = result.error ?? "Impossible d'envoyer l'email.";
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ √©vite le crash et donne une erreur lisible
                StatusLabel.TextColor = Colors.Red;
                StatusLabel.Text = "Erreur : " + ex.Message;
            }
            finally
            {
                if (SendButton != null)
                    SendButton.IsEnabled = true;
            }
        }

        private async void OnBackClicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PopAsync();
            }
            catch
            {
                // au cas o√π
                await Shell.Current?.GoToAsync("..");
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFrameworks>net10.0-android;net10.0-ios;net10.0-maccatalyst</TargetFrameworks>
		<TargetFrameworks Condition="$([MSBuild]::IsOSPlatform('windows'))">$(TargetFrameworks);net10.0-windows10.0.19041.0</TargetFrameworks>

		<!-- Note for MacCatalyst:
		The default runtime is maccatalyst-x64, except in Release config, in which case the default is maccatalyst-x64;maccatalyst-arm64.
		When specifying both architectures, use the plural <RuntimeIdentifiers> instead of the singular <RuntimeIdentifier>.
		The Mac App Store will NOT accept apps with ONLY maccatalyst-arm64 indicated;
		either BOTH runtimes must be indicated or ONLY macatalyst-x64. -->
		<!-- For example: <RuntimeIdentifiers>maccatalyst-x64;maccatalyst-arm64</RuntimeIdentifiers> -->

		<OutputType>Exe</OutputType>
		<RootNamespace>LoGeCuiMobile</RootNamespace>
		<UseMaui>true</UseMaui>
		<SingleProject>true</SingleProject>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>

		<!-- Display name -->
		<ApplicationTitle>LoGeCuiMobile</ApplicationTitle>

		<!-- App Identifier -->
		<ApplicationId>com.companyname.logecuimobile</ApplicationId>

		<!-- Versions -->
		<ApplicationDisplayVersion>2.0.0</ApplicationDisplayVersion>
		<ApplicationVersion>6</ApplicationVersion>

		<!-- To develop, package, and publish an app to the Microsoft Store, see: https://aka.ms/MauiTemplateUnpackaged -->
		<WindowsPackageType>None</WindowsPackageType>

		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'ios'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'maccatalyst'">15.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'android'">21.0</SupportedOSPlatformVersion>
		<SupportedOSPlatformVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</SupportedOSPlatformVersion>
		<TargetPlatformMinVersion Condition="$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)')) == 'windows'">10.0.17763.0</TargetPlatformMinVersion>
		<AndroidSigningKeyStore>logecui.keystore</AndroidSigningKeyStore>
	</PropertyGroup>

	<PropertyGroup>
		<UserSecretsId>votre-guid-unique</UserSecretsId>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Debug|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <EmbedAssembliesIntoApk>False</EmbedAssembliesIntoApk>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(TargetFramework)|$(Platform)'=='Release|net10.0-android|AnyCPU'">
	  <AndroidKeyStore>True</AndroidKeyStore>
	  <AndroidSigningStorePass>LoGeCui2025</AndroidSigningStorePass>
	  <AndroidSigningKeyAlias>LoGeCui</AndroidSigningKeyAlias>
	  <AndroidSigningKeyPass>LoGeCui2025</AndroidSigningKeyPass>
	  <AndroidCreatePackagePerAbi>False</AndroidCreatePackagePerAbi>
	</PropertyGroup>

	<ItemGroup>
		<!-- App Icon -->
		<MauiIcon Include="Resources\AppIcon\postriticone.png" />

		<!-- Splash Screen -->
		<MauiSplashScreen Include="Resources\Splash\postriticone.png" Color="#FFFFFF" BaseSize="128,128" />

		<!-- Images -->
		<MauiImage Include="Resources\Images\*" />
		<MauiImage Update="Resources\Images\dotnet_bot.png" Resize="True" BaseSize="300,185" />
		
		<!-- Custom Fonts -->
		<MauiFont Include="Resources\Fonts\*" />

		<!-- Raw Assets (also remove the "Resources\Raw" prefix) -->
		<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />
	</ItemGroup>

	<ItemGroup>
		<MauiAsset Include="appsettings.json">
		  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</MauiAsset>
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="CommunityToolkit.Maui" Version="14.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="10.0.2" />
		<PackageReference Include="Microsoft.Maui.Controls" Version="10.0.30" />
		<PackageReference Include="Microsoft.Extensions.Logging.Debug" Version="10.0.2" />
		<PackageReference Include="SkiaSharp" Version="3.119.1" />
		<PackageReference Include="sqlite-net-pcl" Version="1.9.172" />
		<PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
	</ItemGroup>

	<ItemGroup>
	  <ProjectReference Include="..\LoGeCuiShared\LoGeCuiShared.csproj" />
	</ItemGroup>

	<ItemGroup>
	  <MauiXaml Update="ForgotPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="LoginPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterIngredientPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\AjouterRecettePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ListeCoursesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MenuAleatoirePage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesIngredientsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\MesRecettesPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\ResetPasswordPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	  <MauiXaml Update="Pages\SettingsPage.xaml">
	    <Generator>MSBuild:Compile</Generator>
	  </MauiXaml>
	</ItemGroup>

	<ItemGroup>
	  <Folder Include="Platforms\Android\Resources\Raw\" />
	</ItemGroup>

	<ItemGroup>
	  <Compile Update="Resources\Lang\AppResources.Designer.cs">
	    <DesignTime>True</DesignTime>
	    <AutoGen>True</AutoGen>
	    <DependentUpon>AppResources.resx</DependentUpon>
	  </Compile>
	</ItemGroup>

	<ItemGroup>
	  <EmbeddedResource Update="Resources\Lang\AppResources.resx">
	    <Generator>PublicResXFileCodeGenerator</Generator>
	    <LastGenOutput>AppResources.Designer.cs</LastGenOutput>
	  </EmbeddedResource>
	</ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiMobile.sln
================================================================================

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.5.2.0
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "LoGeCuiMobile", "LoGeCuiMobile.csproj", "{718860EB-0CC0-D204-6424-4B05AD96CB46}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{718860EB-0CC0-D204-6424-4B05AD96CB46}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {FE3EFD92-D10C-4693-8095-DE23E3011D74}
	EndGlobalSection
EndGlobal

================================================================================
FILE: LoginPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lang="clr-namespace:LoGeCuiMobile.Resources.Lang"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.LoginPage"
             Title="LoGeCui - Connexion"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="20" VerticalOptions="Center">

            

            <!-- Logo -->
            <Label Text="üõí LoGeCui"
                   FontSize="42"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                   Margin="0,10,0,30"/>

            <!-- üåç Choix de langue -->
            <Picker x:Name="LanguagePicker"
        Title="üåç Language"
        SelectedIndexChanged="LanguagePicker_SelectedIndexChanged">
                <Picker.Items>
                    <x:String>üá´üá∑ Fran√ßais</x:String>
                    <x:String>üá¨üáß English</x:String>
                    <x:String>üá©üá™ Deutsch</x:String>
                    <x:String>üá™üá∏ Espa√±ol</x:String>
                    <x:String>üáÆüáπ Italiano</x:String>
                    <x:String>üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</x:String>
                    <x:String>üáµüá± Polski</x:String>
                    <x:String>üáπüá∑ T√ºrk√ße</x:String>
                    <x:String>üá∑üá¥ Rom√¢nƒÉ</x:String>
                    <x:String>üá®üáø ƒåe≈°tina</x:String>
                    <x:String>üá∞üá∑ ÌïúÍµ≠Ïñ¥</x:String>
                    <x:String>üáØüáµ Êó•Êú¨Ë™û</x:String>
                    <x:String>üáπüá≠ ‡πÑ‡∏ó‡∏¢</x:String>
                    <x:String>üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</x:String>
                </Picker.Items>
            </Picker>

            <!-- Email -->
            <Label Text="{tr:Translate Email}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Entry x:Name="TxtEmail"
                   Placeholder="email@example.com"
                   Keyboard="Email"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <!-- Mot de passe -->
            <Label Text="{tr:Translate Password}"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

            <Grid ColumnDefinitions="*,Auto"
                  BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                  Padding="8">

                <Entry x:Name="TxtPassword"
                       Placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                       IsPassword="True"
                       BackgroundColor="Transparent"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                <Button Grid.Column="1"
                        Text="üëÅ"
                        BackgroundColor="Transparent"
                        Clicked="TogglePassword"/>
            </Grid>

            <!-- Rester connect√© -->
            <HorizontalStackLayout Spacing="10">
                <CheckBox x:Name="ChkRememberMe" Color="#27AE60"/>
                <Label Text="{tr:Translate StayConnected}"
                       VerticalOptions="Center"
                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            </HorizontalStackLayout>

            <!-- Connexion -->
            <Button x:Name="BtnConnexion"
                    Text="{tr:Translate LoginButton}"
                    BackgroundColor="#27AE60"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnConnexion_Clicked"/>

            <!-- Inscription -->
            <Button x:Name="BtnInscription"
                    Text="{tr:Translate SignupButton}"
                    BackgroundColor="#3498DB"
                    TextColor="White"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="10"
                    Clicked="BtnInscription_Clicked"/>

            <!-- Message -->
            <Label x:Name="TxtMessage"
                   TextColor="Red"
                   HorizontalOptions="Center"
                   IsVisible="False"/>

            <!-- Mot de passe oubli√© -->
            <Button Text="{tr:Translate ForgotPassword}"
                    BackgroundColor="Transparent"
                    TextColor="{AppThemeBinding Light=Blue, Dark=#4DA3FF}"
                    Clicked="BtnForgotPassword_Clicked"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoginPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile; // ForgotPasswordPage / RootPage
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;
using System.Globalization;

namespace LoGeCuiMobile.Pages
{
    public partial class LoginPage : ContentPage
    {
        private readonly SupabaseService _supabase;
        private bool _isPasswordVisible = false;

        // Emp√™che SelectedIndexChanged pendant l'init
        private bool _isInitializingLanguage = false;

        public LoginPage()
        {
            InitializeComponent();

            _isInitializingLanguage = true;
            InitLanguagePickerSelection();
            _isInitializingLanguage = false;

            var url = ConfigurationHelper.GetSupabaseUrl();
            var key = ConfigurationHelper.GetSupabaseKey();
            _supabase = new SupabaseService(url, key);

            _ = LoadSavedUserAsync();
        }

        // =========================
        // LANGUE (Picker)
        // =========================
        private void LanguagePicker_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (_isInitializingLanguage)
                return;

            if (LanguagePicker.SelectedIndex < 0)
                return;

            var langCode = LanguagePicker.SelectedIndex switch
            {
                0 => "fr",
                1 => "en",
                2 => "de",
                3 => "es",
                4 => "it",
                5 => "ar",
                6 => "pl",
                7 => "tr",
                8 => "ro",
                9 => "cs",
                10 => "ko",
                11 => "ja",
                12 => "th",
                13 => "hi",
                _ => "fr"
            };

            var current = Preferences.Get("app_language", "fr");
            if (string.Equals(current, langCode, StringComparison.OrdinalIgnoreCase))
                return;

            Preferences.Set("app_language", langCode);

            var culture = new CultureInfo(langCode);

            // ‚úÖ Applique la culture + notifie l'UI (si tu utilises TranslateExtension)
            LocalizationResourceManager.Instance.SetCulture(culture);

            // ‚ö†Ô∏è Si ton XAML est encore en x:Static et que tu veux quand m√™me voir le changement,
            // d√©-commente ce bloc (mais √©vite de le faire pendant l'init) :
            // MainThread.BeginInvokeOnMainThread(() =>
            // {
            //     Application.Current.MainPage = RootPage.CreateLoginRoot();
            // });
        }

        private void InitLanguagePickerSelection()
        {
            var lang = Preferences.Get("app_language", "fr");

            var index = lang switch
            {
                "fr" => 0,
                "en" => 1,
                "de" => 2,
                "es" => 3,
                "it" => 4,
                "ar" => 5,
                "pl" => 6,
                "tr" => 7,
                "ro" => 8,
                "cs" => 9,
                "ko" => 10,
                "ja" => 11,
                "th" => 12,
                "hi" => 13,
                _ => 0
            };

            LanguagePicker.SelectedIndex = index;
        }

        // =========================
        // LOGIN
        // =========================
        private async void BtnConnexion_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.Connecting, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.ConnectionError, Colors.Red);
                    await DisplayAlert(AppResources.ErrorTitle, AppResources.BadPassword, "OK");
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);


                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async Task LoadSavedUserAsync()
        {
            try
            {
                var rememberMe = await SecureStorage.GetAsync("remember_me");
                if (!string.Equals(rememberMe, "true", StringComparison.OrdinalIgnoreCase))
                    return;

                var email = await SecureStorage.GetAsync("user_email");
                if (!string.IsNullOrEmpty(email))
                {
                    TxtEmail.Text = email;
                    ChkRememberMe.IsChecked = true;
                }
            }
            catch
            {
                // ignore SecureStorage errors
            }
        }

        private async void BtnInscription_Clicked(object sender, EventArgs e)
        {
            try
            {
                SetStatus(AppResources.CreatingAccount, Colors.Blue);

                var email = TxtEmail.Text?.Trim() ?? string.Empty;
                var password = TxtPassword.Text ?? string.Empty;

                if (string.IsNullOrWhiteSpace(email) || string.IsNullOrWhiteSpace(password))
                {
                    SetStatus(AppResources.FillAllFields, Colors.Red);
                    return;
                }

                var (success, accessToken, userId, error) =
                    await _supabase.SignUpThenSignInAsync(email, password);

                if (!success)
                {
                    SetStatus(error ?? AppResources.SignupError, Colors.Red);
                    return;
                }

                accessToken ??= string.Empty;
                userId ??= string.Empty;

                if (ChkRememberMe?.IsChecked == true)
                {
                    await SecureStorage.SetAsync("remember_me", "true");
                    await SecureStorage.SetAsync("sb_access_token", accessToken);
                    await SecureStorage.SetAsync("sb_user_id", userId);
                    await SecureStorage.SetAsync("user_email", email);
                }
                else
                {
                    SecureStorage.Remove("remember_me");
                    SecureStorage.Remove("sb_access_token");
                    SecureStorage.Remove("sb_user_id");
                    SecureStorage.Remove("user_email");
                }

                if (!string.IsNullOrWhiteSpace(accessToken) && !string.IsNullOrWhiteSpace(userId))
                    _supabase.SetSession(accessToken, userId);

                var app = (App)Application.Current;
                app.SetSupabase(_supabase);

                if (Guid.TryParse(userId, out var guidUserId))
                    app.SetCurrentUserId(guidUserId);

                app.InitRestServices(accessToken);
                app.ShowAppShell();
            }
            catch (Exception ex)
            {
                SetStatus($"{AppResources.ErrorTitle} : {ex.Message}", Colors.Red);
            }
        }

        private async void BtnForgotPassword_Clicked(object sender, EventArgs e)
        {
            try
            {
                await Navigation.PushAsync(new ForgotPasswordPage());
            }
            catch (Exception ex)
            {
                await DisplayAlert(AppResources.ErrorTitle, ex.ToString(), "OK");
            }
        }

        private void TogglePassword(object sender, EventArgs e)
        {
            _isPasswordVisible = !_isPasswordVisible;

            TxtPassword.IsPassword = !_isPasswordVisible;

            if (sender is Button btn)
                btn.Text = _isPasswordVisible ? "üôà" : "üëÅ";

            if (!string.IsNullOrEmpty(TxtPassword.Text))
            {
                var t = TxtPassword.Text;
                TxtPassword.Text = string.Empty;
                TxtPassword.Text = t;
            }
        }

        private void SetStatus(string message, Color color)
        {
            TxtMessage.Text = message;
            TxtMessage.TextColor = color;
            TxtMessage.IsVisible = true;
        }
    }
}

================================================================================
FILE: MainPage.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LoGeCuiMobile.MainPage">

    <ScrollView>
        <VerticalStackLayout
            Padding="30,0"
            Spacing="25">
            <Image
                Source="dotnet_bot.png"
                HeightRequest="185"
                Aspect="AspectFit"
                SemanticProperties.Description="dot net bot in a submarine number ten" />

            <Label
                Text="Hello, World!"
                Style="{StaticResource Headline}"
                SemanticProperties.HeadingLevel="Level1" />

            <Label
                Text="Welcome to &#10;.NET Multi-platform App UI"
                Style="{StaticResource SubHeadline}"
                SemanticProperties.HeadingLevel="Level2"
                SemanticProperties.Description="Welcome to dot net Multi platform App U I" />

            <Button
                x:Name="CounterBtn"
                Text="Click me" 
                SemanticProperties.Hint="Counts the number of times you click"
                Clicked="OnCounterClicked"
                HorizontalOptions="Fill" />
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: MainPage.xaml.cs
================================================================================

Ôªønamespace LoGeCuiMobile
{
    public partial class MainPage : ContentPage
    {
        int count = 0;

        public MainPage()
        {
            InitializeComponent();
        }

        private void OnCounterClicked(object? sender, EventArgs e)
        {
            count++;

            if (count == 1)
                CounterBtn.Text = $"Clicked {count} time";
            else
                CounterBtn.Text = $"Clicked {count} times";

            SemanticScreenReader.Announce(CounterBtn.Text);
        }
    }
}

================================================================================
FILE: MauiProgram.cs
================================================================================

Ôªøusing System;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using Microsoft.Maui.Storage;
using CommunityToolkit.Maui;

namespace LoGeCuiMobile
{
    public static class MauiProgram
    {
        public static IConfiguration Configuration { get; private set; } = new ConfigurationBuilder().Build();

        public static MauiApp CreateMauiApp()
        {
            var builder = MauiApp.CreateBuilder();

            builder
            .UseMauiApp<App>()
            .UseMauiCommunityToolkit()   // üëà AJOUT ICI
            .ConfigureFonts(fonts =>
            {
                fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
            });

#if DEBUG
            builder.Logging.AddDebug();
#endif

            // ‚úÖ Charge appsettings.json (MauiAsset) sans faire crasher l'app si absent
            try
            {
                using var stream = FileSystem.OpenAppPackageFileAsync("appsettings.json")
                                             .GetAwaiter()
                                             .GetResult();

                builder.Configuration.AddJsonStream(stream);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIG ERROR ==========");
                System.Diagnostics.Debug.WriteLine("Impossible de charger appsettings.json depuis le package MAUI.");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("==================================");
                // On continue volontairement pour √©viter le crash.
            }

            Configuration = builder.Configuration;

            // ‚úÖ IMPORTANT: on force le namespace exact (√©vite conflits)
            try
            {
                LoGeCuiShared.Services.ConfigurationHelper.Configure(key => Configuration[key]);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine("========== CONFIGHELPER ERROR ==========");
                System.Diagnostics.Debug.WriteLine(ex.ToString());
                System.Diagnostics.Debug.WriteLine("========================================");
                // On continue; l'erreur r√©elle ressortira quand une cl√© sera demand√©e.
            }

            return builder.Build();
        }
    }
}


================================================================================
FILE: Models\IngredientUI.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    public class IngredientUi : INotifyPropertyChanged
    {
        public Ingredient Model { get; }

        public IngredientUi(Ingredient model)
        {
            Model = model;
        }

        public System.Guid Id => Model.Id;
        public string Nom => Model.Nom ?? "";
        public string? Quantite => Model.Quantite;
        public string? Unite => Model.Unite;

        public bool EstDisponible
        {
            get => Model.EstDisponible;
            set
            {
                if (Model.EstDisponible == value) return;
                Model.EstDisponible = value;
                OnPropertyChanged();
            }
        }

        // ‚úÖ NOUVEAU : Favori (n√©cessite Model.EstFavori)
        public bool EstFavori
        {
            get => Model.EstFavori;
            set
            {
                if (Model.EstFavori == value) return;
                Model.EstFavori = value;
                OnPropertyChanged();
                OnPropertyChanged(nameof(HeartText));
            }
        }

        // ‚úÖ NOUVEAU : emoji coeur
        public string HeartText => EstFavori ? "‚ù§Ô∏è" : "ü§ç";

        bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                OnPropertyChanged();
            }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: Models\LanguageItem.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiMobile.Models
{
    internal class LanguageItem
    {
        public string Name { get; set; } = "";
        public string Code { get; set; } = "";
        public string Flag { get; set; } = ""; // emoji drapeau
    }
}

================================================================================
FILE: Pages\AjouterIngredientPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    x:Class="LoGeCuiMobile.Pages.AjouterIngredientPage"
    Title="{tr:Translate Ingredients_Add_Title}">

    <VerticalStackLayout Padding="20" Spacing="14">

        <Entry
            x:Name="NomEntry"
            Placeholder="{tr:Translate Ingredients_Add_NamePlaceholder}" />

        <Entry
            x:Name="QuantiteEntry"
            Placeholder="{tr:Translate Ingredients_Add_QuantityPlaceholder}"
            Keyboard="Numeric" />

        <Entry
            x:Name="UniteEntry"
            Placeholder="{tr:Translate Ingredients_Add_UnitPlaceholder}" />

        <HorizontalStackLayout Spacing="10">
            <CheckBox x:Name="DisponibleCheckBox" IsChecked="True"/>
            <Label Text="{tr:Translate Ingredients_Add_Available}"
                   VerticalTextAlignment="Center"/>
        </HorizontalStackLayout>

        <Button
            Text="{tr:Translate Ingredients_Add_Save}"
            BackgroundColor="#28a745"
            Clicked="OnSaveClicked"/>

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: Pages\AjouterIngredientPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.Pages;

public partial class AjouterIngredientPage : ContentPage
{
    public AjouterIngredientPage()
    {
        InitializeComponent();
    }

    private async void OnSaveClicked(object sender, EventArgs e)
    {
        try
        {
            if (string.IsNullOrWhiteSpace(NomEntry.Text))
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Ingredients_Add_NameRequired"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            var ingredient = new Ingredient
            {
                Nom = NomEntry.Text.Trim(),
                Quantite = QuantiteEntry.Text?.Trim() ?? "",
                Unite = UniteEntry.Text?.Trim() ?? "",
                EstDisponible = DisponibleCheckBox.IsChecked
            };

            // ‚úÖ 1) Toujours sauver dans le cache local (offline-first)
            await SaveIngredientToLocalCacheAsync(ingredient);

            // ‚úÖ 2) Si internet + connect√© => push Supabase
            var app = (App)Application.Current;

            var hasInternet = Connectivity.Current.NetworkAccess == NetworkAccess.Internet;

            if (hasInternet && app.IsConnected && app.IngredientsService != null && app.CurrentUserId != null)
            {
                await app.IngredientsService.CreateIngredientAsync(app.CurrentUserId.Value, ingredient);

            }

            // ‚úÖ Retour
            await Shell.Current.GoToAsync("..");
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private static async System.Threading.Tasks.Task SaveIngredientToLocalCacheAsync(Ingredient ingredient)
    {
        // R√©cup√®re cache local
        var local = await App.LocalDb.GetIngredientsAsync();
        var models = local.Select(x => x.ToModel()).ToList();

        // Evite doublon par Nom (tu peux adapter sur ExternalId si tu en as)
        bool exists = models.Any(x =>
            string.Equals(x.Nom?.Trim(), ingredient.Nom?.Trim(), StringComparison.OrdinalIgnoreCase));

        if (!exists)
            models.Add(ingredient);

        await App.LocalDb.SaveIngredientsAsync(models);
    }
}

================================================================================
FILE: Pages\AjouterRecettePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.AjouterRecettePage"
             Title="{tr:Translate Recipes_Add_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="{tr:Translate Recipes_Add_NameLabel}" />
            <Entry x:Name="NomEntry"
                   Placeholder="{tr:Translate Recipes_Add_NamePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_CategoryLabel}" />
            <Picker x:Name="CategoriePicker"
                    Title="{tr:Translate Recipes_Add_CategoryPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_TimeLabel}" />
            <Entry x:Name="TempsEntry"
                   Keyboard="Numeric"
                   Placeholder="{tr:Translate Recipes_Add_TimePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_IngredientsLabel}" />
            <Editor x:Name="IngredientsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="140"
                    Placeholder="{tr:Translate Recipes_Add_IngredientsPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_InstructionsLabel}" />
            <Editor x:Name="InstructionsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="180"
                    Placeholder="{tr:Translate Recipes_Add_InstructionsPlaceholder}" />

            <Button Text="{tr:Translate Recipes_Add_ScanOcr}"
                    Clicked="OnScanClicked" />

            <Button Text="{tr:Translate Recipes_Add_Save}"
                    Clicked="OnSaveClicked" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: Pages\AjouterRecettePage.xaml.cs
================================================================================

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.Services;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Media;

namespace LoGeCuiMobile.Pages
{
    public partial class AjouterRecettePage : ContentPage
    {
        private Recette? _editingRecette;

        public AjouterRecettePage(Recette? recette = null)
        {
            InitializeComponent();

            // Valeurs conformes ÔøΩ ta DB Supabase (Entree / Plat / Dessert)
            CategoriePicker.ItemsSource = new List<string> { "Entree", "Plat", "Dessert" };
            CategoriePicker.SelectedIndex = 1; // Plat par dÔøΩfaut

            _editingRecette = recette;

            if (_editingRecette != null)
            {
                Title = "Modifier recette";
                _ = LoadRecetteForEditAsync();
            }
            else
            {
                Title = "Ajouter recette";
            }
        }

        private async System.Threading.Tasks.Task LoadRecetteForEditAsync()
        {
            try
            {
                if (_editingRecette == null)
                    return;

                NomEntry.Text = _editingRecette.Nom;
                TempsEntry.Text = _editingRecette.TempsPreparation.ToString(CultureInfo.InvariantCulture);
                InstructionsEditor.Text = _editingRecette.Instructions ?? "";

                // CatÔøΩgorie
                var cat = string.IsNullOrWhiteSpace(_editingRecette.CategorieDb) ? "Plat" : _editingRecette.CategorieDb.Trim();
                if (CategoriePicker.ItemsSource is List<string> cats && cats.Contains(cat))
                    CategoriePicker.SelectedItem = cat;
                else
                    CategoriePicker.SelectedItem = "Plat";

                // Charger ingrÔøΩdients depuis Supabase
                var app = (App)Application.Current;
                if (app.RecetteIngredientsService != null && _editingRecette.Id != Guid.Empty)
                {
                    var items = await app.RecetteIngredientsService.GetForRecetteAsync(_editingRecette.Id);

                    // On remplit l'editor ingrÔøΩdients en "1 par ligne"
                    // NOTE: items = (nom, quantite, unite)
                    IngredientsEditor.Text = (items.Count == 0)
                        ? ""
                        : string.Join("\n", items.Select(x =>
                            string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                                ? x.nom
                                : $"{x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                        ));
                }
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    ex.Message,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        private async void OnSaveClicked(object sender, EventArgs e)
        {
            try
            {
                var app = (App)Application.Current;

                if (app.CurrentUserId == null || app.RecipesService == null)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_LoginRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                if (app.RecetteIngredientsService == null)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ServiceNotReady"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NameRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                var userId = app.CurrentUserId.Value;
                var categorie = (CategoriePicker.SelectedItem as string) ?? "Plat";
                int temps = int.TryParse(TempsEntry.Text, out var t) ? t : 0;

                // Mode ÔøΩdition => on reprend la recette, sinon crÔøΩation
                var recette = _editingRecette ?? new Recette();

                recette.Nom = NomEntry.Text.Trim();
                recette.CategorieDb = categorie;
                recette.TempsPreparation = temps;
                recette.Difficulte = 1;
                recette.Instructions = InstructionsEditor.Text ?? "";
                recette.IsFavorite = false;

                // ExternalId stable (requis pour lÔøΩupsert + rÔøΩcupÔøΩration d'id si besoin)
                if (string.IsNullOrWhiteSpace(recette.ExternalId))
                    recette.ExternalId = Guid.NewGuid().ToString("N");

                // 1) Upsert recette (table recettes)
                await app.RecipesService.UpsertRecetteAsync(userId, recette);

                // 2) Obtenir l'UUID DB (recette_id) pour recette_ingredients
                Guid recetteId;

                // Si on est en ÔøΩdition et qu'on a un Id valide, on l'utilise directement
                if (_editingRecette != null && _editingRecette.Id != Guid.Empty)
                {
                    recetteId = _editingRecette.Id;
                }
                else
                {
                    // Sinon fallback via ExternalId (fiable aprÔøΩs upsert)
                    var rid = await app.RecipesService.GetRecetteIdByExternalIdAsync(recette.ExternalId);
                    if (rid == null)
                    {
                        await DisplayAlert(
                            LocalizationResourceManager.Instance["ErrorTitle"],
                            LocalizationResourceManager.Instance["Recipes_Add_IdNotFound"],
                            LocalizationResourceManager.Instance["Dialog_Ok"]
                        );
                        return;
                    }

                    recetteId = rid.Value;
                }

                // 3) Parser les ingrÔøΩdients depuis l'ÔøΩditeur
                var items = ParseIngredientsEditor(IngredientsEditor.Text);

                // 4) ÔøΩcriture dans recette_ingredients (delete + insert)
                await app.RecetteIngredientsService.ReplaceForRecetteAsync(recetteId, items);

                await DisplayAlert(
                    LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_Saved"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );

                await Navigation.PopAsync();
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex.ToString());
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    ex.Message,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        // Transforme le texte du multi-line editor en liste (nom, quantite, unite)
        private static List<(string nom, string? quantite, string? unite)> ParseIngredientsEditor(string? text)
        {
            text ??= "";

            return text
                .Replace("\r\n", "\n")
                .Replace("\r", "\n")
                .Split('\n', StringSplitOptions.RemoveEmptyEntries)
                .Select(l => l.Trim())
                .Where(l => !string.IsNullOrWhiteSpace(l))
                .Select(ParseIngredientLine)
                .Where(x => !string.IsNullOrWhiteSpace(x.nom))
                .ToList();
        }

        // Supporte:
        // - "Tomate"
        // - "200 g Farine"
        // - "2 pcs Tomate"
        // - "Farine - 200 g"
        private static (string nom, string? quantite, string? unite) ParseIngredientLine(string line)
        {
            // "Nom - Quantite Unite"
            var dashSplit = line.Split(" - ", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
            if (dashSplit.Length >= 2)
            {
                var nomPart = dashSplit[0];
                var qtePart = dashSplit[1];

                var parts = qtePart.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                if (parts.Length >= 2)
                    return (nomPart, parts[0], string.Join(" ", parts.Skip(1)));

                return (nomPart, qtePart, null);
            }

            // "200 g Farine"
            var tokens = line.Split(' ', StringSplitOptions.RemoveEmptyEntries);
            if (tokens.Length >= 3 && char.IsDigit(tokens[0][0]))
            {
                var quantite = tokens[0];
                var unite = tokens[1];
                var nom = string.Join(" ", tokens.Skip(2));
                return (nom, quantite, unite);
            }

            // Sinon : juste le nom
            return (line, null, null);
        }

        private async void OnScanClicked(object sender, EventArgs e)
        {
            try
            {
                // Permission camÔøΩra (Android 6+)
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                // Capture supportÔøΩe ?
                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                var photo = await MediaPicker.Default.CapturePhotoAsync(new MediaPickerOptions
                {
                    Title = LocalizationResourceManager.Instance["Recipes_Add_ScanTitle"]
                });

                if (photo == null)
                    return;

                byte[] bytes;
                using (var stream = await photo.OpenReadAsync())
                using (var ms = new MemoryStream())
                {
                    await stream.CopyToAsync(ms);
                    bytes = ms.ToArray();
                }

                Debug.WriteLine($"Image originale: {bytes.Length / 1024} KB");

                // Compression pour rester sous la limite OCR.Space (souvent 1024 KB)
                bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1600, jpegQuality: 75);
                Debug.WriteLine($"Image compressÔøΩe: {bytes.Length / 1024} KB");

                // Si encore trop gros, on retente plus agressif automatiquement
                if (bytes.Length > 1024 * 1024)
                {
                    bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1200, jpegQuality: 65);
                    Debug.WriteLine($"Image recompressÔøΩe: {bytes.Length / 1024} KB");
                }

                if (bytes.Length > 1024 * 1024)
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                // OCR
                var ocrKey = LoGeCuiShared.Services.ConfigurationHelper.GetOcrApiKey();
                var ocr = new OcrService(ocrKey);

                var fullText = await ocr.ExtractTextFromImageAsync(bytes, photo.FileName);

                if (string.IsNullOrWhiteSpace(fullText))
                {
                    await DisplayAlert(
                        LocalizationResourceManager.Instance["OcrTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NoTextDetected"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]
                    );
                    return;
                }

                fullText = NormalizeOcrText(fullText);

                var (ingredients, instructions) = SplitRecipeText(fullText);

                if (!string.IsNullOrWhiteSpace(instructions))
                    InstructionsEditor.Text = instructions.Trim();

                if (!string.IsNullOrWhiteSpace(ingredients))
                    IngredientsEditor.Text = ingredients.Trim();

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    var title = GuessTitle(fullText);
                    if (!string.IsNullOrWhiteSpace(title))
                        NomEntry.Text = title;
                }

                await DisplayAlert(
                    LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_OcrSuccess"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
            catch (Exception ex)
            {
                var msg = ex.Message ?? LocalizationResourceManager.Instance["UnknownError"];

                if (msg.Contains("File failed validation", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("maximum permissible file size", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("1024kb", StringComparison.OrdinalIgnoreCase))
                {
                    msg = LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"];
                }

                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    msg,
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
            }
        }

        private static string NormalizeOcrText(string s)
        {
            s = s.Replace("\r\n", "\n").Replace("\r", "\n");
            while (s.Contains("\n\n\n")) s = s.Replace("\n\n\n", "\n\n");
            return s.Trim();
        }

        private static (string ingredients, string instructions) SplitRecipeText(string text)
        {
            var lower = text.ToLowerInvariant();

            int idxIng = IndexOfAny(lower, "ingrÔøΩdients", "ingredients");
            int idxPrep = IndexOfAny(lower, "prÔøΩparation", "preparation", "instructions", "rÔøΩalisation", "realisation", "ÔøΩtapes", "etapes");

            if (idxIng >= 0 && idxPrep > idxIng)
            {
                var ingPart = text.Substring(idxIng, idxPrep - idxIng);
                var prepPart = text.Substring(idxPrep);

                ingPart = RemoveHeaderLine(ingPart);
                prepPart = RemoveHeaderLine(prepPart);

                return (CleanupListLike(ingPart), CleanupParagraph(prepPart));
            }

            if (idxPrep >= 0)
            {
                var before = text.Substring(0, idxPrep);
                var after = text.Substring(idxPrep);

                after = RemoveHeaderLine(after);
                return (CleanupListLike(before), CleanupParagraph(after));
            }

            var lines = text.Split('\n').Select(l => l.Trim()).Where(l => l.Length > 0).ToList();

            var ingLines = new List<string>();
            var instrLines = new List<string>();

            bool inInstructions = false;
            foreach (var line in lines)
            {
                if (!inInstructions && LooksLikeStep(line))
                    inInstructions = true;

                if (!inInstructions && LooksLikeIngredientLine(line))
                    ingLines.Add(line);
                else
                    instrLines.Add(line);
            }

            return (string.Join("\n", ingLines), string.Join("\n", instrLines));
        }

        private static int IndexOfAny(string haystack, params string[] needles)
        {
            int best = -1;
            foreach (var n in needles)
            {
                var i = haystack.IndexOf(n, StringComparison.OrdinalIgnoreCase);
                if (i >= 0 && (best < 0 || i < best)) best = i;
            }
            return best;
        }

        private static string RemoveHeaderLine(string block)
        {
            var lines = block.Replace("\r\n", "\n").Split('\n').ToList();
            if (lines.Count == 0) return block;
            lines.RemoveAt(0);
            return string.Join("\n", lines).Trim();
        }

        private static string CleanupListLike(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0)
                .Select(l => l.TrimStart('-', 'ÔøΩ', '*', 'ÔøΩ', 'ÔøΩ', 'ÔøΩ', ' '))
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static string CleanupParagraph(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static bool LooksLikeIngredientLine(string line)
        {
            if (line.StartsWith("-") || line.StartsWith("ÔøΩ") || line.StartsWith("*")) return true;

            var l = line.ToLowerInvariant();
            string[] units = { " g", "kg", " ml", "cl", " l", "cÔøΩs", "cas", "cÔøΩc", "cac", "cuillÔøΩre", "pincÔøΩe", "tranche", "sachet" };
            if (units.Any(u => l.Contains(u))) return true;

            if (char.IsDigit(line.FirstOrDefault())) return true;

            return false;
        }

        private static bool LooksLikeStep(string line)
        {
            var l = line.Trim();
            if (l.StartsWith("1)") || l.StartsWith("1.") ||
                l.StartsWith("ÔøΩtape", StringComparison.OrdinalIgnoreCase) ||
                l.StartsWith("Etape", StringComparison.OrdinalIgnoreCase))
                return true;

            if (l.Length >= 2 && char.IsDigit(l[0]) && (l[1] == ')' || l[1] == '.'))
                return true;

            return false;
        }

        private static string GuessTitle(string text)
        {
            var first = text.Split('\n').Select(l => l.Trim()).FirstOrDefault(l => l.Length > 0) ?? "";
            if (first.Length >= 3 && first.Length <= 50) return first;
            return "";
        }
    }
}

================================================================================
FILE: Pages\ListeCoursesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ListeCoursesPage"
             Title="{tr:Translate Shopping_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:BoolToStrikethroughConverter x:Key="BoolToStrikethroughConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Checkbox Tout s√©lectionner -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Label Grid.Row="0"
               Text="{tr:Translate Shopping_Header}"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10,0,10"/>

        <!-- Buttons -->
        <Grid Grid.Row="1" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Shopping_AddItem}"
                    BackgroundColor="#27AE60"
                    FontAttributes="Bold"
                    Clicked="BtnAjouter_Clicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelection"
                    Text="{tr:Translate Shopping_DeleteSelection}"
                    BackgroundColor="#E67E22"
                    FontAttributes="Bold"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="2"
                               Spacing="10"
                               Padding="4,6"
                               VerticalOptions="Center">
            <CheckBox x:Name="ChkToutSelectionner"
                      CheckedChanged="ChkToutSelectionner_CheckedChanged"/>
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray"/>
        </HorizontalStackLayout>

        <!-- Liste des courses -->
        <CollectionView Grid.Row="3"
                        x:Name="ListeCourses"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Shopping_Empty}"
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="6"
                           Padding="14"
                           BorderColor="#DDDDDD"
                           CornerRadius="12"
                           HasShadow="True"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}">

                        <VerticalStackLayout Spacing="8">

                            <!-- Nom -->
                            <Label Text="{Binding Nom}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextDecorations="{Binding EstAchete, Converter={StaticResource BoolToStrikethroughConverter}}"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                            <!-- Quantit√© -->
                            <Label FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Quantite}"/>
                                        <Span Text=" "/>
                                        <Span Text="{Binding Unite}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Actions -->
                            <HorizontalStackLayout Spacing="20">

                                <!-- Achet√© -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstAchete, Mode=TwoWay}"
                                              CheckedChanged="CheckBox_CheckedChanged"/>
                                    <Label Text="{tr:Translate Shopping_Bought}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                                <!-- S√©lection pour suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}"/>
                                    <Label Text="{tr:Translate Shopping_Delete}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: Pages\ListeCoursesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiMobile.Models;

namespace LoGeCuiMobile.Pages
{
    public partial class ListeCoursesPage : ContentPage
    {
        private readonly ObservableCollection<ArticleCourseUi> _articles = new();
        private readonly SupabaseService _supabase;

        // Emp√™che la checkbox "Tout s√©lectionner" de d√©clencher une s√©lection de masse
        // quand on la met √† jour depuis le code.
        private bool _suppressSelectAllEvent;

        public ListeCoursesPage()
        {
            InitializeComponent();

            _supabase = ((App)Application.Current).Supabase
                ?? throw new InvalidOperationException("Supabase non initialis√©.");

            // IMPORTANT : ne pas re-s'abonner ici si ton XAML a d√©j√† Clicked="BtnSupprimerSelection_Clicked"
            // BtnSupprimerSelection.Clicked += BtnSupprimerSelection_Clicked;  <-- SUPPRIM√â

            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private async void ChargerDonnees()
        {
            try
            {
                // 1Ô∏è‚É£ Charger depuis le cache local
                var local = await App.LocalDb.GetArticlesAsync();
                _articles.Clear();
                foreach (var a in local)
                    _articles.Add(new ArticleCourseUi(a.ToModel()));

                // 2Ô∏è‚É£ Si internet ‚Üí rafra√Æchir depuis Supabase
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var remote = await _supabase.GetArticlesAsync();

                    _articles.Clear();
                    foreach (var a in remote)
                        _articles.Add(new ArticleCourseUi(a));

                    // üîÑ Mettre √† jour le cache
                    await App.LocalDb.SaveArticlesAsync(remote);
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Chargement impossible : {ex.Message}", "OK");
            }
        }

        private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
        {
            var selected = _articles.Where(a => a.IsSelectedForDelete).ToList();

            if (selected.Count == 0)
            {
                await DisplayAlert("Information", "Aucun article s√©lectionn√©.", "OK");
                return;
            }

            bool confirm = await DisplayAlert(
                "Confirmation",
                $"Supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Oui",
                "Non");

            if (!confirm)
                return;

            try
            {
                foreach (var articleUi in selected)
                {
                    await _supabase.DeleteArticleAsync(articleUi.Id);
                    _articles.Remove(articleUi);
                }

                RefreshSelectAllCheckBox();

                await DisplayAlert("Succ√®s", $"{selected.Count} article(s) supprim√©(s).", "OK");
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Suppression impossible : {ex.Message}", "OK");
                ChargerDonnees();
            }
        }

        private async void CheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            // Checkbox "Achet√©"
            if (sender is not CheckBox checkbox) return;
            if (checkbox.BindingContext is not ArticleCourseUi articleUi) return;

            var article = articleUi.Model;

            checkbox.IsEnabled = false;
            var oldValue = !e.Value;

            try
            {
                await _supabase.UpdateArticleAsync(article.Id, article);
            }
            catch (Exception ex)
            {
                article.EstAchete = oldValue;
                checkbox.IsChecked = oldValue;

                await DisplayAlert("Erreur", $"Synchronisation √©chou√©e : {ex.Message}", "OK");
            }
            finally
            {
                checkbox.IsEnabled = true;
            }
        }

        // Checkbox "Tout s√©lectionner" (pour suppression)
        private void ChkToutSelectionner_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (_suppressSelectAllEvent) return;

            foreach (var a in _articles)
                a.IsSelectedForDelete = e.Value;

            // Optionnel : si tu veux d√©sactiver le bouton supprimer quand rien n'est coch√©,
            // il faudra √©couter les changements de IsSelectedForDelete (INotifyPropertyChanged).
            // Ici on se contente de garder la checkbox coh√©rente.
        }

        private void RefreshSelectAllCheckBox()
        {
            if (ChkToutSelectionner == null) return;

            _suppressSelectAllEvent = true;
            try
            {
                if (_articles.Count == 0)
                {
                    ChkToutSelectionner.IsEnabled = false;
                    ChkToutSelectionner.IsChecked = false;
                    return;
                }

                ChkToutSelectionner.IsEnabled = true;

                // MAUI CheckBox n'a pas de tri-state :
                // on met "checked" seulement si TOUT est s√©lectionn√©.
                bool allSelected = _articles.All(a => a.IsSelectedForDelete);
                ChkToutSelectionner.IsChecked = allSelected;
            }
            finally
            {
                _suppressSelectAllEvent = false;
            }
        }

        private async void BtnAjouter_Clicked(object sender, EventArgs e)
        {
            string nom = await DisplayPromptAsync("Ajouter", "Nom de l'article :");
            if (string.IsNullOrWhiteSpace(nom))
                return;

            string quantite = await DisplayPromptAsync("Ajouter", "Quantit√© :");
            if (string.IsNullOrWhiteSpace(quantite))
                return;

            string unite = await DisplayPromptAsync("Ajouter", "Unit√© (g, kg, L, pi√®ces...) :");
            if (string.IsNullOrWhiteSpace(unite))
                return;

            try
            {
                var app = (App)Application.Current;
                if (app.CurrentUserId == null)
                {
                    await DisplayAlert("Erreur", "Vous devez √™tre connect√©.", "OK");
                    return;
                }

                var article = new ArticleCourse
                {
                    UserId = app.CurrentUserId.Value,
                    Nom = nom,
                    Quantite = quantite,
                    Unite = unite,
                    EstAchete = false
                };

                var added = await _supabase.AddArticleAsync(article);
                if (added != null)
                {
                    _articles.Add(new ArticleCourseUi(added));

                    // Nouveau item => on met √† jour la checkbox "Tout s√©lectionner"
                    RefreshSelectAllCheckBox();

                    await DisplayAlert("Succ√®s", $"'{added.Nom}' ajout√© !", "OK");
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Impossible d'ajouter : {ex.Message}", "OK");
            }
        }
    }
}

================================================================================
FILE: Pages\MenuAleatoirePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.MenuAleatoirePage"
             Title="{tr:Translate RandomMenu_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Button
                Text="{tr:Translate RandomMenu_GenerateButton}"
                Clicked="OnMenuAleatoireClicked" />

            <Label
                x:Name="ResultLabel"
                Text="{tr:Translate RandomMenu_DefaultText}"
                FontSize="18"
                HorizontalTextAlignment="Center" />

            <!-- Bouton visible uniquement apr√®s g√©n√©ration si ingr√©dients manquants -->
            <Button x:Name="SendMissingButton"
                    Text="{tr:Translate RandomMenu_SendMissingToShopping}"
                    Clicked="OnSendMissingClicked"
                    HorizontalOptions="FillAndExpand"
                    IsVisible="False"
                    IsEnabled="False" />

            <Button
                Text="{tr:Translate RandomMenu_OpenShopping}"
                Clicked="OnOpenListeCoursesClicked"
                HorizontalOptions="FillAndExpand" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: Pages\MenuAleatoirePage.xaml.cs
================================================================================

Ôªøusing CommunityToolkit.Maui.Views;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace LoGeCuiMobile.Pages;

public partial class MenuAleatoirePage : ContentPage
{
    private static readonly Random _random = new();
    public record MenuOptionsResult(bool Entree, bool Plat, bool Dessert);


    private List<string> _lastMissing = new();
    private Guid? _lastUserId;
    private bool _lastIngredientsKnown = false;

    public MenuAleatoirePage()
    {
        InitializeComponent();

        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
    }

    // ------------------ UTIL ------------------

    private static string Norm(string s)
    {
        if (string.IsNullOrWhiteSpace(s))
            return "";

        var normalized = s.Trim().ToLowerInvariant().Normalize(NormalizationForm.FormD);
        var sb = new StringBuilder();

        foreach (var c in normalized)
            if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
                sb.Append(c);

        return sb.ToString();
    }

    private sealed class RecetteIngredientRow
    {
        public string? ingredient_nom { get; set; }
    }

    private async Task<List<string>> GetRecetteIngredientsAsync(App app, Guid recetteId)
    {
        if (app.RestClient == null)
            return new List<string>();

        // recette_ingredients(recette_id, ingredient_nom, quantite, unite)
        var q = $"recette_ingredients?select=ingredient_nom&recette_id=eq.{recetteId}";

        var rows = await app.RestClient.GetAsync<List<RecetteIngredientRow>>(q)
                   ?? new List<RecetteIngredientRow>();

        return rows
            .Select(r => r.ingredient_nom ?? "")
            .Select(s => s.Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private async Task<List<string>> GetUserIngredientsAsync(App app, Guid userId)
    {
        if (app.IngredientsService == null)
            return new List<string>();

        var rows = await app.IngredientsService.GetIngredientsAsync(userId)
                   ?? new List<Ingredient>();

        return rows
            .Where(i => i.EstDisponible)
            .Select(i => (i.Nom ?? "").Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private static Recette? PickRandom(List<Recette> list)
    {
        if (list == null || list.Count == 0) return null;
        return list[_random.Next(list.Count)];
    }

    // ------------------ EVENTS ------------------

    private async void OnMenuAleatoireClicked(object sender, EventArgs e)
    {
        try
        {
            // Choix initial : on d√©marre tout coch√©
            bool wantEntree = true;
            bool wantPlat = true;
            bool wantDessert = true;

            while (true)
            {
                string entreeTxt = wantEntree ? "‚úÖ Entr√©e" : "‚¨ú Entr√©e";
                string platTxt = wantPlat ? "‚úÖ Plat" : "‚¨ú Plat";
                string dessertTxt = wantDessert ? "‚úÖ Dessert" : "‚¨ú Dessert";

                var choice = await DisplayActionSheet(
                    "Choisis les cat√©gories",
                    "Annuler",
                    "G√©n√©rer",
                    entreeTxt,
                    platTxt,
                    dessertTxt
                );

                if (choice == "Annuler")
                    return;

                if (choice == "G√©n√©rer")
                {
                    if (!wantEntree && !wantPlat && !wantDessert)
                    {
                        await DisplayAlert("Info", "Coche au moins une cat√©gorie.", "OK");
                        continue;
                    }

                    var opts = new MenuOptionsResult(wantEntree, wantPlat, wantDessert);
                    await RunMenuAleatoireAsync(opts);
                    return;
                }

                if (choice == entreeTxt) wantEntree = !wantEntree;
                else if (choice == platTxt) wantPlat = !wantPlat;
                else if (choice == dessertTxt) wantDessert = !wantDessert;
            }
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }



    private async void OnOpenListeCoursesClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;
            if (app?.ListeCoursesSupabaseService == null)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["ServiceUnavailable"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            await Shell.Current.GoToAsync(nameof(ListeCoursesPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private async void OnSendMissingClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;

            if (app?.ListeCoursesSupabaseService == null || app.CurrentUserId == null)
                return;

            if (!_lastIngredientsKnown || _lastMissing.Count == 0)
                return;

            bool confirm = await DisplayAlert(
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmTitle"],
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmBody"] + "\n- " + string.Join("\n- ", _lastMissing),
                LocalizationResourceManager.Instance["Dialog_Yes"],
                LocalizationResourceManager.Instance["Dialog_No"]
            );

            if (!confirm)
                return;

            await app.ListeCoursesSupabaseService.AddMissingAsync(
                app.CurrentUserId.Value,
                _lastMissing);

            SendMissingButton.IsEnabled = false;
            SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SentButton"];
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // ------------------ LOGIQUE ------------------

    private async Task RunMenuAleatoireAsync(MenuOptionsResult opts)
    {
        var app = Application.Current as App;
        if (app == null)
            return;

        // Reset UI
        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
        SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SendMissingToShopping"];
        _lastMissing = new List<string>();
        _lastIngredientsKnown = false;
        _lastUserId = app.CurrentUserId;

        if (app.CurrentUserId == null ||
            app.RestClient == null ||
            app.RecipesService == null ||
            app.IngredientsService == null ||
            app.ListeCoursesSupabaseService == null)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["LoginRequired"];
            return;
        }

        var userId = app.CurrentUserId.Value;
        ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_Generating"];

        // 1) Recettes utilisateur
        // (tu utilises GetMyRecettesAsync dans ton code : je le garde)
        var recettes = await app.RecipesService.GetMyRecettesAsync();

        if (recettes == null || recettes.Count == 0)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_NoRecipes"];
            return;
        }

        // 2) Listes par type (si l'option est coch√©e)
        var entrees = opts.Entree ? recettes.Where(r => r.Type == TypePlat.Entree).ToList() : new List<Recette>();
        var plats = opts.Plat ? recettes.Where(r => r.Type == TypePlat.Plat).ToList() : new List<Recette>();
        var desserts = opts.Dessert ? recettes.Where(r => r.Type == TypePlat.Dessert).ToList() : new List<Recette>();

        // 3) Tirage (uniquement si demand√©)
        var entree = opts.Entree ? PickRandom(entrees) : null;
        var plat = opts.Plat ? PickRandom(plats) : null;
        var dessert = opts.Dessert ? PickRandom(desserts) : null;

        // Si une cat√©gorie coch√©e n'a aucune recette
        if ((opts.Entree && entree == null) || (opts.Plat && plat == null) || (opts.Dessert && dessert == null))
        {
            var sbErr = new StringBuilder();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotGenerate"]);
            sbErr.AppendLine();

            if (opts.Entree && entree == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Entr√©e");
            if (opts.Plat && plat == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Plat");
            if (opts.Dessert && dessert == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Dessert");

            sbErr.AppendLine();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CheckCategories"]);

            ResultLabel.Text = sbErr.ToString();
            return;
        }

        // 4) Ingr√©dients utilisateur disponibles
        var userIngredients = await GetUserIngredientsAsync(app, userId);
        var userSet = userIngredients
            .Select(Norm)
            .Where(x => !string.IsNullOrWhiteSpace(x))
            .ToHashSet();

        // 5) Analyse d'une recette
        async Task<(List<string> ingredients, List<string> missing, bool hasData)> AnalyzeAsync(Recette r)
        {
            var ingredients = await GetRecetteIngredientsAsync(app, r.Id);
            var distinct = ingredients
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (distinct.Count == 0)
                return (distinct, new List<string>(), false);

            var missing = distinct
                .Where(i => !userSet.Contains(Norm(i)))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            return (distinct, missing, true);
        }

        // 6) Analyse seulement des recettes r√©ellement tir√©es
        var chosen = new List<Recette>();
        if (entree != null) chosen.Add(entree);
        if (plat != null) chosen.Add(plat);
        if (dessert != null) chosen.Add(dessert);

        var analyses = new Dictionary<Guid, (List<string> ingredients, List<string> missing, bool hasData)>();
        foreach (var r in chosen)
            analyses[r.Id] = await AnalyzeAsync(r);

        // 7) Agr√©gation manquants (uniquement si on a des donn√©es pour toutes les recettes choisies)
        var allHaveData = chosen.All(r => analyses[r.Id].hasData);

        if (allHaveData)
        {
            _lastMissing = chosen
                .SelectMany(r => analyses[r.Id].missing)
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            _lastIngredientsKnown = true;
        }
        else
        {
            _lastMissing = new List<string>();
            _lastIngredientsKnown = false;
        }

        // 8) UI texte
        var sb = new StringBuilder();

        sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GeneratedHeader"]);

        if (entree != null) sb.AppendLine($"- {entree.TypeTexte} : {entree.Nom}");
        if (plat != null) sb.AppendLine($"- {plat.TypeTexte} : {plat.Nom}");
        if (dessert != null) sb.AppendLine($"- {dessert.TypeTexte} : {dessert.Nom}");
        sb.AppendLine();

        void AppendRecetteBlock(Recette r)
        {
            var a = analyses[r.Id];

            sb.AppendLine($"{r.TypeTexte} ‚Äî {r.Nom}");

            if (!a.hasData)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_NoIngredientsForRecipe"]);
                sb.AppendLine();
                return;
            }

            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_IngredientsHeader"]);
            foreach (var i in a.ingredients)
                sb.AppendLine("- " + i);

            if (a.missing.Count == 0)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingNone"]);
            }
            else
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingHeader"]);
                foreach (var m in a.missing)
                    sb.AppendLine("- " + m);
            }

            sb.AppendLine();
        }

        foreach (var r in chosen)
            AppendRecetteBlock(r);

        // 9) Bouton ‚Äúenvoyer manquants‚Äù
        if (!allHaveData)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotComputeMissing"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else if (_lastMissing.Count == 0)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_AllAvailable"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GlobalMissingHeader"]);
            foreach (var m in _lastMissing)
                sb.AppendLine("- " + m);

            SendMissingButton.IsVisible = true;
            SendMissingButton.IsEnabled = true;
        }

        ResultLabel.Text = sb.ToString();
    }
}

================================================================================
FILE: Pages\MesIngredientsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
    x:Class="LoGeCuiMobile.Pages.MesIngredientsPage"
    Title="{tr:Translate Ingredients_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:QuantityFormatConverter x:Key="QuantityFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="16" RowDefinitions="Auto,Auto,*" RowSpacing="12">

        <!-- Boutons -->
        <Grid Grid.Row="0" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Ingredients_AddButton}"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    Clicked="OnAddIngredientClicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelectionIngredients"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="OnDeleteSelectedIngredientsClicked" />
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Padding="4,0">
            <CheckBox x:Name="ChkToutSelectionnerIngredients"
                      CheckedChanged="ChkToutSelectionnerIngredients_CheckedChanged" />
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray" />
        </HorizontalStackLayout>

        <!-- Liste -->
        <CollectionView Grid.Row="2"
                        x:Name="IngredientsCollection"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="Aucun ingr√©dient."
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12"
                           Margin="0,4"
                           BorderColor="#ddd"
                           CornerRadius="10">

                        <Grid ColumnDefinitions="*,Auto">

                            <VerticalStackLayout Spacing="6">

                                <Label Text="{Binding Nom}"
                                       FontSize="18"
                                       FontAttributes="Bold" />

                                <Label FontSize="14" TextColor="Gray">
                                    <Label.Text>
                                        <MultiBinding Converter="{StaticResource QuantityFormatConverter}">
                                            <Binding Path="Quantite"/>
                                            <Binding Path="Unite"/>
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>

                                <!-- Disponible -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstDisponible}"
                                                CheckedChanged="OnDisponibleChanged" />
                                    <Label Text="{tr:Translate Ingredients_Available}"
                                           VerticalTextAlignment="Center"/>
                                </HorizontalStackLayout>

                                <!-- S√©lection suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}" />
                                    <Label Text="Supprimer"
                                           VerticalTextAlignment="Center"
                                           TextColor="Gray"/>
                                </HorizontalStackLayout>

                            </VerticalStackLayout>

                            <!-- Supprimer item -->
                            <Button Grid.Column="1"
                                    Text="üóë"
                                    BackgroundColor="#e74c3c"
                                    Clicked="OnDeleteIngredientClicked" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: Pages\MesIngredientsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Models;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Networking;


namespace LoGeCuiMobile.Pages;

public partial class MesIngredientsPage : ContentPage
{
    private readonly ObservableCollection<IngredientUi> _ingredients = new();

    private bool _isLoading;
    private bool _suppressSelectAllEvent;

    public MesIngredientsPage()
    {
        InitializeComponent();
        IngredientsCollection.ItemsSource = _ingredients;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();
        await LoadIngredientsAsync();
    }

    private async Task LoadIngredientsAsync()
    {
        if (_isLoading) return;

        try
        {
            _isLoading = true;

            // 0) Toujours tenter d'afficher le cache local en premier (offline-friendly)
            var local = await App.LocalDb.GetIngredientsAsync();
            _ingredients.Clear();
            foreach (var li in local)
                _ingredients.Add(new IngredientUi(li.ToModel()));

            RefreshSelectAllCheckBox();

            // 1) Si pas connect√© (session) -> on s'arr√™te apr√®s le cache
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            // 2) Si pas internet -> on s'arr√™te apr√®s le cache
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return;

            var userId = app.CurrentUserId.Value;

            // 3) Refresh depuis Supabase
            var remote = await app.IngredientsService.GetIngredientsAsync(userId);

            // 4) Mettre √† jour l'UI avec remote
            _ingredients.Clear();
            foreach (var ing in remote)
                _ingredients.Add(new IngredientUi(ing));

            // 5) Sauver remote dans SQLite
            await App.LocalDb.SaveIngredientsAsync(remote);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        finally
        {
            _isLoading = false;
        }
    }


    private async void OnAddIngredientClicked(object sender, EventArgs e)
    {
        try
        {
            await Shell.Current.GoToAsync(nameof(AjouterIngredientPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // Suppression d'un seul ingr√©dient via l'ic√¥ne üóë
    private async void OnDeleteIngredientClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        if (sender is not Button btn || btn.BindingContext is not IngredientUi ingredientUi)
            return;

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"{LocalizationResourceManager.Instance["Dialog_DeleteConfirm"]}\n{ingredientUi.Nom}",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            _ingredients.Remove(ingredientUi);

            if (ingredientUi.Id != Guid.Empty)
                await app.IngredientsService.DeleteIngredientAsync(ingredientUi.Id);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Checkbox "Tout s√©lectionner" (s√©lection suppression)
    private void ChkToutSelectionnerIngredients_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_suppressSelectAllEvent) return;

        foreach (var ing in _ingredients)
            ing.IsSelectedForDelete = e.Value;
    }

    private void RefreshSelectAllCheckBox()
    {
        if (ChkToutSelectionnerIngredients == null) return;

        _suppressSelectAllEvent = true;
        try
        {
            if (_ingredients.Count == 0)
            {
                ChkToutSelectionnerIngredients.IsEnabled = false;
                ChkToutSelectionnerIngredients.IsChecked = false;
                return;
            }

            ChkToutSelectionnerIngredients.IsEnabled = true;
            ChkToutSelectionnerIngredients.IsChecked = _ingredients.All(i => i.IsSelectedForDelete);
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    // Supprimer s√©lection
    private async void OnDeleteSelectedIngredientsClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        var selected = _ingredients.Where(i => i.IsSelectedForDelete).ToList();

        if (selected.Count == 0)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                "Aucun ingr√©dient s√©lectionn√©.",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"Supprimer {selected.Count} ingr√©dient(s) s√©lectionn√©(s) ?",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            foreach (var ingUi in selected)
            {
                if (ingUi.Id != Guid.Empty)
                    await app.IngredientsService.DeleteIngredientAsync(ingUi.Id);

                _ingredients.Remove(ingUi);
            }

            RefreshSelectAllCheckBox();

            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                $"{selected.Count} ingr√©dient(s) supprim√©(s).",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Mise √† jour "Disponible" -> synchro Supabase (si tu as une m√©thode UpdateIngredientAsync)
    private async void OnDisponibleChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_isLoading) return;

        if (sender is not CheckBox cb || cb.BindingContext is not IngredientUi ingUi)
            return;

        try
        {
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null)
                return;

            // Ici il faut une m√©thode d'update dans IngredientsService.
            // Si tu l'as d√©j√† : await app.IngredientsService.UpdateIngredientAsync(ingUi.Model.Id, ingUi.Model);
            // Sinon : on ne fait rien (l'UI reste locale). Dis-moi et je te donne l'impl√©mentation c√¥t√© service.
        }
        catch
        {
            // Optionnel : rollback si update √©choue
        }
    }
}

================================================================================
FILE: Pages\MesRecettesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="LoGeCuiMobile.Pages.MesRecettesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:vm="clr-namespace:LoGeCuiMobile.ViewModels"
    Title="{tr:Translate Recipes_Title}">

    <Grid Padding="12" RowDefinitions="Auto,Auto,*" RowSpacing="10">

        <!-- ====== FILTRES + ACTIONS HAUT ====== -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">

            <Picker Title="{tr:Translate Recipes_Category}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategorie}" />

            <HorizontalStackLayout Spacing="10">
                <Button Text="{tr:Translate Recipes_Refresh}"
                        Command="{Binding RefreshCommand}"
                        HorizontalOptions="StartAndExpand" />

                <Button Text="{tr:Translate Recipes_Add}"
                        Clicked="OnAjouterRecetteClicked"
                        HorizontalOptions="EndAndExpand" />
            </HorizontalStackLayout>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}" />

        </VerticalStackLayout>

        <!-- ====== LIGNE S√âLECTION MULTIPLE ====== -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" VerticalOptions="Center">

            <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">
                <CheckBox x:Name="ChkToutSelectionnerRecettes"
                          CheckedChanged="ChkToutSelectionnerRecettes_CheckedChanged"/>
                <Label Text="Tout s√©lectionner"
                       VerticalTextAlignment="Center"
                       TextColor="Gray"/>
            </HorizontalStackLayout>

            <Label Grid.Column="1"
                   x:Name="SelectionInfoLabel"
                   Text=""
                   TextColor="Gray"
                   VerticalTextAlignment="Center"/>

            <Button Grid.Column="2"
                    x:Name="BtnSupprimerSelection"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- ====== LISTE DES RECETTES ====== -->
        <CollectionView Grid.Row="2"
                        x:Name="RecettesCollection"
                        ItemsSource="{Binding Recettes}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Recipes_Empty}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       Margin="0,30,0,0" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10"
                           Margin="0,6"
                           HasShadow="False">

                        <!-- üî¥üü¢ Couleur bordure selon disponibilit√© -->
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Unknown}">
                                <Setter Property="BorderColor" Value="#B0B0B0"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.AllAvailable}">
                                <Setter Property="BorderColor" Value="#27AE60"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Missing}">
                                <Setter Property="BorderColor" Value="#E74C3C"/>
                            </DataTrigger>
                        </Frame.Triggers>

                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">

                            <!-- Checkbox suppression multiple -->
                            <CheckBox Grid.Column="0"
                                      Grid.RowSpan="2"
                                      IsChecked="{Binding IsSelectedForDelete}"
                                      CheckedChanged="RecetteDeleteCheckBox_CheckedChanged"
                                      VerticalOptions="Center" />

                            <!-- Zone infos recette (tap = d√©tails) -->
                            <Grid Grid.Column="1" Grid.RowSpan="2">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRecetteTapped"
                                                          CommandParameter="{Binding Model}" />
                                </Grid.GestureRecognizers>

                                <VerticalStackLayout Spacing="4">

                                    <Label Text="{Binding Nom}"
                                           FontSize="18"
                                           FontAttributes="Bold" />

                                    <Label Text="{Binding TypeTexte}" />

                                    <Label Text="{Binding TempsPreparation, StringFormat='{tr:Translate Recipes_TimeFormat}'}" />

                                    <Label Text="{Binding DifficulteTexte}" />

                                    <Label Text="{Binding AvailabilityLabel}"
                                           FontSize="12"
                                           TextColor="Gray"/>

                                </VerticalStackLayout>
                            </Grid>

                            <!-- Boutons actions -->
                            <HorizontalStackLayout Grid.Column="2" Grid.RowSpan="2"
                                                   Spacing="8"
                                                   VerticalOptions="Center">

                                <!-- Ajouter ingr√©dients manquants -->
                                <Button Text="üõí"
                                        BackgroundColor="#3498DB"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnAjouterManquants_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <!-- Supprimer une recette -->
                                <Button Text="üóë"
                                        BackgroundColor="#e74c3c"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnSupprimerRecette_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <!-- Modifier recette -->
                                <Button Text="‚úèÔ∏è"
                                        BackgroundColor="#F1C40F"
                                        TextColor="Black"
                                        Padding="8"
                                        Clicked="BtnModifierRecette_Clicked"
                                        CommandParameter="{Binding Model}"/>

                            </HorizontalStackLayout>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>
</ContentPage>

================================================================================
FILE: Pages\MesRecettesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.ViewModels;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Pages;

public partial class MesRecettesPage : ContentPage
{
    private MesRecettesViewModel? _vm;
    private bool _suppressSelectAllEvent;

    public MesRecettesPage()
    {
        InitializeComponent();

        var app = (App)Application.Current;

        if (app.RecipesService == null)
        {
            MainThread.BeginInvokeOnMainThread(async () =>
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Recipes_ServiceNull"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                ));

            return;
        }

        _vm = new MesRecettesViewModel(app.RecipesService);
        BindingContext = _vm;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        if (_vm == null)
            return;

        await _vm.LoadAsync();

        // Recalcule vert/rouge si ton VM le fait (et si tu l‚Äôas impl√©ment√©)
        // Sinon tu peux commenter la ligne.
        await _vm.RefreshAvailabilityAsync();

        RefreshSelectionUi();
    }

    private async void OnAjouterRecetteClicked(object sender, EventArgs e)
    {
        await Navigation.PushAsync(new AjouterRecettePage());
    }

    // Tap recette -> d√©tails
    private async void OnRecetteTapped(object sender, TappedEventArgs e)
    {
        // Ici on accepte RecetteUi OU Recette
        Recette? recette = e.Parameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        var app = (App)Application.Current;

        if (app.RecetteIngredientsService == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Recipes_IngredientsServiceNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var items = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

        var ingredientsText = (items.Count == 0)
            ? LocalizationResourceManager.Instance["Recipes_NoIngredients"]
            : string.Join("\n", items.Select(x =>
                string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                    ? $"‚Ä¢ {x.nom}"
                    : $"‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
            ));

        var details = string.Format(
            LocalizationResourceManager.Instance["Recipes_DetailsFormat"],
            recette.CategorieDb,
            recette.TempsPreparation,
            ingredientsText,
            recette.Instructions ?? ""
        );

        await DisplayAlert(recette.Nom, details, LocalizationResourceManager.Instance["Dialog_Ok"]);
    }

    // ----------- S√©lection / suppression -----------

    private void ChkToutSelectionnerRecettes_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_vm == null) return;
        if (_suppressSelectAllEvent) return;

        foreach (var r in _vm.Recettes)
            r.IsSelectedForDelete = e.Value;

        RefreshSelectionUi();
    }

    private void RecetteDeleteCheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        RefreshSelectionUi();
    }

    private void RefreshSelectionUi()
    {
        if (_vm == null) return;

        // ‚ö†Ô∏è si ton XAML n‚Äôa pas ces x:Name, √ßa crash => je prot√®ge
        var selectedCount = _vm.Recettes.Count(x => x.IsSelectedForDelete);

        if (SelectionInfoLabel != null)
            SelectionInfoLabel.Text = selectedCount == 0 ? "" : $"{selectedCount} s√©lectionn√©(s)";

        _suppressSelectAllEvent = true;
        try
        {
            if (ChkToutSelectionnerRecettes != null)
            {
                if (_vm.Recettes.Count == 0)
                {
                    ChkToutSelectionnerRecettes.IsEnabled = false;
                    ChkToutSelectionnerRecettes.IsChecked = false;
                }
                else
                {
                    ChkToutSelectionnerRecettes.IsEnabled = true;
                    ChkToutSelectionnerRecettes.IsChecked = _vm.Recettes.All(x => x.IsSelectedForDelete);
                }
            }
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        var selected = _vm.Recettes.Where(r => r.IsSelectedForDelete).ToList();
        if (selected.Count == 0)
        {
            await DisplayAlert("Info", "Aucune recette s√©lectionn√©e.", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer {selected.Count} recette(s) s√©lectionn√©e(s) ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteSelectedAsync(selected);

        RefreshSelectionUi();
    }

    private async void BtnSupprimerRecette_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        if (sender is not Button btn)
            return;

        // Accepte RecetteUi OU Recette (pratique si tu changes le XAML)
        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null)
            return;

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer '{recetteUi.Nom}' ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteOneAsync(recetteUi);
        RefreshSelectionUi();
    }

    // ----------- Modifier -----------

    private async void BtnModifierRecette_Clicked(object sender, EventArgs e)
    {
        if (sender is not Button btn)
            return;

        Recette? recette = btn.CommandParameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        await Navigation.PushAsync(new AjouterRecettePage(recette));
    }

    // ----------- Ajouter manquants √† la liste de courses -----------

    private async void BtnAjouterManquants_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        var missing = await _vm.GetMissingIngredientsForRecipeAsync(recetteUi.Model);
        if (missing == null)
        {
            await DisplayAlert("Info", "Impossible de calculer les ingr√©dients (offline ou donn√©es manquantes).", "OK");
            return;
        }

        if (missing.Count == 0)
        {
            await DisplayAlert("Info", "Tu as d√©j√† tous les ingr√©dients pour cette recette ‚úÖ", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Ajouter √† la liste",
            "Ajouter ces ingr√©dients manquants ?\n- " + string.Join("\n- ", missing),
            "Oui",
            "Non");

        if (!confirm) return;

        var ok = await _vm.SendMissingToShoppingAsync(missing);

        if (ok)
            await DisplayAlert("Succ√®s", $"{missing.Count} ingr√©dient(s) ajout√©(s) √† la liste de courses.", "OK");
        else
            await DisplayAlert("Erreur", "Impossible d‚Äôajouter √† la liste de courses.", "OK");
    }
}

================================================================================
FILE: Pages\ResetPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ResetPasswordPage"
             Title="{tr:Translate Reset_Title}">

    <VerticalStackLayout Padding="24" Spacing="12">

        <Label Text="{tr:Translate Reset_Header}"
               FontSize="20"
               FontAttributes="Bold" />

        <Entry x:Name="Pwd1"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_NewPassword}" />

        <Entry x:Name="Pwd2"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_ConfirmPassword}" />

        <Button Text="{tr:Translate Reset_Submit}"
                Clicked="OnSubmit" />

        <Label x:Name="Msg" />

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: Pages\ResetPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages;

public partial class ResetPasswordPage : ContentPage
{
    private readonly string _accessToken;
    private readonly SupabaseService _supabase;

    public ResetPasswordPage(string accessToken)
    {
        InitializeComponent();
        _accessToken = accessToken;

        string url = ConfigurationHelper.GetSupabaseUrl();
        string key = ConfigurationHelper.GetSupabaseKey();
        _supabase = new SupabaseService(url, key);
    }

    private async void OnSubmit(object sender, EventArgs e)
    {
        var p1 = Pwd1.Text ?? "";
        var p2 = Pwd2.Text ?? "";

        if (string.IsNullOrWhiteSpace(p1) || p1.Length < 6)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMinLength"];
            Msg.TextColor = Colors.Red;
            return;
        }

        if (p1 != p2)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMismatch"];
            Msg.TextColor = Colors.Red;
            return;
        }

        Msg.Text = LocalizationResourceManager.Instance["Reset_Updating"];
        Msg.TextColor = Colors.Blue;

        var (success, error) = await _supabase.UpdatePasswordAsync(_accessToken, p1);

        if (success)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Reset_DoneTitle"],
                LocalizationResourceManager.Instance["Reset_DoneBody"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await Navigation.PopToRootAsync();
        }
        else
        {
            Msg.Text = string.IsNullOrWhiteSpace(error)
                ? LocalizationResourceManager.Instance["Reset_Failed"]
                : error;

            Msg.TextColor = Colors.Red;
        }
    }
}

================================================================================
FILE: Pages\SettingsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.SettingsPage"
             Title="{tr:Translate Settings_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <Label Text="{tr:Translate Settings_Account}"
                   FontSize="18"
                   FontAttributes="Bold" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">

                    <Button Text="{tr:Translate Settings_Logout}"
                            BackgroundColor="#34495E"
                            FontAttributes="Bold"
                            Clicked="OnLogoutClicked" />

                    <Label Text="{tr:Translate Settings_DangerZone}"
                           FontSize="14"
                           TextColor="Gray"
                           Margin="0,6,0,0" />

                    <Button Text="{tr:Translate Settings_Unsubscribe}"
                            BackgroundColor="IndianRed"
                            FontAttributes="Bold"
                            Clicked="OnDesinscriptionClicked" />

                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: Pages\SettingsPage.xaml.cs
================================================================================

Ôªøusing System;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages;

public partial class SettingsPage : ContentPage
{
    public SettingsPage()
    {
        InitializeComponent();
    }

    private async void OnDesinscriptionClicked(object sender, EventArgs e)
    {
        bool confirm = await DisplayAlert(
            LocalizationResourceManager.Instance["Settings_DeleteConfirmTitle"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmBody"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmYes"],
            LocalizationResourceManager.Instance["Dialog_Cancel"]);

        if (!confirm) return;

        var app = (App)Application.Current;

        if (app.Supabase == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Settings_SupabaseNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        // 1) Lire la session stock√©e
        var token = await SecureStorage.GetAsync("sb_access_token");
        var userId = await SecureStorage.GetAsync("sb_user_id");

        if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["SessionTitle"],
                LocalizationResourceManager.Instance["SessionExpired"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        // 2) R√©injecter la session AVANT delete
        app.Supabase.SetSession(token, userId);

        // 3) Appel Edge Function
        var (ok, err) = await app.Supabase.DeleteAccountAsync();

        if (!ok)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                string.Format(LocalizationResourceManager.Instance["Settings_DeleteFailed"], err),
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            if (!string.IsNullOrWhiteSpace(err) &&
                err.Contains("Invalid JWT", StringComparison.OrdinalIgnoreCase))
            {
                app.ShowLogin();
            }

            return;
        }

        // Nettoyage local
        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        await DisplayAlert(
            LocalizationResourceManager.Instance["Dialog_Ok"],
            LocalizationResourceManager.Instance["Settings_DeleteSuccess"],
            LocalizationResourceManager.Instance["Dialog_Ok"]);

        app.ShowLogin();
    }

    private void OnLogoutClicked(object sender, EventArgs e)
    {
        var app = (App)Application.Current;

        app.Supabase?.ClearSession();

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        app.ShowLogin();
    }
}

================================================================================
FILE: Platforms\Android\AndroidManifest.xml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
	<application android:allowBackup="true" android:icon="@mipmap/postriticone" android:supportsRtl="true"></application>
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.CAMERA" />
	<queries>
		<intent>
			<action android:name="android.intent.action.VIEW" />
			<data android:scheme="logecui" />
		</intent>
	</queries>
</manifest>

================================================================================
FILE: Platforms\Android\MainActivity.cs
================================================================================

Ôªøusing Android.App;
using Android.Content;
using Android.Content.PM;
using Android.OS;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile
{
    [Activity(
        Theme = "@style/Maui.SplashTheme",
        MainLauncher = true,
        LaunchMode = LaunchMode.SingleTop,
        ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | ConfigChanges.SmallestScreenSize | ConfigChanges.Density)]

    // Configuration du Deep Link pour la confirmation email
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "confirm",
        AutoVerify = true)]

    // Deep Link - reset password
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "reset-password")]

    public class MainActivity : MauiAppCompatActivity
    {
        protected override void OnCreate(Bundle? savedInstanceState)
        {
            base.OnCreate(savedInstanceState);

            // G√©rer le deep link si l'app est lanc√©e via un lien
            HandleIntent(Intent);
        }

        protected override void OnNewIntent(Intent? intent)
        {
            base.OnNewIntent(intent);

            if (intent != null)
            {
                Intent = intent;
                HandleIntent(intent);
            }
        }

        private void HandleIntent(Intent? intent)
        {
            var data = intent?.DataString;
            if (string.IsNullOrEmpty(data))
                return;

            var uri = new Uri(data);

            MainThread.BeginInvokeOnMainThread(async () =>
            {
                if (Microsoft.Maui.Controls.Application.Current is App app)
                    await app.HandleDeepLinkAsync(uri);
            });
        }
    }
}

================================================================================
FILE: Platforms\Android\MainApplication.cs
================================================================================

Ôªøusing Android.App;
using Android.Runtime;

namespace LoGeCuiMobile
{
    [Application]
    public class MainApplication : MauiApplication
    {
        public MainApplication(IntPtr handle, JniHandleOwnership ownership)
            : base(handle, ownership)
        {
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\Android\Resources\values\colors.xml
================================================================================

<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="colorPrimary">#512BD4</color>
    <color name="colorPrimaryDark">#2B0B98</color>
    <color name="colorAccent">#2B0B98</color>
</resources>

================================================================================
FILE: Platforms\iOS\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\iOS\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: Platforms\MacCatalyst\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: Platforms\MacCatalyst\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: Platforms\Windows\App.xaml
================================================================================

Ôªø<maui:MauiWinUIApplication
    x:Class="LoGeCuiMobile.WinUI.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:maui="using:Microsoft.Maui"
    xmlns:local="using:LoGeCuiMobile.WinUI">

</maui:MauiWinUIApplication>

================================================================================
FILE: Platforms\Windows\App.xaml.cs
================================================================================

Ôªøusing Microsoft.UI.Xaml;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace LoGeCuiMobile.WinUI
{
    /// <summary>
    /// Provides application-specific behavior to supplement the default Application class.
    /// </summary>
    public partial class App : MauiWinUIApplication
    {
        /// <summary>
        /// Initializes the singleton application object.  This is the first line of authored code
        /// executed, and as such is the logical equivalent of main() or WinMain().
        /// </summary>
        public App()
        {
            this.InitializeComponent();
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }

}

================================================================================
FILE: Properties\launchSettings.json
================================================================================

{
  "profiles": {
    "Windows Machine": {
      "commandName": "Project",
      "nativeDebugging": false
    }
  }
}

================================================================================
FILE: Resources\Lang\AppResources.Designer.cs
================================================================================

Ôªø//------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a √©t√© g√©n√©r√© par un outil.
//     Version du runtime :4.0.30319.42000
//
//     Les modifications apport√©es √† ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est r√©g√©n√©r√©.
// </auto-generated>
//------------------------------------------------------------------------------

namespace LoGeCuiMobile.Resources.Lang {
    using System;
    
    
    /// <summary>
    ///   Une classe de ressource fortement typ√©e destin√©e, entre autres, √† la consultation des cha√Ænes localis√©es.
    /// </summary>
    // Cette classe a √©t√© g√©n√©r√©e automatiquement par la classe StronglyTypedResourceBuilder
    // √† l'aide d'un outil, tel que ResGen ou Visual Studio.
    // Pour ajouter ou supprimer un membre, modifiez votre fichier .ResX, puis r√©ex√©cutez ResGen
    // avec l'option /str ou r√©g√©n√©rez votre projet VS.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "18.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    public class AppResources {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal AppResources() {
        }
        
        /// <summary>
        ///   Retourne l'instance ResourceManager mise en cache utilis√©e par cette classe.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("LoGeCuiMobile.Resources.Lang.AppResources", typeof(AppResources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   Remplace la propri√©t√© CurrentUICulture du thread actuel pour toutes
        ///   les recherches de ressources √† l'aide de cette classe de ressource fortement typ√©e.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mauvais mot de passe.
        /// </summary>
        public static string BadPassword {
            get {
                return ResourceManager.GetString("BadPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Connexion en cours....
        /// </summary>
        public static string Connecting {
            get {
                return ResourceManager.GetString("Connecting", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur de connexion.
        /// </summary>
        public static string ConnectionError {
            get {
                return ResourceManager.GetString("ConnectionError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©ation du compte....
        /// </summary>
        public static string CreatingAccount {
            get {
                return ResourceManager.GetString("CreatingAccount", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Annuler.
        /// </summary>
        public static string Dialog_Cancel {
            get {
                return ResourceManager.GetString("Dialog_Cancel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer cet ingr√©dient ?.
        /// </summary>
        public static string Dialog_DeleteConfirm {
            get {
                return ResourceManager.GetString("Dialog_DeleteConfirm", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Non.
        /// </summary>
        public static string Dialog_No {
            get {
                return ResourceManager.GetString("Dialog_No", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OK.
        /// </summary>
        public static string Dialog_Ok {
            get {
                return ResourceManager.GetString("Dialog_Ok", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui.
        /// </summary>
        public static string Dialog_Yes {
            get {
                return ResourceManager.GetString("Dialog_Yes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Email.
        /// </summary>
        public static string Email {
            get {
                return ResourceManager.GetString("Email", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur.
        /// </summary>
        public static string ErrorTitle {
            get {
                return ResourceManager.GetString("ErrorTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Veuillez remplir tous les champs.
        /// </summary>
        public static string FillAllFields {
            get {
                return ResourceManager.GetString("FillAllFields", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe oubli√© ?.
        /// </summary>
        public static string ForgotPassword {
            get {
                return ResourceManager.GetString("ForgotPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Add_Available {
            get {
                return ResourceManager.GetString("Ingredients_Add_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de l‚Äôingr√©dient.
        /// </summary>
        public static string Ingredients_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Ingredients_Add_NameRequired {
            get {
                return ResourceManager.GetString("Ingredients_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© (ex : 10).
        /// </summary>
        public static string Ingredients_Add_QuantityPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_QuantityPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üíæ Enregistrer.
        /// </summary>
        public static string Ingredients_Add_Save {
            get {
                return ResourceManager.GetString("Ingredients_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_Add_Title {
            get {
                return ResourceManager.GetString("Ingredients_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Unit√© (ex : kg, pi√®ces).
        /// </summary>
        public static string Ingredients_Add_UnitPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_UnitPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_AddButton {
            get {
                return ResourceManager.GetString("Ingredients_AddButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Available {
            get {
                return ResourceManager.GetString("Ingredients_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dient.
        /// </summary>
        public static string Ingredients_DialogTitle {
            get {
                return ResourceManager.GetString("Ingredients_DialogTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© : {0} {1}.
        /// </summary>
        public static string Ingredients_QuantityFormat {
            get {
                return ResourceManager.GetString("Ingredients_QuantityFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Gestion des ingr√©dients.
        /// </summary>
        public static string Ingredients_Title {
            get {
                return ResourceManager.GetString("Ingredients_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Se connecter.
        /// </summary>
        public static string LoginButton {
            get {
                return ResourceManager.GetString("LoginButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string LoginRequired {
            get {
                return ResourceManager.GetString("LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients.
        /// </summary>
        public static string Nav_Ingredients {
            get {
                return ResourceManager.GetString("Nav_Ingredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Menu al√©atoire.
        /// </summary>
        public static string Nav_RandomMenu {
            get {
                return ResourceManager.GetString("Nav_RandomMenu", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Nav_Recipes {
            get {
                return ResourceManager.GetString("Nav_Recipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Nav_Settings {
            get {
                return ResourceManager.GetString("Nav_Settings", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste de courses.
        /// </summary>
        public static string Nav_ShoppingList {
            get {
                return ResourceManager.GetString("Nav_ShoppingList", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OCR.
        /// </summary>
        public static string OcrTitle {
            get {
                return ResourceManager.GetString("OcrTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe.
        /// </summary>
        public static string Password {
            get {
                return ResourceManager.GetString("Password", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üîí Permission.
        /// </summary>
        public static string PermissionTitle {
            get {
                return ResourceManager.GetString("PermissionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Tout est disponible. Aucun ingr√©dient manquant..
        /// </summary>
        public static string RandomMenu_AllAvailable {
            get {
                return ResourceManager.GetString("RandomMenu_AllAvailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de calculer les ingr√©dients manquants : certaines recettes n‚Äôont pas d‚Äôingr√©dients enregistr√©s..
        /// </summary>
        public static string RandomMenu_CannotComputeMissing {
            get {
                return ResourceManager.GetString("RandomMenu_CannotComputeMissing", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de g√©n√©rer un menu Entr√©e/Plat/Dessert..
        /// </summary>
        public static string RandomMenu_CannotGenerate {
            get {
                return ResourceManager.GetString("RandomMenu_CannotGenerate", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† V√©rifie que tes recettes ont bien &apos;categorie&apos; = Entree / Plat / Dessert en DB..
        /// </summary>
        public static string RandomMenu_CheckCategories {
            get {
                return ResourceManager.GetString("RandomMenu_CheckCategories", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Entr√©es: {0}
        ///Plats: {1}
        ///Desserts: {2}.
        /// </summary>
        public static string RandomMenu_CountsFormat {
            get {
                return ResourceManager.GetString("RandomMenu_CountsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Appuyez sur le bouton pour g√©n√©rer un menu.
        /// </summary>
        public static string RandomMenu_DefaultText {
            get {
                return ResourceManager.GetString("RandomMenu_DefaultText", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_GenerateButton {
            get {
                return ResourceManager.GetString("RandomMenu_GenerateButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Menu g√©n√©r√© :.
        /// </summary>
        public static string RandomMenu_GeneratedHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GeneratedHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ G√©n√©ration du menu (Entr√©e / Plat / Dessert)‚Ä¶.
        /// </summary>
        public static string RandomMenu_Generating {
            get {
                return ResourceManager.GetString("RandomMenu_Generating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste globale des ingr√©dients manquants :.
        /// </summary>
        public static string RandomMenu_GlobalMissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GlobalMissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients :.
        /// </summary>
        public static string RandomMenu_IngredientsHeader {
            get {
                return ResourceManager.GetString("RandomMenu_IngredientsHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants :.
        /// </summary>
        public static string RandomMenu_MissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_MissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants : aucun.
        /// </summary>
        public static string RandomMenu_MissingNone {
            get {
                return ResourceManager.GetString("RandomMenu_MissingNone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients : (aucun ingr√©dient enregistr√© pour cette recette).
        /// </summary>
        public static string RandomMenu_NoIngredientsForRecipe {
            get {
                return ResourceManager.GetString("RandomMenu_NoIngredientsForRecipe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette disponible..
        /// </summary>
        public static string RandomMenu_NoRecipes {
            get {
                return ResourceManager.GetString("RandomMenu_NoRecipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ouvrir la liste de courses.
        /// </summary>
        public static string RandomMenu_OpenShopping {
            get {
                return ResourceManager.GetString("RandomMenu_OpenShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Il manque :.
        /// </summary>
        public static string RandomMenu_SendConfirmBody {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Envoyer ?.
        /// </summary>
        public static string RandomMenu_SendConfirmTitle {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Envoyer les ingr√©dients manquants dans la liste de courses.
        /// </summary>
        public static string RandomMenu_SendMissingToShopping {
            get {
                return ResourceManager.GetString("RandomMenu_SendMissingToShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ingr√©dients envoy√©s.
        /// </summary>
        public static string RandomMenu_SentButton {
            get {
                return ResourceManager.GetString("RandomMenu_SentButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_Title {
            get {
                return ResourceManager.GetString("RandomMenu_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add {
            get {
                return ResourceManager.GetString("Recipes_Add", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;acc√®s √† la cam√©ra est requis pour scanner..
        /// </summary>
        public static string Recipes_Add_CameraPermission {
            get {
                return ResourceManager.GetString("Recipes_Add_CameraPermission", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Capture photo non support√©e sur cet appareil..
        /// </summary>
        public static string Recipes_Add_CaptureNotSupported {
            get {
                return ResourceManager.GetString("Recipes_Add_CaptureNotSupported", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Choisir une cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de retrouver l&apos;ID de la recette apr√®s sauvegarde..
        /// </summary>
        public static string Recipes_Add_IdNotFound {
            get {
                return ResourceManager.GetString("Recipes_Add_IdNotFound", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;image est trop lourde pour l&apos;OCR. Essayez de cadrer plus serr√© ou baissez la r√©solution..
        /// </summary>
        public static string Recipes_Add_ImageTooLarge {
            get {
                return ResourceManager.GetString("Recipes_Add_ImageTooLarge", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients (1 par ligne).
        /// </summary>
        public static string Recipes_Add_IngredientsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex :
        ///2 ≈ìufs
        ///100g farine
        ///1 pinc√©e de sel.
        /// </summary>
        public static string Recipes_Add_IngredientsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Instructions.
        /// </summary>
        public static string Recipes_Add_InstructionsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : M√©langer, cuire 10 min....
        /// </summary>
        public static string Recipes_Add_InstructionsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string Recipes_Add_LoginRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom.
        /// </summary>
        public static string Recipes_Add_NameLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_NameLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de la recette.
        /// </summary>
        public static string Recipes_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Recipes_Add_NameRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun texte d√©tect√©. Essayez avec plus de lumi√®re et sans flou..
        /// </summary>
        public static string Recipes_Add_NoTextDetected {
            get {
                return ResourceManager.GetString("Recipes_Add_NoTextDetected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Texte scann√© et champs pr√©-remplis. V√©rifiez et corrigez si besoin..
        /// </summary>
        public static string Recipes_Add_OcrSuccess {
            get {
                return ResourceManager.GetString("Recipes_Add_OcrSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Enregistrer.
        /// </summary>
        public static string Recipes_Add_Save {
            get {
                return ResourceManager.GetString("Recipes_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Recette enregistr√©e..
        /// </summary>
        public static string Recipes_Add_Saved {
            get {
                return ResourceManager.GetString("Recipes_Add_Saved", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Scanner (OCR).
        /// </summary>
        public static string Recipes_Add_ScanOcr {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanOcr", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üì∏ Scanner une recette.
        /// </summary>
        public static string Recipes_Add_ScanTitle {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_Add_ServiceNotReady {
            get {
                return ResourceManager.GetString("Recipes_Add_ServiceNotReady", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps (minutes).
        /// </summary>
        public static string Recipes_Add_TimeLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_TimeLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : 30.
        /// </summary>
        public static string Recipes_Add_TimePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_TimePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add_Title {
            get {
                return ResourceManager.GetString("Recipes_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Category {
            get {
                return ResourceManager.GetString("Recipes_Category", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie: {0}
        ///Temps: {1} min
        ///
        ///Ingr√©dients:
        ///{2}
        ///
        ///Instructions:
        ///{3}.
        /// </summary>
        public static string Recipes_DetailsFormat {
            get {
                return ResourceManager.GetString("Recipes_DetailsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette pour l&apos;instant..
        /// </summary>
        public static string Recipes_Empty {
            get {
                return ResourceManager.GetString("Recipes_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_IngredientsServiceNull {
            get {
                return ResourceManager.GetString("Recipes_IngredientsServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† (aucun ingr√©dient renseign√©).
        /// </summary>
        public static string Recipes_NoIngredients {
            get {
                return ResourceManager.GetString("Recipes_NoIngredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rafra√Æchir.
        /// </summary>
        public static string Recipes_Refresh {
            get {
                return ResourceManager.GetString("Recipes_Refresh", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecipesService est NULL (InitRestServices n&apos;a pas √©t√© appel√© apr√®s login)..
        /// </summary>
        public static string Recipes_ServiceNull {
            get {
                return ResourceManager.GetString("Recipes_ServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps : {0} min.
        /// </summary>
        public static string Recipes_TimeFormat {
            get {
                return ResourceManager.GetString("Recipes_TimeFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Recipes_Title {
            get {
                return ResourceManager.GetString("Recipes_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Confirmer le mot de passe.
        /// </summary>
        public static string Reset_ConfirmPassword {
            get {
                return ResourceManager.GetString("Reset_ConfirmPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Votre mot de passe a √©t√© modifi√©. Vous pouvez vous connecter..
        /// </summary>
        public static string Reset_DoneBody {
            get {
                return ResourceManager.GetString("Reset_DoneBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Termin√©.
        /// </summary>
        public static string Reset_DoneTitle {
            get {
                return ResourceManager.GetString("Reset_DoneTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de modifier le mot de passe..
        /// </summary>
        public static string Reset_Failed {
            get {
                return ResourceManager.GetString("Reset_Failed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialiser votre mot de passe.
        /// </summary>
        public static string Reset_Header {
            get {
                return ResourceManager.GetString("Reset_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nouveau mot de passe.
        /// </summary>
        public static string Reset_NewPassword {
            get {
                return ResourceManager.GetString("Reset_NewPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le mot de passe doit contenir au moins 6 caract√®res..
        /// </summary>
        public static string Reset_PwdMinLength {
            get {
                return ResourceManager.GetString("Reset_PwdMinLength", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Les mots de passe ne correspondent pas..
        /// </summary>
        public static string Reset_PwdMismatch {
            get {
                return ResourceManager.GetString("Reset_PwdMismatch", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Valider.
        /// </summary>
        public static string Reset_Submit {
            get {
                return ResourceManager.GetString("Reset_Submit", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialisation.
        /// </summary>
        public static string Reset_Title {
            get {
                return ResourceManager.GetString("Reset_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ Mise √† jour en cours....
        /// </summary>
        public static string Reset_Updating {
            get {
                return ResourceManager.GetString("Reset_Updating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Service indisponible..
        /// </summary>
        public static string ServiceUnavailable {
            get {
                return ResourceManager.GetString("ServiceUnavailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session absente ou expir√©e. Veuillez vous reconnecter..
        /// </summary>
        public static string SessionExpired {
            get {
                return ResourceManager.GetString("SessionExpired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session.
        /// </summary>
        public static string SessionTitle {
            get {
                return ResourceManager.GetString("SessionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Compte.
        /// </summary>
        public static string Settings_Account {
            get {
                return ResourceManager.GetString("Settings_Account", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Zone dangereuse.
        /// </summary>
        public static string Settings_DangerZone {
            get {
                return ResourceManager.GetString("Settings_DangerZone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Es-tu s√ªr de vouloir supprimer ton compte ? Cette action est irr√©versible..
        /// </summary>
        public static string Settings_DeleteConfirmBody {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_DeleteConfirmTitle {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui, supprimer.
        /// </summary>
        public static string Settings_DeleteConfirmYes {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmYes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Suppression impossible : {0}.
        /// </summary>
        public static string Settings_DeleteFailed {
            get {
                return ResourceManager.GetString("Settings_DeleteFailed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Votre compte a √©t√© supprim√©..
        /// </summary>
        public static string Settings_DeleteSuccess {
            get {
                return ResourceManager.GetString("Settings_DeleteSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©connexion.
        /// </summary>
        public static string Settings_Logout {
            get {
                return ResourceManager.GetString("Settings_Logout", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supabase non initialis√©. Reconnectez-vous..
        /// </summary>
        public static string Settings_SupabaseNull {
            get {
                return ResourceManager.GetString("Settings_SupabaseNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Settings_Title {
            get {
                return ResourceManager.GetString("Settings_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_Unsubscribe {
            get {
                return ResourceManager.GetString("Settings_Unsubscribe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un article.
        /// </summary>
        public static string Shopping_AddItem {
            get {
                return ResourceManager.GetString("Shopping_AddItem", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Achet√©.
        /// </summary>
        public static string Shopping_Bought {
            get {
                return ResourceManager.GetString("Shopping_Bought", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer.
        /// </summary>
        public static string Shopping_Delete {
            get {
                return ResourceManager.GetString("Shopping_Delete", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üóëÔ∏è Supprimer s√©lection.
        /// </summary>
        public static string Shopping_DeleteSelection {
            get {
                return ResourceManager.GetString("Shopping_DeleteSelection", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun article pour l‚Äôinstant..
        /// </summary>
        public static string Shopping_Empty {
            get {
                return ResourceManager.GetString("Shopping_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ma liste de courses.
        /// </summary>
        public static string Shopping_Header {
            get {
                return ResourceManager.GetString("Shopping_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Liste de Courses.
        /// </summary>
        public static string Shopping_Title {
            get {
                return ResourceManager.GetString("Shopping_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©er un compte.
        /// </summary>
        public static string SignupButton {
            get {
                return ResourceManager.GetString("SignupButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur lors de l&apos;inscription.
        /// </summary>
        public static string SignupError {
            get {
                return ResourceManager.GetString("SignupError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rester connect√©.
        /// </summary>
        public static string StayConnected {
            get {
                return ResourceManager.GetString("StayConnected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ OK.
        /// </summary>
        public static string SuccessTitle {
            get {
                return ResourceManager.GetString("SuccessTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur inconnue..
        /// </summary>
        public static string UnknownError {
            get {
                return ResourceManager.GetString("UnknownError", resourceCulture);
            }
        }
    }
}

================================================================================
FILE: Resources\Lang\LocalizationResourceManager.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Globalization;
using System.Resources;

namespace LoGeCuiMobile.Resources.Lang;

public class LocalizationResourceManager : INotifyPropertyChanged
{
    public static LocalizationResourceManager Instance { get; } = new();

    private readonly ResourceManager _resourceManager = AppResources.ResourceManager;

    public event PropertyChangedEventHandler? PropertyChanged;

    public string this[string key] => _resourceManager.GetString(key, CultureInfo.CurrentUICulture) ?? key;

    public void SetCulture(CultureInfo culture)
    {
        if (culture == null) return;

        CultureInfo.CurrentUICulture = culture;
        CultureInfo.CurrentCulture = culture;

        CultureInfo.DefaultThreadCurrentCulture = culture;
        CultureInfo.DefaultThreadCurrentUICulture = culture;

        // ‚úÖ Notifie toute l‚ÄôUI : toutes les bindings se r√©√©valuent
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(null));
    }
}

================================================================================
FILE: Resources\Lang\TranslateExtension.cs
================================================================================

Ôªøusing Microsoft.Maui.Controls;
using System;

namespace LoGeCuiMobile.Resources.Lang;

[ContentProperty(nameof(Key))]
public class TranslateExtension : IMarkupExtension<BindingBase>
{
    public string Key { get; set; } = "";

    public BindingBase ProvideValue(IServiceProvider serviceProvider)
        => new Binding($"[{Key}]", source: LocalizationResourceManager.Instance);

    object IMarkupExtension.ProvideValue(IServiceProvider serviceProvider)
        => ProvideValue(serviceProvider);
}

================================================================================
FILE: Resources\Raw\AboutAssets.txt
================================================================================

ÔªøAny raw assets you want to be deployed with your application can be placed in
this directory (and child directories). Deployment of the asset to your application
is automatically handled by the following `MauiAsset` Build Action within your `.csproj`.

	<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />

These files will be deployed with your package and will be accessible using Essentials:

	async Task LoadMauiAsset()
	{
		using var stream = await FileSystem.OpenAppPackageFileAsync("AboutAssets.txt");
		using var reader = new StreamReader(stream);

		var contents = reader.ReadToEnd();
	}

================================================================================
FILE: Resources\Styles\Colors.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- Couleurs fixes -->
    <Color x:Key="AccentColor">#FF6B00</Color>

    <!-- Couleurs Light -->
    <Color x:Key="LightPageBackground">#FFFFFF</Color>
    <Color x:Key="LightTextPrimary">#111111</Color>
    <Color x:Key="LightCardBackground">#F2F2F2</Color>

    <!-- Couleurs Dark -->
    <Color x:Key="DarkPageBackground">#121212</Color>
    <Color x:Key="DarkTextPrimary">#FFFFFF</Color>
    <Color x:Key="DarkCardBackground">#1E1E1E</Color>

    <!-- Texte sur cartes -->
    <Color x:Key="LightCardText">#111111</Color>
    <Color x:Key="DarkCardText">#FFFFFF</Color>

</ResourceDictionary>


================================================================================
FILE: Resources\Styles\Styles.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- PAGE -->
    <Style TargetType="ContentPage">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightPageBackground}"
                                 Dark="{StaticResource DarkPageBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- LABEL -->
    <Style TargetType="Label">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- ENTRY -->
    <Style TargetType="Entry">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- FRAME -->
    <Style TargetType="Frame">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- BUTTON -->
    <Style TargetType="Button">
        <Setter Property="TextColor" Value="White" />
        <Setter Property="BackgroundColor" Value="{StaticResource AccentColor}" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Padding" Value="14,10" />
        <Setter Property="MinimumHeightRequest" Value="44" />
        <Setter Property="MinimumWidthRequest" Value="44" />
    </Style>

    <!-- LABEL DANS UNE CARTE -->
    <Style TargetType="Label" x:Key="CardLabel">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardText}"
                             Dark="{StaticResource DarkCardText}" />
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>

================================================================================
FILE: RootPage.cs
================================================================================

namespace LoGeCuiMobile;

public static class RootPage
{
    public static Page CreateLoginRoot()
        => new NavigationPage(new Pages.LoginPage());

    public static Page CreateAppShellRoot()
        => new AppShell();
}

================================================================================
FILE: Services\Local\ArticleLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class ArticleLocal
    {
        [PrimaryKey]
        public int Id { get; set; }   // int

        public string Nom { get; set; } = "";
        public string Quantite { get; set; } = "";
        public string Unite { get; set; } = "";
        public bool EstAchete { get; set; }

        public ArticleLocal() { }

        public ArticleLocal(ArticleCourse a)
        {
            Id = a.Id;                 // int -> int ‚úÖ
            Nom = a.Nom ?? "";
            Quantite = a.Quantite ?? "";
            Unite = a.Unite ?? "";
            EstAchete = a.EstAchete;
        }

        public ArticleCourse ToModel()
        {
            return new ArticleCourse
            {
                Id = Id,              // int -> int ‚úÖ
                Nom = Nom,
                Quantite = Quantite,
                Unite = Unite,
                EstAchete = EstAchete
            };
        }
    }
}

================================================================================
FILE: Services\Local\IngredientLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

public class IngredientLocal
{
    [PrimaryKey]
    public Guid Id { get; set; }
    public string Nom { get; set; } = "";
    public string? Quantite { get; set; }
    public string? Unite { get; set; }
    public bool EstDisponible { get; set; }

    public IngredientLocal() { }

    public IngredientLocal(Ingredient i)
    {
        Id = i.Id;
        Nom = i.Nom;
        Quantite = i.Quantite;
        Unite = i.Unite;
        EstDisponible = i.EstDisponible;
    }

    public Ingredient ToModel() => new Ingredient
    {
        Id = Id,
        Nom = Nom,
        Quantite = Quantite,
        Unite = Unite,
        EstDisponible = EstDisponible
    };
}

================================================================================
FILE: Services\Local\LocalDatabase.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local;

public class LocalDatabase
{
    private readonly SQLiteAsyncConnection _db;

    public LocalDatabase(string path)
    {
        _db = new SQLiteAsyncConnection(path);
        _db.CreateTableAsync<IngredientLocal>().Wait();
        _db.CreateTableAsync<ArticleLocal>().Wait();
        _db.CreateTableAsync<RecetteLocal>().Wait();

    }

    // ---------- INGREDIENTS ----------
    public Task<List<IngredientLocal>> GetIngredientsAsync() =>
        _db.Table<IngredientLocal>().ToListAsync();

    public Task SaveIngredientsAsync(IEnumerable<Ingredient> ingredients)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<IngredientLocal>();
            foreach (var i in ingredients)
                tran.Insert(new IngredientLocal(i));
        });
    }

    // ---------- ARTICLES ----------
    public Task<List<ArticleLocal>> GetArticlesAsync() =>
        _db.Table<ArticleLocal>().ToListAsync();

    public Task SaveArticlesAsync(IEnumerable<ArticleCourse> articles)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<ArticleLocal>();
            foreach (var a in articles)
                tran.Insert(new ArticleLocal(a));
        });
    }

    public Task<List<RecetteLocal>> GetRecettesAsync() =>
    _db.Table<RecetteLocal>().ToListAsync();

    public Task SaveRecettesAsync(IEnumerable<Recette> recettes)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<RecetteLocal>();
            foreach (var r in recettes)
                tran.Insert(new RecetteLocal(r));
        });
    }
}

================================================================================
FILE: Services\Local\RecetteLocal.cs
================================================================================

Ôªøusing System;
using SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class RecetteLocal
    {
        [PrimaryKey]
        public string Id { get; set; } = ""; // Guid stock√© en texte

        public string Nom { get; set; } = "";
        public int TempsPreparation { get; set; }
        public string Instructions { get; set; } = "";
        public string CategorieDb { get; set; } = "";
        public int Type { get; set; } // enum -> int

        public RecetteLocal() { }

        public RecetteLocal(Recette r)
        {
            // adapte selon ton type r√©el :
            // si r.Id est Guid => r.Id.ToString()
            // si r.Id est string => r.Id
            // si r.Id est int => r.Id.ToString()
            Id = r.Id.ToString();

            Nom = r.Nom ?? "";
            TempsPreparation = r.TempsPreparation;
            Instructions = r.Instructions ?? "";
            CategorieDb = r.CategorieDb ?? "";
            Type = (int)r.Type;
        }

        public Recette ToModel()
        {
            // si Recette.Id est Guid, remets Guid.Parse
            // sinon adapte.
            Guid.TryParse(Id, out var guid);

            return new Recette
            {
                Id = guid,
                Nom = Nom,
                TempsPreparation = TempsPreparation,
                Instructions = Instructions,
                CategorieDb = CategorieDb,
                Type = (TypePlat)Type
            };
        }
    }
}

================================================================================
FILE: Services\OcrService.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text.Json;

namespace LoGeCuiMobile.Services
{
    public sealed class OcrService
    {
        private readonly HttpClient _http;
        private readonly string _apiKey;

        public OcrService(string apiKey)
        {
            _apiKey = apiKey ?? throw new ArgumentNullException(nameof(apiKey));
            _http = new HttpClient { Timeout = TimeSpan.FromSeconds(60) };
        }

        public async Task<string> ExtractTextFromImageAsync(byte[] imageBytes, string fileName = "scan.jpg")
        {
            if (imageBytes is null || imageBytes.Length == 0)
                throw new ArgumentException("Image vide.", nameof(imageBytes));

            if (string.IsNullOrWhiteSpace(_apiKey))
                throw new InvalidOperationException("Cl√© OCR manquante (apiKey).");

            var url = "https://api.ocr.space/parse/image";

            using var content = new MultipartFormDataContent();

            // Param√®tres utiles
            content.Add(new StringContent("fre"), "language");          // fre = fran√ßais
            content.Add(new StringContent("false"), "isOverlayRequired");
            content.Add(new StringContent("2"), "OCREngine");           // 1 ou 2 (2 souvent meilleur)
            content.Add(new StringContent("true"), "scale");
            content.Add(new StringContent("true"), "detectOrientation");

            var fileContent = new ByteArrayContent(imageBytes);
            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("image/jpeg");
            content.Add(fileContent, "file", fileName);

            using var request = new HttpRequestMessage(HttpMethod.Post, url);
            request.Headers.Add("apikey", _apiKey); // ‚úÖ endroit le plus fiable
            request.Content = content;

            using var resp = await _http.SendAsync(request);
            var json = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"OCR HTTP {(int)resp.StatusCode}: {json}");

            using var doc = JsonDocument.Parse(json);

            // Si l‚ÄôAPI retourne une erreur applicative
            if (doc.RootElement.TryGetProperty("IsErroredOnProcessing", out var errored)
                && errored.ValueKind == JsonValueKind.True)
            {
                string msg = "Erreur OCR.";
                if (doc.RootElement.TryGetProperty("ErrorMessage", out var em))
                {
                    // ErrorMessage peut √™tre string ou tableau selon les cas
                    msg = em.ValueKind switch
                    {
                        JsonValueKind.Array => string.Join(" | ", em.EnumerateArray().Select(x => x.ToString())),
                        _ => em.ToString()
                    };
                }
                throw new Exception(msg);
            }

            if (!doc.RootElement.TryGetProperty("ParsedResults", out var parsedResults)
                || parsedResults.ValueKind != JsonValueKind.Array
                || parsedResults.GetArrayLength() == 0)
            {
                return "";
            }

            var first = parsedResults[0];
            if (!first.TryGetProperty("ParsedText", out var parsedTextEl))
                return "";

            return parsedTextEl.GetString() ?? "";
        }
    }
}



================================================================================
FILE: Services\Skiasharp.cs
================================================================================

Ôªøusing SkiaSharp;

namespace LoGeCuiMobile.Services
{
    public static class ImageCompressionHelper
    {
        public static byte[] CompressJpeg(
            byte[] input,
            int maxWidth = 1600,
            int jpegQuality = 75)
        {
            using var inputStream = new SKMemoryStream(input);
            using var codec = SKCodec.Create(inputStream);
            using var bitmap = SKBitmap.Decode(codec);

            if (bitmap == null)
                throw new InvalidOperationException("Impossible de d√©coder l'image.");

            var width = bitmap.Width;
            var height = bitmap.Height;

            if (width > maxWidth)
            {
                var ratio = (float)maxWidth / width;
                var newW = maxWidth;
                var newH = (int)(height * ratio);

                using var resized = bitmap.Resize(
                    new SKImageInfo(newW, newH),
                    SKFilterQuality.Medium);

                using var image = SKImage.FromBitmap(resized);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
            else
            {
                using var image = SKImage.FromBitmap(bitmap);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
        }
    }
}


================================================================================
FILE: Services\SupabaseConfig.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public static class SupabaseConfig
    {
        public static string Url { get; } = ConfigurationHelper.GetSupabaseUrl();
        public static string Key { get; } = ConfigurationHelper.GetSupabaseKey();
    }
}

================================================================================
FILE: ViewModels\ArticleCourseUi.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    // Wrapper UI: on conserve ArticleCourse et on ajoute une s√©lection locale (non persist√©e)
    public class ArticleCourseUi : INotifyPropertyChanged
    {
        public ArticleCourseUi(ArticleCourse model) => Model = model;

        public ArticleCourse Model { get; }

        public int Id => Model.Id;

        public string Nom
        {
            get => Model.Nom;
            set { if (Model.Nom != value) { Model.Nom = value; OnPropertyChanged(); } }
        }

        public string Quantite
        {
            get => Model.Quantite;
            set { if (Model.Quantite != value) { Model.Quantite = value; OnPropertyChanged(); } }
        }

        public string Unite
        {
            get => Model.Unite;
            set { if (Model.Unite != value) { Model.Unite = value; OnPropertyChanged(); } }
        }

        public bool EstAchete
        {
            get => Model.EstAchete;
            set { if (Model.EstAchete != value) { Model.EstAchete = value; OnPropertyChanged(); } }
        }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set { if (_isSelectedForDelete != value) { _isSelectedForDelete = value; OnPropertyChanged(); } }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}


================================================================================
FILE: ViewModels\MesRecettesViewModel.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.ViewModels
{
    public enum AvailabilityState
    {
        Unknown,
        AllAvailable,
        Missing
    }

    // ‚úÖ UI wrapper (selection, couleurs, etc.)
    public class RecetteUi : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        public Recette Model { get; }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(IsSelectedForDelete)));
            }
        }

        private AvailabilityState _availabilityState = AvailabilityState.Unknown;
        public AvailabilityState AvailabilityState
        {
            get => _availabilityState;
            set
            {
                if (_availabilityState == value) return;
                _availabilityState = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityState)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        private int _missingCount;
        public int MissingCount
        {
            get => _missingCount;
            set
            {
                if (_missingCount == value) return;
                _missingCount = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(MissingCount)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        public string AvailabilityLabel =>
            AvailabilityState == AvailabilityState.Unknown ? "Disponibilit√© inconnue"
            : AvailabilityState == AvailabilityState.AllAvailable ? "‚úÖ Tous ingr√©dients disponibles"
            : $"‚ùå Manque {MissingCount} ingr√©dient(s)";

        public Guid Id => Model.Id;
        public string Nom => Model.Nom;
        public string TypeTexte => Model.TypeTexte;
        public int TempsPreparation => Model.TempsPreparation;
        public string DifficulteTexte => Model.DifficulteTexte;

        public RecetteUi(Recette r) => Model = r;
    }

    public class MesRecettesViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));

        private readonly RecipesService _recipesService;

        public ObservableCollection<RecetteUi> Recettes { get; } = new();

        public ObservableCollection<string> Categories { get; } =
            new() { "Toutes", "Entr√©es", "Plats", "Desserts" };

        private string _selectedCategorie = "Toutes";
        public string SelectedCategorie
        {
            get => _selectedCategorie;
            set
            {
                if (_selectedCategorie == value) return;
                _selectedCategorie = value;
                OnPropertyChanged(nameof(SelectedCategorie));
                ApplyFilter(); // ‚úÖ synchro
            }
        }

        public ICommand RefreshCommand { get; }

        private bool _isBusy;
        public bool IsBusy
        {
            get => _isBusy;
            private set
            {
                if (_isBusy == value) return;
                _isBusy = value;
                OnPropertyChanged(nameof(IsBusy));
            }
        }

        private List<Recette> _all = new();

        public MesRecettesViewModel(RecipesService recipesService)
        {
            _recipesService = recipesService;
            RefreshCommand = new Command(async () => await LoadAsync(forceRemote: true));
        }

        // ------------------ HELPERS erreurs Supabase ------------------

        private static bool IsJwtExpired(Exception ex)
        {
            // On d√©tecte "JWT expired" m√™me si c'est encapsul√© dans une exception
            var msg = ex.ToString();
            return msg.Contains("JWT expired", StringComparison.OrdinalIgnoreCase);
        }

        private static bool IsNetworkRelated(Exception ex)
        {
            // Large: HttpRequestException, timeout, etc.
            // On fait simple: si on est online mais l'appel rate, on fallback cache.
            // (Si tu veux, on peut raffiner apr√®s.)
            var msg = ex.ToString();
            return msg.Contains("HttpRequestException", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timed out", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timeout", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("network", StringComparison.OrdinalIgnoreCase);
        }

        // ------------------ LOAD ------------------

        public async Task LoadAsync(bool forceRemote = false)
        {
            if (IsBusy) return;

            try
            {
                IsBusy = true;

                // 0) Cache local d‚Äôabord (offline friendly)
                var local = await App.LocalDb.GetRecettesAsync();
                _all = local.Select(x => x.ToModel()).ToList();

                // 1) Si internet + connect√© : refresh
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var app = (App)Microsoft.Maui.Controls.Application.Current;

                    if (app.IsConnected && app.CurrentUserId != null)
                    {
                        try
                        {
                            var remote = await _recipesService.GetRecettesAsync(app.CurrentUserId.Value)
                                         ?? new List<Recette>();

                            // Si forceRemote on remplace toujours
                            // Sinon: on remplace si remote non vide (√©vite d‚Äô√©craser cache avec vide)
                            if (forceRemote || remote.Count > 0)
                            {
                                _all = remote;
                                await App.LocalDb.SaveRecettesAsync(remote);
                            }
                        }
                        catch (Exception ex)
                        {
                            // ‚úÖ IMPORTANT : si JWT expir√©, on reste sur cache (ne pas crasher l'app)
                            if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                            {
                                // Optionnel: tu peux d√©clencher une UI "Reconnecte-toi"
                                // mais ici on reste silencieux pour que l'app d√©marre.
                            }
                            else
                            {
                                // Autres erreurs: on laisse remonter (ou tu peux aussi fallback)
                                throw;
                            }
                        }
                    }
                }

                ApplyFilter();
            }
            finally
            {
                IsBusy = false;
            }
        }

        private void ApplyFilter()
        {
            IEnumerable<Recette> filtered = _all;

            if (SelectedCategorie == "Entr√©es")
                filtered = _all.Where(r => r.Type == TypePlat.Entree);
            else if (SelectedCategorie == "Plats")
                filtered = _all.Where(r => r.Type == TypePlat.Plat);
            else if (SelectedCategorie == "Desserts")
                filtered = _all.Where(r => r.Type == TypePlat.Dessert);

            Recettes.Clear();
            foreach (var r in filtered)
                Recettes.Add(new RecetteUi(r));
        }

        // -------- Availability (vert/rouge) --------
        public async Task RefreshAvailabilityAsync()
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            // Offline => Unknown
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            try
            {
                var userId = app.CurrentUserId.Value;

                // 1) ingr√©dients dispo user
                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                // 2) pour chaque recette, calcule missing (‚ö†Ô∏è N requ√™tes - ok pour d√©marrer)
                foreach (var r in Recettes)
                {
                    var rows = await app.RecetteIngredientsService.GetForRecetteAsync(r.Model.Id);

                    var recipeNames = rows
                        .Select(x => Norm(x.nom))
                        .Where(s => !string.IsNullOrWhiteSpace(s))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    if (recipeNames.Count == 0)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                        continue;
                    }

                    var missing = recipeNames
                        .Where(n => !userSet.Contains(n))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    r.MissingCount = missing.Count;
                    r.AvailabilityState = (missing.Count == 0) ? AvailabilityState.AllAvailable : AvailabilityState.Missing;
                }
            }
            catch (Exception ex)
            {
                // ‚úÖ si JWT expir√© => on met tout en Unknown et on sort
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                {
                    foreach (var r in Recettes)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                    }
                    return;
                }

                throw;
            }
        }

        // -------- Actions recette -> liste de courses --------
        public async Task<List<string>?> GetMissingIngredientsForRecipeAsync(Recette recette)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return null;

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
                return null;

            try
            {
                var userId = app.CurrentUserId.Value;

                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                var rows = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);
                var recipeNames = rows
                    .Select(x => (x.nom ?? "").Trim())
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                if (recipeNames.Count == 0)
                    return null;

                var missing = recipeNames
                    .Where(n => !userSet.Contains(Norm(n)))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                return missing;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return null;

                throw;
            }
        }

        public async Task<bool> SendMissingToShoppingAsync(List<string> missing)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return false;

            if (!app.IsConnected || app.CurrentUserId == null || app.ListeCoursesSupabaseService == null)
                return false;

            try
            {
                await app.ListeCoursesSupabaseService.AddMissingAsync(app.CurrentUserId.Value, missing);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return false;

                throw;
            }
        }

        // -------- Suppression --------
        public async Task DeleteSelectedAsync(List<RecetteUi> selected)
        {
            var app = (App)Microsoft.Maui.Controls.Application.Current;

            // Optimistic UI
            foreach (var r in selected.ToList())
                Recettes.Remove(r);

            // Supabase si possible
            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet && app.IsConnected && app.RecipesService != null)
            {
                try
                {
                    foreach (var r in selected)
                        await app.RecipesService.DeleteRecetteAsync(r.Model.Id);
                }
                catch (Exception ex)
                {
                    // si JWT expir√© => on ne peut pas supprimer c√¥t√© serveur.
                    // on reload depuis cache pour √™tre coh√©rent
                    if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                        throw;
                }
            }

            // Recharge (cache + remote si possible)
            await LoadAsync(forceRemote: true);

            // Refresh disponibilit√© (si possible)
            try
            {
                await RefreshAvailabilityAsync();
            }
            catch (Exception ex)
            {
                if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                    throw;
            }
        }

        public Task DeleteOneAsync(RecetteUi one)
            => DeleteSelectedAsync(new List<RecetteUi> { one });

        // -------- Helpers --------
        private static string Norm(string? s)
            => (s ?? "").Trim().ToLowerInvariant();
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterIngredientPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    x:Class="LoGeCuiMobile.Pages.AjouterIngredientPage"
    Title="{tr:Translate Ingredients_Add_Title}">

    <VerticalStackLayout Padding="20" Spacing="14">

        <Entry
            x:Name="NomEntry"
            Placeholder="{tr:Translate Ingredients_Add_NamePlaceholder}" />

        <Entry
            x:Name="QuantiteEntry"
            Placeholder="{tr:Translate Ingredients_Add_QuantityPlaceholder}"
            Keyboard="Numeric" />

        <Entry
            x:Name="UniteEntry"
            Placeholder="{tr:Translate Ingredients_Add_UnitPlaceholder}" />

        <HorizontalStackLayout Spacing="10">
            <CheckBox x:Name="DisponibleCheckBox" IsChecked="True"/>
            <Label Text="{tr:Translate Ingredients_Add_Available}"
                   VerticalTextAlignment="Center"/>
        </HorizontalStackLayout>

        <Button
            Text="{tr:Translate Ingredients_Add_Save}"
            BackgroundColor="#28a745"
            Clicked="OnSaveClicked"/>

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterIngredientPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.Pages;

public partial class AjouterIngredientPage : ContentPage
{
    public AjouterIngredientPage()
    {
        InitializeComponent();
    }

    private async void OnSaveClicked(object sender, EventArgs e)
    {
        try
        {
            if (string.IsNullOrWhiteSpace(NomEntry.Text))
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Ingredients_Add_NameRequired"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            var ingredient = new Ingredient
            {
                Nom = NomEntry.Text.Trim(),
                Quantite = QuantiteEntry.Text?.Trim() ?? "",
                Unite = UniteEntry.Text?.Trim() ?? "",
                EstDisponible = DisponibleCheckBox.IsChecked
            };

            // ‚úÖ 1) Toujours sauver dans le cache local (offline-first)
            await SaveIngredientToLocalCacheAsync(ingredient);

            // ‚úÖ 2) Si internet + connect√© => push Supabase
            var app = (App)Application.Current;

            var hasInternet = Connectivity.Current.NetworkAccess == NetworkAccess.Internet;

            if (hasInternet && app.IsConnected && app.IngredientsService != null && app.CurrentUserId != null)
            {
                await app.IngredientsService.CreateIngredientAsync(app.CurrentUserId.Value, ingredient);

            }

            // ‚úÖ Retour
            await Shell.Current.GoToAsync("..");
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private static async System.Threading.Tasks.Task SaveIngredientToLocalCacheAsync(Ingredient ingredient)
    {
        // R√©cup√®re cache local
        var local = await App.LocalDb.GetIngredientsAsync();
        var models = local.Select(x => x.ToModel()).ToList();

        // Evite doublon par Nom (tu peux adapter sur ExternalId si tu en as)
        bool exists = models.Any(x =>
            string.Equals(x.Nom?.Trim(), ingredient.Nom?.Trim(), StringComparison.OrdinalIgnoreCase));

        if (!exists)
            models.Add(ingredient);

        await App.LocalDb.SaveIngredientsAsync(models);
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterRecettePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.AjouterRecettePage"
             Title="{tr:Translate Recipes_Add_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="12">

            <Label Text="{tr:Translate Recipes_Add_NameLabel}" />
            <Entry x:Name="NomEntry"
                   Placeholder="{tr:Translate Recipes_Add_NamePlaceholder}" />

            <!-- PHOTO RECETTE -->
            <Label Text="Photo" />

            <Frame Padding="0"
                   CornerRadius="12"
                   HasShadow="False"
                   BorderColor="{AppThemeBinding Light=#DDD, Dark=#444}">
                <Grid RowDefinitions="180,Auto" ColumnDefinitions="*,*"
                      RowSpacing="10"
                      Padding="0">

                    <!-- Preview -->
                    <Image x:Name="PhotoImage"
                           Grid.Row="0" Grid.ColumnSpan="2"
                           Aspect="AspectFill"
                           HeightRequest="180" />

                    <!-- Actions -->
                    <Button Grid.Row="1" Grid.Column="0"
                            Text="Choisir une photo"
                            Clicked="OnPickPhotoClicked" />

                    <Button Grid.Row="1" Grid.Column="1"
                            Text="Prendre une photo"
                            Clicked="OnTakePhotoClicked" />
                </Grid>
            </Frame>

            <Button x:Name="RemovePhotoButton"
                    Text="Supprimer la photo"
                    IsVisible="False"
                    Clicked="OnRemovePhotoClicked" />

            <Label Text="{tr:Translate Recipes_Add_CategoryLabel}" />
            <Picker x:Name="CategoriePicker"
                    Title="{tr:Translate Recipes_Add_CategoryPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_TimeLabel}" />
            <Entry x:Name="TempsEntry"
                   Keyboard="Numeric"
                   Placeholder="{tr:Translate Recipes_Add_TimePlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_IngredientsLabel}" />
            <Editor x:Name="IngredientsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="140"
                    Placeholder="{tr:Translate Recipes_Add_IngredientsPlaceholder}" />

            <Label Text="{tr:Translate Recipes_Add_InstructionsLabel}" />
            <Editor x:Name="InstructionsEditor"
                    AutoSize="TextChanges"
                    HeightRequest="180"
                    Placeholder="{tr:Translate Recipes_Add_InstructionsPlaceholder}" />

            <Button Text="{tr:Translate Recipes_Add_ScanOcr}"
                    Clicked="OnScanClicked" />

            <Button Text="{tr:Translate Recipes_Add_Save}"
                    Clicked="OnSaveClicked" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\AjouterRecettePage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text;
using System.Text.Json;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.Services;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiShared.Utils;
using Microsoft.Maui.ApplicationModel;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Media;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages
{
    public partial class AjouterRecettePage : ContentPage
    {
        private Recette? _editingRecette;
        private string? _photoLocalPath;

        private readonly SupabaseStorageService _storage = new SupabaseStorageService();

        // ‚úÖ HttpClient r√©utilis√© (√©vite ANR/sockets)
        private static readonly HttpClient _http = new HttpClient
        {
            Timeout = TimeSpan.FromSeconds(60)
        };

        public AjouterRecettePage(Recette? recette = null)
        {
            InitializeComponent();

            CategoriePicker.ItemsSource = new List<string> { "Entree", "Plat", "Dessert" };
            CategoriePicker.SelectedIndex = 1;

            _editingRecette = recette;

            if (_editingRecette != null)
            {
                Title = "Modifier recette";
                _ = LoadRecetteForEditAsync();
            }
            else
            {
                Title = "Ajouter recette";
                SetPhotoPreview(null);
            }
        }

        private async System.Threading.Tasks.Task LoadRecetteForEditAsync()
        {
            try
            {
                if (_editingRecette == null)
                    return;

                NomEntry.Text = _editingRecette.Nom;
                TempsEntry.Text = _editingRecette.TempsPreparation.ToString(CultureInfo.InvariantCulture);
                InstructionsEditor.Text = _editingRecette.Instructions ?? "";

                var cat = string.IsNullOrWhiteSpace(_editingRecette.CategorieDb) ? "Plat" : _editingRecette.CategorieDb.Trim();
                if (CategoriePicker.ItemsSource is List<string> cats && cats.Contains(cat))
                    CategoriePicker.SelectedItem = cat;
                else
                    CategoriePicker.SelectedItem = "Plat";

                // Photo : local d'abord, sinon URL
                if (!string.IsNullOrWhiteSpace(_editingRecette.PhotoLocalPath) && File.Exists(_editingRecette.PhotoLocalPath))
                {
                    _photoLocalPath = _editingRecette.PhotoLocalPath;
                    SetPhotoPreview(_photoLocalPath);
                }
                else if (!string.IsNullOrWhiteSpace(_editingRecette.PhotoUrl))
                {
                    _photoLocalPath = null;
                    PhotoImage.Source = ImageSource.FromUri(new Uri(_editingRecette.PhotoUrl));
                    RemovePhotoButton.IsVisible = true;
                }
                else
                {
                    _photoLocalPath = null;
                    SetPhotoPreview(null);
                }

                // Ingr√©dients (depuis Supabase)
                var app = (App)Application.Current;
                if (app.RecetteIngredientsService != null && _editingRecette.Id != Guid.Empty)
                {
                    var items = await app.RecetteIngredientsService.GetForRecetteAsync(_editingRecette.Id);

                    IngredientsEditor.Text = (items.Count == 0)
                        ? ""
                        : string.Join("\n", items.Select(x =>
                            string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                                ? x.nom
                                : $"{x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
                        ));
                }
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        // ---------- PHOTO ----------
        private async void OnPickPhotoClicked(object sender, EventArgs e)
        {
            try
            {
                var path = await PickOrTakeAsync(takePhoto: false);
                if (path == null) return;

                _photoLocalPath = path;
                SetPhotoPreview(path);
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        private async void OnTakePhotoClicked(object sender, EventArgs e)
        {
            try
            {
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var path = await PickOrTakeAsync(takePhoto: true);
                if (path == null) return;

                _photoLocalPath = path;
                SetPhotoPreview(path);
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex);
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        private void OnRemovePhotoClicked(object sender, EventArgs e)
        {
            _photoLocalPath = null;

            if (_editingRecette != null)
            {
                _editingRecette.PhotoLocalPath = null;
                _editingRecette.PhotoUrl = null;
            }

            SetPhotoPreview(null);
        }

        private void SetPhotoPreview(string? path)
        {
            if (!string.IsNullOrWhiteSpace(path) && File.Exists(path))
            {
                PhotoImage.Source = ImageSource.FromFile(path);
                RemovePhotoButton.IsVisible = true;
            }
            else
            {
                PhotoImage.Source = null;
                RemovePhotoButton.IsVisible = false;
            }
        }

        private async System.Threading.Tasks.Task<string?> PickOrTakeAsync(bool takePhoto)
        {
            FileResult? result = takePhoto
                ? await MediaPicker.Default.CapturePhotoAsync()
                : await MediaPicker.Default.PickPhotoAsync();

            if (result == null) return null;

            var ext = Path.GetExtension(result.FileName);
            if (string.IsNullOrWhiteSpace(ext)) ext = ".jpg";

            var fileName = $"recipe_{DateTime.UtcNow:yyyyMMdd_HHmmss}{ext}";
            var destPath = Path.Combine(FileSystem.AppDataDirectory, fileName);

            await using var src = await result.OpenReadAsync();
            await using var dest = File.OpenWrite(destPath);
            await src.CopyToAsync(dest);

            return destPath;
        }

        // ‚úÖ UPDATE par ID (anti-duplicata)
        private static async System.Threading.Tasks.Task UpdateRecetteByIdAsync(
            string supabaseUrl,
            string supabaseKey,
            string accessToken,
            Guid recetteId,
            Guid userId,
            Recette recette)
        {
            supabaseUrl = supabaseUrl.TrimEnd('/');

            var url = $"{supabaseUrl}/rest/v1/recettes?id=eq.{recetteId}";

            using var req = new HttpRequestMessage(HttpMethod.Patch, url);
            req.Headers.Add("apikey", supabaseKey);
            req.Headers.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
            req.Headers.Add("Prefer", "return=representation");

            var payload = new
            {
                owner_user_id = userId,
                external_id = recette.ExternalId,
                nom = recette.Nom,
                categorie = recette.CategorieDb,
                temps_minutes = recette.TempsPreparation,
                note = recette.Difficulte,
                is_favorite = recette.IsFavorite,
                instructions = recette.Instructions,
                photo_url = recette.PhotoUrl
            };

            req.Content = new StringContent(JsonSerializer.Serialize(payload), Encoding.UTF8, "application/json");

            using var res = await _http.SendAsync(req);
            var body = await res.Content.ReadAsStringAsync();

            if (!res.IsSuccessStatusCode)
                throw new Exception($"Update recette failed ({(int)res.StatusCode}): {body}");
        }

        // ---------- SAVE ----------
        private async void OnSaveClicked(object sender, EventArgs e)
        {
            try
            {
                var app = (App)Application.Current;

                if (app.CurrentUserId == null || app.RecipesService == null)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_LoginRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (app.RecetteIngredientsService == null)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ServiceNotReady"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NameRequired"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var userId = app.CurrentUserId.Value;
                var categorie = (CategoriePicker.SelectedItem as string) ?? "Plat";
                int temps = int.TryParse(TempsEntry.Text, out var t) ? t : 0;

                bool isEdit = (_editingRecette != null && _editingRecette.Id != Guid.Empty);

                var recette = _editingRecette ?? new Recette();

                // ‚úÖ ExternalId stable : seulement si nouveau
                if (string.IsNullOrWhiteSpace(recette.ExternalId))
                    recette.ExternalId = Guid.NewGuid().ToString("N");

                // ‚úÖ owner
                recette.OwnerUserId = userId;

                // ‚úÖ champs
                recette.Nom = NomEntry.Text.Trim();
                recette.CategorieDb = categorie;
                recette.TempsPreparation = temps;
                recette.Difficulte = 1;
                recette.Instructions = InstructionsEditor.Text ?? "";
                recette.IsFavorite = false;

                // photo locale
                recette.PhotoLocalPath = _photoLocalPath;

                // 1) Save recette (anti-duplicata)
                if (isEdit)
                {
                    if (string.IsNullOrWhiteSpace(app.CurrentAccessToken))
                    {
                        await DisplayAlert("Erreur", "Session invalide, reconnecte-toi.", "OK");
                        return;
                    }

                    recette.Id = _editingRecette!.Id;

                    await UpdateRecetteByIdAsync(
                        ConfigurationHelper.GetSupabaseUrl(),
                        ConfigurationHelper.GetSupabaseKey(),
                        app.CurrentAccessToken!,
                        recette.Id,
                        userId,
                        recette);
                }
                else
                {
                    // CREATE via upsert(external_id)
                    await app.RecipesService.UpsertRecetteAsync(userId, recette);
                }

                // 2) R√©cup√©rer l'ID DB
                Guid recetteId;
                if (isEdit)
                {
                    recetteId = _editingRecette!.Id;
                }
                else
                {
                    // ‚úÖ ta signature actuelle: (Guid userId, string externalId)
                    var rid = await app.RecipesService.GetRecetteIdByExternalIdAsync(userId, recette.ExternalId!);

                    if (rid == null)
                    {
                        await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                            LocalizationResourceManager.Instance["Recipes_Add_IdNotFound"],
                            LocalizationResourceManager.Instance["Dialog_Ok"]);
                        return;
                    }

                    recetteId = rid.Value;
                }

                // stabiliser
                recette.Id = recetteId;
                if (_editingRecette != null) _editingRecette.Id = recetteId;

                // 3) Upload photo + UPDATE photo_url (jamais upsert ici)
                if (!string.IsNullOrWhiteSpace(_photoLocalPath) && File.Exists(_photoLocalPath))
                {
                    if (string.IsNullOrWhiteSpace(app.CurrentAccessToken))
                    {
                        await DisplayAlert("Erreur", "Session invalide, reconnecte-toi.", "OK");
                        return;
                    }

                    var url = await _storage.UploadRecipePhotoAndGetPublicUrlAsync(
                        app.CurrentAccessToken!, userId, recetteId, _photoLocalPath);

                    recette.PhotoUrl = url;

                    await UpdateRecetteByIdAsync(
                        ConfigurationHelper.GetSupabaseUrl(),
                        ConfigurationHelper.GetSupabaseKey(),
                        app.CurrentAccessToken!,
                        recetteId,
                        userId,
                        recette);
                }

                // 4) Ingr√©dients (NORMALIS√âS)
                var items = ParseIngredientsEditorNormalized(IngredientsEditor.Text);

                await app.RecetteIngredientsService.ReplaceForRecetteAsync(recetteId, items);

                await DisplayAlert(LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_Saved"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]);

                await Navigation.PopAsync();
            }
            catch (Exception ex)
            {
                Debug.WriteLine(ex.ToString());
                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], ex.Message, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        // ---------- INGREDIENTS PARSER (NORMALIS√â) ----------
        private static List<(string nom, string? quantite, string? unite)> ParseIngredientsEditorNormalized(string? text)
        {
            text ??= "";

            return text
                .Replace("\r\n", "\n")
                .Replace("\r", "\n")
                .Split('\n', StringSplitOptions.RemoveEmptyEntries)
                .Select(l => l.Trim())
                .Where(l => !string.IsNullOrWhiteSpace(l))
                .Select(ParseIngredientLineNormalized)
                .Where(x => !string.IsNullOrWhiteSpace(x.nom))
                .ToList();
        }

        private static (string nom, string? quantite, string? unite) ParseIngredientLineNormalized(string line)
        {
            // "Nom - Quantite Unite"
            var dashSplit = line.Split(" - ", StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
            if (dashSplit.Length >= 2)
            {
                var nomPart = IngredientNormalizer.Normalize(dashSplit[0]); // ‚úÖ normalize
                var qtePart = dashSplit[1];

                var parts = qtePart.Split(' ', StringSplitOptions.RemoveEmptyEntries);
                if (parts.Length >= 2)
                    return (nomPart, parts[0], string.Join(" ", parts.Skip(1)));

                return (nomPart, qtePart, null);
            }

            // "200 g Farine"
            var tokens = line.Split(' ', StringSplitOptions.RemoveEmptyEntries);
            if (tokens.Length >= 3 && char.IsDigit(tokens[0][0]))
            {
                var quantite = tokens[0];
                var unite = tokens[1];
                var nom = IngredientNormalizer.Normalize(string.Join(" ", tokens.Skip(2))); // ‚úÖ normalize
                return (nom, quantite, unite);
            }

            // Sinon : juste le nom
            return (IngredientNormalizer.Normalize(line), null, null); // ‚úÖ normalize
        }

        // ---------- OCR ----------
        private async void OnScanClicked(object sender, EventArgs e)
        {
            try
            {
                var status = await Permissions.CheckStatusAsync<Permissions.Camera>();
                if (status != PermissionStatus.Granted)
                    status = await Permissions.RequestAsync<Permissions.Camera>();

                if (status != PermissionStatus.Granted)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["PermissionTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CameraPermission"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                if (!MediaPicker.Default.IsCaptureSupported)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_CaptureNotSupported"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var photo = await MediaPicker.Default.CapturePhotoAsync(new MediaPickerOptions
                {
                    Title = LocalizationResourceManager.Instance["Recipes_Add_ScanTitle"]
                });

                if (photo == null)
                    return;

                byte[] bytes;
                using (var stream = await photo.OpenReadAsync())
                using (var ms = new MemoryStream())
                {
                    await stream.CopyToAsync(ms);
                    bytes = ms.ToArray();
                }

                bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1600, jpegQuality: 75);
                if (bytes.Length > 1024 * 1024)
                    bytes = ImageCompressionHelper.CompressJpeg(bytes, maxWidth: 1200, jpegQuality: 65);

                if (bytes.Length > 1024 * 1024)
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                var ocrKey = ConfigurationHelper.GetOcrApiKey();
                var ocr = new OcrService(ocrKey);

                var fullText = await ocr.ExtractTextFromImageAsync(bytes, photo.FileName);
                if (string.IsNullOrWhiteSpace(fullText))
                {
                    await DisplayAlert(LocalizationResourceManager.Instance["OcrTitle"],
                        LocalizationResourceManager.Instance["Recipes_Add_NoTextDetected"],
                        LocalizationResourceManager.Instance["Dialog_Ok"]);
                    return;
                }

                fullText = NormalizeOcrText(fullText);
                var (ingredients, instructions) = SplitRecipeText(fullText);

                if (!string.IsNullOrWhiteSpace(instructions))
                    InstructionsEditor.Text = instructions.Trim();

                if (!string.IsNullOrWhiteSpace(ingredients))
                    IngredientsEditor.Text = ingredients.Trim();

                if (string.IsNullOrWhiteSpace(NomEntry.Text))
                {
                    var title = GuessTitle(fullText);
                    if (!string.IsNullOrWhiteSpace(title))
                        NomEntry.Text = title;
                }

                await DisplayAlert(LocalizationResourceManager.Instance["SuccessTitle"],
                    LocalizationResourceManager.Instance["Recipes_Add_OcrSuccess"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
            catch (Exception ex)
            {
                var msg = ex.Message ?? LocalizationResourceManager.Instance["UnknownError"];

                if (msg.Contains("File failed validation", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("maximum permissible file size", StringComparison.OrdinalIgnoreCase) ||
                    msg.Contains("1024kb", StringComparison.OrdinalIgnoreCase))
                {
                    msg = LocalizationResourceManager.Instance["Recipes_Add_ImageTooLarge"];
                }

                await DisplayAlert(LocalizationResourceManager.Instance["ErrorTitle"], msg, LocalizationResourceManager.Instance["Dialog_Ok"]);
            }
        }

        // ---------- OCR HELPERS ----------
        private static string NormalizeOcrText(string s)
        {
            s = s.Replace("\r\n", "\n").Replace("\r", "\n");
            while (s.Contains("\n\n\n")) s = s.Replace("\n\n\n", "\n\n");
            return s.Trim();
        }

        private static (string ingredients, string instructions) SplitRecipeText(string text)
        {
            var lower = text.ToLowerInvariant();

            int idxIng = IndexOfAny(lower, "ingr√©dients", "ingredients");
            int idxPrep = IndexOfAny(lower, "pr√©paration", "preparation", "instructions", "r√©alisation", "realisation", "√©tapes", "etapes");

            if (idxIng >= 0 && idxPrep > idxIng)
            {
                var ingPart = text.Substring(idxIng, idxPrep - idxIng);
                var prepPart = text.Substring(idxPrep);

                ingPart = RemoveHeaderLine(ingPart);
                prepPart = RemoveHeaderLine(prepPart);

                return (CleanupListLike(ingPart), CleanupParagraph(prepPart));
            }

            if (idxPrep >= 0)
            {
                var before = text.Substring(0, idxPrep);
                var after = text.Substring(idxPrep);

                after = RemoveHeaderLine(after);
                return (CleanupListLike(before), CleanupParagraph(after));
            }

            var lines = text.Split('\n').Select(l => l.Trim()).Where(l => l.Length > 0).ToList();

            var ingLines = new List<string>();
            var instrLines = new List<string>();

            bool inInstructions = false;
            foreach (var line in lines)
            {
                if (!inInstructions && LooksLikeStep(line))
                    inInstructions = true;

                if (!inInstructions && LooksLikeIngredientLine(line))
                    ingLines.Add(line);
                else
                    instrLines.Add(line);
            }

            return (string.Join("\n", ingLines), string.Join("\n", instrLines));
        }

        private static int IndexOfAny(string haystack, params string[] needles)
        {
            int best = -1;
            foreach (var n in needles)
            {
                var i = haystack.IndexOf(n, StringComparison.OrdinalIgnoreCase);
                if (i >= 0 && (best < 0 || i < best)) best = i;
            }
            return best;
        }

        private static string RemoveHeaderLine(string block)
        {
            var lines = block.Replace("\r\n", "\n").Split('\n').ToList();
            if (lines.Count == 0) return block;
            lines.RemoveAt(0);
            return string.Join("\n", lines).Trim();
        }

        private static string CleanupListLike(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0)
                .Select(l => l.TrimStart('-', '‚Ä¢', '*', '‚Äì', '‚Äî', '¬∑', ' '))
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static string CleanupParagraph(string s)
        {
            var lines = s.Replace("\r\n", "\n").Split('\n')
                .Select(l => l.Trim())
                .Where(l => l.Length > 0);

            return string.Join("\n", lines);
        }

        private static bool LooksLikeIngredientLine(string line)
        {
            if (line.StartsWith("-") || line.StartsWith("‚Ä¢") || line.StartsWith("*")) return true;

            var l = line.ToLowerInvariant();
            string[] units = { " g", "kg", " ml", "cl", " l", "c√†s", "cas", "c√†c", "cac", "cuill√®re", "pinc√©e", "tranche", "sachet" };
            if (units.Any(u => l.Contains(u))) return true;

            if (char.IsDigit(line.FirstOrDefault())) return true;

            return false;
        }

        private static bool LooksLikeStep(string line)
        {
            var l = line.Trim();
            if (l.StartsWith("1)") || l.StartsWith("1.") ||
                l.StartsWith("√âtape", StringComparison.OrdinalIgnoreCase) ||
                l.StartsWith("Etape", StringComparison.OrdinalIgnoreCase))
                return true;

            if (l.Length >= 2 && char.IsDigit(l[0]) && (l[1] == ')' || l[1] == '.'))
                return true;

            return false;
        }

        private static string GuessTitle(string text)
        {
            var first = text.Split('\n').Select(l => l.Trim()).FirstOrDefault(l => l.Length > 0) ?? "";
            if (first.Length >= 3 && first.Length <= 50) return first;
            return "";
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\ListeCoursesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ListeCoursesPage"
             Title="{tr:Translate Shopping_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:BoolToStrikethroughConverter x:Key="BoolToStrikethroughConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Checkbox Tout s√©lectionner -->
            <RowDefinition Height="*"/>
            <!-- Liste -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Label Grid.Row="0"
               Text="{tr:Translate Shopping_Header}"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10,0,10"/>

        <!-- Buttons -->
        <Grid Grid.Row="1" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Shopping_AddItem}"
                    BackgroundColor="#27AE60"
                    FontAttributes="Bold"
                    Clicked="BtnAjouter_Clicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelection"
                    Text="{tr:Translate Shopping_DeleteSelection}"
                    BackgroundColor="#E67E22"
                    FontAttributes="Bold"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="2"
                               Spacing="10"
                               Padding="4,6"
                               VerticalOptions="Center">
            <CheckBox x:Name="ChkToutSelectionner"
                      CheckedChanged="ChkToutSelectionner_CheckedChanged"/>
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray"/>
        </HorizontalStackLayout>

        <!-- Liste des courses -->
        <CollectionView Grid.Row="3"
                        x:Name="ListeCourses"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Shopping_Empty}"
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Margin="6"
                           Padding="14"
                           BorderColor="#DDDDDD"
                           CornerRadius="12"
                           HasShadow="True"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}">

                        <VerticalStackLayout Spacing="8">

                            <!-- Nom -->
                            <Label Text="{Binding Nom}"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextDecorations="{Binding EstAchete, Converter={StaticResource BoolToStrikethroughConverter}}"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}" />

                            <!-- Quantit√© -->
                            <Label FontSize="14"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Quantite}"/>
                                        <Span Text=" "/>
                                        <Span Text="{Binding Unite}"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>

                            <!-- Actions -->
                            <HorizontalStackLayout Spacing="20">

                                <!-- Achet√© -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstAchete, Mode=TwoWay}"
                                              CheckedChanged="CheckBox_CheckedChanged"/>
                                    <Label Text="{tr:Translate Shopping_Bought}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                                <!-- S√©lection pour suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}"/>
                                    <Label Text="{tr:Translate Shopping_Delete}"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                                </HorizontalStackLayout>

                            </HorizontalStackLayout>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\ListeCoursesPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;
using LoGeCuiMobile.Models;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages
{
    public partial class ListeCoursesPage : ContentPage
    {
        private readonly ObservableCollection<ArticleCourseUi> _articles = new();
        private readonly ListeCoursesSupabaseService _svc;

        private bool _suppressSelectAllEvent;

        public ListeCoursesPage()
        {
            InitializeComponent();

            var app = (App)Application.Current;

            if (app.CurrentUserId == null)
                throw new InvalidOperationException("Utilisateur non connect√©.");

            _svc = app.ListeCoursesSupabaseService
                ?? throw new InvalidOperationException("ListeCoursesSupabaseService non initialis√©.");

            ListeCourses.ItemsSource = _articles;

            ChargerDonnees();
        }

        private Guid? GetActiveListIdOrNull()
        {
            var app = (App)Application.Current;
            if (app.CurrentShoppingListId == null || app.CurrentShoppingListId == Guid.Empty)
                return null;

            return app.CurrentShoppingListId.Value;
        }

        private static ArticleCourse MapToModel(ListeCoursesSupabaseService.ArticleCourseRow row)
        {
            // si ton ArticleCourse.Id est int, on cast.
            // sinon change ArticleCourse.Id en long et supprime checked().
            int idInt = checked((int)row.id);

            return new ArticleCourse
            {
                Id = idInt,
                Nom = row.nom ?? "",
                Quantite = row.quantite,
                Unite = row.unite,
                EstAchete = row.est_achete,
                UserId = row.user_id
            };
        }

        private async void ChargerDonnees()
        {
            try
            {
                if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                {
                    await DisplayAlert("Info", "Pas d'internet : chargement impossible.", "OK");
                    return;
                }

                var app = (App)Application.Current;
                var userId = app.CurrentUserId!.Value;
                var listId = GetActiveListIdOrNull();

                var remote = await _svc.GetArticlesAsync(userId, listId);

                _articles.Clear();
                foreach (var row in remote)
                    _articles.Add(new ArticleCourseUi(MapToModel(row)));

                RefreshSelectAllCheckBox();
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Chargement impossible : {ex.Message}", "OK");
            }
        }

        private async void BtnAjouter_Clicked(object sender, EventArgs e)
        {
            string nom = await DisplayPromptAsync("Ajouter", "Nom de l'article :");
            if (string.IsNullOrWhiteSpace(nom))
                return;

            string quantite = await DisplayPromptAsync("Ajouter", "Quantit√© (optionnel) :");
            string unite = await DisplayPromptAsync("Ajouter", "Unit√© (optionnel) :");

            try
            {
                if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                {
                    await DisplayAlert("Info", "Pas d'internet : ajout impossible.", "OK");
                    return;
                }

                var app = (App)Application.Current;
                var userId = app.CurrentUserId!.Value;
                var listId = GetActiveListIdOrNull();

                var addedRow = await _svc.AddArticleAsync(
                    userId,
                    nom.Trim(),
                    string.IsNullOrWhiteSpace(quantite) ? null : quantite.Trim(),
                    string.IsNullOrWhiteSpace(unite) ? null : unite.Trim(),
                    listId
                );

                if (addedRow != null)
                {
                    _articles.Add(new ArticleCourseUi(MapToModel(addedRow)));
                    RefreshSelectAllCheckBox();
                }
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Impossible d'ajouter : {ex.Message}", "OK");
            }
        }

        private async void CheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (sender is not CheckBox checkbox) return;
            if (checkbox.BindingContext is not ArticleCourseUi articleUi) return;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                await DisplayAlert("Info", "Pas d'internet : mise √† jour impossible.", "OK");
                checkbox.IsChecked = !e.Value;
                return;
            }

            checkbox.IsEnabled = false;
            try
            {
                await _svc.UpdateArticleAsync(articleUi.Id, e.Value);
                articleUi.Model.EstAchete = e.Value;
            }
            catch (Exception ex)
            {
                checkbox.IsChecked = !e.Value;
                articleUi.Model.EstAchete = !e.Value;
                await DisplayAlert("Erreur", $"Synchronisation √©chou√©e : {ex.Message}", "OK");
            }
            finally
            {
                checkbox.IsEnabled = true;
            }
        }

        private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
        {
            var selected = _articles.Where(a => a.IsSelectedForDelete).ToList();

            if (selected.Count == 0)
            {
                await DisplayAlert("Information", "Aucun article s√©lectionn√©.", "OK");
                return;
            }

            bool confirm = await DisplayAlert(
                "Confirmation",
                $"Supprimer {selected.Count} article(s) s√©lectionn√©(s) ?",
                "Oui",
                "Non");

            if (!confirm)
                return;

            try
            {
                if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                {
                    await DisplayAlert("Info", "Pas d'internet : suppression impossible.", "OK");
                    return;
                }

                foreach (var articleUi in selected)
                    _articles.Remove(articleUi);

                RefreshSelectAllCheckBox();

                foreach (var articleUi in selected)
                    await _svc.DeleteArticleAsync(articleUi.Id);
            }
            catch (Exception ex)
            {
                await DisplayAlert("Erreur", $"Suppression impossible : {ex.Message}", "OK");
                ChargerDonnees();
            }
        }

        private void ChkToutSelectionner_CheckedChanged(object sender, CheckedChangedEventArgs e)
        {
            if (_suppressSelectAllEvent) return;

            foreach (var a in _articles)
                a.IsSelectedForDelete = e.Value;
        }

        private void RefreshSelectAllCheckBox()
        {
            if (ChkToutSelectionner == null) return;

            _suppressSelectAllEvent = true;
            try
            {
                if (_articles.Count == 0)
                {
                    ChkToutSelectionner.IsEnabled = false;
                    ChkToutSelectionner.IsChecked = false;
                    return;
                }

                ChkToutSelectionner.IsEnabled = true;
                ChkToutSelectionner.IsChecked = _articles.All(a => a.IsSelectedForDelete);
            }
            finally
            {
                _suppressSelectAllEvent = false;
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\MenuAleatoirePage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.MenuAleatoirePage"
             Title="{tr:Translate RandomMenu_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <Button
                Text="{tr:Translate RandomMenu_GenerateButton}"
                Clicked="OnMenuAleatoireClicked" />

            <Label
                x:Name="ResultLabel"
                Text="{tr:Translate RandomMenu_DefaultText}"
                FontSize="18"
                HorizontalTextAlignment="Center" />

            <!-- Bouton visible uniquement apr√®s g√©n√©ration si ingr√©dients manquants -->
            <Button x:Name="SendMissingButton"
                    Text="{tr:Translate RandomMenu_SendMissingToShopping}"
                    Clicked="OnSendMissingClicked"
                    HorizontalOptions="FillAndExpand"
                    IsVisible="False"
                    IsEnabled="False" />

            <Button
                Text="{tr:Translate RandomMenu_OpenShopping}"
                Clicked="OnOpenListeCoursesClicked"
                HorizontalOptions="FillAndExpand" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\MenuAleatoirePage.xaml.cs
================================================================================

Ôªøusing CommunityToolkit.Maui.Views;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace LoGeCuiMobile.Pages;

public partial class MenuAleatoirePage : ContentPage
{
    private static readonly Random _random = new();
    public record MenuOptionsResult(bool Entree, bool Plat, bool Dessert);


    private List<string> _lastMissing = new();
    private Guid? _lastUserId;
    private bool _lastIngredientsKnown = false;

    public MenuAleatoirePage()
    {
        InitializeComponent();

        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
    }

    // ------------------ UTIL ------------------

    private static string Norm(string s)
    {
        if (string.IsNullOrWhiteSpace(s))
            return "";

        var normalized = s.Trim().ToLowerInvariant().Normalize(NormalizationForm.FormD);
        var sb = new StringBuilder();

        foreach (var c in normalized)
            if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
                sb.Append(c);

        return sb.ToString();
    }

    private sealed class RecetteIngredientRow
    {
        public string? ingredient_nom { get; set; }
    }

    private async Task<List<string>> GetRecetteIngredientsAsync(App app, Guid recetteId)
    {
        if (app.RestClient == null)
            return new List<string>();

        // recette_ingredients(recette_id, ingredient_nom, quantite, unite)
        var q = $"recette_ingredients?select=ingredient_nom&recette_id=eq.{recetteId}";

        var rows = await app.RestClient.GetAsync<List<RecetteIngredientRow>>(q)
                   ?? new List<RecetteIngredientRow>();

        return rows
            .Select(r => r.ingredient_nom ?? "")
            .Select(s => s.Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private async Task<List<string>> GetUserIngredientsAsync(App app, Guid userId)
    {
        if (app.IngredientsService == null)
            return new List<string>();

        var rows = await app.IngredientsService.GetIngredientsAsync(userId)
                   ?? new List<Ingredient>();

        return rows
            .Where(i => i.EstDisponible)
            .Select(i => (i.Nom ?? "").Trim())
            .Where(n => !string.IsNullOrWhiteSpace(n))
            .Distinct(StringComparer.OrdinalIgnoreCase)
            .ToList();
    }

    private static Recette? PickRandom(List<Recette> list)
    {
        if (list == null || list.Count == 0) return null;
        return list[_random.Next(list.Count)];
    }

    // ------------------ EVENTS ------------------

    private async void OnMenuAleatoireClicked(object sender, EventArgs e)
    {
        try
        {
            // Choix initial : on d√©marre tout coch√©
            bool wantEntree = true;
            bool wantPlat = true;
            bool wantDessert = true;

            while (true)
            {
                string entreeTxt = wantEntree ? "‚úÖ Entr√©e" : "‚¨ú Entr√©e";
                string platTxt = wantPlat ? "‚úÖ Plat" : "‚¨ú Plat";
                string dessertTxt = wantDessert ? "‚úÖ Dessert" : "‚¨ú Dessert";

                var choice = await DisplayActionSheet(
                    "Choisis les cat√©gories",
                    "Annuler",
                    "G√©n√©rer",
                    entreeTxt,
                    platTxt,
                    dessertTxt
                );

                if (choice == "Annuler")
                    return;

                if (choice == "G√©n√©rer")
                {
                    if (!wantEntree && !wantPlat && !wantDessert)
                    {
                        await DisplayAlert("Info", "Coche au moins une cat√©gorie.", "OK");
                        continue;
                    }

                    var opts = new MenuOptionsResult(wantEntree, wantPlat, wantDessert);
                    await RunMenuAleatoireAsync(opts);
                    return;
                }

                if (choice == entreeTxt) wantEntree = !wantEntree;
                else if (choice == platTxt) wantPlat = !wantPlat;
                else if (choice == dessertTxt) wantDessert = !wantDessert;
            }
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }



    private async void OnOpenListeCoursesClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;
            if (app?.ListeCoursesSupabaseService == null)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["ServiceUnavailable"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            await Shell.Current.GoToAsync(nameof(ListeCoursesPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    private async void OnSendMissingClicked(object sender, EventArgs e)
    {
        try
        {
            var app = Application.Current as App;

            if (app?.ListeCoursesSupabaseService == null || app.CurrentUserId == null)
                return;

            if (!_lastIngredientsKnown || _lastMissing.Count == 0)
                return;

            // ‚úÖ list_id obligatoire dans articles_courses
            var listId = app.CurrentShoppingListId;
            if (listId == null || listId.Value == Guid.Empty)
            {
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    "Aucune liste active. Cr√©e ou rejoins une liste avant d'envoyer les ingr√©dients.",
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                );
                return;
            }

            bool confirm = await DisplayAlert(
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmTitle"],
                LocalizationResourceManager.Instance["RandomMenu_SendConfirmBody"] + "\n- " + string.Join("\n- ", _lastMissing),
                LocalizationResourceManager.Instance["Dialog_Yes"],
                LocalizationResourceManager.Instance["Dialog_No"]
            );

            if (!confirm)
                return;

            await app.ListeCoursesSupabaseService.AddMissingAsync(
                app.CurrentUserId.Value,
                _lastMissing,
                listId.Value); // ‚úÖ on passe list_id

            SendMissingButton.IsEnabled = false;
            SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SentButton"];
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }


    private Guid? GetActiveListIdOrNull()
    {
        var app = (App)Application.Current;
        if (app.CurrentShoppingListId == null || app.CurrentShoppingListId == Guid.Empty)
            return null;

        return app.CurrentShoppingListId.Value;
    }

    // ------------------ LOGIQUE ------------------

    private async Task RunMenuAleatoireAsync(MenuOptionsResult opts)
    {
        var app = Application.Current as App;
        if (app == null)
            return;

        // Reset UI
        SendMissingButton.IsVisible = false;
        SendMissingButton.IsEnabled = false;
        SendMissingButton.Text = LocalizationResourceManager.Instance["RandomMenu_SendMissingToShopping"];
        _lastMissing = new List<string>();
        _lastIngredientsKnown = false;
        _lastUserId = app.CurrentUserId;

        if (app.CurrentUserId == null ||
            app.RestClient == null ||
            app.RecipesService == null ||
            app.IngredientsService == null ||
            app.ListeCoursesSupabaseService == null)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["LoginRequired"];
            return;
        }

        var userId = app.CurrentUserId.Value;
        ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_Generating"];

        // 1) Recettes utilisateur
        // (tu utilises GetMyRecettesAsync dans ton code : je le garde)
        var recettes = await app.RecipesService.GetMyRecettesAsync(app.CurrentUserId!.Value, null);



        if (recettes == null || recettes.Count == 0)
        {
            ResultLabel.Text = LocalizationResourceManager.Instance["RandomMenu_NoRecipes"];
            return;
        }

        // 2) Listes par type (si l'option est coch√©e)
        var entrees = opts.Entree ? recettes.Where(r => r.Type == TypePlat.Entree).ToList() : new List<Recette>();
        var plats = opts.Plat ? recettes.Where(r => r.Type == TypePlat.Plat).ToList() : new List<Recette>();
        var desserts = opts.Dessert ? recettes.Where(r => r.Type == TypePlat.Dessert).ToList() : new List<Recette>();

        // 3) Tirage (uniquement si demand√©)
        var entree = opts.Entree ? PickRandom(entrees) : null;
        var plat = opts.Plat ? PickRandom(plats) : null;
        var dessert = opts.Dessert ? PickRandom(desserts) : null;

        // Si une cat√©gorie coch√©e n'a aucune recette
        if ((opts.Entree && entree == null) || (opts.Plat && plat == null) || (opts.Dessert && dessert == null))
        {
            var sbErr = new StringBuilder();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotGenerate"]);
            sbErr.AppendLine();

            if (opts.Entree && entree == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Entr√©e");
            if (opts.Plat && plat == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Plat");
            if (opts.Dessert && dessert == null) sbErr.AppendLine("‚Ä¢ Aucune recette de type Dessert");

            sbErr.AppendLine();
            sbErr.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CheckCategories"]);

            ResultLabel.Text = sbErr.ToString();
            return;
        }

        // 4) Ingr√©dients utilisateur disponibles
        var userIngredients = await GetUserIngredientsAsync(app, userId);
        var userSet = userIngredients
            .Select(Norm)
            .Where(x => !string.IsNullOrWhiteSpace(x))
            .ToHashSet();

        // 5) Analyse d'une recette
        async Task<(List<string> ingredients, List<string> missing, bool hasData)> AnalyzeAsync(Recette r)
        {
            var ingredients = await GetRecetteIngredientsAsync(app, r.Id);
            var distinct = ingredients
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (distinct.Count == 0)
                return (distinct, new List<string>(), false);

            var missing = distinct
                .Where(i => !userSet.Contains(Norm(i)))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            return (distinct, missing, true);
        }

        // 6) Analyse seulement des recettes r√©ellement tir√©es
        var chosen = new List<Recette>();
        if (entree != null) chosen.Add(entree);
        if (plat != null) chosen.Add(plat);
        if (dessert != null) chosen.Add(dessert);

        var analyses = new Dictionary<Guid, (List<string> ingredients, List<string> missing, bool hasData)>();
        foreach (var r in chosen)
            analyses[r.Id] = await AnalyzeAsync(r);

        // 7) Agr√©gation manquants (uniquement si on a des donn√©es pour toutes les recettes choisies)
        var allHaveData = chosen.All(r => analyses[r.Id].hasData);

        if (allHaveData)
        {
            _lastMissing = chosen
                .SelectMany(r => analyses[r.Id].missing)
                .Where(s => !string.IsNullOrWhiteSpace(s))
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            _lastIngredientsKnown = true;
        }
        else
        {
            _lastMissing = new List<string>();
            _lastIngredientsKnown = false;
        }

        // 8) UI texte
        var sb = new StringBuilder();

        sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GeneratedHeader"]);

        if (entree != null) sb.AppendLine($"- {entree.TypeTexte} : {entree.Nom}");
        if (plat != null) sb.AppendLine($"- {plat.TypeTexte} : {plat.Nom}");
        if (dessert != null) sb.AppendLine($"- {dessert.TypeTexte} : {dessert.Nom}");
        sb.AppendLine();

        void AppendRecetteBlock(Recette r)
        {
            var a = analyses[r.Id];

            sb.AppendLine($"{r.TypeTexte} ‚Äî {r.Nom}");

            if (!a.hasData)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_NoIngredientsForRecipe"]);
                sb.AppendLine();
                return;
            }

            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_IngredientsHeader"]);
            foreach (var i in a.ingredients)
                sb.AppendLine("- " + i);

            if (a.missing.Count == 0)
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingNone"]);
            }
            else
            {
                sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_MissingHeader"]);
                foreach (var m in a.missing)
                    sb.AppendLine("- " + m);
            }

            sb.AppendLine();
        }

        foreach (var r in chosen)
            AppendRecetteBlock(r);

        // 9) Bouton ‚Äúenvoyer manquants‚Äù
        if (!allHaveData)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_CannotComputeMissing"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else if (_lastMissing.Count == 0)
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_AllAvailable"]);
            SendMissingButton.IsVisible = false;
            SendMissingButton.IsEnabled = false;
        }
        else
        {
            sb.AppendLine(LocalizationResourceManager.Instance["RandomMenu_GlobalMissingHeader"]);
            foreach (var m in _lastMissing)
                sb.AppendLine("- " + m);

            SendMissingButton.IsVisible = true;
            SendMissingButton.IsEnabled = true;
        }

        ResultLabel.Text = sb.ToString();
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\MesIngredientsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:conv="clr-namespace:LoGeCuiMobile.Converters"
    x:Class="LoGeCuiMobile.Pages.MesIngredientsPage"
    Title="{tr:Translate Ingredients_Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:QuantityFormatConverter x:Key="QuantityFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="16" RowDefinitions="Auto,Auto,*" RowSpacing="12">

        <!-- Boutons -->
        <Grid Grid.Row="0" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{tr:Translate Ingredients_AddButton}"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    Clicked="OnAddIngredientClicked" />

            <Button Grid.Column="1"
                    x:Name="BtnSupprimerSelectionIngredients"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="OnDeleteSelectedIngredientsClicked" />
        </Grid>

        <!-- Checkbox Tout s√©lectionner -->
        <HorizontalStackLayout Grid.Row="1" Spacing="10" Padding="4,0">
            <CheckBox x:Name="ChkToutSelectionnerIngredients"
                      CheckedChanged="ChkToutSelectionnerIngredients_CheckedChanged" />
            <Label Text="Tout s√©lectionner"
                   VerticalTextAlignment="Center"
                   TextColor="Gray" />
        </HorizontalStackLayout>

        <!-- Liste -->
        <CollectionView Grid.Row="2"
                        x:Name="IngredientsCollection"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="Aucun ingr√©dient."
                       HorizontalOptions="Center"
                       Margin="0,20,0,0"
                       TextColor="Gray"/>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="12"
                           Margin="0,4"
                           BorderColor="#ddd"
                           CornerRadius="10">

                        <Grid ColumnDefinitions="*,Auto">

                            <VerticalStackLayout Spacing="6">

                                <Label Text="{Binding Nom}"
                                       FontSize="18"
                                       FontAttributes="Bold" />

                                <Label FontSize="14" TextColor="Gray">
                                    <Label.Text>
                                        <MultiBinding Converter="{StaticResource QuantityFormatConverter}">
                                            <Binding Path="Quantite"/>
                                            <Binding Path="Unite"/>
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>

                                <!-- Disponible -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding EstDisponible}"
                                                CheckedChanged="OnDisponibleChanged" />
                                    <Label Text="{tr:Translate Ingredients_Available}"
                                           VerticalTextAlignment="Center"/>
                                </HorizontalStackLayout>

                                <!-- S√©lection suppression -->
                                <HorizontalStackLayout Spacing="6">
                                    <CheckBox IsChecked="{Binding IsSelectedForDelete}" />
                                    <Label Text="Supprimer"
                                           VerticalTextAlignment="Center"
                                           TextColor="Gray"/>
                                </HorizontalStackLayout>

                            </VerticalStackLayout>

                            <!-- Supprimer item -->
                            <Button Grid.Column="1"
                                    Text="üóë"
                                    BackgroundColor="#e74c3c"
                                    Clicked="OnDeleteIngredientClicked" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
    </Grid>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\MesIngredientsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.ObjectModel;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Models;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Models;
using Microsoft.Maui.Networking;


namespace LoGeCuiMobile.Pages;

public partial class MesIngredientsPage : ContentPage
{
    private readonly ObservableCollection<IngredientUi> _ingredients = new();

    private bool _isLoading;
    private bool _suppressSelectAllEvent;

    public MesIngredientsPage()
    {
        InitializeComponent();
        IngredientsCollection.ItemsSource = _ingredients;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();
        await LoadIngredientsAsync();
    }

    private async Task LoadIngredientsAsync()
    {
        if (_isLoading) return;

        try
        {
            _isLoading = true;

            // 0) Toujours tenter d'afficher le cache local en premier (offline-friendly)
            var local = await App.LocalDb.GetIngredientsAsync();
            _ingredients.Clear();
            foreach (var li in local)
                _ingredients.Add(new IngredientUi(li.ToModel()));

            RefreshSelectAllCheckBox();

            // 1) Si pas connect√© (session) -> on s'arr√™te apr√®s le cache
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            // 2) Si pas internet -> on s'arr√™te apr√®s le cache
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return;

            var userId = app.CurrentUserId.Value;

            // 3) Refresh depuis Supabase
            var remote = await app.IngredientsService.GetIngredientsAsync(userId);

            // 4) Mettre √† jour l'UI avec remote
            _ingredients.Clear();
            foreach (var ing in remote)
                _ingredients.Add(new IngredientUi(ing));

            // 5) Sauver remote dans SQLite
            await App.LocalDb.SaveIngredientsAsync(remote);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        finally
        {
            _isLoading = false;
        }
    }


    private async void OnAddIngredientClicked(object sender, EventArgs e)
    {
        try
        {
            await Shell.Current.GoToAsync(nameof(AjouterIngredientPage));
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
    }

    // Suppression d'un seul ingr√©dient via l'ic√¥ne üóë
    private async void OnDeleteIngredientClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        if (sender is not Button btn || btn.BindingContext is not IngredientUi ingredientUi)
            return;

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"{LocalizationResourceManager.Instance["Dialog_DeleteConfirm"]}\n{ingredientUi.Nom}",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            _ingredients.Remove(ingredientUi);

            if (ingredientUi.Id != Guid.Empty)
                await app.IngredientsService.DeleteIngredientAsync(ingredientUi.Id);

            RefreshSelectAllCheckBox();
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Checkbox "Tout s√©lectionner" (s√©lection suppression)
    private void ChkToutSelectionnerIngredients_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_suppressSelectAllEvent) return;

        foreach (var ing in _ingredients)
            ing.IsSelectedForDelete = e.Value;
    }

    private void RefreshSelectAllCheckBox()
    {
        if (ChkToutSelectionnerIngredients == null) return;

        _suppressSelectAllEvent = true;
        try
        {
            if (_ingredients.Count == 0)
            {
                ChkToutSelectionnerIngredients.IsEnabled = false;
                ChkToutSelectionnerIngredients.IsChecked = false;
                return;
            }

            ChkToutSelectionnerIngredients.IsEnabled = true;
            ChkToutSelectionnerIngredients.IsChecked = _ingredients.All(i => i.IsSelectedForDelete);
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    // Supprimer s√©lection
    private async void OnDeleteSelectedIngredientsClicked(object sender, EventArgs e)
    {
        if (_isLoading) return;

        var selected = _ingredients.Where(i => i.IsSelectedForDelete).ToList();

        if (selected.Count == 0)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                "Aucun ingr√©dient s√©lectionn√©.",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var ok = await DisplayAlert(
            LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
            $"Supprimer {selected.Count} ingr√©dient(s) s√©lectionn√©(s) ?",
            LocalizationResourceManager.Instance["Dialog_Yes"],
            LocalizationResourceManager.Instance["Dialog_No"]
        );

        if (!ok) return;

        try
        {
            _isLoading = true;

            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null || app.CurrentUserId == null)
                return;

            foreach (var ingUi in selected)
            {
                if (ingUi.Id != Guid.Empty)
                    await app.IngredientsService.DeleteIngredientAsync(ingUi.Id);

                _ingredients.Remove(ingUi);
            }

            RefreshSelectAllCheckBox();

            await DisplayAlert(
                LocalizationResourceManager.Instance["Ingredients_DialogTitle"],
                $"{selected.Count} ingr√©dient(s) supprim√©(s).",
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
        }
        catch (Exception ex)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                ex.Message,
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await LoadIngredientsAsync();
        }
        finally
        {
            _isLoading = false;
        }
    }

    // Mise √† jour "Disponible" -> synchro Supabase (si tu as une m√©thode UpdateIngredientAsync)
    private async void OnDisponibleChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_isLoading) return;

        if (sender is not CheckBox cb || cb.BindingContext is not IngredientUi ingUi)
            return;

        try
        {
            if (Application.Current is not App app || !app.IsConnected || app.IngredientsService == null)
                return;

            // Ici il faut une m√©thode d'update dans IngredientsService.
            // Si tu l'as d√©j√† : await app.IngredientsService.UpdateIngredientAsync(ingUi.Model.Id, ingUi.Model);
            // Sinon : on ne fait rien (l'UI reste locale). Dis-moi et je te donne l'impl√©mentation c√¥t√© service.
        }
        catch
        {
            // Optionnel : rollback si update √©choue
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\MesRecettesPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="LoGeCuiMobile.Pages.MesRecettesPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
    xmlns:vm="clr-namespace:LoGeCuiMobile.ViewModels"
    Title="{tr:Translate Recipes_Title}">

    <Grid Padding="12" RowDefinitions="Auto,Auto,*" RowSpacing="10">

        <!-- ====== FILTRES + ACTIONS HAUT ====== -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">

            <Picker Title="{tr:Translate Recipes_Category}"
                    ItemsSource="{Binding Categories}"
                    SelectedItem="{Binding SelectedCategorie}" />

            <HorizontalStackLayout Spacing="10">
                <Button Text="{tr:Translate Recipes_Refresh}"
                        Command="{Binding RefreshCommand}"
                        HorizontalOptions="StartAndExpand" />

                <Button Text="{tr:Translate Recipes_Add}"
                        Clicked="OnAjouterRecetteClicked"
                        HorizontalOptions="EndAndExpand" />
            </HorizontalStackLayout>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}" />

        </VerticalStackLayout>

        <!-- ====== LIGNE S√âLECTION MULTIPLE ====== -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" VerticalOptions="Center">

            <HorizontalStackLayout Grid.Column="0" Spacing="8" VerticalOptions="Center">
                <CheckBox x:Name="ChkToutSelectionnerRecettes"
                          CheckedChanged="ChkToutSelectionnerRecettes_CheckedChanged"/>
                <Label Text="Tout s√©lectionner"
                       VerticalTextAlignment="Center"
                       TextColor="Gray"/>
            </HorizontalStackLayout>

            <Label Grid.Column="1"
                   x:Name="SelectionInfoLabel"
                   Text=""
                   TextColor="Gray"
                   VerticalTextAlignment="Center"/>

            <Button Grid.Column="2"
                    x:Name="BtnSupprimerSelection"
                    Text="Supprimer s√©lection"
                    BackgroundColor="#E67E22"
                    TextColor="White"
                    Clicked="BtnSupprimerSelection_Clicked"/>
        </Grid>

        <!-- ====== LISTE DES RECETTES ====== -->
        <CollectionView Grid.Row="2"
                        x:Name="RecettesCollection"
                        ItemsSource="{Binding Recettes}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="{tr:Translate Recipes_Empty}"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"
                       Margin="0,30,0,0" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10"
                           Margin="0,6"
                           HasShadow="False">

                        <!-- üî¥üü¢ Couleur bordure selon disponibilit√© -->
                        <Frame.Triggers>
                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Unknown}">
                                <Setter Property="BorderColor" Value="#B0B0B0"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.AllAvailable}">
                                <Setter Property="BorderColor" Value="#27AE60"/>
                            </DataTrigger>

                            <DataTrigger TargetType="Frame"
                                         Binding="{Binding AvailabilityState}"
                                         Value="{x:Static vm:AvailabilityState.Missing}">
                                <Setter Property="BorderColor" Value="#E74C3C"/>
                            </DataTrigger>
                        </Frame.Triggers>

                        <!-- ‚úÖ Ajout d'une colonne pour la photo -->
                        <Grid ColumnDefinitions="Auto,Auto,*,Auto"
                              RowDefinitions="Auto,Auto"
                              ColumnSpacing="10">

                            <!-- Checkbox suppression multiple -->
                            <CheckBox Grid.Column="0"
                                      Grid.RowSpan="2"
                                      IsChecked="{Binding IsSelectedForDelete}"
                                      CheckedChanged="RecetteDeleteCheckBox_CheckedChanged"
                                      VerticalOptions="Center" />

                            <!-- ‚úÖ Photo miniature -->
                            <Frame Grid.Column="1"
                                       Grid.RowSpan="2"
                                       WidthRequest="44"
                                       HeightRequest="44"
                                       CornerRadius="22"
                                       Padding="0"
                                       HasShadow="False"
                                       IsClippedToBounds="True"
                                       BorderColor="#DDDDDD"
                                       BackgroundColor="#F2F2F2"
                                       VerticalOptions="Center"
                                       IsVisible="{Binding HasPhoto}">
                                                                <Image Source="{Binding PhotoSource}"
                                           WidthRequest="44"
                                           HeightRequest="44"
                                           Aspect="AspectFill" />
                            </Frame>

                            <!-- Zone infos recette (tap = d√©tails) -->
                            <Grid Grid.Column="2" Grid.RowSpan="2">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRecetteTapped"
                                                          CommandParameter="{Binding Model}" />
                                </Grid.GestureRecognizers>

                                <VerticalStackLayout Spacing="4">

                                    <Label Text="{Binding Nom}"
                                           FontSize="18"
                                           FontAttributes="Bold" />

                                    <Label Text="{Binding TypeTexte}" />

                                    <Label Text="{Binding TempsPreparation, StringFormat='{tr:Translate Recipes_TimeFormat}'}" />

                                    <Label Text="{Binding DifficulteTexte}" />

                                    <Label Text="{Binding AvailabilityLabel}"
                                           FontSize="12"
                                           TextColor="Gray"/>

                                </VerticalStackLayout>
                            </Grid>

                            <!-- Boutons actions -->
                            <HorizontalStackLayout Grid.Column="3" Grid.RowSpan="2"
                                                   Spacing="8"
                                                   VerticalOptions="Center">

                                <Button Text="üõí"
                                        BackgroundColor="#3498DB"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnAjouterManquants_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <Button Text="üóë"
                                        BackgroundColor="#e74c3c"
                                        TextColor="White"
                                        Padding="8"
                                        Clicked="BtnSupprimerRecette_Clicked"
                                        CommandParameter="{Binding .}"/>

                                <Button Text="‚úèÔ∏è"
                                        BackgroundColor="#F1C40F"
                                        TextColor="Black"
                                        Padding="8"
                                        Clicked="BtnModifierRecette_Clicked"
                                        CommandParameter="{Binding Model}"/>

                            </HorizontalStackLayout>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </Grid>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\MesRecettesPage.xaml.cs
================================================================================

Ôªøusing System.Linq;
using LoGeCuiMobile.Resources.Lang;
using LoGeCuiMobile.ViewModels;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Pages;

public partial class MesRecettesPage : ContentPage
{
    private MesRecettesViewModel? _vm;
    private bool _suppressSelectAllEvent;

    public MesRecettesPage()
    {
        InitializeComponent();

        var app = (App)Application.Current;

        if (app.RecipesService == null)
        {
            MainThread.BeginInvokeOnMainThread(async () =>
                await DisplayAlert(
                    LocalizationResourceManager.Instance["ErrorTitle"],
                    LocalizationResourceManager.Instance["Recipes_ServiceNull"],
                    LocalizationResourceManager.Instance["Dialog_Ok"]
                ));

            return;
        }

        _vm = new MesRecettesViewModel(app.RecipesService);
        BindingContext = _vm;
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        if (_vm == null)
            return;

        // ‚úÖ UN SEUL chargement propre
        await _vm.LoadAsync(forceRemote: true);

        // ‚úÖ Puis recalcul des ingr√©dients dispo ‚Üí bordures vert/rouge
        await _vm.RefreshAvailabilityAsync();

        RefreshSelectionUi();
    }

    private async void OnAjouterRecetteClicked(object sender, EventArgs e)
    {
        await Navigation.PushAsync(new AjouterRecettePage());
    }

    // ---------------- TAP RECETTE ----------------
    private async void OnRecetteTapped(object sender, TappedEventArgs e)
    {
        Recette? recette = e.Parameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null)
            return;

        var app = (App)Application.Current;

        if (app.RecetteIngredientsService == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Recipes_IngredientsServiceNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );
            return;
        }

        var items = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

        var ingredientsText = (items.Count == 0)
            ? LocalizationResourceManager.Instance["Recipes_NoIngredients"]
            : string.Join("\n", items.Select(x =>
                string.IsNullOrWhiteSpace(x.quantite) && string.IsNullOrWhiteSpace(x.unite)
                    ? $"‚Ä¢ {x.nom}"
                    : $"‚Ä¢ {x.quantite} {x.unite} {x.nom}".Replace("  ", " ").Trim()
            ));

        var details = string.Format(
            LocalizationResourceManager.Instance["Recipes_DetailsFormat"],
            recette.CategorieDb,
            recette.TempsPreparation,
            ingredientsText,
            recette.Instructions ?? ""
        );

        await DisplayAlert(recette.Nom, details, LocalizationResourceManager.Instance["Dialog_Ok"]);
    }

    // ---------------- SELECTION MULTIPLE ----------------

    private void ChkToutSelectionnerRecettes_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        if (_vm == null || _suppressSelectAllEvent) return;

        foreach (var r in _vm.Recettes)
            r.IsSelectedForDelete = e.Value;

        RefreshSelectionUi();
    }

    private void RecetteDeleteCheckBox_CheckedChanged(object sender, CheckedChangedEventArgs e)
    {
        RefreshSelectionUi();
    }

    private void RefreshSelectionUi()
    {
        if (_vm == null) return;

        var selectedCount = _vm.Recettes.Count(x => x.IsSelectedForDelete);

        if (SelectionInfoLabel != null)
            SelectionInfoLabel.Text = selectedCount == 0 ? "" : $"{selectedCount} s√©lectionn√©(s)";

        _suppressSelectAllEvent = true;
        try
        {
            if (ChkToutSelectionnerRecettes != null)
            {
                if (_vm.Recettes.Count == 0)
                {
                    ChkToutSelectionnerRecettes.IsEnabled = false;
                    ChkToutSelectionnerRecettes.IsChecked = false;
                }
                else
                {
                    ChkToutSelectionnerRecettes.IsEnabled = true;
                    ChkToutSelectionnerRecettes.IsChecked = _vm.Recettes.All(x => x.IsSelectedForDelete);
                }
            }
        }
        finally
        {
            _suppressSelectAllEvent = false;
        }
    }

    private async void BtnSupprimerSelection_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;

        var selected = _vm.Recettes.Where(r => r.IsSelectedForDelete).ToList();
        if (selected.Count == 0)
        {
            await DisplayAlert("Info", "Aucune recette s√©lectionn√©e.", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer {selected.Count} recette(s) s√©lectionn√©e(s) ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteSelectedAsync(selected);
        RefreshSelectionUi();
    }

    private async void BtnSupprimerRecette_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        bool confirm = await DisplayAlert(
            "Confirmation",
            $"Supprimer '{recetteUi.Nom}' ?",
            "Oui",
            "Non");

        if (!confirm) return;

        await _vm.DeleteOneAsync(recetteUi);
        RefreshSelectionUi();
    }

    // ---------------- MODIFIER ----------------

    private async void BtnModifierRecette_Clicked(object sender, EventArgs e)
    {
        if (sender is not Button btn) return;

        Recette? recette = btn.CommandParameter switch
        {
            Recette r => r,
            RecetteUi ui => ui.Model,
            _ => null
        };

        if (recette == null) return;

        await Navigation.PushAsync(new AjouterRecettePage(recette));
    }

    // ---------------- AJOUTER MANQUANTS ----------------

    private async void BtnAjouterManquants_Clicked(object sender, EventArgs e)
    {
        if (_vm == null) return;
        if (sender is not Button btn) return;

        RecetteUi? recetteUi = btn.CommandParameter switch
        {
            RecetteUi ui => ui,
            Recette r => _vm.Recettes.FirstOrDefault(x => x.Model.Id == r.Id),
            _ => null
        };

        if (recetteUi == null) return;

        var missing = await _vm.GetMissingIngredientsForRecipeAsync(recetteUi.Model);
        if (missing == null)
        {
            await DisplayAlert("Info", "Impossible de calculer les ingr√©dients (offline ou donn√©es manquantes).", "OK");
            return;
        }

        if (missing.Count == 0)
        {
            await DisplayAlert("Info", "Tu as d√©j√† tous les ingr√©dients pour cette recette ‚úÖ", "OK");
            return;
        }

        bool confirm = await DisplayAlert(
            "Ajouter √† la liste",
            "Ajouter ces ingr√©dients manquants ?\n- " + string.Join("\n- ", missing),
            "Oui",
            "Non");

        if (!confirm) return;

        var ok = await _vm.SendMissingToShoppingAsync(missing);

        if (ok)
            await DisplayAlert("Succ√®s", $"{missing.Count} ingr√©dient(s) ajout√©(s) √† la liste de courses.", "OK");
        else
            await DisplayAlert("Erreur", "Impossible d‚Äôajouter √† la liste de courses.", "OK");
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\ResetPasswordPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.ResetPasswordPage"
             Title="{tr:Translate Reset_Title}">

    <VerticalStackLayout Padding="24" Spacing="12">

        <Label Text="{tr:Translate Reset_Header}"
               FontSize="20"
               FontAttributes="Bold" />

        <Entry x:Name="Pwd1"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_NewPassword}" />

        <Entry x:Name="Pwd2"
               IsPassword="True"
               Placeholder="{tr:Translate Reset_ConfirmPassword}" />

        <Button Text="{tr:Translate Reset_Submit}"
                Clicked="OnSubmit" />

        <Label x:Name="Msg" />

    </VerticalStackLayout>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\ResetPasswordPage.xaml.cs
================================================================================

Ôªøusing LoGeCuiMobile.Resources.Lang;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Pages;

public partial class ResetPasswordPage : ContentPage
{
    private readonly string _accessToken;
    private readonly SupabaseService _supabase;

    public ResetPasswordPage(string accessToken)
    {
        InitializeComponent();
        _accessToken = accessToken;

        string url = ConfigurationHelper.GetSupabaseUrl();
        string key = ConfigurationHelper.GetSupabaseKey();
        _supabase = new SupabaseService(url, key);
    }

    private async void OnSubmit(object sender, EventArgs e)
    {
        var p1 = Pwd1.Text ?? "";
        var p2 = Pwd2.Text ?? "";

        if (string.IsNullOrWhiteSpace(p1) || p1.Length < 6)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMinLength"];
            Msg.TextColor = Colors.Red;
            return;
        }

        if (p1 != p2)
        {
            Msg.Text = LocalizationResourceManager.Instance["Reset_PwdMismatch"];
            Msg.TextColor = Colors.Red;
            return;
        }

        Msg.Text = LocalizationResourceManager.Instance["Reset_Updating"];
        Msg.TextColor = Colors.Blue;

        var (success, error) = await _supabase.UpdatePasswordAsync(_accessToken, p1);

        if (success)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["Reset_DoneTitle"],
                LocalizationResourceManager.Instance["Reset_DoneBody"],
                LocalizationResourceManager.Instance["Dialog_Ok"]
            );

            await Navigation.PopToRootAsync();
        }
        else
        {
            Msg.Text = string.IsNullOrWhiteSpace(error)
                ? LocalizationResourceManager.Instance["Reset_Failed"]
                : error;

            Msg.TextColor = Colors.Red;
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Pages\SettingsPage.xaml
================================================================================

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:tr="clr-namespace:LoGeCuiMobile.Resources.Lang"
             x:Class="LoGeCuiMobile.Pages.SettingsPage"
             Title="{tr:Translate Settings_Title}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">

            <!-- ========================= -->
            <!-- PARTAGE LISTE DE COURSES  -->
            <!-- ========================= -->
            <Label Text="Liste de courses partag√©e"
                   FontSize="18"
                   FontAttributes="Bold" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="10">

                    <Label Text="Liste active :"
                           FontAttributes="Bold" />

                    <Label x:Name="LblActiveList"
                           Text="(aucune)"
                           TextColor="Gray" />

                    <Label Text="Code de partage :"
                           FontAttributes="Bold"
                           Margin="0,6,0,0"/>

                    <Label x:Name="LblShareCode"
                           Text="(aucun)"
                           TextColor="Gray" />

                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Cr√©er/voir mon code"
                                Clicked="OnCreateOrShowMyCodeClicked"
                                HorizontalOptions="FillAndExpand"/>

                        <Button Text="Copier"
                                Clicked="OnCopyCodeClicked"
                                HorizontalOptions="End"/>
                    </HorizontalStackLayout>

                    <Button Text="Rejoindre avec un code"
                            Clicked="OnJoinWithCodeClicked" />

                    <Button Text="Choisir une liste active"
                            Clicked="OnPickActiveListClicked" />

                    <Button Text="Revenir √† ma liste perso"
                            BackgroundColor="#E67E22"
                            TextColor="White"
                            Clicked="OnDisableSharedListClicked" />

                </VerticalStackLayout>
            </Frame>

            <!-- ========================= -->
            <!-- COMPTE                    -->
            <!-- ========================= -->
            <Label Text="{tr:Translate Settings_Account}"
                   FontSize="18"
                   FontAttributes="Bold"
                   Margin="0,10,0,0" />

            <Frame Padding="12"
                   CornerRadius="12"
                   BorderColor="#DDDDDD"
                   HasShadow="True">
                <VerticalStackLayout Spacing="12">

                    <Button Text="{tr:Translate Settings_Logout}"
                            BackgroundColor="#34495E"
                            TextColor="White"
                            FontAttributes="Bold"
                            Clicked="OnLogoutClicked" />

                    <Label Text="{tr:Translate Settings_DangerZone}"
                           FontSize="14"
                           TextColor="Gray"
                           Margin="0,6,0,0" />

                    <Button Text="{tr:Translate Settings_Unsubscribe}"
                            BackgroundColor="IndianRed"
                            TextColor="White"
                            FontAttributes="Bold"
                            Clicked="OnDesinscriptionClicked" />

                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>

================================================================================
FILE: LoGeCuiMobile\Pages\SettingsPage.xaml.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiMobile.Resources.Lang;
using Microsoft.Maui.Storage;

namespace LoGeCuiMobile.Pages;

public partial class SettingsPage : ContentPage
{
    private const string ListsTable = "shopping_lists";
    private const string MembersTable = "shopping_list_members";

    // RPC recommand√©e (SECURITY DEFINER)
    private const string JoinRpc = "join_shopping_list";

    public SettingsPage()
    {
        InitializeComponent();
    }

    protected override async void OnAppearing()
    {
        base.OnAppearing();

        try
        {
            await RefreshSharingUiAsync();
        }
        catch (Exception ex)
        {
            // IMPORTANT : √©vite crash dans OnAppearing
            await DisplayAlert("Erreur", ex.Message, "OK");
        }
    }

    // =========================
    // UI actions (partage)
    // =========================

    private async void OnCreateOrShowMyCodeClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            if (app.CurrentUserId == null || app.RestClient == null)
            {
                await DisplayAlert("Erreur", "Tu dois √™tre connect√©.", "OK");
                return;
            }

            // 1) Cr√©e ou r√©cup√®re la liste dont je suis owner
            var myList = await GetOrCreateMyOwnedListAsync(app.CurrentUserId.Value);

            // 2) Active la liste
            app.SetCurrentShoppingListId(myList.id);

            await RefreshSharingUiAsync();

            await DisplayAlert("OK", $"Ton code de partage : {myList.share_code}", "OK");
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnCopyCodeClicked(object sender, EventArgs e)
    {
        try
        {
            var code = LblShareCode?.Text?.Trim();

            if (string.IsNullOrWhiteSpace(code) || code == "(aucun)")
            {
                await DisplayAlert("Info", "Aucun code √† copier.", "OK");
                return;
            }

            await Clipboard.SetTextAsync(code);
            await DisplayAlert("OK", "Code copi√© ‚úÖ", "OK");
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnJoinWithCodeClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            if (app.CurrentUserId == null || app.RestClient == null || !app.IsConnected)
            {
                await DisplayAlert("Erreur", "Tu dois √™tre connect√© pour rejoindre une liste.", "OK");
                return;
            }

            var code = await DisplayPromptAsync("Rejoindre une liste", "Entre le code de partage :");
            if (string.IsNullOrWhiteSpace(code))
                return;

            code = code.Trim();

            // ‚úÖ JOIN via RPC (recommand√© avec RLS)
            var joined = await JoinByCodeViaRpcAsync(code);

            if (joined == null)
            {
                await DisplayAlert("Erreur", "Code invalide (liste introuvable).", "OK");
                return;
            }

            app.SetCurrentShoppingListId(joined.Value.listId);

            await RefreshSharingUiAsync();

            await DisplayAlert("Succ√®s", $"Tu as rejoint la liste : {joined.Value.name}", "OK");
        }
        catch (Exception ex)
        {
            // ‚úÖ Affiche l'erreur r√©elle (au lieu de javaProxyThrowable)
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnPickActiveListClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            if (app.CurrentUserId == null || app.RestClient == null)
            {
                await DisplayAlert("Erreur", "Tu dois √™tre connect√©.", "OK");
                return;
            }

            var lists = await GetMyAccessibleListsAsync(app.CurrentUserId.Value);

            if (lists.Count == 0)
            {
                await DisplayAlert("Info", "Tu n‚Äôas aucune liste partag√©e.", "OK");
                return;
            }

            var labels = lists
                .Select(l => $"{(string.IsNullOrWhiteSpace(l.name) ? "Liste partag√©e" : l.name)}  ({l.share_code})")
                .ToArray();

            var chosen = await DisplayActionSheet("Choisir la liste active", "Annuler", null, labels);
            if (string.IsNullOrWhiteSpace(chosen) || chosen == "Annuler")
                return;

            var idx = Array.IndexOf(labels, chosen);
            if (idx < 0) return;

            app.SetCurrentShoppingListId(lists[idx].id);

            await RefreshSharingUiAsync();
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    private async void OnDisableSharedListClicked(object sender, EventArgs e)
    {
        try
        {
            var app = (App)Application.Current;

            // Guid.Empty = d√©sactiv√©
            app.SetCurrentShoppingListId(Guid.Empty);

            await RefreshSharingUiAsync();

            await DisplayAlert("OK", "Retour √† ta liste perso ‚úÖ", "OK");
        }
        catch (Exception ex)
        {
            await DisplayAlert("Erreur", ex.ToString(), "OK");
        }
    }

    // =========================
    // UI actions (compte)
    // =========================

    private async void OnDesinscriptionClicked(object sender, EventArgs e)
    {
        bool confirm = await DisplayAlert(
            LocalizationResourceManager.Instance["Settings_DeleteConfirmTitle"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmBody"],
            LocalizationResourceManager.Instance["Settings_DeleteConfirmYes"],
            LocalizationResourceManager.Instance["Dialog_Cancel"]);

        if (!confirm) return;

        var app = (App)Application.Current;

        if (app.Supabase == null)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                LocalizationResourceManager.Instance["Settings_SupabaseNull"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        var token = await SecureStorage.GetAsync("sb_access_token");
        var userId = await SecureStorage.GetAsync("sb_user_id");

        if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["SessionTitle"],
                LocalizationResourceManager.Instance["SessionExpired"],
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            app.ShowLogin();
            return;
        }

        app.Supabase.SetSession(token, userId);

        var (ok, err) = await app.Supabase.DeleteAccountAsync();

        if (!ok)
        {
            await DisplayAlert(
                LocalizationResourceManager.Instance["ErrorTitle"],
                string.Format(LocalizationResourceManager.Instance["Settings_DeleteFailed"], err),
                LocalizationResourceManager.Instance["Dialog_Ok"]);

            if (!string.IsNullOrWhiteSpace(err) &&
                err.Contains("Invalid JWT", StringComparison.OrdinalIgnoreCase))
            {
                app.ShowLogin();
            }

            return;
        }

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        await DisplayAlert(
            LocalizationResourceManager.Instance["Dialog_Ok"],
            LocalizationResourceManager.Instance["Settings_DeleteSuccess"],
            LocalizationResourceManager.Instance["Dialog_Ok"]);

        app.ShowLogin();
    }

    private void OnLogoutClicked(object sender, EventArgs e)
    {
        var app = (App)Application.Current;

        app.Supabase?.ClearSession();

        SecureStorage.Remove("sb_access_token");
        SecureStorage.Remove("sb_user_id");

        app.ShowLogin();
    }

    // =========================
    // Helpers: refresh UI
    // =========================

    private async Task RefreshSharingUiAsync()
    {
        var app = (App)Application.Current;

        if (app.CurrentUserId == null || app.RestClient == null)
        {
            LblActiveList.Text = "(non connect√©)";
            LblShareCode.Text = "(aucun)";
            return;
        }

        if (app.CurrentShoppingListId == null || app.CurrentShoppingListId == Guid.Empty)
        {
            LblActiveList.Text = "Liste perso (non partag√©e)";
            LblShareCode.Text = "(aucun)";
            return;
        }

        var list = await GetListByIdAsync(app.CurrentShoppingListId.Value);
        if (list == null)
        {
            LblActiveList.Text = "Liste introuvable";
            LblShareCode.Text = "(aucun)";
            return;
        }

        LblActiveList.Text = $"{(string.IsNullOrWhiteSpace(list.name) ? "Liste partag√©e" : list.name)}";
        LblShareCode.Text = list.share_code ?? "(aucun)";
    }

    // =========================
    // JOIN via RPC (recommand√©)
    // =========================

    private async Task<(Guid listId, string name)?> JoinByCodeViaRpcAsync(string code)
    {
        var app = (App)Application.Current;

        // Payload attendu c√¥t√© SQL : p_share_code (ou share_code selon ta fonction)
        // Je g√®re les 2 cas: tu peux adapter dans la fonction SQL ensuite.
        var payload = new
        {
            p_share_code = code
        };

        try
        {
            // PostgREST RPC: POST /rest/v1/rpc/<fn>
            // Ton SupabaseRestClient doit accepter "rpc/<fn>"
            var rows = await app.RestClient!.PostAsync<List<JoinResultRow>>(
                $"rpc/{JoinRpc}",
                payload,
                returnRepresentation: true);

            var row = rows?.FirstOrDefault();
            if (row == null || row.list_id == Guid.Empty)
                return null;

            return (row.list_id, row.name ?? "Liste partag√©e");
        }
        catch (Exception ex)
        {
            // Si la RPC n'existe pas (404), ou policy/401, on veut le voir clairement
            var msg = ex.ToString();

            if (msg.Contains("404", StringComparison.OrdinalIgnoreCase) ||
                msg.Contains("Not Found", StringComparison.OrdinalIgnoreCase) ||
                msg.Contains("could not find the function", StringComparison.OrdinalIgnoreCase))
            {
                throw new Exception(
                    "La fonction RPC 'join_shopping_list' n‚Äôexiste pas c√¥t√© Supabase.\n" +
                    "Il faut la cr√©er (SECURITY DEFINER) pour rejoindre une liste par share_code avec RLS.\n\n" +
                    "Dis-moi et je te donne le SQL exact √† coller.",
                    ex);
            }

            throw;
        }
    }

    // =========================
    // Supabase queries (liste)
    // =========================

    private async Task<ShoppingListRow?> GetListByIdAsync(Guid id)
    {
        var app = (App)Application.Current;
        var q = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&id=eq.{id}&limit=1";

        var rows = await app.RestClient!.GetAsync<List<ShoppingListRow>>(q);
        return rows?.FirstOrDefault();
    }

    private async Task<ShoppingListRow> GetOrCreateMyOwnedListAsync(Guid userId)
    {
        var app = (App)Application.Current;

        // 1) Essayer de r√©cup√©rer une liste dont je suis owner
        var q = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&owner_user_id=eq.{userId}&order=created_at.asc&limit=1";
        var existing = await app.RestClient!.GetAsync<List<ShoppingListRow>>(q);
        var row = existing?.FirstOrDefault();
        if (row != null)
            return row;

        // 2) Sinon cr√©er une liste (share_code mis par trigger)
        var payload = new
        {
            owner_user_id = userId,
            name = "Liste partag√©e"
        };

        var created = await app.RestClient!.PostAsync<List<ShoppingListRow>>(
            $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at",
            payload,
            returnRepresentation: true);

        var createdRow = created?.FirstOrDefault()
            ?? throw new Exception("Cr√©ation de liste impossible.");

        // 3) Owner devient membre aussi
        await UpsertMemberAsync(createdRow.id, userId, role: "owner");

        return createdRow;
    }

    private async Task<List<ShoppingListRow>> GetMyAccessibleListsAsync(Guid userId)
    {
        var app = (App)Application.Current;

        // memberships o√π user_id == moi
        var mq = $"{MembersTable}?select=list_id,role&user_id=eq.{userId}";
        var memberships = await app.RestClient!.GetAsync<List<MemberRow>>(mq) ?? new List<MemberRow>();

        var ids = memberships.Select(m => m.list_id).Distinct().ToList();

        // listes dont je suis owner
        var oq = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&owner_user_id=eq.{userId}";
        var owned = await app.RestClient!.GetAsync<List<ShoppingListRow>>(oq) ?? new List<ShoppingListRow>();

        foreach (var o in owned)
            if (!ids.Contains(o.id))
                ids.Add(o.id);

        if (ids.Count == 0)
            return owned;

        var inList = string.Join(",", ids.Select(x => x.ToString()));
        var q = $"{ListsTable}?select=id,owner_user_id,name,share_code,created_at&id=in.({inList})&order=created_at.desc";

        var rows = await app.RestClient!.GetAsync<List<ShoppingListRow>>(q);
        return rows ?? new List<ShoppingListRow>();
    }

    private async Task UpsertMemberAsync(Guid listId, Guid userId, string role = "member")
    {
        var app = (App)Application.Current;

        var payload = new[]
        {
            new { list_id = listId, user_id = userId, role = role }
        };

        await app.RestClient!.PostAsync<object>(
            $"{MembersTable}?on_conflict=list_id,user_id",
            payload,
            returnRepresentation: false,
            mergeDuplicates: true);
    }

    // =========================
    // DTOs
    // =========================

    private sealed class ShoppingListRow
    {
        public Guid id { get; set; }
        public Guid owner_user_id { get; set; }
        public string? name { get; set; }
        public string? share_code { get; set; }
        public DateTimeOffset created_at { get; set; }
    }

    private sealed class MemberRow
    {
        public Guid list_id { get; set; }
        public string? role { get; set; }
    }

    private sealed class JoinResultRow
    {
        public Guid list_id { get; set; }
        public string? name { get; set; }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\AndroidManifest.xml
================================================================================

Ôªø<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
	<application android:allowBackup="true" android:icon="@mipmap/postriticone" android:supportsRtl="true"></application>
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
	<uses-permission android:name="android.permission.CAMERA" />
	<queries>
		<intent>
			<action android:name="android.intent.action.VIEW" />
			<data android:scheme="logecui" />
		</intent>
	</queries>
</manifest>

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\MainActivity.cs
================================================================================

Ôªøusing Android.App;
using Android.Content;
using Android.Content.PM;
using Android.OS;
using Microsoft.Maui.Controls;

namespace LoGeCuiMobile
{
    [Activity(
        Theme = "@style/Maui.SplashTheme",
        MainLauncher = true,
        LaunchMode = LaunchMode.SingleTop,
        ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | ConfigChanges.SmallestScreenSize | ConfigChanges.Density)]

    // Configuration du Deep Link pour la confirmation email
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "confirm",
        AutoVerify = true)]

    // Deep Link - reset password
    [IntentFilter(
        new[] { Intent.ActionView },
        Categories = new[] { Intent.CategoryDefault, Intent.CategoryBrowsable },
        DataScheme = "logecui",
        DataHost = "reset-password")]

    public class MainActivity : MauiAppCompatActivity
    {
        protected override void OnCreate(Bundle? savedInstanceState)
        {
            base.OnCreate(savedInstanceState);

            // G√©rer le deep link si l'app est lanc√©e via un lien
            HandleIntent(Intent);
        }

        protected override void OnNewIntent(Intent? intent)
        {
            base.OnNewIntent(intent);

            if (intent != null)
            {
                Intent = intent;
                HandleIntent(intent);
            }
        }

        private void HandleIntent(Intent? intent)
        {
            var data = intent?.DataString;
            if (string.IsNullOrEmpty(data))
                return;

            var uri = new Uri(data);

            MainThread.BeginInvokeOnMainThread(async () =>
            {
                if (Microsoft.Maui.Controls.Application.Current is App app)
                    await app.HandleDeepLinkAsync(uri);
            });
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\MainApplication.cs
================================================================================

Ôªøusing Android.App;
using Android.Runtime;

namespace LoGeCuiMobile
{
    [Application]
    public class MainApplication : MauiApplication
    {
        public MainApplication(IntPtr handle, JniHandleOwnership ownership)
            : base(handle, ownership)
        {
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Android\Resources\values\colors.xml
================================================================================

<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="colorPrimary">#512BD4</color>
    <color name="colorPrimaryDark">#2B0B98</color>
    <color name="colorAccent">#2B0B98</color>
</resources>

================================================================================
FILE: LoGeCuiMobile\Platforms\iOS\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\iOS\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\MacCatalyst\AppDelegate.cs
================================================================================

Ôªøusing Foundation;

namespace LoGeCuiMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\MacCatalyst\Program.cs
================================================================================

Ôªøusing ObjCRuntime;
using UIKit;

namespace LoGeCuiMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Platforms\Windows\App.xaml
================================================================================

Ôªø<maui:MauiWinUIApplication
    x:Class="LoGeCuiMobile.WinUI.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:maui="using:Microsoft.Maui"
    xmlns:local="using:LoGeCuiMobile.WinUI">

</maui:MauiWinUIApplication>

================================================================================
FILE: LoGeCuiMobile\Platforms\Windows\App.xaml.cs
================================================================================

Ôªøusing Microsoft.UI.Xaml;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace LoGeCuiMobile.WinUI
{
    /// <summary>
    /// Provides application-specific behavior to supplement the default Application class.
    /// </summary>
    public partial class App : MauiWinUIApplication
    {
        /// <summary>
        /// Initializes the singleton application object.  This is the first line of authored code
        /// executed, and as such is the logical equivalent of main() or WinMain().
        /// </summary>
        public App()
        {
            this.InitializeComponent();
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }

}

================================================================================
FILE: LoGeCuiMobile\Properties\launchSettings.json
================================================================================

{
  "profiles": {
    "Windows Machine": {
      "commandName": "Project",
      "nativeDebugging": false
    }
  }
}

================================================================================
FILE: LoGeCuiMobile\Resources\Lang\AppResources.Designer.cs
================================================================================

Ôªø//------------------------------------------------------------------------------
// <auto-generated>
//     Ce code a √©t√© g√©n√©r√© par un outil.
//     Version du runtime :4.0.30319.42000
//
//     Les modifications apport√©es √† ce fichier peuvent provoquer un comportement incorrect et seront perdues si
//     le code est r√©g√©n√©r√©.
// </auto-generated>
//------------------------------------------------------------------------------

namespace LoGeCuiMobile.Resources.Lang {
    using System;
    
    
    /// <summary>
    ///   Une classe de ressource fortement typ√©e destin√©e, entre autres, √† la consultation des cha√Ænes localis√©es.
    /// </summary>
    // Cette classe a √©t√© g√©n√©r√©e automatiquement par la classe StronglyTypedResourceBuilder
    // √† l'aide d'un outil, tel que ResGen ou Visual Studio.
    // Pour ajouter ou supprimer un membre, modifiez votre fichier .ResX, puis r√©ex√©cutez ResGen
    // avec l'option /str ou r√©g√©n√©rez votre projet VS.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "18.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    public class AppResources {
        
        private static global::System.Resources.ResourceManager resourceMan;
        
        private static global::System.Globalization.CultureInfo resourceCulture;
        
        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal AppResources() {
        }
        
        /// <summary>
        ///   Retourne l'instance ResourceManager mise en cache utilis√©e par cette classe.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Resources.ResourceManager ResourceManager {
            get {
                if (object.ReferenceEquals(resourceMan, null)) {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("LoGeCuiMobile.Resources.Lang.AppResources", typeof(AppResources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }
        
        /// <summary>
        ///   Remplace la propri√©t√© CurrentUICulture du thread actuel pour toutes
        ///   les recherches de ressources √† l'aide de cette classe de ressource fortement typ√©e.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        public static global::System.Globalization.CultureInfo Culture {
            get {
                return resourceCulture;
            }
            set {
                resourceCulture = value;
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mauvais mot de passe.
        /// </summary>
        public static string BadPassword {
            get {
                return ResourceManager.GetString("BadPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Connexion en cours....
        /// </summary>
        public static string Connecting {
            get {
                return ResourceManager.GetString("Connecting", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur de connexion.
        /// </summary>
        public static string ConnectionError {
            get {
                return ResourceManager.GetString("ConnectionError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©ation du compte....
        /// </summary>
        public static string CreatingAccount {
            get {
                return ResourceManager.GetString("CreatingAccount", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Annuler.
        /// </summary>
        public static string Dialog_Cancel {
            get {
                return ResourceManager.GetString("Dialog_Cancel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer cet ingr√©dient ?.
        /// </summary>
        public static string Dialog_DeleteConfirm {
            get {
                return ResourceManager.GetString("Dialog_DeleteConfirm", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Non.
        /// </summary>
        public static string Dialog_No {
            get {
                return ResourceManager.GetString("Dialog_No", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OK.
        /// </summary>
        public static string Dialog_Ok {
            get {
                return ResourceManager.GetString("Dialog_Ok", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui.
        /// </summary>
        public static string Dialog_Yes {
            get {
                return ResourceManager.GetString("Dialog_Yes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Email.
        /// </summary>
        public static string Email {
            get {
                return ResourceManager.GetString("Email", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur.
        /// </summary>
        public static string ErrorTitle {
            get {
                return ResourceManager.GetString("ErrorTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Veuillez remplir tous les champs.
        /// </summary>
        public static string FillAllFields {
            get {
                return ResourceManager.GetString("FillAllFields", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe oubli√© ?.
        /// </summary>
        public static string ForgotPassword {
            get {
                return ResourceManager.GetString("ForgotPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Add_Available {
            get {
                return ResourceManager.GetString("Ingredients_Add_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de l‚Äôingr√©dient.
        /// </summary>
        public static string Ingredients_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Ingredients_Add_NameRequired {
            get {
                return ResourceManager.GetString("Ingredients_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© (ex : 10).
        /// </summary>
        public static string Ingredients_Add_QuantityPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_QuantityPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üíæ Enregistrer.
        /// </summary>
        public static string Ingredients_Add_Save {
            get {
                return ResourceManager.GetString("Ingredients_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_Add_Title {
            get {
                return ResourceManager.GetString("Ingredients_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Unit√© (ex : kg, pi√®ces).
        /// </summary>
        public static string Ingredients_Add_UnitPlaceholder {
            get {
                return ResourceManager.GetString("Ingredients_Add_UnitPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un ingr√©dient.
        /// </summary>
        public static string Ingredients_AddButton {
            get {
                return ResourceManager.GetString("Ingredients_AddButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Disponible.
        /// </summary>
        public static string Ingredients_Available {
            get {
                return ResourceManager.GetString("Ingredients_Available", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dient.
        /// </summary>
        public static string Ingredients_DialogTitle {
            get {
                return ResourceManager.GetString("Ingredients_DialogTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Quantit√© : {0} {1}.
        /// </summary>
        public static string Ingredients_QuantityFormat {
            get {
                return ResourceManager.GetString("Ingredients_QuantityFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Gestion des ingr√©dients.
        /// </summary>
        public static string Ingredients_Title {
            get {
                return ResourceManager.GetString("Ingredients_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Se connecter.
        /// </summary>
        public static string LoginButton {
            get {
                return ResourceManager.GetString("LoginButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string LoginRequired {
            get {
                return ResourceManager.GetString("LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients.
        /// </summary>
        public static string Nav_Ingredients {
            get {
                return ResourceManager.GetString("Nav_Ingredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Menu al√©atoire.
        /// </summary>
        public static string Nav_RandomMenu {
            get {
                return ResourceManager.GetString("Nav_RandomMenu", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Nav_Recipes {
            get {
                return ResourceManager.GetString("Nav_Recipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Nav_Settings {
            get {
                return ResourceManager.GetString("Nav_Settings", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste de courses.
        /// </summary>
        public static string Nav_ShoppingList {
            get {
                return ResourceManager.GetString("Nav_ShoppingList", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† OCR.
        /// </summary>
        public static string OcrTitle {
            get {
                return ResourceManager.GetString("OcrTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mot de passe.
        /// </summary>
        public static string Password {
            get {
                return ResourceManager.GetString("Password", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üîí Permission.
        /// </summary>
        public static string PermissionTitle {
            get {
                return ResourceManager.GetString("PermissionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Tout est disponible. Aucun ingr√©dient manquant..
        /// </summary>
        public static string RandomMenu_AllAvailable {
            get {
                return ResourceManager.GetString("RandomMenu_AllAvailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de calculer les ingr√©dients manquants : certaines recettes n‚Äôont pas d‚Äôingr√©dients enregistr√©s..
        /// </summary>
        public static string RandomMenu_CannotComputeMissing {
            get {
                return ResourceManager.GetString("RandomMenu_CannotComputeMissing", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de g√©n√©rer un menu Entr√©e/Plat/Dessert..
        /// </summary>
        public static string RandomMenu_CannotGenerate {
            get {
                return ResourceManager.GetString("RandomMenu_CannotGenerate", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† V√©rifie que tes recettes ont bien &apos;categorie&apos; = Entree / Plat / Dessert en DB..
        /// </summary>
        public static string RandomMenu_CheckCategories {
            get {
                return ResourceManager.GetString("RandomMenu_CheckCategories", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Entr√©es: {0}
        ///Plats: {1}
        ///Desserts: {2}.
        /// </summary>
        public static string RandomMenu_CountsFormat {
            get {
                return ResourceManager.GetString("RandomMenu_CountsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Appuyez sur le bouton pour g√©n√©rer un menu.
        /// </summary>
        public static string RandomMenu_DefaultText {
            get {
                return ResourceManager.GetString("RandomMenu_DefaultText", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_GenerateButton {
            get {
                return ResourceManager.GetString("RandomMenu_GenerateButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Menu g√©n√©r√© :.
        /// </summary>
        public static string RandomMenu_GeneratedHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GeneratedHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ G√©n√©ration du menu (Entr√©e / Plat / Dessert)‚Ä¶.
        /// </summary>
        public static string RandomMenu_Generating {
            get {
                return ResourceManager.GetString("RandomMenu_Generating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Liste globale des ingr√©dients manquants :.
        /// </summary>
        public static string RandomMenu_GlobalMissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_GlobalMissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients :.
        /// </summary>
        public static string RandomMenu_IngredientsHeader {
            get {
                return ResourceManager.GetString("RandomMenu_IngredientsHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants :.
        /// </summary>
        public static string RandomMenu_MissingHeader {
            get {
                return ResourceManager.GetString("RandomMenu_MissingHeader", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Manquants : aucun.
        /// </summary>
        public static string RandomMenu_MissingNone {
            get {
                return ResourceManager.GetString("RandomMenu_MissingNone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients : (aucun ingr√©dient enregistr√© pour cette recette).
        /// </summary>
        public static string RandomMenu_NoIngredientsForRecipe {
            get {
                return ResourceManager.GetString("RandomMenu_NoIngredientsForRecipe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette disponible..
        /// </summary>
        public static string RandomMenu_NoRecipes {
            get {
                return ResourceManager.GetString("RandomMenu_NoRecipes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ouvrir la liste de courses.
        /// </summary>
        public static string RandomMenu_OpenShopping {
            get {
                return ResourceManager.GetString("RandomMenu_OpenShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Il manque :.
        /// </summary>
        public static string RandomMenu_SendConfirmBody {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Envoyer ?.
        /// </summary>
        public static string RandomMenu_SendConfirmTitle {
            get {
                return ResourceManager.GetString("RandomMenu_SendConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Envoyer les ingr√©dients manquants dans la liste de courses.
        /// </summary>
        public static string RandomMenu_SendMissingToShopping {
            get {
                return ResourceManager.GetString("RandomMenu_SendMissingToShopping", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Ingr√©dients envoy√©s.
        /// </summary>
        public static string RandomMenu_SentButton {
            get {
                return ResourceManager.GetString("RandomMenu_SentButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üé≤ Menu al√©atoire.
        /// </summary>
        public static string RandomMenu_Title {
            get {
                return ResourceManager.GetString("RandomMenu_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add {
            get {
                return ResourceManager.GetString("Recipes_Add", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;acc√®s √† la cam√©ra est requis pour scanner..
        /// </summary>
        public static string Recipes_Add_CameraPermission {
            get {
                return ResourceManager.GetString("Recipes_Add_CameraPermission", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Capture photo non support√©e sur cet appareil..
        /// </summary>
        public static string Recipes_Add_CaptureNotSupported {
            get {
                return ResourceManager.GetString("Recipes_Add_CaptureNotSupported", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Choisir une cat√©gorie.
        /// </summary>
        public static string Recipes_Add_CategoryPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_CategoryPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de retrouver l&apos;ID de la recette apr√®s sauvegarde..
        /// </summary>
        public static string Recipes_Add_IdNotFound {
            get {
                return ResourceManager.GetString("Recipes_Add_IdNotFound", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† L&apos;image est trop lourde pour l&apos;OCR. Essayez de cadrer plus serr√© ou baissez la r√©solution..
        /// </summary>
        public static string Recipes_Add_ImageTooLarge {
            get {
                return ResourceManager.GetString("Recipes_Add_ImageTooLarge", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ingr√©dients (1 par ligne).
        /// </summary>
        public static string Recipes_Add_IngredientsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex :
        ///2 ≈ìufs
        ///100g farine
        ///1 pinc√©e de sel.
        /// </summary>
        public static string Recipes_Add_IngredientsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_IngredientsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Instructions.
        /// </summary>
        public static string Recipes_Add_InstructionsLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : M√©langer, cuire 10 min....
        /// </summary>
        public static string Recipes_Add_InstructionsPlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_InstructionsPlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Vous devez √™tre connect√©..
        /// </summary>
        public static string Recipes_Add_LoginRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_LoginRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom.
        /// </summary>
        public static string Recipes_Add_NameLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_NameLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nom de la recette.
        /// </summary>
        public static string Recipes_Add_NamePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_NamePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le nom est obligatoire..
        /// </summary>
        public static string Recipes_Add_NameRequired {
            get {
                return ResourceManager.GetString("Recipes_Add_NameRequired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun texte d√©tect√©. Essayez avec plus de lumi√®re et sans flou..
        /// </summary>
        public static string Recipes_Add_NoTextDetected {
            get {
                return ResourceManager.GetString("Recipes_Add_NoTextDetected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Texte scann√© et champs pr√©-remplis. V√©rifiez et corrigez si besoin..
        /// </summary>
        public static string Recipes_Add_OcrSuccess {
            get {
                return ResourceManager.GetString("Recipes_Add_OcrSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Enregistrer.
        /// </summary>
        public static string Recipes_Add_Save {
            get {
                return ResourceManager.GetString("Recipes_Add_Save", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Recette enregistr√©e..
        /// </summary>
        public static string Recipes_Add_Saved {
            get {
                return ResourceManager.GetString("Recipes_Add_Saved", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Scanner (OCR).
        /// </summary>
        public static string Recipes_Add_ScanOcr {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanOcr", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üì∏ Scanner une recette.
        /// </summary>
        public static string Recipes_Add_ScanTitle {
            get {
                return ResourceManager.GetString("Recipes_Add_ScanTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_Add_ServiceNotReady {
            get {
                return ResourceManager.GetString("Recipes_Add_ServiceNotReady", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps (minutes).
        /// </summary>
        public static string Recipes_Add_TimeLabel {
            get {
                return ResourceManager.GetString("Recipes_Add_TimeLabel", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ex : 30.
        /// </summary>
        public static string Recipes_Add_TimePlaceholder {
            get {
                return ResourceManager.GetString("Recipes_Add_TimePlaceholder", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ajouter une recette.
        /// </summary>
        public static string Recipes_Add_Title {
            get {
                return ResourceManager.GetString("Recipes_Add_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie.
        /// </summary>
        public static string Recipes_Category {
            get {
                return ResourceManager.GetString("Recipes_Category", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cat√©gorie: {0}
        ///Temps: {1} min
        ///
        ///Ingr√©dients:
        ///{2}
        ///
        ///Instructions:
        ///{3}.
        /// </summary>
        public static string Recipes_DetailsFormat {
            get {
                return ResourceManager.GetString("Recipes_DetailsFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucune recette pour l&apos;instant..
        /// </summary>
        public static string Recipes_Empty {
            get {
                return ResourceManager.GetString("Recipes_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecetteIngredientsService non initialis√©..
        /// </summary>
        public static string Recipes_IngredientsServiceNull {
            get {
                return ResourceManager.GetString("Recipes_IngredientsServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† (aucun ingr√©dient renseign√©).
        /// </summary>
        public static string Recipes_NoIngredients {
            get {
                return ResourceManager.GetString("Recipes_NoIngredients", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rafra√Æchir.
        /// </summary>
        public static string Recipes_Refresh {
            get {
                return ResourceManager.GetString("Recipes_Refresh", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† RecipesService est NULL (InitRestServices n&apos;a pas √©t√© appel√© apr√®s login)..
        /// </summary>
        public static string Recipes_ServiceNull {
            get {
                return ResourceManager.GetString("Recipes_ServiceNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Temps : {0} min.
        /// </summary>
        public static string Recipes_TimeFormat {
            get {
                return ResourceManager.GetString("Recipes_TimeFormat", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Mes recettes.
        /// </summary>
        public static string Recipes_Title {
            get {
                return ResourceManager.GetString("Recipes_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Confirmer le mot de passe.
        /// </summary>
        public static string Reset_ConfirmPassword {
            get {
                return ResourceManager.GetString("Reset_ConfirmPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Votre mot de passe a √©t√© modifi√©. Vous pouvez vous connecter..
        /// </summary>
        public static string Reset_DoneBody {
            get {
                return ResourceManager.GetString("Reset_DoneBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Termin√©.
        /// </summary>
        public static string Reset_DoneTitle {
            get {
                return ResourceManager.GetString("Reset_DoneTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Impossible de modifier le mot de passe..
        /// </summary>
        public static string Reset_Failed {
            get {
                return ResourceManager.GetString("Reset_Failed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialiser votre mot de passe.
        /// </summary>
        public static string Reset_Header {
            get {
                return ResourceManager.GetString("Reset_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Nouveau mot de passe.
        /// </summary>
        public static string Reset_NewPassword {
            get {
                return ResourceManager.GetString("Reset_NewPassword", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Le mot de passe doit contenir au moins 6 caract√®res..
        /// </summary>
        public static string Reset_PwdMinLength {
            get {
                return ResourceManager.GetString("Reset_PwdMinLength", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Les mots de passe ne correspondent pas..
        /// </summary>
        public static string Reset_PwdMismatch {
            get {
                return ResourceManager.GetString("Reset_PwdMismatch", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Valider.
        /// </summary>
        public static string Reset_Submit {
            get {
                return ResourceManager.GetString("Reset_Submit", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† R√©initialisation.
        /// </summary>
        public static string Reset_Title {
            get {
                return ResourceManager.GetString("Reset_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚è≥ Mise √† jour en cours....
        /// </summary>
        public static string Reset_Updating {
            get {
                return ResourceManager.GetString("Reset_Updating", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Service indisponible..
        /// </summary>
        public static string ServiceUnavailable {
            get {
                return ResourceManager.GetString("ServiceUnavailable", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session absente ou expir√©e. Veuillez vous reconnecter..
        /// </summary>
        public static string SessionExpired {
            get {
                return ResourceManager.GetString("SessionExpired", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Session.
        /// </summary>
        public static string SessionTitle {
            get {
                return ResourceManager.GetString("SessionTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Compte.
        /// </summary>
        public static string Settings_Account {
            get {
                return ResourceManager.GetString("Settings_Account", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Zone dangereuse.
        /// </summary>
        public static string Settings_DangerZone {
            get {
                return ResourceManager.GetString("Settings_DangerZone", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Es-tu s√ªr de vouloir supprimer ton compte ? Cette action est irr√©versible..
        /// </summary>
        public static string Settings_DeleteConfirmBody {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmBody", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_DeleteConfirmTitle {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Oui, supprimer.
        /// </summary>
        public static string Settings_DeleteConfirmYes {
            get {
                return ResourceManager.GetString("Settings_DeleteConfirmYes", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Suppression impossible : {0}.
        /// </summary>
        public static string Settings_DeleteFailed {
            get {
                return ResourceManager.GetString("Settings_DeleteFailed", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ Votre compte a √©t√© supprim√©..
        /// </summary>
        public static string Settings_DeleteSuccess {
            get {
                return ResourceManager.GetString("Settings_DeleteSuccess", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©connexion.
        /// </summary>
        public static string Settings_Logout {
            get {
                return ResourceManager.GetString("Settings_Logout", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supabase non initialis√©. Reconnectez-vous..
        /// </summary>
        public static string Settings_SupabaseNull {
            get {
                return ResourceManager.GetString("Settings_SupabaseNull", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Param√®tres.
        /// </summary>
        public static string Settings_Title {
            get {
                return ResourceManager.GetString("Settings_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† D√©sinscription.
        /// </summary>
        public static string Settings_Unsubscribe {
            get {
                return ResourceManager.GetString("Settings_Unsubscribe", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚ûï Ajouter un article.
        /// </summary>
        public static string Shopping_AddItem {
            get {
                return ResourceManager.GetString("Shopping_AddItem", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Achet√©.
        /// </summary>
        public static string Shopping_Bought {
            get {
                return ResourceManager.GetString("Shopping_Bought", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Supprimer.
        /// </summary>
        public static string Shopping_Delete {
            get {
                return ResourceManager.GetString("Shopping_Delete", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üóëÔ∏è Supprimer s√©lection.
        /// </summary>
        public static string Shopping_DeleteSelection {
            get {
                return ResourceManager.GetString("Shopping_DeleteSelection", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Aucun article pour l‚Äôinstant..
        /// </summary>
        public static string Shopping_Empty {
            get {
                return ResourceManager.GetString("Shopping_Empty", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Ma liste de courses.
        /// </summary>
        public static string Shopping_Header {
            get {
                return ResourceManager.GetString("Shopping_Header", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† üõí Liste de Courses.
        /// </summary>
        public static string Shopping_Title {
            get {
                return ResourceManager.GetString("Shopping_Title", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Cr√©er un compte.
        /// </summary>
        public static string SignupButton {
            get {
                return ResourceManager.GetString("SignupButton", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur lors de l&apos;inscription.
        /// </summary>
        public static string SignupError {
            get {
                return ResourceManager.GetString("SignupError", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Rester connect√©.
        /// </summary>
        public static string StayConnected {
            get {
                return ResourceManager.GetString("StayConnected", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† ‚úÖ OK.
        /// </summary>
        public static string SuccessTitle {
            get {
                return ResourceManager.GetString("SuccessTitle", resourceCulture);
            }
        }
        
        /// <summary>
        ///   Recherche une cha√Æne localis√©e semblable √† Erreur inconnue..
        /// </summary>
        public static string UnknownError {
            get {
                return ResourceManager.GetString("UnknownError", resourceCulture);
            }
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Resources\Lang\LocalizationResourceManager.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Globalization;
using System.Resources;

namespace LoGeCuiMobile.Resources.Lang;

public class LocalizationResourceManager : INotifyPropertyChanged
{
    public static LocalizationResourceManager Instance { get; } = new();

    private readonly ResourceManager _resourceManager = AppResources.ResourceManager;

    public event PropertyChangedEventHandler? PropertyChanged;

    public string this[string key] => _resourceManager.GetString(key, CultureInfo.CurrentUICulture) ?? key;

    public void SetCulture(CultureInfo culture)
    {
        if (culture == null) return;

        CultureInfo.CurrentUICulture = culture;
        CultureInfo.CurrentCulture = culture;

        CultureInfo.DefaultThreadCurrentCulture = culture;
        CultureInfo.DefaultThreadCurrentUICulture = culture;

        // ‚úÖ Notifie toute l‚ÄôUI : toutes les bindings se r√©√©valuent
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(null));
    }
}

================================================================================
FILE: LoGeCuiMobile\Resources\Lang\TranslateExtension.cs
================================================================================

Ôªøusing Microsoft.Maui.Controls;
using System;

namespace LoGeCuiMobile.Resources.Lang;

[ContentProperty(nameof(Key))]
public class TranslateExtension : IMarkupExtension<BindingBase>
{
    public string Key { get; set; } = "";

    public BindingBase ProvideValue(IServiceProvider serviceProvider)
        => new Binding($"[{Key}]", source: LocalizationResourceManager.Instance);

    object IMarkupExtension.ProvideValue(IServiceProvider serviceProvider)
        => ProvideValue(serviceProvider);
}

================================================================================
FILE: LoGeCuiMobile\Resources\Raw\AboutAssets.txt
================================================================================

ÔªøAny raw assets you want to be deployed with your application can be placed in
this directory (and child directories). Deployment of the asset to your application
is automatically handled by the following `MauiAsset` Build Action within your `.csproj`.

	<MauiAsset Include="Resources\Raw\**" LogicalName="%(RecursiveDir)%(Filename)%(Extension)" />

These files will be deployed with your package and will be accessible using Essentials:

	async Task LoadMauiAsset()
	{
		using var stream = await FileSystem.OpenAppPackageFileAsync("AboutAssets.txt");
		using var reader = new StreamReader(stream);

		var contents = reader.ReadToEnd();
	}

================================================================================
FILE: LoGeCuiMobile\Resources\Styles\Colors.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- Couleurs fixes -->
    <Color x:Key="AccentColor">#FF6B00</Color>

    <!-- Couleurs Light -->
    <Color x:Key="LightPageBackground">#FFFFFF</Color>
    <Color x:Key="LightTextPrimary">#111111</Color>
    <Color x:Key="LightCardBackground">#F2F2F2</Color>

    <!-- Couleurs Dark -->
    <Color x:Key="DarkPageBackground">#121212</Color>
    <Color x:Key="DarkTextPrimary">#FFFFFF</Color>
    <Color x:Key="DarkCardBackground">#1E1E1E</Color>

    <!-- Texte sur cartes -->
    <Color x:Key="LightCardText">#111111</Color>
    <Color x:Key="DarkCardText">#FFFFFF</Color>

</ResourceDictionary>


================================================================================
FILE: LoGeCuiMobile\Resources\Styles\Styles.xaml
================================================================================

Ôªø<?xml version="1.0" encoding="UTF-8" ?>
<ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <!-- PAGE -->
    <Style TargetType="ContentPage">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightPageBackground}"
                                 Dark="{StaticResource DarkPageBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- LABEL -->
    <Style TargetType="Label">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- ENTRY -->
    <Style TargetType="Entry">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightTextPrimary}"
                                 Dark="{StaticResource DarkTextPrimary}" />
            </Setter.Value>
        </Setter>
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
    </Style>

    <!-- FRAME -->
    <Style TargetType="Frame">
        <Setter Property="BackgroundColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardBackground}"
                                 Dark="{StaticResource DarkCardBackground}" />
            </Setter.Value>
        </Setter>
    </Style>

    <!-- BUTTON -->
    <Style TargetType="Button">
        <Setter Property="TextColor" Value="White" />
        <Setter Property="BackgroundColor" Value="{StaticResource AccentColor}" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="FontFamily" Value="OpenSansRegular" />
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Padding" Value="14,10" />
        <Setter Property="MinimumHeightRequest" Value="44" />
        <Setter Property="MinimumWidthRequest" Value="44" />
    </Style>

    <!-- LABEL DANS UNE CARTE -->
    <Style TargetType="Label" x:Key="CardLabel">
        <Setter Property="TextColor">
            <Setter.Value>
                <AppThemeBinding Light="{StaticResource LightCardText}"
                             Dark="{StaticResource DarkCardText}" />
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>

================================================================================
FILE: LoGeCuiMobile\RootPage.cs
================================================================================

namespace LoGeCuiMobile;

public static class RootPage
{
    public static Page CreateLoginRoot()
        => new NavigationPage(new Pages.LoginPage());

    public static Page CreateAppShellRoot()
        => new AppShell();
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\ArticleLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class ArticleLocal
    {
        [PrimaryKey]
        public int Id { get; set; }   // int

        public string Nom { get; set; } = "";
        public string Quantite { get; set; } = "";
        public string Unite { get; set; } = "";
        public bool EstAchete { get; set; }

        public ArticleLocal() { }

        public ArticleLocal(ArticleCourse a)
        {
            Id = a.Id;                 // int -> int ‚úÖ
            Nom = a.Nom ?? "";
            Quantite = a.Quantite ?? "";
            Unite = a.Unite ?? "";
            EstAchete = a.EstAchete;
        }

        public ArticleCourse ToModel()
        {
            return new ArticleCourse
            {
                Id = Id,              // int -> int ‚úÖ
                Nom = Nom,
                Quantite = Quantite,
                Unite = Unite,
                EstAchete = EstAchete
            };
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\IngredientLocal.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

public class IngredientLocal
{
    [PrimaryKey]
    public Guid Id { get; set; }
    public string Nom { get; set; } = "";
    public string? Quantite { get; set; }
    public string? Unite { get; set; }
    public bool EstDisponible { get; set; }

    public IngredientLocal() { }

    public IngredientLocal(Ingredient i)
    {
        Id = i.Id;
        Nom = i.Nom;
        Quantite = i.Quantite;
        Unite = i.Unite;
        EstDisponible = i.EstDisponible;
    }

    public Ingredient ToModel() => new Ingredient
    {
        Id = Id,
        Nom = Nom,
        Quantite = Quantite,
        Unite = Unite,
        EstDisponible = EstDisponible
    };
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\LocalDatabase.cs
================================================================================

Ôªøusing SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local;

public class LocalDatabase
{
    private readonly SQLiteAsyncConnection _db;

    public LocalDatabase(string path)
    {
        _db = new SQLiteAsyncConnection(path);
        _db.CreateTableAsync<IngredientLocal>().Wait();
        _db.CreateTableAsync<ArticleLocal>().Wait();
        _db.CreateTableAsync<RecetteLocal>().Wait();

    }

    // ---------- INGREDIENTS ----------
    public Task<List<IngredientLocal>> GetIngredientsAsync() =>
        _db.Table<IngredientLocal>().ToListAsync();

    public Task SaveIngredientsAsync(IEnumerable<Ingredient> ingredients)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<IngredientLocal>();
            foreach (var i in ingredients)
                tran.Insert(new IngredientLocal(i));
        });
    }

    // ---------- ARTICLES ----------
    public Task<List<ArticleLocal>> GetArticlesAsync() =>
        _db.Table<ArticleLocal>().ToListAsync();

    public Task SaveArticlesAsync(IEnumerable<ArticleCourse> articles)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<ArticleLocal>();
            foreach (var a in articles)
                tran.Insert(new ArticleLocal(a));
        });
    }

    public Task<List<RecetteLocal>> GetRecettesAsync() =>
    _db.Table<RecetteLocal>().ToListAsync();

    public Task SaveRecettesAsync(IEnumerable<Recette> recettes)
    {
        return _db.RunInTransactionAsync(tran =>
        {
            tran.DeleteAll<RecetteLocal>();
            foreach (var r in recettes)
                tran.Insert(new RecetteLocal(r));
        });
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\Local\RecetteLocal.cs
================================================================================

Ôªøusing System;
using SQLite;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Services.Local
{
    public class RecetteLocal
    {
        [PrimaryKey]
        public string Id { get; set; } = ""; // Guid stock√© en texte

        public string Nom { get; set; } = "";
        public int TempsPreparation { get; set; }
        public string Instructions { get; set; } = "";
        public string CategorieDb { get; set; } = "";
        public int Type { get; set; } // enum -> int

        // ‚úÖ Pour √©viter les doublons √† l‚Äô√©dition (upsert stable)
        public string? ExternalId { get; set; }

        // ‚úÖ utile pour coh√©rence (optionnel)
        public string? OwnerUserId { get; set; }

        // ‚úÖ Photos (sync + cache)
        public string? PhotoUrl { get; set; }
        public string? PhotoLocalPath { get; set; }

        public RecetteLocal() { }

        public RecetteLocal(Recette r)
        {
            Id = r.Id.ToString();

            Nom = r.Nom ?? "";
            TempsPreparation = r.TempsPreparation;
            Instructions = r.Instructions ?? "";
            CategorieDb = r.CategorieDb ?? "";
            Type = (int)r.Type;

            ExternalId = r.ExternalId;
            OwnerUserId = r.OwnerUserId?.ToString();

            PhotoUrl = r.PhotoUrl;
            PhotoLocalPath = r.PhotoLocalPath;
        }

        public Recette ToModel()
        {
            Guid.TryParse(Id, out var guid);

            Guid? owner = null;
            if (!string.IsNullOrWhiteSpace(OwnerUserId) && Guid.TryParse(OwnerUserId, out var ouid))
                owner = ouid;

            return new Recette
            {
                Id = guid,
                Nom = Nom,
                TempsPreparation = TempsPreparation,
                Instructions = Instructions,
                CategorieDb = CategorieDb,
                Type = (TypePlat)Type,

                ExternalId = ExternalId,
                OwnerUserId = owner,

                PhotoUrl = PhotoUrl,
                PhotoLocalPath = PhotoLocalPath
            };
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\OcrService.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text.Json;

namespace LoGeCuiMobile.Services
{
    public sealed class OcrService
    {
        private readonly HttpClient _http;
        private readonly string _apiKey;

        public OcrService(string apiKey)
        {
            _apiKey = apiKey ?? throw new ArgumentNullException(nameof(apiKey));
            _http = new HttpClient { Timeout = TimeSpan.FromSeconds(60) };
        }

        public async Task<string> ExtractTextFromImageAsync(byte[] imageBytes, string fileName = "scan.jpg")
        {
            if (imageBytes is null || imageBytes.Length == 0)
                throw new ArgumentException("Image vide.", nameof(imageBytes));

            if (string.IsNullOrWhiteSpace(_apiKey))
                throw new InvalidOperationException("Cl√© OCR manquante (apiKey).");

            var url = "https://api.ocr.space/parse/image";

            using var content = new MultipartFormDataContent();

            // Param√®tres utiles
            content.Add(new StringContent("fre"), "language");          // fre = fran√ßais
            content.Add(new StringContent("false"), "isOverlayRequired");
            content.Add(new StringContent("2"), "OCREngine");           // 1 ou 2 (2 souvent meilleur)
            content.Add(new StringContent("true"), "scale");
            content.Add(new StringContent("true"), "detectOrientation");

            var fileContent = new ByteArrayContent(imageBytes);
            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("image/jpeg");
            content.Add(fileContent, "file", fileName);

            using var request = new HttpRequestMessage(HttpMethod.Post, url);
            request.Headers.Add("apikey", _apiKey); // ‚úÖ endroit le plus fiable
            request.Content = content;

            using var resp = await _http.SendAsync(request);
            var json = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"OCR HTTP {(int)resp.StatusCode}: {json}");

            using var doc = JsonDocument.Parse(json);

            // Si l‚ÄôAPI retourne une erreur applicative
            if (doc.RootElement.TryGetProperty("IsErroredOnProcessing", out var errored)
                && errored.ValueKind == JsonValueKind.True)
            {
                string msg = "Erreur OCR.";
                if (doc.RootElement.TryGetProperty("ErrorMessage", out var em))
                {
                    // ErrorMessage peut √™tre string ou tableau selon les cas
                    msg = em.ValueKind switch
                    {
                        JsonValueKind.Array => string.Join(" | ", em.EnumerateArray().Select(x => x.ToString())),
                        _ => em.ToString()
                    };
                }
                throw new Exception(msg);
            }

            if (!doc.RootElement.TryGetProperty("ParsedResults", out var parsedResults)
                || parsedResults.ValueKind != JsonValueKind.Array
                || parsedResults.GetArrayLength() == 0)
            {
                return "";
            }

            var first = parsedResults[0];
            if (!first.TryGetProperty("ParsedText", out var parsedTextEl))
                return "";

            return parsedTextEl.GetString() ?? "";
        }
    }
}



================================================================================
FILE: LoGeCuiMobile\Services\Skiasharp.cs
================================================================================

Ôªøusing SkiaSharp;

namespace LoGeCuiMobile.Services
{
    public static class ImageCompressionHelper
    {
        public static byte[] CompressJpeg(
            byte[] input,
            int maxWidth = 1600,
            int jpegQuality = 75)
        {
            using var inputStream = new SKMemoryStream(input);
            using var codec = SKCodec.Create(inputStream);
            using var bitmap = SKBitmap.Decode(codec);

            if (bitmap == null)
                throw new InvalidOperationException("Impossible de d√©coder l'image.");

            var width = bitmap.Width;
            var height = bitmap.Height;

            if (width > maxWidth)
            {
                var ratio = (float)maxWidth / width;
                var newW = maxWidth;
                var newH = (int)(height * ratio);

                using var resized = bitmap.Resize(
                    new SKImageInfo(newW, newH),
                    SKFilterQuality.Medium);

                using var image = SKImage.FromBitmap(resized);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
            else
            {
                using var image = SKImage.FromBitmap(bitmap);
                using var data = image.Encode(
                    SKEncodedImageFormat.Jpeg,
                    jpegQuality);

                return data.ToArray();
            }
        }
    }
}


================================================================================
FILE: LoGeCuiMobile\Services\SupabaseConfig.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public static class SupabaseConfig
    {
        public static string Url { get; } = ConfigurationHelper.GetSupabaseUrl();
        public static string Key { get; } = ConfigurationHelper.GetSupabaseKey();
    }
}

================================================================================
FILE: LoGeCuiMobile\Services\SupabaseStorageService.cs
================================================================================

Ôªøusing System;
using System.IO;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Threading.Tasks;
using LoGeCuiShared.Services;

namespace LoGeCuiMobile.Services
{
    public class SupabaseStorageService
    {
        private readonly string _supabaseUrl;
        private readonly string _supabaseKey;
        private const string Bucket = "recipe-photos";

        // ‚úÖ r√©utiliser HttpClient (√©vite sockets leak)
        private static readonly HttpClient _http = new HttpClient
        {
            Timeout = TimeSpan.FromSeconds(60)
        };

        public SupabaseStorageService()
        {
            _supabaseUrl = ConfigurationHelper.GetSupabaseUrl().TrimEnd('/');
            _supabaseKey = ConfigurationHelper.GetSupabaseKey();
        }

        /// <summary>
        /// Upload une photo dans Supabase Storage et retourne l'URL publique.
        /// Bucket = recipe-photos (public).
        /// </summary>
        public async Task<string> UploadRecipePhotoAndGetPublicUrlAsync(
            string accessToken,
            Guid userId,
            Guid recetteId,
            string localPath)
        {
            if (string.IsNullOrWhiteSpace(accessToken))
                throw new InvalidOperationException("Token manquant. Reconnecte-toi.");

            if (!File.Exists(localPath))
                throw new FileNotFoundException("Photo introuvable", localPath);

            var ext = Path.GetExtension(localPath);
            if (string.IsNullOrWhiteSpace(ext)) ext = ".jpg";

            // Range tes fichiers par user -> plus simple pour les policies
            var objectPath = $"{userId}/recipes/{recetteId}/{DateTime.UtcNow:yyyyMMdd_HHmmss}{ext}";

            var uploadUrl = $"{_supabaseUrl}/storage/v1/object/{Bucket}/{objectPath}";
            var publicUrl = $"{_supabaseUrl}/storage/v1/object/public/{Bucket}/{objectPath}";

            await using var stream = File.OpenRead(localPath);

            using var req = new HttpRequestMessage(HttpMethod.Put, uploadUrl);
            req.Headers.Add("apikey", _supabaseKey);
            req.Headers.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);

            // Permet d'√©craser si le fichier existe d√©j√† (selon comportement Storage)
            req.Headers.Add("x-upsert", "true");

            req.Content = new StreamContent(stream);
            req.Content.Headers.ContentType = new MediaTypeHeaderValue(GetMimeType(ext));

            using var res = await _http.SendAsync(req);
            var body = await res.Content.ReadAsStringAsync();

            if (!res.IsSuccessStatusCode)
                throw new Exception($"Upload Storage failed ({(int)res.StatusCode}): {body}");

            return publicUrl;
        }

        private static string GetMimeType(string ext)
        {
            ext = (ext ?? "").ToLowerInvariant();
            return ext switch
            {
                ".png" => "image/png",
                ".webp" => "image/webp",
                _ => "image/jpeg"
            };
        }
    }
}

================================================================================
FILE: LoGeCuiMobile\ViewModels\ArticleCourseUi.cs
================================================================================

Ôªøusing System.ComponentModel;
using System.Runtime.CompilerServices;
using LoGeCuiShared.Models;

namespace LoGeCuiMobile.Models
{
    // Wrapper UI: on conserve ArticleCourse et on ajoute une s√©lection locale (non persist√©e)
    public class ArticleCourseUi : INotifyPropertyChanged
    {
        public ArticleCourseUi(ArticleCourse model) => Model = model;

        public ArticleCourse Model { get; }

        public int Id => Model.Id;

        public string Nom
        {
            get => Model.Nom;
            set { if (Model.Nom != value) { Model.Nom = value; OnPropertyChanged(); } }
        }

        public string Quantite
        {
            get => Model.Quantite;
            set { if (Model.Quantite != value) { Model.Quantite = value; OnPropertyChanged(); } }
        }

        public string Unite
        {
            get => Model.Unite;
            set { if (Model.Unite != value) { Model.Unite = value; OnPropertyChanged(); } }
        }

        public bool EstAchete
        {
            get => Model.EstAchete;
            set { if (Model.EstAchete != value) { Model.EstAchete = value; OnPropertyChanged(); } }
        }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set { if (_isSelectedForDelete != value) { _isSelectedForDelete = value; OnPropertyChanged(); } }
        }

        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}


================================================================================
FILE: LoGeCuiMobile\ViewModels\MesRecettesViewModel.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Input;
using LoGeCuiShared.Models;
using LoGeCuiShared.Services;
using LoGeCuiShared.Utils;
using Microsoft.Maui.Controls;
using Microsoft.Maui.Networking;

namespace LoGeCuiMobile.ViewModels
{
    public enum AvailabilityState
    {
        Unknown,
        AllAvailable,
        Missing
    }

    // ‚úÖ UI wrapper
    public class RecetteUi : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        public Recette Model { get; }

        private bool _isSelectedForDelete;
        public bool IsSelectedForDelete
        {
            get => _isSelectedForDelete;
            set
            {
                if (_isSelectedForDelete == value) return;
                _isSelectedForDelete = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(IsSelectedForDelete)));
            }
        }

        private AvailabilityState _availabilityState = AvailabilityState.Unknown;
        public AvailabilityState AvailabilityState
        {
            get => _availabilityState;
            set
            {
                if (_availabilityState == value) return;
                _availabilityState = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityState)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        private int _missingCount;
        public int MissingCount
        {
            get => _missingCount;
            set
            {
                if (_missingCount == value) return;
                _missingCount = value;
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(MissingCount)));
                PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(AvailabilityLabel)));
            }
        }

        public string AvailabilityLabel =>
            AvailabilityState == AvailabilityState.Unknown ? "Disponibilit√© inconnue"
            : AvailabilityState == AvailabilityState.AllAvailable ? "‚úÖ Tous ingr√©dients disponibles"
            : $"‚ùå Manque {MissingCount} ingr√©dient(s)";

        public Guid Id => Model.Id;
        public string Nom => Model.Nom;
        public string TypeTexte => Model.TypeTexte;
        public int TempsPreparation => Model.TempsPreparation;
        public string DifficulteTexte => Model.DifficulteTexte;

        // ‚úÖ Image pour la liste (local > url + cache busting optionnel)
        public ImageSource? PhotoSource
        {
            get
            {
                try
                {
                    if (!string.IsNullOrWhiteSpace(Model.PhotoLocalPath) && File.Exists(Model.PhotoLocalPath))
                        return ImageSource.FromFile(Model.PhotoLocalPath);

                    if (!string.IsNullOrWhiteSpace(Model.PhotoUrl))
                        return ImageSource.FromUri(new Uri(Model.PhotoUrl));

                    return null;
                }
                catch
                {
                    return null;
                }
            }
        }

        public void NotifyPhotoChanged()
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(PhotoSource)));

        public RecetteUi(Recette r) => Model = r;
    }

    public class MesRecettesViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;
        private void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));

        private readonly RecipesService _recipesService;

        public ObservableCollection<RecetteUi> Recettes { get; } = new();

        public ObservableCollection<string> Categories { get; } =
            new() { "Toutes", "Entr√©es", "Plats", "Desserts" };

        private string _selectedCategorie = "Toutes";
        public string SelectedCategorie
        {
            get => _selectedCategorie;
            set
            {
                if (_selectedCategorie == value) return;
                _selectedCategorie = value;
                OnPropertyChanged(nameof(SelectedCategorie));
                ApplyFilter();
            }
        }

        public ICommand RefreshCommand { get; }

        private bool _isBusy;
        public bool IsBusy
        {
            get => _isBusy;
            private set
            {
                if (_isBusy == value) return;
                _isBusy = value;
                OnPropertyChanged(nameof(IsBusy));
            }
        }

        private List<Recette> _all = new();

        public MesRecettesViewModel(RecipesService recipesService)
        {
            _recipesService = recipesService;
            RefreshCommand = new Command(async () => await LoadAsync(forceRemote: true));
        }

        private static bool IsJwtExpired(Exception ex)
            => ex.ToString().Contains("JWT expired", StringComparison.OrdinalIgnoreCase);

        private static bool IsNetworkRelated(Exception ex)
        {
            var msg = ex.ToString();
            return msg.Contains("HttpRequestException", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timed out", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("timeout", StringComparison.OrdinalIgnoreCase)
                || msg.Contains("network", StringComparison.OrdinalIgnoreCase);
        }

        // ‚úÖ Normalisation unique partout (safe)
        private static string Norm(string? s)
        {
            var n = IngredientNormalizer.Normalize(s);
            return string.IsNullOrWhiteSpace(n) ? "" : n;
        }

        public async Task LoadAsync(bool forceRemote = false)
        {
            if (IsBusy) return;

            try
            {
                IsBusy = true;

                // 0) Cache local d'abord
                var local = await App.LocalDb.GetRecettesAsync();
                _all = local.Select(x => x.ToModel()).ToList();

                // 1) Remote si internet + connect√©
                if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet)
                {
                    var app = (App)Application.Current;

                    if (app.IsConnected && app.CurrentUserId != null)
                    {
                        try
                        {
                            var remote = await _recipesService.GetRecettesAsync(app.CurrentUserId.Value)
                                         ?? new List<Recette>();

                            // Ne pas √©craser le cache par vide si pas force
                            if (forceRemote || remote.Count > 0)
                            {
                                _all = remote;
                                await App.LocalDb.SaveRecettesAsync(remote);
                            }
                        }
                        catch (Exception ex)
                        {
                            if (!(IsJwtExpired(ex) || IsNetworkRelated(ex)))
                                throw;
                        }
                    }
                }

                ApplyFilter();
            }
            finally
            {
                IsBusy = false;
            }
        }

        private void ApplyFilter()
        {
            IEnumerable<Recette> filtered = _all;

            if (SelectedCategorie == "Entr√©es")
                filtered = _all.Where(r => r.Type == TypePlat.Entree);
            else if (SelectedCategorie == "Plats")
                filtered = _all.Where(r => r.Type == TypePlat.Plat);
            else if (SelectedCategorie == "Desserts")
                filtered = _all.Where(r => r.Type == TypePlat.Dessert);

            Recettes.Clear();
            foreach (var r in filtered)
                Recettes.Add(new RecetteUi(r));
        }

        public async Task RefreshAvailabilityAsync()
        {
            var app = (App)Application.Current;

            // Offline => Unknown
            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
            {
                foreach (var r in Recettes)
                {
                    r.AvailabilityState = AvailabilityState.Unknown;
                    r.MissingCount = 0;
                }
                return;
            }

            try
            {
                var userId = app.CurrentUserId.Value;

                // ‚úÖ ingr√©dients utilisateur disponibles
                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                foreach (var r in Recettes)
                {
                    var rows = await app.RecetteIngredientsService.GetForRecetteAsync(r.Model.Id);

                    var recipeNames = rows
                        .Select(x => Norm(x.nom))
                        .Where(s => !string.IsNullOrWhiteSpace(s))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    if (recipeNames.Count == 0)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                        continue;
                    }

                    var missing = recipeNames
                        .Where(n => !userSet.Contains(n))
                        .Distinct(StringComparer.OrdinalIgnoreCase)
                        .ToList();

                    r.MissingCount = missing.Count;
                    r.AvailabilityState = (missing.Count == 0)
                        ? AvailabilityState.AllAvailable
                        : AvailabilityState.Missing;
                }
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                {
                    foreach (var r in Recettes)
                    {
                        r.AvailabilityState = AvailabilityState.Unknown;
                        r.MissingCount = 0;
                    }
                    return;
                }

                throw;
            }
        }

        public async Task<List<string>?> GetMissingIngredientsForRecipeAsync(Recette recette)
        {
            var app = (App)Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return null;

            if (!app.IsConnected || app.CurrentUserId == null || app.IngredientsService == null || app.RecetteIngredientsService == null)
                return null;

            try
            {
                var userId = app.CurrentUserId.Value;

                var userIngredients = await app.IngredientsService.GetIngredientsAsync(userId) ?? new List<Ingredient>();
                var userSet = userIngredients
                    .Where(i => i.EstDisponible)
                    .Select(i => Norm(i.Nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .ToHashSet(StringComparer.OrdinalIgnoreCase);

                var rows = await app.RecetteIngredientsService.GetForRecetteAsync(recette.Id);

                var recipeNames = rows
                    .Select(x => Norm(x.nom))
                    .Where(s => !string.IsNullOrWhiteSpace(s))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                if (recipeNames.Count == 0)
                    return new List<string>(); // pas null => "aucun ingr√©dient renseign√©"

                var missing = recipeNames
                    .Where(n => !userSet.Contains(n))
                    .Distinct(StringComparer.OrdinalIgnoreCase)
                    .ToList();

                return missing;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return null;

                throw;
            }
        }

        public async Task<bool> SendMissingToShoppingAsync(List<string> missing)
        {
            var app = (App)Application.Current;

            if (Connectivity.Current.NetworkAccess != NetworkAccess.Internet)
                return false;

            if (!app.IsConnected || app.CurrentUserId == null || app.ListeCoursesSupabaseService == null)
                return false;

            try
            {
                await app.ListeCoursesSupabaseService.AddMissingAsync(app.CurrentUserId.Value, missing);
                return true;
            }
            catch (Exception ex)
            {
                if (IsJwtExpired(ex) || IsNetworkRelated(ex))
                    return false;

                throw;
            }
        }

        public async Task DeleteSelectedAsync(List<RecetteUi> selected)
        {
            var app = (App)Application.Current;

            // Optimistic UI
            foreach (var r in selected.ToList())
                Recettes.Remove(r);

            if (Connectivity.Current.NetworkAccess == NetworkAccess.Internet && app.IsConnected && app.RecipesService != null)
            {
                try
                {
                    foreach (var r in selected)
                        await app.RecipesService.DeleteRecetteAsync(r.Model.Id);
                }
                catch (Exception ex)
                {
                    if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                        throw;
                }
            }

            await LoadAsync(forceRemote: true);

            try
            {
                await RefreshAvailabilityAsync();
            }
            catch (Exception ex)
            {
                if (!IsJwtExpired(ex) && !IsNetworkRelated(ex))
                    throw;
            }
        }

        public Task DeleteOneAsync(RecetteUi one)
            => DeleteSelectedAsync(new List<RecetteUi> { one });
    }
}

================================================================================
FILE: LoGeCuiShared\LoGeCuiShared.csproj
================================================================================

Ôªø<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Supabase" Version="1.1.1" />
    <PackageReference Include="Supabase.Core" Version="1.0.0" />
    <PackageReference Include="Supabase.Postgrest" Version="4.1.0" />
  </ItemGroup>

</Project>

================================================================================
FILE: LoGeCuiShared\Models\ArticleCourse.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.Text.Json.Serialization;
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace LoGeCuiShared.Models
{
    public class ArticleCourse : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler? PropertyChanged;

        private int _id;
        private Guid _userId;
        private string _nom = "";
        private string _quantite = "";
        private string _unite = "";
        private bool _estAchete;

        [JsonPropertyName("id")]
        public int Id
        {
            get => _id;
            set { _id = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("user_id")]
        public Guid UserId
        {
            get => _userId;
            set { _userId = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("nom")]
        public string Nom
        {
            get => _nom;
            set { _nom = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("quantite")]
        public string Quantite
        {
            get => _quantite;
            set { _quantite = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("unite")]
        public string Unite
        {
            get => _unite;
            set { _unite = value; OnPropertyChanged(); }
        }

        [JsonPropertyName("est_achete")]
        public bool EstAchete
        {
            get => _estAchete;
            set { _estAchete = value; OnPropertyChanged(); }
        }

        private void OnPropertyChanged([CallerMemberName] string? name = null)
            => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}

================================================================================
FILE: LoGeCuiShared\Models\Ingredient.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiShared.Models
{
    public class Ingredient
    {
        public bool EstFavori { get; set; }

        public Guid Id { get; set; }          // id (uuid) dans Supabase
        public Guid? UserId { get; set; }     // user_id (uuid) dans Supabase
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }
        public bool EstDisponible { get; set; }

        public Ingredient()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
            EstDisponible = true;
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Models\IngredientRecette.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiShared.Models
{
    public class IngredientRecette
    {
        public string Nom { get; set; }
        public string Quantite { get; set; }
        public string Unite { get; set; }

        public IngredientRecette()
        {
            Nom = "";
            Quantite = "";
            Unite = "";
        }

        public override string ToString()
        {
            return $"{Nom} - {Quantite} {Unite}";
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Models\MenuJournalier.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;

namespace LoGeCuiShared.Models
{
    public class MenuJournalier
    {
        public DateTime Date { get; set; }
        public Recette? Entree { get; set; }
        public Recette? Plat { get; set; }
        public Recette? Dessert { get; set; }
        public List<IngredientRecette> IngredientsManquants { get; set; }

        public MenuJournalier()
        {
            Date = DateTime.Now;
            IngredientsManquants = new List<IngredientRecette>();
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Models\Recette.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text.Json.Serialization;

namespace LoGeCuiShared.Models
{
    public enum TypePlat
    {
        Entree,
        Plat,
        Dessert
    }

    public class Recette
    {
        // ----------------------------
        // Champs DB / JSON (Supabase)
        // ----------------------------

        [JsonPropertyName("id")]
        public Guid Id { get; set; }

        [JsonPropertyName("created_at")]
        public DateTimeOffset CreatedAt { get; set; }

        [JsonPropertyName("owner_user_id")]
        public Guid? OwnerUserId { get; set; }

        [JsonPropertyName("external_id")]
        public string? ExternalId { get; set; }

        [JsonPropertyName("nom")]
        public string Nom { get; set; } = "";

        [JsonPropertyName("categorie")]
        public string CategorieDb
        {
            get => Type switch
            {
                TypePlat.Entree => "Entree",
                TypePlat.Plat => "Plat",
                TypePlat.Dessert => "Dessert",
                _ => "Plat"
            };
            set
            {
                Type = value switch
                {
                    "Entree" => TypePlat.Entree,
                    "Plat" => TypePlat.Plat,
                    "Dessert" => TypePlat.Dessert,
                    _ => TypePlat.Plat
                };
            }
        }

        // Colonne DB: temps_minutes
        [JsonPropertyName("temps_minutes")]
        public int TempsMinutesDb
        {
            get => TempsPreparation;
            set => TempsPreparation = value;
        }

        // Colonne DB: note (1..5)
        [JsonPropertyName("note")]
        public int? NoteDb
        {
            get => Difficulte;
            set => Difficulte = Math.Clamp(value ?? 1, 1, 5);
        }

        [JsonPropertyName("is_favorite")]
        public bool IsFavorite { get; set; }

        [JsonPropertyName("instructions")]
        public string InstructionsDb
        {
            get => Instructions;
            set => Instructions = value ?? "";
        }

        // ‚úÖ Photo synchronis√©e (DB Supabase: photo_url)
        [JsonPropertyName("photo_url")]
        public string? PhotoUrl { get; set; }

        // ‚úÖ Photo locale (cache sur l'appareil) - NON envoy√©e √† Supabase
        [JsonIgnore]
        public string? PhotoLocalPath { get; set; }

        // ----------------------------
        // Propri√©t√©s m√©tier (non DB)
        // ----------------------------

        [JsonIgnore]
        public TypePlat Type { get; set; } = TypePlat.Plat;

        [JsonIgnore]
        public int TempsPreparation { get; set; } = 0;

        [JsonIgnore]
        public int Difficulte { get; set; } = 1;

        [JsonIgnore]
        public List<IngredientRecette> Ingredients { get; set; } = new();

        [JsonIgnore]
        public string Instructions { get; set; } = "";

        [JsonIgnore]
        public string TypeTexte => Type switch
        {
            TypePlat.Entree => "Entr√©e",
            TypePlat.Plat => "Plat",
            TypePlat.Dessert => "Dessert",
            _ => "Inconnu"
        };

        [JsonIgnore]
        public string DifficulteTexte => new string('‚≠ê', Math.Clamp(Difficulte, 1, 5));
    }
}

================================================================================
FILE: LoGeCuiShared\Services\ConfigurationHelper.cs
================================================================================

Ôªøusing System;

namespace LoGeCuiShared.Services
{
    public static class ConfigurationHelper
    {
        private static Func<string, string?>? _get;

        // Appel√© 1 fois au d√©marrage par le projet MAUI
        public static void Configure(Func<string, string?> getValue)
        {
            _get = getValue ?? throw new ArgumentNullException(nameof(getValue));
        }

        private static string Get(string key)
        {
            if (_get == null)
                throw new InvalidOperationException("ConfigurationHelper n'est pas configur√©. Appelez ConfigurationHelper.Configure(...) au d√©marrage.");

            return _get(key) ?? throw new InvalidOperationException($"Cl√© manquante : {key}");
        }

        // Versions s√ªres qui renvoient null si la cl√© est absente (pour permettre un d√©marrage sans crash)
        public static string? GetSupabaseUrlSafe() => _get?.Invoke("Supabase:Url");
        public static string? GetSupabaseKeySafe() => _get?.Invoke("Supabase:AnonKey");
        public static string? GetOcrApiKeySafe() => _get?.Invoke("OCR:ApiKey");

        // Les anciennes m√©thodes conservent le comportement strict (throw) ‚Äî vous pouvez les remplacer par les versions Safe si n√©cessaire.
        public static string GetSupabaseUrl() => Get("Supabase:Url");
        public static string GetSupabaseKey() => Get("Supabase:AnonKey");
        public static string GetOcrApiKey() => Get("OCR:ApiKey");
    }
}



================================================================================
FILE: LoGeCuiShared\Services\IngredientsService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Threading.Tasks;
using LoGeCuiShared.Models;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class IngredientsService
    {
        private readonly SupabaseRestClient _client;
        private const string Table = "ingredients";

        public IngredientsService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        public async Task<List<Ingredient>> GetIngredientsAsync(Guid userId)
        {
            var q =
                $"{Table}?" +
                "select=id,user_id,nom,quantite,unite,est_disponible,est_favori,created_at" +
                $"&user_id=eq.{userId}" +
                "&order=created_at.desc";

            return await _client.GetAsync<List<Ingredient>>(q) ?? new List<Ingredient>();
        }

        public async Task<Ingredient?> CreateIngredientAsync(Guid userId, Ingredient i)
        {
            var payload = new
            {
                user_id = userId,
                nom = i.Nom,
                quantite = string.IsNullOrWhiteSpace(i.Quantite) ? null : i.Quantite,
                unite = string.IsNullOrWhiteSpace(i.Unite) ? null : i.Unite,
                est_disponible = i.EstDisponible,
                est_favori = i.EstFavori
            };

            var created = await _client.PostAsync<List<Ingredient>>(
                $"{Table}?select=id,user_id,nom,quantite,unite,est_disponible,est_favori,created_at",
                payload,
                returnRepresentation: true);

            return created?.Count > 0 ? created[0] : null;
        }


        public async Task UpdateDisponibiliteAsync(Guid ingredientId, bool estDisponible)
        {
            var payload = new { est_disponible = estDisponible };
            await _client.PatchAsync($"{Table}?id=eq.{ingredientId}", payload);
        }

        public async Task DeleteIngredientAsync(Guid ingredientId)
        {
            await _client.DeleteAsync($"{Table}?id=eq.{ingredientId}");
        }

        public async Task UpdateFavoriAsync(Guid ingredientId, bool estFavori)
        {
            var payload = new { est_favori = estFavori };
            await _client.PatchAsync($"{Table}?id=eq.{ingredientId}", payload);
        }

    }
}



================================================================================
FILE: LoGeCuiShared\Services\ListeCoursesService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Text;
using System.IO;
using System.Text.Json;
using LoGeCuiShared.Models;

namespace LoGeCuiShared.Services
{
    public class ListeCoursesService
    {
        private readonly string _cheminFichier;

        public ListeCoursesService(string cheminFichier)
        {
            _cheminFichier = cheminFichier;
        }

        public List<ArticleCourse> ChargerListeCourses()
        {
            try
            {
                if (!File.Exists(_cheminFichier))
                {
                    return new List<ArticleCourse>();
                }

                string json = File.ReadAllText(_cheminFichier);
                var liste = JsonSerializer.Deserialize<List<ArticleCourse>>(json);
                return liste ?? new List<ArticleCourse>();
            }
            catch (Exception)
            {
                return new List<ArticleCourse>();
            }
        }

        public void SauvegarderListeCourses(List<ArticleCourse> articles)
        {
            try
            {
                var options = new JsonSerializerOptions { WriteIndented = true };
                string json = JsonSerializer.Serialize(articles, options);

                // Cr√©er le dossier si n√©cessaire
                var dossier = Path.GetDirectoryName(_cheminFichier);
                if (!string.IsNullOrEmpty(dossier) && !Directory.Exists(dossier))
                {
                    Directory.CreateDirectory(dossier);
                }

                File.WriteAllText(_cheminFichier, json);
            }
            catch (Exception)
            {
                throw;
            }
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\ListeCoursesSupabaseService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class ListeCoursesSupabaseService
    {
        private readonly SupabaseRestClient _client;
        private const string Table = "articles_courses";

        public ListeCoursesSupabaseService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        private static bool IsShared(Guid? listId) => listId.HasValue && listId.Value != Guid.Empty;

        // =========================
        // GET
        // =========================
        public async Task<List<ArticleCourseRow>> GetArticlesAsync(Guid userId, Guid? listId = null)
        {
            var q = IsShared(listId)
                ? $"{Table}?select=id,created_at,nom,quantite,unite,est_achete,user_id,list_id" +
                  $"&list_id=eq.{listId!.Value}" +
                  "&order=created_at.desc"
                : $"{Table}?select=id,created_at,nom,quantite,unite,est_achete,user_id,list_id" +
                  $"&user_id=eq.{userId}" +
                  "&order=created_at.desc";

            return await _client.GetAsync<List<ArticleCourseRow>>(q) ?? new List<ArticleCourseRow>();
        }

        // =========================
        // INSERT
        // ‚úÖ IMPORTANT: on envoie user_id explicitement => √©vite 403 RLS
        // =========================
        public async Task<ArticleCourseRow?> AddArticleAsync(Guid userId, string nom, string? quantite, string? unite, Guid? listId = null)
        {
            if (string.IsNullOrWhiteSpace(nom))
                throw new ArgumentException("nom requis", nameof(nom));

            if (listId == null || listId == Guid.Empty)
                throw new InvalidOperationException("Aucune liste active (list_id requis).");

            var payloadRow = new
            {
                user_id = userId,
                list_id = listId.Value,
                nom = nom.Trim(),
                quantite = quantite,
                unite = unite,
                est_achete = false
            };

            var created = await _client.PostAsync<List<ArticleCourseRow>>(
                $"{Table}?select=id,created_at,nom,quantite,unite,est_achete,user_id,list_id",
                new[] { payloadRow },
                returnRepresentation: true);

            return created?.FirstOrDefault();
        }


        // =========================
        // UPDATE (PATCH)
        // =========================
        public async Task UpdateArticleAsync(long id, bool estAchete)
        {
            var q = $"{Table}?id=eq.{id}";
            var payload = new { est_achete = estAchete };
            await _client.PatchAsync(q, payload);
        }

        // =========================
        // DELETE
        // =========================
        public async Task DeleteArticleAsync(long id)
        {
            await _client.DeleteAsync($"{Table}?id=eq.{id}");
        }

        // =========================
        // ADD MISSING (batch)
        // ‚úÖ Envoie user_id + list_id si partag√©
        // =========================
        public async Task AddMissingAsync(Guid userId, IEnumerable<string> missingNames, Guid? listId = null)
        {
            if (listId == null || listId == Guid.Empty)
                throw new InvalidOperationException("Aucune liste active (list_id requis).");

            var names = (missingNames ?? Enumerable.Empty<string>())
                .Where(n => !string.IsNullOrWhiteSpace(n))
                .Select(n => n.Trim())
                .Distinct(StringComparer.OrdinalIgnoreCase)
                .ToList();

            if (names.Count == 0)
                return;

            bool shared = IsShared(listId);

            // 1) Lire ce qui existe d√©j√† (non achet√©)
            string existingQuery = shared
                ? $"{Table}?select=nom&list_id=eq.{listId!.Value}&est_achete=eq.false"
                : $"{Table}?select=nom&user_id=eq.{userId}&est_achete=eq.false";

            var existingRows = await _client.GetAsync<List<NomRow>>(existingQuery) ?? new List<NomRow>();

            var existing = existingRows
                .Where(r => !string.IsNullOrWhiteSpace(r.nom))
                .Select(r => r.nom!.Trim())
                .ToHashSet(StringComparer.OrdinalIgnoreCase);

            // 2) Construire payload
            var payload = new List<object>();

            foreach (var n in names)
            {
                if (existing.Contains(n))
                    continue;

                if (shared)
                {
                    payload.Add(new
                    {
                        user_id = userId,
                        list_id = listId!.Value,
                        nom = n,
                        quantite = (string?)null,
                        unite = (string?)null,
                        est_achete = false
                    });
                }
                else
                {
                    payload.Add(new
                    {
                        user_id = userId,
                        nom = n,
                        quantite = (string?)null,
                        unite = (string?)null,
                        est_achete = false
                    });
                }
            }

            if (payload.Count == 0)
                return;

            await _client.PostAsync<object>(
                Table,
                payload.ToArray(),
                returnRepresentation: false);
        }

        // =========================
        // RPC: join shared list
        // =========================
        public async Task<(Guid listId, string name, string code)?> JoinByCodeAsync(string shareCode)
        {
            if (string.IsNullOrWhiteSpace(shareCode))
                return null;

            var payload = new { p_share_code = shareCode.Trim() };

            var result = await _client.PostAsync<List<JoinResult>>(
                "rpc/join_shopping_list",
                payload,
                returnRepresentation: true);

            var row = result?.FirstOrDefault();
            if (row == null)
                return null;

            return (row.list_id, row.name ?? "Liste partag√©e", row.share_code ?? shareCode.Trim());
        }

        // =========================
        // DTOs
        // =========================
        private sealed class NomRow
        {
            public string? nom { get; set; }
        }

        private sealed class JoinResult
        {
            public Guid list_id { get; set; }
            public string? name { get; set; }
            public string? share_code { get; set; }
        }

        public sealed class ArticleCourseRow
        {
            public long id { get; set; }
            public DateTimeOffset created_at { get; set; }
            public string? nom { get; set; }
            public string? quantite { get; set; }
            public string? unite { get; set; }
            public bool est_achete { get; set; }
            public Guid user_id { get; set; }
            public Guid? list_id { get; set; }
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\RecetteIngredientsService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class RecetteIngredientsService
    {
        private readonly SupabaseRestClient _client;
        private const string Table = "recette_ingredients";

        public RecetteIngredientsService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        // DTO conforme au sch√©ma DB
        private sealed class Row
        {
            public string? ingredient_nom { get; set; }
            public string? quantite { get; set; }
            public string? unite { get; set; }
        }

        public async Task<List<(string nom, string? quantite, string? unite)>> GetForRecetteAsync(Guid recetteId)
        {
            var q = $"{Table}?select=ingredient_nom,quantite,unite&recette_id=eq.{recetteId}&order=created_at.asc";
            var rows = await _client.GetAsync<List<Row>>(q) ?? new List<Row>();

            return rows
                .Where(r => !string.IsNullOrWhiteSpace(r.ingredient_nom))
                .Select(r => (r.ingredient_nom!.Trim(), r.quantite, r.unite))
                .ToList();
        }

        // Remplace la liste compl√®te (simple et robuste)
        public async Task ReplaceForRecetteAsync(Guid recetteId, IEnumerable<(string nom, string? quantite, string? unite)> items)
        {
            // 1) delete
            await _client.DeleteAsync($"{Table}?recette_id=eq.{recetteId}");

            // 2) insert
            var payload = items
                .Where(i => !string.IsNullOrWhiteSpace(i.nom))
                .Select(i => new
                {
                    recette_id = recetteId,
                    ingredient_nom = i.nom.Trim(),
                    quantite = string.IsNullOrWhiteSpace(i.quantite) ? null : i.quantite.Trim(),
                    unite = string.IsNullOrWhiteSpace(i.unite) ? null : i.unite.Trim()
                })
                .ToArray();

            if (payload.Length == 0)
                return;

            await _client.PostAsync<object>(Table, payload, returnRepresentation: false);
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\RecipesService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using LoGeCuiShared.Models;

namespace LoGeCuiShared.Services
{
    public sealed class RecipesService
    {
        private readonly SupabaseRestClient _client;

        public RecipesService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        // ‚úÖ Toujours s√©lectionner ces colonnes (sinon: pas de photo + pas d'external_id)
        private const string SelectCols =
            "id,created_at,owner_user_id,nom,categorie,temps_minutes,note,is_favorite,instructions,external_id,photo_url";

        /// <summary>
        /// R√©cup√®re TOUTES les recettes de l‚Äôutilisateur courant
        /// </summary>
        public async Task<List<Recette>> GetRecettesAsync(Guid userId)
        {
            var q =
                "recettes?" +
                $"select={SelectCols}" +
                $"&owner_user_id=eq.{userId}" +
                "&order=created_at.desc";

            return await _client.GetAsync<List<Recette>>(q)
                   ?? new List<Recette>();
        }

        /// <summary>
        /// R√©cup√®re les recettes (optionnellement filtr√©es par cat√©gorie)
        /// </summary>
        public async Task<List<Recette>> GetMyRecettesAsync(Guid userId, string? categorie = null)
        {
            var q =
                "recettes?" +
                $"select={SelectCols}" +
                $"&owner_user_id=eq.{userId}" +
                "&order=created_at.desc";

            if (!string.IsNullOrWhiteSpace(categorie) &&
                !string.Equals(categorie, "Toutes", StringComparison.OrdinalIgnoreCase))
            {
                q += $"&categorie=eq.{Uri.EscapeDataString(categorie)}";
            }

            return await _client.GetAsync<List<Recette>>(q)
                   ?? new List<Recette>();
        }

        /// <summary>
        /// Cr√©e une recette et retourne la recette cr√©√©e
        /// </summary>
        public async Task<Recette?> CreateRecetteAsync(Guid ownerUserId, Recette r)
        {
            if (r == null) throw new ArgumentNullException(nameof(r));

            // ‚úÖ external_id obligatoire pour √©viter les futurs doublons
            if (string.IsNullOrWhiteSpace(r.ExternalId))
                r.ExternalId = Guid.NewGuid().ToString("N");

            var payload = new
            {
                owner_user_id = ownerUserId,
                external_id = r.ExternalId,
                nom = r.Nom,
                categorie = r.CategorieDb,
                temps_minutes = r.TempsMinutesDb,
                note = r.NoteDb,
                is_favorite = r.IsFavorite,
                instructions = r.InstructionsDb,
                photo_url = r.PhotoUrl
            };

            var created = await _client.PostAsync<List<Recette>>(
                $"recettes?select={SelectCols}",
                payload,
                returnRepresentation: true);

            return created?.FirstOrDefault();
        }

        /// <summary>
        /// Supprime une recette
        /// </summary>
        public async Task DeleteRecetteAsync(Guid recetteId)
        {
            await _client.DeleteAsync($"recettes?id=eq.{recetteId}");
        }

        /// <summary>
        /// Insert ou met √† jour une recette via (owner_user_id, external_id)
        /// ‚úÖ √©vite les doublons si external_id n'est pas unique globalement
        /// </summary>
        public async Task UpsertRecetteAsync(Guid ownerUserId, Recette r)
        {
            if (r == null) throw new ArgumentNullException(nameof(r));

            if (string.IsNullOrWhiteSpace(r.ExternalId))
                throw new ArgumentException("ExternalId est requis pour upsert.", nameof(r));

            var payload = new[]
            {
                new
                {
                    owner_user_id = ownerUserId,
                    external_id = r.ExternalId,
                    nom = r.Nom,
                    categorie = r.CategorieDb,
                    temps_minutes = r.TempsMinutesDb,
                    note = r.NoteDb,
                    is_favorite = r.IsFavorite,
                    instructions = r.InstructionsDb,
                    photo_url = r.PhotoUrl
                }
            };

            // ‚úÖ IMPORTANT :
            // n√©cessite une contrainte unique sur (owner_user_id, external_id) c√¥t√© DB.
            await _client.PostAsync<object>(
                "recettes?on_conflict=owner_user_id,external_id",
                payload,
                returnRepresentation: false,
                mergeDuplicates: true);
        }

        public async Task<Guid?> GetRecetteIdByExternalIdAsync(Guid userId, string externalId)
        {
            if (string.IsNullOrWhiteSpace(externalId))
                throw new ArgumentException("externalId requis", nameof(externalId));

            var q =
                "recettes?" +
                "select=id" +
                $"&owner_user_id=eq.{userId}" +
                $"&external_id=eq.{Uri.EscapeDataString(externalId)}" +
                "&limit=1";

            var rows = await _client.GetAsync<List<RecetteIdRow>>(q);

            return rows?.FirstOrDefault()?.id;
        }

        private sealed class RecetteIdRow
        {
            public Guid id { get; set; }
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\ShoppingListBootstrapService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace LoGeCuiShared.Services
{
    public sealed class ShoppingListBootstrapService
    {
        private readonly SupabaseRestClient _client;

        public ShoppingListBootstrapService(SupabaseRestClient client)
        {
            _client = client ?? throw new ArgumentNullException(nameof(client));
        }

        private sealed class Row
        {
            public Guid list_id { get; set; }
        }

        public async Task<Guid?> GetFirstListIdForUserAsync(Guid userId)
        {
            var q =
                "shopping_list_members?select=list_id" +
                $"&user_id=eq.{userId}" +
                "&limit=1";

            var rows = await _client.GetAsync<List<Row>>(q);
            return rows?.FirstOrDefault()?.list_id;
        }
    }
}


================================================================================
FILE: LoGeCuiShared\Services\ShoppingListsService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Supabase;

namespace LoGeCuiShared.Services
{
    public sealed class ShoppingListsService
    {
        private readonly SupabaseRestClient _client;

        public ShoppingListsService(SupabaseRestClient client)
        {
            _client = client;
        }

        private sealed class ShoppingListRow
        {
            public Guid id { get; set; }
            public Guid owner_user_id { get; set; }
            public string? name { get; set; }
            public string? share_code { get; set; }
        }

        public async Task<Guid> EnsurePersonalListIdAsync(Guid userId)
        {
            // 1) Chercher une liste existante
            var q = "shopping_lists?select=id,owner_user_id,name,share_code" +
                    $"&owner_user_id=eq.{userId}" +
                    "&order=created_at.asc&limit=1";

            var existing = await _client.GetAsync<List<ShoppingListRow>>(q);
            var row = existing?.FirstOrDefault();
            if (row != null)
                return row.id;

            // 2) Sinon cr√©er une liste perso
            var payload = new[]
            {
                new
                {
                    owner_user_id = userId,
                    name = "Ma liste"
                    // share_code g√©n√©r√© automatiquement par le trigger SQL
                }
            };

            var created = await _client.PostAsync<List<ShoppingListRow>>(
                "shopping_lists?select=id,owner_user_id,name,share_code",
                payload,
                returnRepresentation: true);

            return created!.First().id;
        }
    }
}

================================================================================
FILE: LoGeCuiShared\Services\SupabaseRestClient.cs
================================================================================

Ôªøusing System.Net.Http.Headers;
using System.Text;
using System.Text.Json;

namespace LoGeCuiShared.Services
{
    public sealed class SupabaseRestClient
    {
        private readonly HttpClient _http;
        private readonly string _baseRestUrl;

        public SupabaseRestClient(string supabaseUrl, string supabaseAnonKey)
        {
            if (string.IsNullOrWhiteSpace(supabaseUrl)) throw new ArgumentException("supabaseUrl is required");
            if (string.IsNullOrWhiteSpace(supabaseAnonKey)) throw new ArgumentException("supabaseAnonKey is required");

            _baseRestUrl = supabaseUrl.TrimEnd('/') + "/rest/v1/";

            _http = new HttpClient();
            _http.DefaultRequestHeaders.Add("apikey", supabaseAnonKey);
            _http.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
        }

        public void SetBearerToken(string accessToken)
        {
            _http.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);
        }

        public async Task<T?> GetAsync<T>(string pathAndQuery)
        {
            var url = _baseRestUrl + pathAndQuery;

            using var resp = await _http.GetAsync(url);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase GET failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");

            return JsonSerializer.Deserialize<T>(body, JsonOptions());
        }

        public async Task<T?> PostAsync<T>(string pathAndQuery, object payload, bool returnRepresentation = false)
        {
            var url = _baseRestUrl + pathAndQuery;
            var json = JsonSerializer.Serialize(payload, JsonOptions());

            using var req = new HttpRequestMessage(HttpMethod.Post, url)
            {
                Content = new StringContent(json, Encoding.UTF8, "application/json")
            };

            if (returnRepresentation)
                req.Headers.Add("Prefer", "return=representation");

            using var resp = await _http.SendAsync(req);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase POST failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");

            if (string.IsNullOrWhiteSpace(body))
                return default;

            return JsonSerializer.Deserialize<T>(body, JsonOptions());
        }

        public async Task PatchAsync(string pathAndQuery, object payload)
        {
            var url = _baseRestUrl + pathAndQuery;
            var json = JsonSerializer.Serialize(payload, JsonOptions());

            using var req = new HttpRequestMessage(new HttpMethod("PATCH"), url)
            {
                Content = new StringContent(json, Encoding.UTF8, "application/json")
            };

            using var resp = await _http.SendAsync(req);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase PATCH failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");
        }

        public async Task DeleteAsync(string pathAndQuery)
        {
            var url = _baseRestUrl + pathAndQuery;

            using var resp = await _http.DeleteAsync(url);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase DELETE failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");
        }

        private static JsonSerializerOptions JsonOptions() => new()
        {
            PropertyNameCaseInsensitive = true
        };

        public async Task<T?> PostAsync<T>(
        string pathAndQuery,
        object payload,
        bool returnRepresentation = false,
        bool mergeDuplicates = false)
        {
            var url = _baseRestUrl + pathAndQuery;
            var json = JsonSerializer.Serialize(payload, JsonOptions());

            using var req = new HttpRequestMessage(HttpMethod.Post, url)
            {
                Content = new StringContent(json, Encoding.UTF8, "application/json")
            };

            // PostgREST Prefer headers
            if (returnRepresentation)
                req.Headers.Add("Prefer", "return=representation");

            if (mergeDuplicates)
                req.Headers.Add("Prefer", "resolution=merge-duplicates");

            using var resp = await _http.SendAsync(req);
            var body = await resp.Content.ReadAsStringAsync();

            if (!resp.IsSuccessStatusCode)
                throw new Exception($"Supabase POST failed: {(int)resp.StatusCode} {resp.ReasonPhrase}\n{body}");

            if (string.IsNullOrWhiteSpace(body))
                return default;

            return JsonSerializer.Deserialize<T>(body, JsonOptions());
        }

    }
}


================================================================================
FILE: LoGeCuiShared\Services\SupabaseService.cs
================================================================================

Ôªøusing System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Net.Http.Json;
using System.Text.Json;
using System.Threading.Tasks;
using LoGeCuiShared.Models;
using Supabase.Postgrest;
using Supabase.Postgrest.Attributes;
using Supabase.Postgrest.Models;
using System.Net.Http.Headers;


namespace LoGeCuiShared.Services
{
    public class SupabaseService
    {
        private readonly HttpClient _httpClient;
        private readonly string _supabaseUrl;
        private readonly string _supabaseKey;

        // Session courante (apr√®s login)
        private string? _accessToken;    // JWT utilisateur
        private string? _currentUserId;  // GUID string

        private readonly Client _client;

        public SupabaseService(string url, string key)
        {
            _supabaseUrl = url ?? throw new ArgumentNullException(nameof(url));
            _supabaseKey = key ?? throw new ArgumentNullException(nameof(key));

            _httpClient = new HttpClient { Timeout = TimeSpan.FromSeconds(30) };

            var options = new ClientOptions
            {
                Headers = new Dictionary<string, string>
                {
                    { "apikey", key },
                    // Tant qu'on n'est pas connect√©, on reste en "anon"
                    { "Authorization", $"Bearer {key}" }
                }
            };

            _client = new Client($"{url}/rest/v1", options);
        }

        // =========================
        // SESSION
        // =========================

        public void SetSession(string accessToken, string userId)
        {
            if (string.IsNullOrWhiteSpace(accessToken))
                throw new ArgumentException("accessToken manquant", nameof(accessToken));

            if (string.IsNullOrWhiteSpace(userId))
                throw new ArgumentException("userId manquant", nameof(userId));

            _accessToken = accessToken;
            _currentUserId = userId;

            // IMPORTANT: PostgREST doit utiliser le JWT utilisateur pour RLS
            _client.Options.Headers["Authorization"] = $"Bearer {_accessToken}";
        }

        public void ClearSession()
        {
            _accessToken = null;
            _currentUserId = null;

            // Retour "anon"
            _client.Options.Headers["Authorization"] = $"Bearer {_supabaseKey}";
        }

        public string? GetCurrentUserId() => _currentUserId;

        private Guid RequireCurrentUserGuid()
        {
            if (string.IsNullOrWhiteSpace(_currentUserId))
                throw new InvalidOperationException("Utilisateur non connect√©. Veuillez vous reconnecter.");

            if (!Guid.TryParse(_currentUserId, out var guid))
                throw new InvalidOperationException("Identifiant utilisateur invalide. Veuillez vous reconnecter.");

            return guid;
        }

        private void RequireAccessToken()
        {
            if (string.IsNullOrWhiteSpace(_accessToken))
                throw new InvalidOperationException("Session invalide. Veuillez vous reconnecter.");
        }

        // =========================
        // AUTH REST
        // =========================

        public async Task<(bool success, string? userId, string? error)> SignUpAsync(string email, string password)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
                    return (false, null, "Adresse email invalide");

                if (string.IsNullOrWhiteSpace(password) || password.Length < 6)
                    return (false, null, "Le mot de passe doit contenir au moins 6 caract√®res");

                var request = new { email = email.Trim(), password };

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);
                _httpClient.DefaultRequestHeaders.Authorization =
                    new AuthenticationHeaderValue("Bearer", _supabaseKey);

                var response = await _httpClient.PostAsJsonAsync($"{_supabaseUrl}/auth/v1/signup", request);
                var content = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                    return (false, null, ExtractSupabaseError(content, response.StatusCode));

                // Supabase renvoie souvent { user: { id: ... } }, parfois { id: ... }
                try
                {
                    var json = JsonDocument.Parse(content);

                    if (json.RootElement.TryGetProperty("user", out var userEl) &&
                        userEl.TryGetProperty("id", out var uidEl))
                    {
                        var uid = uidEl.GetString();
                        if (!string.IsNullOrWhiteSpace(uid))
                            return (true, uid, null);
                    }

                    if (json.RootElement.TryGetProperty("id", out var idEl))
                    {
                        var uid = idEl.GetString();
                        if (!string.IsNullOrWhiteSpace(uid))
                            return (true, uid, null);
                    }

                    return (true, "unknown", null);
                }
                catch
                {
                    return (true, "unknown", null);
                }
            }
            catch (HttpRequestException)
            {
                return (false, null, "Erreur de connexion au serveur. V√©rifiez votre connexion internet.");
            }
            catch (TaskCanceledException)
            {
                return (false, null, "La requ√™te a expir√©. V√©rifiez votre connexion internet.");
            }
            catch (Exception ex)
            {
                return (false, null, $"Erreur inattendue : {ex.Message}");
            }
        }

        public async Task<(bool success, string? accessToken, string? userId, string? error)> SignInAsync(string email, string password)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
                    return (false, null, null, "Adresse email invalide");

                if (string.IsNullOrWhiteSpace(password))
                    return (false, null, null, "Le mot de passe est requis");

                var request = new { email = email.Trim(), password };

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);

                var response = await _httpClient.PostAsJsonAsync(
                    $"{_supabaseUrl}/auth/v1/token?grant_type=password",
                    request);

                var content = await response.Content.ReadAsStringAsync();

                if (!response.IsSuccessStatusCode)
                    return (false, null, null, ExtractSupabaseError(content, response.StatusCode));

                var json = JsonDocument.Parse(content);

                var token = json.RootElement.GetProperty("access_token").GetString();
                var userId = json.RootElement.GetProperty("user").GetProperty("id").GetString();

                if (string.IsNullOrWhiteSpace(token) || string.IsNullOrWhiteSpace(userId))
                    return (false, null, null, "R√©ponse Supabase invalide (token/userId manquant).");

                SetSession(token, userId);
                return (true, token, userId, null);
            }
            catch (HttpRequestException)
            {
                return (false, null, null, "Erreur de connexion au serveur. V√©rifiez votre connexion internet.");
            }
            catch (TaskCanceledException)
            {
                return (false, null, null, "La requ√™te a expir√©. V√©rifiez votre connexion internet.");
            }
            catch (Exception ex)
            {
                return (false, null, null, $"Erreur inattendue : {ex.Message}");
            }
        }

        public async Task<(bool success, string? accessToken, string? userId, string? error)>
            SignUpThenSignInAsync(string email, string password)
        {
            var (signUpSuccess, _, signUpError) = await SignUpAsync(email, password);
            if (!signUpSuccess)
                return (false, null, null, signUpError);

            var (signInSuccess, accessToken, userId, signInError) = await SignInAsync(email, password);
            if (!signInSuccess)
                return (false, null, null, signInError);

            return (true, accessToken, userId, null);
        }

        public async Task<(bool success, string? error)> SendPasswordResetAsync(string email)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
                    return (false, "Adresse email invalide");

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);

                var request = new
                {
                    email = email.Trim(),
                    redirect_to = "https://logecui.fr/logecui-reset-password/index.html"
                };

                var response = await _httpClient.PostAsJsonAsync($"{_supabaseUrl}/auth/v1/recover", request);
                var content = await response.Content.ReadAsStringAsync();

                return response.IsSuccessStatusCode
                    ? (true, null)
                    : (false, ExtractSupabaseError(content, response.StatusCode));
            }
            catch
            {
                return (false, "Erreur r√©seau. R√©essayez plus tard.");
            }
        }

        public async Task<(bool success, string? error)> UpdatePasswordAsync(string accessToken, string newPassword)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(newPassword) || newPassword.Length < 6)
                    return (false, "Le mot de passe doit contenir au moins 6 caract√®res.");

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add("apikey", _supabaseKey);
                _httpClient.DefaultRequestHeaders.Add("Authorization", $"Bearer {accessToken}");

                var response = await _httpClient.PutAsJsonAsync(
                    $"{_supabaseUrl}/auth/v1/user",
                    new { password = newPassword });

                var content = await response.Content.ReadAsStringAsync();

                return response.IsSuccessStatusCode
                    ? (true, null)
                    : (false, ExtractSupabaseError(content, response.StatusCode));
            }
            catch
            {
                return (false, "Erreur r√©seau.");
            }
        }

        // =========================
        // EDGE FUNCTION : DELETE ACCOUNT
        // =========================

        public async Task<(bool success, string? error)> DeleteAccountAsync()
        {
            try
            {
                RequireAccessToken();

                System.Diagnostics.Debug.WriteLine("=== DELETE ACCOUNT DEBUG ===");
                System.Diagnostics.Debug.WriteLine($"Token: {_accessToken?.Substring(0, 30)}");

                // ‚úÖ IMPORTANT : Cr√©er une nouvelle requ√™te √† chaque fois
                using var request = new HttpRequestMessage(HttpMethod.Post,
                    $"{_supabaseUrl}/functions/v1/delete-account");

                // ‚úÖ Ajouter les headers dans le bon ordre
                request.Headers.TryAddWithoutValidation("apikey", _supabaseKey);
                request.Headers.TryAddWithoutValidation("Authorization", $"Bearer {_accessToken}");

                System.Diagnostics.Debug.WriteLine($"Headers added: {request.Headers.Count()}");

                var response = await _httpClient.SendAsync(request);
                var content = await response.Content.ReadAsStringAsync();

                System.Diagnostics.Debug.WriteLine($"Response: {(int)response.StatusCode} - {content}");

                if (!response.IsSuccessStatusCode)
                {
                    return (false, $"Erreur : {content}");
                }

                // Nettoyage local
                var userGuid = RequireCurrentUserGuid();
                await _client.Table<ArticleCourseDb>()
                    .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                    .Delete();

                await _client.Table<IngredientDb>()
                    .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                    .Delete();

                ClearSession();
                return (true, null);
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Exception: {ex.Message}");
                return (false, $"Erreur : {ex.Message}");
            }
        }



        // =========================
        // ARTICLES (Liste de courses)
        // =========================

        public async Task<List<ArticleCourse>> GetArticlesAsync()
        {
            var userGuid = RequireCurrentUserGuid();

            var response = await _client
                .Table<ArticleCourseDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Get();

            return response.Models.Select(db => new ArticleCourse
            {
                Id = db.Id,
                Nom = db.Nom ?? "",
                Quantite = db.Quantite ?? "",
                Unite = db.Unite ?? "",
                EstAchete = db.EstAchete,
                // IMPORTANT: si ton mod√®le ArticleCourse.UserId est Guid (non nullable),
                // on prot√®ge avec ?? Guid.Empty
                UserId = db.UserId ?? Guid.Empty
            }).ToList();
        }

        public async Task<ArticleCourse?> AddArticleAsync(ArticleCourse article)
        {
            var userGuid = RequireCurrentUserGuid();

            var dbArticle = new ArticleCourseDb
            {
                Nom = article.Nom,
                Quantite = article.Quantite,
                Unite = article.Unite,
                EstAchete = article.EstAchete,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            var response = await _client.Table<ArticleCourseDb>().Insert(dbArticle);
            var inserted = response.Models.FirstOrDefault();
            if (inserted == null) return null;

            return new ArticleCourse
            {
                Id = inserted.Id,
                Nom = inserted.Nom ?? "",
                Quantite = inserted.Quantite ?? "",
                Unite = inserted.Unite ?? "",
                EstAchete = inserted.EstAchete,
                UserId = inserted.UserId ?? Guid.Empty
            };
        }

        public async Task<bool> UpdateArticleAsync(int id, ArticleCourse article)
        {
            var userGuid = RequireCurrentUserGuid();

            var dbArticle = new ArticleCourseDb
            {
                Id = id,
                Nom = article.Nom,
                Quantite = article.Quantite,
                Unite = article.Unite,
                EstAchete = article.EstAchete,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            await _client.Table<ArticleCourseDb>().Update(dbArticle);
            return true;
        }

        public async Task<bool> DeleteArticleAsync(int id)
        {
            var userGuid = RequireCurrentUserGuid();

            // S√©curise par user_id (sinon RLS peut bloquer ou pire, toucher autre chose si policy permissive)
            await _client.Table<ArticleCourseDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Filter("id", Supabase.Postgrest.Constants.Operator.Equals, id)
                .Delete();

            return true;
        }

        public async Task<bool> DeleteAchetesAsync()
        {
            var userGuid = RequireCurrentUserGuid();

            await _client.Table<ArticleCourseDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Filter("est_achete", Supabase.Postgrest.Constants.Operator.Equals, true)
                .Delete();

            return true;
        }

        // =========================
        // INGREDIENTS
        // =========================

        public async Task<List<Ingredient>> GetIngredientsAsync()
        {
            var userGuid = RequireCurrentUserGuid();

            var response = await _client
                .Table<IngredientDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Get();

            return response.Models.Select(db => new Ingredient
            {
                Id = db.Id,
                // Si Ingredient.UserId est Guid (non nullable), on prot√®ge :
                UserId = db.UserId ?? Guid.Empty,
                Nom = db.Nom ?? "",
                Quantite = db.Quantite ?? "",
                Unite = db.Unite ?? "",
                EstDisponible = db.EstDisponible
            }).ToList();
        }

        public async Task<Ingredient?> AddIngredientAsync(Ingredient ingredient)
        {
            var userGuid = RequireCurrentUserGuid();

            var db = new IngredientDb
            {
                Nom = ingredient.Nom,
                Quantite = ingredient.Quantite,
                Unite = ingredient.Unite,
                EstDisponible = ingredient.EstDisponible,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            var response = await _client.Table<IngredientDb>().Insert(db);
            var inserted = response.Models.FirstOrDefault();
            if (inserted == null) return null;

            return new Ingredient
            {
                Id = inserted.Id,
                UserId = inserted.UserId ?? Guid.Empty,
                Nom = inserted.Nom ?? "",
                Quantite = inserted.Quantite ?? "",
                Unite = inserted.Unite ?? "",
                EstDisponible = inserted.EstDisponible
            };
        }

        public async Task<bool> UpdateIngredientAsync(Ingredient ingredient)
        {
            var userGuid = RequireCurrentUserGuid();

            if (ingredient.Id == Guid.Empty)
                throw new InvalidOperationException("Id ingr√©dient manquant.");

            var db = new IngredientDb
            {
                Id = ingredient.Id,
                Nom = ingredient.Nom,
                Quantite = ingredient.Quantite,
                Unite = ingredient.Unite,
                EstDisponible = ingredient.EstDisponible,
                UserId = (Guid?)userGuid // ‚úÖ Guid -> Guid?
            };

            await _client.Table<IngredientDb>().Update(db);
            return true;
        }

        public async Task<bool> DeleteIngredientAsync(Guid id)
        {
            var userGuid = RequireCurrentUserGuid();

            if (id == Guid.Empty)
                throw new InvalidOperationException("Id ingr√©dient manquant.");

            await _client.Table<IngredientDb>()
                .Filter("user_id", Supabase.Postgrest.Constants.Operator.Equals, userGuid.ToString())
                .Filter("id", Supabase.Postgrest.Constants.Operator.Equals, id.ToString())
                .Delete();

            return true;
        }

        // =========================
        // UTIL
        // =========================

        private static string ExtractSupabaseError(string content, System.Net.HttpStatusCode code)
        {
            if (!string.IsNullOrWhiteSpace(content))
            {
                try
                {
                    var json = JsonDocument.Parse(content);

                    if (json.RootElement.TryGetProperty("msg", out var msg)) return msg.GetString() ?? $"Erreur {code}";
                    if (json.RootElement.TryGetProperty("error_description", out var ed)) return ed.GetString() ?? $"Erreur {code}";
                    if (json.RootElement.TryGetProperty("message", out var m)) return m.GetString() ?? $"Erreur {code}";
                    if (json.RootElement.TryGetProperty("error", out var e)) return e.GetString() ?? $"Erreur {code}";
                }
                catch
                {
                    if (content.Length < 400) return content;
                }
            }

            return $"Erreur {code}";
        }
    }

    // =========================
    // MODELES DB
    // =========================

    [Table("articles_courses")]
    public class ArticleCourseDb : BaseModel
    {
        [PrimaryKey("id", false)]
        public int Id { get; set; }

        [Column("nom")]
        public string? Nom { get; set; }

        [Column("quantite")]
        public string? Quantite { get; set; }

        [Column("unite")]
        public string? Unite { get; set; }

        [Column("est_achete")]
        public bool EstAchete { get; set; }

        [Column("user_id")]
        public Guid? UserId { get; set; } // DB nullable -> mapping prot√®ge avec ?? Guid.Empty
    }

    [Table("ingredients")]
    public class IngredientDb : BaseModel
    {
        [PrimaryKey("id", false)]
        public Guid Id { get; set; }

        [Column("nom")]
        public string? Nom { get; set; }

        [Column("quantite")]
        public string? Quantite { get; set; }

        [Column("unite")]
        public string? Unite { get; set; }

        [Column("est_disponible")]
        public bool EstDisponible { get; set; }

        [Column("user_id")]
        public Guid? UserId { get; set; } // DB nullable -> mapping prot√®ge avec ?? Guid.Empty
    }
}



================================================================================
FILE: supabase\functions\delete-account\Supabase.json
================================================================================

{
  "verify_jwt": false
}
